!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("BulbEditor",[],t):"object"==typeof exports?exports.BulbEditor=t():e.BulbEditor=t()}(window,function(){return function(e){function t(t){for(var o,s,a=t[0],l=t[1],c=t[2],d=0,h=[];d<a.length;d++)s=a[d],i[s]&&h.push(i[s][0]),i[s]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);for(u&&u(t);h.length;)h.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],o=!0,a=1;a<n.length;a++){var l=n[a];0!==i[l]&&(o=!1)}o&&(r.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},i={0:0},r=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="./bulbeditor/";var a=window.webpackJsonpBulbEditor=window.webpackJsonpBulbEditor||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var u=l;return r.push([179,1]),n()}([,function(e,t,n){(function(o){var i;void 0===(i=function(e){for(var t,o=n(110),i=this&&this.DEBUG?this:window,r=i.DEBUG||null!=i.logLevel,s=i.console,a={},l=function(){},c="log warn error time timeEnd profile profileEnd".split(" "),u=c.length;--u>=0;)t=c[u],r&&s[t]?a[t]=s[t].bind(s):a[t]=l;return r&&i.alert?a.debugAlert=function(e){i.alert(e)}:a.debugAlert=a.error,a.log=function(){o.log("Log: ",Array.from(arguments),"white","#CCCCCC")},a.warn=function(){o.warn(Array.from(arguments))},a.error=function(){o.error(Array.from(arguments))},a.DEBUG=r,a}.call(t,n,t,e))||(e.exports=i)}).call(this,n(75))},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";return function(){function e(){}return e.getAllBlockTypes=function(){return[e.ATTACHMENT,e.BLOCK,e.CATALOGUE,e.HANDWRITE,e.HEADING,e.HR,e.IMAGE,e.LIST_ITEM,e.PARAGRAPH,e.TABLE,e.TODO,e.QUOTE,e.CODE,e.UNKNOWN]},e.getType=function(e){if(e)return e.getType()},e.isParagraph=function(t){return e.getType(t)===e.PARAGRAPH},e.isParagraphCluster=function(t){return this.isParagraphClusterType(e.getType(t))},e.isParagraphClusterType=function(t){return t===e.PARAGRAPH||t===e.LIST_ITEM||t===e.HEADING||t===e.CATALOGUE||t===e.TODO||t===e.QUOTE||t===e.CODE},e.isListItem=function(t){return e.getType(t)===e.LIST_ITEM},e.isAttachment=function(t){return e.getType(t)===e.ATTACHMENT},e.isHeaderFooter=function(e){return this.getType(e)===this.HEADER_FOOTER},e.isTable=function(t){return e.getType(t)===e.TABLE},e.isImage=function(t){return e.getType(t)===e.IMAGE},e.isHr=function(t){return e.getType(t)===e.HR},e.isUnknown=function(t){return this.getType(t)===e.UNKNOWN},e.isHeading=function(t){return e.getType(t)===e.HEADING},e.isCatalogue=function(t){return e.getType(t)===e.CATALOGUE},e.isTodo=function(t){return e.getType(t)===e.TODO},e.isQuote=function(t){return e.getType(t)===e.QUOTE},e.isCode=function(t){return e.getType(t)===e.CODE},e.isTextBlock=function(t,n){return(!n||!n.selectWholeBlock)&&e.isParagraphCluster(t)},e.isTextOrTableBlock=function(t){return e.isTextBlock(t)||e.isTable(t)},e.isHandWrite=function(t){return e.getType(t)===e.HANDWRITE},e.ATTACHMENT="attachment",e.BLOCK="block",e.CATALOGUE="catalogue",e.HANDWRITE="handwrite",e.HEADER_FOOTER="header-footer",e.HEADING="heading",e.HR="horizontal-line",e.IMAGE="image",e.LIST_ITEM="list-item",e.PARAGRAPH="paragraph",e.QUOTE="quote",e.TABLE="table",e.TODO="todo",e.CODE="code",e.UNKNOWN="unknown",e}()}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";return function(){function e(){}return e.isCollabCommand=function(e){var t=!1;return null!=e&&null!=e.collabProperties&&(t=e.collabProperties.isCollabCmd),t},e.isGUID=function(e){return!!e&&/^[\w\-]+$/.test(e)},e.isInlineStateSetCommand=function(e){return null!=e.isInlineStateSet&&!0===e.isInlineStateSet()},e.newGUID=function(){var e="";return e+=(Math.floor(100*Math.random())+"00").substr(0,2),e+=(Math.floor(100*Math.random())+"00").substr(0,2),e+="-",e+=Date.now().toString()},e}()}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(1),o=n(0);return{_map:{},add:function(e){var n=e.prototype.name,o=this._map;n?o[n]?t.error("Command class ["+n+"] exists!"):o[n]=e:t.error("The Command class has no name!",e)},get:function(e){var n=this._map[e];return n||t.error("Command class ["+e+"] does not exist!"),n},getAllNames:function(){return o.keys(this._map)}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(17),o=n(1),i=n(0),r=n(165),s={_keyHandlerMap:{},_parseKey:function(e){return e=(e=(e+="").replace(/[\s\uFEFF\xA0]/g,"")).toLowerCase()},_makeMapKey:function(e,t){return(e=e||"main")+"-"+t},getHandler:function(e,t){return this._keyHandlerMap[this._makeMapKey(e,t)]},register:function(e){if(e&&e.name&&e.key&&e.action){var t,n,r,s=this._keyHandlerMap;(n=i.defaults({},e,{scope:"main",read:!1,preventDefault:!0})).key=t=this._parseKey(e.key),t?s[r=this._makeMapKey(n.scope,n.name)]||i.some(s,function(e){return e.key===t&&e.scope===n.scope})?o.error("The key handler is conflict with other",n):s[r]=n:o.warn("The key is not valid!",e)}else o.warn("The param is not valid!",e)},exec:function(e,t,n,i){var r=this._makeMapKey(e,t),s=this._keyHandlerMap[r];s?n.isReadOnly&&n.isReadOnly()&&!s.read?i&&i.preventDefault&&i.preventDefault():(s.preventDefault&&i&&i.preventDefault&&i.preventDefault(),this.disableExec(s,n,i,t)||s.action.apply(s,[n,i,t])):o.warn("No key handler for scope/name: ",e,t)},disableExec:function(e,t,n,o){var i,s,a,l,c,u=r.ACTION_HIDE,d=r.ACTION_DISABLE;return!!t.getNoteRange&&(i=t.getNoteRange().getStartBlockRange().block.getType().toUpperCase(),s=o.replace("insert",""),a=r["RANGE_"+i],l=r.EDITOR_BUTTON_STATE_MAP[s.toLowerCase()],!!(s&&a&&l)&&((c=l.find(function(e){return e.on===a}))&&(c.action===u||c.action===d)))},matchKey:function(e,t){if(t){var n,r=this._keyHandlerMap;if(n=i.find(r,function(n){return n.key===t&&n.scope===e}))return n.name;o.warn("Can not find the key handler with key: "+t)}},getAllHandlerNamesOfScope:function(e){var t=[];return i.each(this._keyHandlerMap,function(n){n.scope===e&&t.push(n.name)}),t}};return t.extend({initialize:function(e){e=i.defaults(e||{},{scope:"main"}),this._scope=e.scope,this._customMap={},delete this.options},getKey:function(e){return(this._customMap[e]||s.getHandler(this._scope,e)||{}).key},bind:function(e){var t=this.getKey(e);t&&this.trigger("bind-key",t)},unbind:function(e){var t=this.getKey(e);t&&this.trigger("unbind-key",t)},updateKey:function(e,t){if(e&&t){s.getHandler(this._scope,e)&&(this.unbind(e),this._customMap[e]={key:t},this.bind(e))}},hasHandler:function(e){return!!s.getHandler(this._scope,e)},execWithKey:function(e,t,n){var r;i.some(this._customMap,function(t,n){if(t.key===e)return r=n,!0}),r||(r=s.matchKey(this._scope,e)),r?s.exec(this._scope,r,t,n):o.warn("no handler for scope/key ",this._scope,e)},execWithName:function(e,t,n){s.exec(this._scope,e,t,n)},getAvailableHandlerNames:function(){return s.getAllHandlerNamesOfScope(this._scope)}},{register:function(e){s.register(e)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";return{COMPAT:"compat",DEFAULT_BACKGROUND:"NoBackground",INTERM:"interm",INDENT_WIDTH:28,MAX_LIST_ITEM_LEVEL:9,LINE_BREAK:/Windows/.test(window.navigator.userAgent)?"\r\n":"\n",IS_MAC:/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),QUOTE_PADDING:"0 10px 0 17px",QUOTE_BORDER_LEFT:"3px solid #e8e8e8",QUOTE_MARGIN:"0 5px",PLATFORM_LINE_HEIGHT:1.75,PAGE_TYPE_A4:"A4",PAGE_TYPE_B5:"B5",PAGE_TYPE_NONE:"NONE",PAGE_TYPE_TEST:"TEST",PAGE_HEIGHT_A4:1123,PAGE_HEIGHT_B5:945,PAGE_HEIGHT_NONE:Number.MAX_VALUE,PAGE_HEIGHT_TEST:100,PAGE_WIDTH_A4:792,PAGE_WIDTH_B5:663,PAGE_WIDTH_NONE:Number.MAX_VALUE,PAGE_WIDTH_TEST:792,PAGE_SPLIT_BLANK_HEIGHT:70,PAGE_SPLIT_MIDDLE_HEIGHT:10,TOLERABLE_HEIGHT_CHANGE:3,PAGE_CLASS_A4:"page-A4",PAGE_CLASS_B5:"page-B5",PAGE_CLASS_TEST:"page-TEST",WSClientStatusCode:{Connecting:0,Open:1,Closing:2,Closed:3,Ready:5,Disabled:10,Intializing:11},WSEVENTID_HOST_CLOSE:4500,MAX_MESSAGE_SIZE:5e3,MAX_UNDO_STACK_SIZE:20,MAX_CMD_DELAY_MILLIS:4e3,MAX_INIT_DELAY_MILLIS:2e3,MAX_LOCAL_CMD_COUNT_PER_SEC:20,REGULAR_CMD_SENT_MILLIS:2e3,LATENCY_TO_SHOW_SET_CONTENT_PROGRESS:2e3,CJSON_ACTION:"action",CJSON_COMMANDID:"cmdId",CJSON_COMMANDOWNER:"cmdOwner",CJSON_COLLABCOMMANDS:"collabCmds",CJSON_COLLAB_NOTE_READY:"collabNoteReady",CJSON_COLLAB_VERSION:"collabVersion",CJSON_DATA_CMD_ERROR:"dataCmdError",CJSON_ENDVERSION:"endVersion",CJSON_ERROR_TO_CLOSE:"errToClose",CJSON_FINALVERSION:"finalVersion",CJSON_INITIALIZE_COLLABSTARTED:"collabStarted",CJSON_INITIALIZE_DONE:"done",CJSON_INITIALIZE_RESULT:"initResult",CJSON_IS_HISTORY_SAVE:"isHistorySave",CJSON_IS_SERVER_CMD:"isServerCmd",CJSON_LOCKCOLOR:"lockColor",CJSON_LOCK_BLOCK_ID:"lockedBlkId",CJSON_MODIFIERS:"modifiers",CJSON_NICKNAME:"nickname",CJSON_NONDATACOMMANDS:"nondataCmds",CJSON_NOTEVERSIONUPDATE:"versionUpdate",CJSON_PORTRAIT:"portraitUrl",CJSON_READONLY:"readOnly",CJSON_SESSIONID:"sessionId",CJSON_SESSIONPROPERTY:"sessionProp",CJSON_STARTVERSION:"startVersion",NONDATACMD_BLOCKSELECTION:"nb_BlkSelection",NONDATACMD_CLINTPONG:"nb_clientPong",NONDATACMD_COLLABCLOSE:"nb_CollabClose",NONDATACMD_COLLABINFO:"nb_CollabInfo",NONDATACMD_DATACMDFAILED:"nb_dataCmdFailed",NONDATACMD_GETMODIFIERS:"nb_getModifiers",NONDATACMD_NOTESAVE:"nb_noteSave",NONDATACMD_LOCKRELEASE:"nb_lockRelease",NONDATACMD_SESSIONINITIALIZED:"nb_sessionInitialized",NONDATACMD_SEVERPING:"nb_serverPing",OPTIONS_COLLABID:"collabId",OPTIONS_NICKNAME:"nickname",OPTIONS_NOTEVERSION:"noteVersion",OPTIONS_PORTRAIT:"portraitUrl",OPTIONS_SESSIONTYPE:"sessionType",OPTIONS_SESSIONID:"sessionId",OPTIONS_USERID:"userId",OPTIONS_BUILDVERSION:"buildVersion",OPTIONS_RECONNECT:"reconn",ERRORID_FAILED_RECEIVE_COLLAB_CMD:4001,ERRORID_FAILED_SEND_LOCAL_CMD:4002,ERRORID_COLLAB_ENGINE_NULL:4003,CONNECTION_FAILED_SEND:"发送协同命令失败：",CONNECTION_NO_CONNECTED:"当前没有与协同服务器连接",CONNECTION_REFUSED:"协同服务器连接被拒绝",CONNECTION_SERVER_CLOSED:"协同服务器已经关闭",ERROR_CODE:"错误编码：",ERROR_CONFLICT_EXECUTION:"编辑区域冲突",ERROR_FAILED_SEND_LOCAL_CMD:"发送本地已执行命令失败",ERROR_FAILED_RECEIVE_COLLAB_CMD:"接收协同命令超时",ERROR_EXCEPTION:"未知错误：",ERROR_REASON:"原因：",ERROR_UNMATCHED_VERSION:"本地笔记版本与服务器端不匹配，本地/服务器：",INVALIDACTION_BLANK_NOTE:"笔记还没有加载",INVALIDACTION_BLOCKS_DIRTY:"目标段落已经被人修改过",INVALIDACTION_COLLAB_NOT_READY:"笔记内容不满足协同的要求",INVALIDACTION_EDIT_READ_ONLY:"只读模式下不可以编辑",INVALIDACTION_EDIT_NOT_READY:"笔记还没有进入编辑状态，如果此状态持续数秒，请刷新页面",INVALIDACTION_FINALVERSION_NOTREADY:"被撤销命令正在同步中，请稍后再试",INVALIDACTION_EMPTY_CMDJSON:"空协同操作指令，将被忽略",INVALIDACTION_EMPTY_LOCALCMD:"空本地操作指令，将被忽略",INVALIDACTION_INVALID_LOCALCMD:"无效的本地命令",INVALIDACTION_FAILED_COLLABCMD:"协同命令执行失败",INVALIDACTION_FAILED_LOCALCMD:"本地命令执行失败",INVALIDACTION_INVALID_CMD_VERSION:"被撤销命令版本无效，丢弃此命令",INVALIDACTION_INVALID_RANGE:"命令所操作区域已经被删除或者无效",INVALIDACTION_TOO_MANY_CMD:"命令操作过快，请稍候，等待处理命令个数：",INVALIDACTION_TOO_LARGE_MESSAGE:"操作所含数据过多，请减少操作数据：",INVALIDACTION_UNSUPPORTED_CMD:"不支持的操作指令：",INVALIDACTION_WORK_ON_LOCKED_BLOCK:"当前或相邻的段落或目标段落被锁定或删除，请稍后操作",LOADING_IMAGE_PATH:"http://note.youdao.com/editor/collab/loading.gif?47",INSERT_BLANK_CATALOGUE_TEXT:"目录为空，请插入标题（字体左侧）后点击刷新按钮"}}.apply(t,[n,t]))||(e.exports=o)},,function(e,t,n){var o;void 0===(o=function(e){var t=n(115),o=n(0),i=n(1),r=new RegExp("^/yws/res/|^https?://"+t.getNamespace()+"/yws/res"),s=new RegExp("^/yws/api/group|^https?://"+t.getNamespace()+"/yws/api/group"),a={UNKNOWN:-1,WEB_NOTE:1,WEB_GROUP:2,PC:3,IPHONE:4,ANDROID:5,MAC:6},l=window.YNE_PLATFORM||a.UNKNOWN,c=o.keys(a),u={};return a.name=l,o.each(c,function(e){var t=e.toLowerCase(),n=l[e];a["IS_"+e]=l===n||l===t}),l.IS_UNKNOWN&&i.error("The platform is unknown!"),u.isFromWebNote=function(e){return r.test(e)},u.isFromWebGroup=function(e){return s.test(e)},o.extend(a,u),a}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(0),i=n(160),r=n(3),s=n(1),a=n(14),l=n(57),c=n(2);return t=i.extend({name:"UnknownCompositeCommand",_args:null,_cmds:null,_affectedBlockIds:null,_note:null,isSimple:!1,startingRange:null,endingRange:null,effected:!1,isLocalExecutedCmd:null,finalNoteVersion:null,originalNoteVersion:null,skipBlockLocking:!1,isOriginalCmd:!1,sendingToCollabServerMillis:null,isReadyToApply:null,initialize:function(){var e;this._args=this.options.args||{},this._args.collabProperties=this._args.collabProperties||{},e=this._args.collabProperties,this._cmds=[],this._affectedBlockIds=[],t.__super__.initialize.apply(this),!0===e.isCollabEnabled&&(e.isCollabCmd&&(this.finalNoteVersion=e.finalNoteVersion),this._initializeAffectedBlocks(),this.rangeIsRequired=!0,this.isReadyToApply=!0,this._args.isOriginalCmd&&(this.isOriginalCmd=!0))},finilize:function(){},_applyCommandToComposite:function(e,t){var n,o=this._cmds;o||(o=this._cmds=[]),n=e.apply(),e.isSimple?this.effected=!1!==n:(this.effected=this.effected||e.effected,this._affectedBlockIds||s.error("_affectedBlockIds cannot be null. please check the cmd("+this.name+") initialize has invoked its parent method")),t?this.setEndingRange(t):!e.isSimple&&e.getEndingRange()&&this.setEndingRange(e.getEndingRange()),o.push(e)},apply:function(){throw"Method not implemented."},doReapply:function(e){var t,n,o=this._cmds;if(s.log("doReapply(): `"+this.name+"`"),r.isCollabCommand(e))return this._reapplyCollabCmd(e);if(!o||!o.length)return s.warn("doReapply(): the composite command `"+this.name+"`no _cmds"),!0;for(t=o.length,n=0;n<t;++n)o[n].doReapply(e);return!0},doUnapply:function(e){var t,n=this._cmds;if(r.isCollabCommand(e))return this._unapplyCollabCmd(e);if(!n||!n.length)return s.warn("doUnapply(): the composite command `"+this.name+"`no _cmds"),!0;for(t=n.length-1;t>=0;--t)n[t].doUnapply(e);return!0},setStartingRange:function(e){a.isNoteRange(e)?(this.startingRange=e,this.options.args.range=this.startingRange):s.warn("noteRange is not a NoteRange",e)},setEndingRange:function(e){var t;a.isNoteRange(e)?(this.endingRange=e,t=this._getAffectedBlockIdsFromRange(this.options.note,this.endingRange),this.pushAffectedBlockIds(t)):s.warn("noteRange is not a NoteRange",e)},getStartingRange:function(){return this.startingRange},getEndingRange:function(){return this.endingRange},canBeMerged:function(e){return!!o.contains(["comp.KeyTextInput"],this.name)&&(!this.isCollabUndo&&!this.isCollabRedo&&e.name===this.name&&e.getCmdId()!==this.getCmdId()&&e.isLocalExecutedCmd===this.isLocalExecutedCmd)},executeAtomicCommand:function(e,t){this._applyCommandToComposite(e,t)},fromCollabJSON:function(){var e=this.options.args,n=e.collabProperties.cmdJSON,o=e.collabProperties.coreEditor;t.__super__.fromCollabJSON.apply(this),n&&(n.startNoteRange&&(e.range=l.buildNoteRangeFromJSON(n.startNoteRange,o),e.range?this.setStartingRange(e.range):s.warn("Failed to re-build the startNoteRange",n.startNoteRange)),n.endNoteRange&&(e.endRange=l.buildNoteRangeFromJSON(n.endNoteRange,o),e.endRange&&this.setEndingRange(e.endRange)),n.cmdNoteVersion&&(this.originalNoteVersion=n.cmdNoteVersion),this.skipBlockLocking=n.skipBlockLocking)},getAffectedBlockIds:function(){return o.clone(this._affectedBlockIds)},getCmdFinalNoteVersion:function(){return this.finalNoteVersion},getCmdOriginalNoteVersion:function(){return this.originalNoteVersion},getCollabProps:function(){return this._args.collabProperties},getLockedBlockIds:function(){var e=[],t=this.endingRange;return this.isCollabUndo?t=this.startingRange:this.skipBlockLocking&&(t=null),a.isNoteRange(t)?e.push(t.getEndBlockRange().getBlockId()):t&&s.error("locked targetRange should be a NOTE range",t),e},getIgnoreUndoRedo:function(){return this._args.ignoreUndoRedo},isSingleBlockAffected:function(){var e=!0;return this._args.range?a.isNoteRange(this._args.range)&&this._args.range.isInMultiBlock()&&(e=!1):e=!1,e},isValidStartNoteRange:function(){return!0},mergeLocalCmd:function(e){s.log("targetCmd:",e)},pushAffectedBlockIds:function(e){e&&(this._affectedBlockIds=o.union(this._affectedBlockIds,e))},resetAffectedBlockIds:function(e){this._affectedBlockIds=[],this.pushAffectedBlockIds(e)},setCmdFinalNoteVersion:function(e){this.finalNoteVersion=e},setCmdOriginalNoteVersion:function(e){this.originalNoteVersion=e},setIgnoreUndoRedo:function(e){this._args.ignoreUndoRedo=e},toCollabJSON:function(){var e,n=this,i=t.__super__.toCollabJSON.apply(n),l=[],c=n.getStartingRange(),u=!1;if(n.isOriginalCmd)if(a.isNoteRange(c))i.startNoteRange=c.toCollabJSON();else if(n.rangeIsRequired)return s.error("startingRange should be noteRange",c),null;if(n.isCollabUndo&&(i.isCollabUndo=n.isCollabUndo),n.isCollabRedo&&(i.isCollabRedo=n.isCollabRedo),n.originalNoteVersion&&(i.cmdNoteVersion=n.originalNoteVersion),n.isCollabUndo||n.isCollabRedo){if(n.cmdId=r.newGUID(),i.cmdId=n.cmdId,n.isOriginalCmd)if(a.isNoteRange(n.endingRange))i.endNoteRange=n.endingRange.toCollabJSON();else if(n.rangeIsRequired)return s.error("endingRange should be a noteRange:",n.endingRange),null;o.each(n._cmds,function(t){u||(t.rangeIsRequired=!1,n.isCollabUndo?(t.setCollabRedo(!1),t.setCollabUndo(!0)):(t.setCollabRedo(!0),t.setCollabUndo(!1)),(e=t.toCollabJSON())?l.push(e):(u=!0,s.error("Failed to get cmdJSON",t)))}),i.affectedBlockIds=n._affectedBlockIds.join(",")}return u?null:(l.length>0&&(i.innerCmds=l),n.isLocalExecutedCmd&&(i.isLocalExecutedCmd=!0),i.skipBlockLocking=n.skipBlockLocking,i)},_getAffectedBlockIdsFromRange:function(e,t){var n=[],i=[];if(e&&t){switch(t.getType()){case a.TYPE:n=e.getInterBlocks(t.getStartBlockRange().block,t.getEndBlockRange().block,!0);break;case c.PARAGRAPH:t.block&&n.push(t.block);break;default:s.error("pending supported range type:"+t.getType())}n&&n.length>0&&o.each(n,function(e){i.push(e.getId())})}return i},_initializeAffectedBlocks:function(){var e=[],t=this.options.note,n=this._args.range;n&&(e=this._getAffectedBlockIdsFromRange(t,n),this.pushAffectedBlockIds(e))},_reapplyCollabCmd:function(e){var t=e.collabProperties.cmdJSON;if(t&&t.innerCmds){var n,o=t.innerCmds,i=o.length;for(n=0;n<i;++n){var r=e.collabProperties.coreEditor.buildInnerCommandFromJSON(o[n],e);r&&(r.doReapply(r._args),r.isSimple&&(e.collabProperties.redoUndoEffected=!0))}}},_unapplyCollabCmd:function(e){var t=e.collabProperties.cmdJSON;if(t&&t.innerCmds){var n,o=t.innerCmds;for(n=o.length-1;n>=0;--n){var i=e.collabProperties.coreEditor.buildInnerCommandFromJSON(o[n],e);i&&(i.doUnapply(i._args),i.isSimple&&(e.collabProperties.redoUndoEffected=!0))}}}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(63),n(17),n(116),n(6),n(1),n(226),n(113),n(21),n(145),n(146)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h,p){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.create=function(e,n){return new t({keepLineBreak:!1!==n,text:e})},t.createBlank=function(e){return t.create("",e)},t.fromCollabJSON=function(e){if(!e||!e.text)return t.createBlank(!0);var o=t.create(e.text,e.keepLineBreak);return n.each(e.inlineStyles,function(e,t){n.each(e,function(e){d.isSupport(t)?o.setStyle(e.from,e.to,t,e.value):o.setUnknownStyle(e.from,e.to,t,e.value)})}),o},t.fromJSON=function(e){if(e&&e.isRichText&&e.data){var o,i=[];return n.each(e.data,function(e){var t=c.fromJSON(e);t&&i.push(t)}),(o=new t({keepLineBreak:e.keepLineBreak,text:""})).appendRichChars(i),o}},t.fromXml=function(e){var n=this,o=$(e),i=new t({text:o.find("text").text()});return o.find("inline-styles").children().each(function(e,t){var n,o,r=t.nodeName.toLowerCase(),s=$(t),l=parseInt(s.find("from").text(),10),c=parseInt(s.find("to").text(),10),h=s.find("value");0!==h.length&&(n=h.text(),d.isSupport(r)?i.setStyle(l,c,r,n):(o=s.attr(a.COMPAT),u.isCompatible(o)&&(p.add(r),n=o+"|"+n,i.setUnknownStyle(l,c,r,n))))}),o.find("entities").children().each(function(e,t){var r=$(t),s={},a=r.find("type").text(),l=parseInt(r.find("start").text(),10);s.type=a,s.start=l,s.inlineStyles=n.getEntityStyles("inline-styles",o),i.appendEntity(s)}),i},t.getEntityStyles=function(e,t){var n={};return $(t).find("entities").children().find(e).children().each(function(e,t){var o=t.nodeName,i=$(t).text();n[o]=i}),n},t.CLONE_DATA=function(e){var t,n=e.length,o=new Array(n);for(t=0;t<n;++t)o[t]=e[t].clone();return o},t.EXTRACT_UNKNOWN_VALUE=function(e){var t=e.indexOf("|");return-1===t?{value:e}:{compat:e.substring(0,t),value:e.substring(t+1)}},t.prototype.append=function(e){e&&e.getClonedData||l.warn("no richText"),this.appendRichChars(e.getClonedData())},t.prototype.appendRichChars=function(e){e&&0!==e.length&&(this.isKeepLineBreak()||(e=this._removeLineBreak(e)),this.richTextProps.data=this.richTextProps.data.concat(e))},t.prototype.clone=function(){var e=new t({keepLineBreak:this.isKeepLineBreak(),text:""});return e.appendRichChars(this.getClonedData()),e},t.prototype.getClonedData=function(){return t.CLONE_DATA(this.richTextProps.data)},t.prototype.getCommonStyle=function(e,t,n,o,i){var r,s,c=this.richTextProps.data,u=null;if(this.isEmpty())return d.getDefault(n);if(e<0)l.warn("start should not be less than 0",e);else if(e>t)l.warn("start should not greater than end",e,t);else{if(!(t>c.length)){if(e===t)0===e&&c[0]?u=c[0].getStyle(n,!1,o):c[e-1]&&(u=c[e-1].getStyle(n,!1,o));else for(r=e;r<t;++r)if(c&&c[r]){if(s=c[r].getStyle(n,!1,o),null===u)u=s;else if(u!==s)return i?null:a.INTERM}else l.warn("unexpected undefine in data",c);return!i||u!==a.INTERM&&u!==d.getDefault(n)?u:null}l.warn("end should not geater than data.length",t,c)}},t.prototype.getCommonStyles=function(e,t,o){var i=this,r={},s=d.getAllConfig();return n.each(s,function(n,s){var a=i.getCommonStyle(e,t,s,o);null!=a&&(r[s]=a)}),r},t.prototype.setEntities=function(e){this.richTextProps.entities=e},t.prototype.getEntities=function(){return this.richTextProps.entities},t.prototype.removeEntitiy=function(e){var t=this;n.each(e,function(e,o){var i=n.findLastIndex(t.richTextProps.entities,{type:o});t.richTextProps.entities.splice(i,1)})},t.prototype.getLength=function(e){var t,n=this.richTextProps.data,o=n.length;if(e)for(t=0;t<n.length;t++)$.trim(n[t].toString())||o--;return o},t.prototype.getReadOnlyData=function(){return this.richTextProps.data},t.prototype.getReadOnlyStylesList=function(e,t,o){var i=this,r=this.richTextProps.data,s=[],a=d.getAllConfig();return e=!1!==e,n.each(r,function(r){var l={};n.each(a,function(n,s){var a;a=o&&!r.getStyle(s,!1)&&i.merStyle(o,s)?i.merStyle(o,s):r.getStyle(s,e,t),(e||!e&&null!=a)&&(l[s]=a)}),s.push(l)}),s},t.prototype.merStyle=function(e,t){var o;return n.each(e,function(e,n){t===n&&(o=e)}),o},t.prototype.getStyle=function(e,t,n,i){var r,s,a,c=this.richTextProps.data;if(o(e>=0),o(e<=t),o(t<=c.length),void 0===e||e<0||void 0===t||e>t||t>c.length)return l.error("unexpected params:",e,t,c.length),null;for(a=new Array(t-e),r=e;r<t;++r)s=c[r].getStyle(n,!1,i),a[r-e]=s;return a},t.prototype.getStyleRanges=function(e,t){if(e){if(t=!0===t,d.isSupport(e))t=!1;else if(!t)return;var o,i,r,s,a=this.richTextProps.data,l=a.length,c=[],u=!1;for(o=0;o<l;o++)i=a[o],(r=t?i.getUnknownStyle(e):i.getStyle(e,!1))?(s=n.last(c),!u&&s&&s.value===r?s.to=o+1:c.push({from:o,to:o+1,value:r}),u=!1):u=!0;return c}},t.prototype.getStylesAtIndex=function(e,t){var n=this.richTextProps.data,o=n.length;if(!(e<0||e>=o))return n[e].getStyles(t);l.warn("invlid index of the text",e,n)},t.prototype.indexOf=function(e,t,n){var o,i,r,s,a,l=e.getReadOnlyData(),c=l.length,u=this.getReadOnlyData(),d=u.length;if(c>d)return-1;for(i=t;i<d;i++){for(o=!0,r=0;r<c;r++){if(s=u[i+r],a=l[r],!s){o=!1;break}if((!0!==n||s.char.toLowerCase()!==a.char.toLowerCase())&&s.char!==a.char){o=!1;break}}if(o)return i}return-1},t.prototype.insert=function(e,t){if(e&&e.getClonedData){var n=this.richTextProps.data,o=n.splice(t),i=e.getClonedData();!1===this.isKeepLineBreak()&&!0===e.isKeepLineBreak()&&(i=this._removeLineBreak(i)),this.richTextProps.data=n.concat(i,o)}},t.prototype.isEmpty=function(){return this.getLength(!1)<=0},t.prototype.isKeepLineBreak=function(){return this.richTextProps.keepLineBreak},t.prototype.removeLineBreak=function(){this.richTextProps.data=this._removeLineBreak(this.richTextProps.data)},t.prototype.removeStyles=function(){var e,t=this.richTextProps.data,n=t.length;for(e=0;e<n;++e)t[e].removeStyles()},t.prototype.appendEntity=function(e){this.richTextProps.entities.push(e)},t.prototype.setKeepLineBreak=function(e){(e=!!e)!==this.richTextProps.keepLineBreak&&(this.richTextProps.keepLineBreak=e,!1===this.richTextProps.keepLineBreak&&this.removeLineBreak())},t.prototype.setStyle=function(e,t,o,i,r){if(o&&null!=i){var s,a=this.richTextProps.data,l=n.isArray(i);for(t=Math.min(t,a.length),s=e;s<t;++s)a[s].setStyle(o,l?i[s-e]:i,r)}},t.prototype.setEntity=function(e){var o=this,i=n.sortBy(o.getEntities(),function(e){return e.start}),r=0;i.forEach(function(n){var i=n.type,s=n.start,a=n.inlineStyles,l=new t({text:e[i]});l.setStyles(0,l.getLength(),a),o.insert(l,s+r),r+=l.getLength()}),o.removeEntitiy(e)},t.prototype.setStyles=function(e,t,o){var i=this;o&&n.each(o,function(n,o){i.setStyle(e,t,o,n)})},t.prototype.setUnknownStyle=function(e,t,o,i){var r,s=this.richTextProps.data,a=n.isArray(i);for(t=Math.min(t,s.length),r=e;r<t;++r)s[r].setUnknownStyle(o,a?i[r-e]:i)},t.prototype.slice=function(e,n,o){var i=this.richTextProps.data.slice(e,n),r=new t({});return!1!==o&&(i=t.CLONE_DATA(i)),r.appendRichChars(i),r},t.prototype.toCollabJSON=function(){return this.toJSON(!0)},t.prototype.toJSON=function(e){return!0===e?this._toSimplifyJSON():{data:n.map(this.richTextProps.data,function(e){return e.toJSON()}),isRichText:!0,keepLineBreak:this.isKeepLineBreak()}},t.prototype.toString=function(){for(var e="",t=this.richTextProps.data,n=0,o=t.length;n<o;n++)e+=t[n];return e},t.prototype.toXml=function(e){var t,o=this,i=e.createElement("inline-styles"),r=d.getAllConfig();return n.each(r,function(t,n){var r=o.getStyleRanges(n,!1);o._handleStyleRangesForXML(e,i,n,r,!1)}),t=p.get(),n.each(t,function(t){var n=o.getStyleRanges(t,!0);o._handleStyleRangesForXML(e,i,t,n,!0)}),i},t.prototype.initialize=function(e){var t=this;this.richTextProps=n.clone(e),this.richTextProps=n.defaults(this.richTextProps||{},{keepLineBreak:!0,text:""}),this.richTextProps.data=[],this.richTextProps.entities=[],this.richTextProps.text=r.clear(this.richTextProps.text),this.richTextProps.keepLineBreak||(this.richTextProps.text=this.richTextProps.text.replace(/[\r\n]/g,"")),n.each(h(this.richTextProps.text),function(e){t.richTextProps.data.push(new c(e))})},t.prototype._handleStyleRangesForXML=function(e,o,i,r,s){r&&r.length&&n.each(r,function(n){if(n&&n.value){var r,l,c,u=e.createElement(i),d=e.createElement("from"),h=e.createElement("to"),p=e.createElement("value");d.appendChild(e.createTextNode(n.from)),u.appendChild(d),h.appendChild(e.createTextNode(n.to)),u.appendChild(h),s?((c=(r=t.EXTRACT_UNKNOWN_VALUE(n.value)).compat)&&u.setAttribute(a.COMPAT,c),l=r.value):l=n.value,p.appendChild(e.createTextNode(l)),u.appendChild(p),o.appendChild(u)}})},t.prototype._handleStyleRangesForJSON=function(e,o,i,r){i&&i.length&&n.each(i,function(n){if(n&&n.value){var i,s=e[o];s||(s=e[o]=[]),i=r?t.EXTRACT_UNKNOWN_VALUE(n.value).value:n.value,s.push({from:n.from,to:n.to,value:i})}})},t.prototype._removeLineBreak=function(e){return e&&0!==e.length?e=n.filter(e,function(e){return!1===e.isLineBreak()}):[]},t.prototype._toSimplifyJSON=function(){var e,t,o=this,i={},r=d.getAllConfig();return n.each(r,function(e,t){var n=o.getStyleRanges(t,!1);o._handleStyleRangesForJSON(i,t,n,!1)}),e=p.get(),n.each(e,function(e){var t=o.getStyleRanges(e,!0);o._handleStyleRangesForJSON(i,e,t,!0)}),t={keepLineBreak:o.isKeepLineBreak(),text:o.toString()},n.isEmpty(i)||(t.inlineStyles=i),t},t}(i)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(57),o=n(26),i=n(2),r=n(97),s=n(21),a=n(114),l=n(0),c=n(10),u=n(1),d=n(19),h=n(35),p=n(76),g=n(52),f=n(47),m=n(98),_=n(48),y=n(49),b=n(102),v=n(23),k=n(22),C=n(58),I=n(130),S=n(131),w=n(161),E=n(104),T=n(132),N=n(6),A=n(14),x=n(70),O=n(43);return{createNewListItem:function(e,t,n){var o=new h({id:t,level:e.getLevel(),list:e.getOwnerList(),text:n});return o.setBlockStyles(e.getBlockStyles()),o},createNewParagraph:function(e,t,n,o){var r=new d({blockId:t,text:o?new c({text:n.toString()}):n});return!e||i.isHeading(e)||i.isCatalogue(e)?e&&(r.setBlockStyle("back-color",e.getBlockStyle("back-color")),r.setBlockStyle("padding",e.getBlockStyle("padding"))):r.setBlockStyles(e.getBlockStyles()),r},createNewTodo:function(e,t){var n=new f(t);return e&&n.setBlockStyles(e.getBlockStyles()),n},createNewCode:function(e,t){var n=new _(t);return e&&n.setBlockStyles(e.getBlockStyles()),n},convertCodeToPara:function(e){var t=this,n=e;return i.isCode(e)&&(n=e.toCodeLines().map(function(n){return t.createNewParagraph(e,null,n)})).forEach(function(t){t.setBlockStyles(e.getBlockStyles())}),n},createNewQuote:function(e,t){var n=new m(t);return e&&n.setBlockStyles(e.getBlockStyles()),n},createNewHeading:function(e,t,n,o,r){var s,l;return n.getLength&&!r&&(l=n.getLength(),i.isHeading(e)&&"b"===e.getLevel()&&(n=this._clearHeadingInlineStyle("color",e,n)),n.setStyles(0,l,a.headingInlineStyles[o])),(s=new p({id:t,text:n,level:o})).setBlockStyles(e.getBlockStyles()),a.headingBlockStyles[o]&&!r&&s.setBlockStyles(a.headingBlockStyles[o]),s},_clearHeadingInlineStyle:function(e,t,n){var o,i=t.getLevel(),r=a.headingInlineStyles[i][e];for(o=0;o<n.getLength();o++)r===n.getStylesAtIndex(o)[e]&&delete n.richTextProps.data[o].styles[e];return n},createNewCatalogue:function(e,t){var n=new g(t);return!t.ownerList&&i.isCatalogue(e)&&(t.ownerList=e.getOwnerList()),n=new g(t),e&&n.setBlockStyles(e.getBlockStyles()),n},isForCatalogueBlock:function(e){return i.isHeading(e)&&e.getLevel()<4&&!e.isEmpty()&&e.getText().toString().trim()},deleteSelectedContent:function(e,t,n){var o,r,s,a,l;A.isNoteRange(n)?(o=n.getStartBlockRange(),s=n.getEndBlockRange(),r=o.block,a=s.block,i.isTextBlock(r)&&(i.isCode(r)?o.selectWholeBlock?e.executeAtomicCommand(new v({note:t,blocks:[r]})):e.executeAtomicCommand(new b({block:r,startBlockRange:o,endBlockRange:s})):e.executeAtomicCommand(new y({block:r,start:o.start,end:o.end}))),n.isInMultiBlock()&&((l=t.getInterBlocks(r,a))&&l.length>0&&e.executeAtomicCommand(new v({note:t,blocks:l})),i.isTextBlock(a)&&(i.isCode(a)?e.executeAtomicCommand(new b({block:a,startBlockRange:o,endBlockRange:s})):e.executeAtomicCommand(new y({block:a,start:s.start,end:s.end}))))):u.error("deleteSelectedContent: selectedNoteRange should be a NoteRange",n)},getBackwardBlockRange:function(e,t){var n=e.getPreBlock(t);if(n)return o.createRangeByBlock({block:n,allContent:!1,collapseToStart:!1})},getForwardBlockRange:function(e,t){var n=e.getNextBlock(t);if(n)return o.createRangeByBlock({block:n,allContent:!1,collapseToStart:!0})},getNoteView:function(e){return e._cmdArgs.collabProperties.coreEditor.noteView},insertTabChar:function(e,t,n,o){var i;(i=new c({text:"\t"})).setStyles(0,i.getLength(),o),e.executeAtomicCommand(new C({block:t,start:n,text:i}))},isInSameList:function(e){var t,n=!1;return i.isListItem(e[0])?n=l.every(e,function(e,n){if(i.isListItem(e)){if(0===n)return t=e.getOwnerList(),!0;if(e.getOwnerList()===t)return!0}return!1}):n},recogLink:function(e,t,n,o){var i,s,a={color:"#003884",underline:!0};i=t.getText().toString().slice(n,o);for(var l=o-1;l>=n;l--)if(t.getTextStyle("href",l,l+1)[0]){n=l;break}i=i.slice(n,o),(s=r.matchEnd(i))&&s.result&&(a.href=s.fullURI,e.executeAtomicCommand(new I({blocks:[t],styleNameValues:a,start:n+s.result.index,end:o})))},replaceBlockWithListItem:function(e,t,n,o,i,r){var s,a=o.getId();return e.executeAtomicCommand(new v({note:t,blocks:[o]})),s=this.createNewListItem(n,a,i),e.executeAtomicCommand(new k({note:t,newBlks:[s],preBlk:r})),s},replaceBlockWithParagraph:function(e,t,n,o,i,r){var s,a=n.getId(),l=t.getPreBlock(n);return(s=this.createNewParagraph(n,a,o,r)).setInlineStylesForEmpty(i),e.executeAtomicCommand(new v({note:t,blocks:[n]})),e.executeAtomicCommand(new k({note:t,newBlks:[s],preBlk:l})),s},replaceBlockWithHeading:function(e,t,n,o,i){var r,s=n.getId(),a=t.getPreBlock(n);return r=this.createNewHeading(n,s,o,i),e.executeAtomicCommand(new v({note:t,blocks:[n]})),e.executeAtomicCommand(new k({note:t,newBlks:[r],preBlk:a})),r},deleteHref:function(e,t,n,o){e.executeAtomicCommand(new I({blocks:[t],styleNameValues:{href:"",color:"#393939",underline:!1},start:n,end:o}))},resetAllStyles:function(e,t,n,o,i,r){this.setStylesOnNoteRange(e,t,n,o,i,r)},setNonTextBlockAsEndingRange:function(e,n){var o=t.buildNoteRangeFromNonTextBlock(n);e.setEndingRange(o)},setBlockStyle:function(e,t){e&&e.setInlineStylesForEmpty&&e.isEmpty()&&e.setInlineStylesForEmpty(t)},setResourceBlockStyleByPreBlock:function(e,t){e&&t&&(e.setBlockStyle("back-color",t.getBlockStyle("back-color")),e.setBlockStyle("padding",t.getBlockStyle("padding")))},setStylesOnNoteRange:function(e,t,n,o,r,a){var c,u=this,d=n.getStartBlockRange(),h=d.block,p=n.getEndBlockRange(),g=p.block,f=[],m=[],_=[],y=[],b=!!a&&a.resetAllStyles,v=!!a&&a.isRemoveFormat;return(void 0===o&&void 0===r||b)&&(c=!0,r||(r=s.getAllDefault(["href"]))),o=o||{},r=r||{},u._isFullSelected(d)?m.push(h):(c&&(o=h.getDefaultBlockStyles()),v||u._setBlocksBlockStyles(e,[h],o)),n.isInMultiBlock()&&(f=t.getInterBlocks(h,g),m=l.union(m,f),u._isFullSelected(p)?m.push(g):(c&&(o=g.getDefaultBlockStyles()),v||u._setBlocksBlockStyles(e,[g],o))),l.each(m,function(t){c&&(o=t.getDefaultBlockStyles()),u._setBlocksBlockStyles(e,[t],o),i.isTextBlock(t)&&_.push(t),i.isTable(t)&&y.push(t)}),l.isEmpty(r)||(i.isTextBlock(h)&&!u._isFullSelected(d)&&e.executeAtomicCommand(new I({blocks:[h],styleNameValues:c&&i.isHeading(h)?h.getDefaultInlineStyles():r,start:d.start,end:d.end})),n.isInMultiBlock()&&i.isTextBlock(g)&&!u._isFullSelected(p)&&e.executeAtomicCommand(new I({blocks:[g],styleNameValues:c&&i.isHeading(g)?g.getDefaultInlineStyles():r,start:p.start,end:p.end})),m.length>0&&(_=u._filterHeadingBlock(e,_,r,c),e.executeAtomicCommand(new I({blocks:_,styleNameValues:r,fullText:!0})))),this._filterTableBlocks({isStyleReset:c,startBlockRange:d,endBlockRange:p,noteRange:n,fullSelectedTableBlocks:y,inlineStyles:r,blockStyles:o,targetCmd:e})},_filterHeadingBlock:function(e,t,n,o){if(!o)return t;var r=t.filter(function(e){if(!i.isHeading(e))return e}),s=t.filter(function(e){if(i.isHeading(e))return e});return s.length>0&&s.forEach(function(t){e.executeAtomicCommand(new I({blocks:[t],styleNameValues:t.getDefaultInlineStyles(),fullText:!0}))}),r},_filterTableBlocks:function(e){var t=this,n=e.startBlockRange,o=e.endBlockRange,r=e.noteRange,s=e.fullSelectedTableBlocks,a=e.inlineStyles,c=e.blockStyles,u=e.targetCmd,d=n.block,h=o.block;n.isOnCellEdit&&n.isOnCellEdit()||t._adaptTableStylesInlineToBlock(a,c,e.isStyleReset),l.isEmpty(a)||(i.isTable(d)&&t._setTableCellInlineStyles({table:d,range:n,styles:a,cmd:u}),r.isInMultiBlock()&&i.isTable(h)&&t._setTableCellInlineStyles({table:h,range:o,styles:a,cmd:u}),s.forEach(function(e){t._setTableCellInlineStyles({table:e,styles:a,isAll:!0,cmd:u})})),l.isEmpty(c)||(i.isTable(d)&&t._setTableCellBlockStyles({table:d,range:n,styles:c,cmd:u}),r.isInMultiBlock()&&i.isTable(h)&&t._setTableCellBlockStyles({table:h,range:o,styles:c,cmd:u}),s.forEach(function(e){t._setTableCellBlockStyles({table:e,isAll:!0,styles:c,cmd:u})}))},_adaptTableStylesInlineToBlock:function(e,t,n){!l.isEmpty(e)&&e["back-color"]&&(t.backColor=e["back-color"],n||delete e["back-color"])},_setTableCellInlineStyles:function(e){var t,n,o=e.isAll,i=e.range,r=e.cmd,s=o?O.TYPES.ALL:O.TYPES.NORMAL;i?t=i.getAsRectRange():s===O.TYPES.ALL&&(t=(i=O.create({block:e.table,type:O.TYPES.ALL})).getAsRectRange()),n=t?t.getRect():null,r.executeAtomicCommand(new w({table:e.table,styles:e.styles,type:s,rect:n}))},_setTableCellBlockStyles:function(e){var t=e.isAll,n=e.range?e.range:O.create({block:e.table,type:O.TYPES.ALL}),o=e.cmd,i=n.getAsRectRange(),r=t?O.ALL:O.NORMAL,s=n&&i?i.getRect():null;o.executeAtomicCommand(new E({table:e.table,styles:e.styles,type:r,rect:s}))},setTextBlockAsEndingRange:function(e,n,o,i){var r=t.buildNoteRangeFromParagraph(n,o,i);e.setEndingRange(r)},setCodeBlockAsEndingRange:function(e,t,n,o){var i=x.createNewRange({preCodeRange:t,charOffset:n,lineOffset:o}),r=A.create({endRange:i,startRange:i});e.setEndingRange(r)},expandCodeRange:function(e,t,n,o){var i=x.createNewRange({preCodeRange:t,charOffset:n,lineOffset:o,needCollapse:!1}),r=A.create({endRange:i,startRange:i});return e.setEndingRange(r),i},updateBlocksIndentLevel:function(e,t,n){var o,i,r={},s={};l.each(t,function(e){o=e.getBlockStyle("indent"),!l.isNumber(o)||0===o&&n<0||(i=parseInt(e.getBlockStyle("text-indent"),10)||0,o=o<0?0:o+n,o=Math.min(o,N.MAX_LIST_ITEM_LEVEL-i),r[o]||(r[o]=[]),r[o].push(e))}),l.each(r,function(t,n){s.indent=n,e.executeAtomicCommand(new S({blocks:t,styleNameValues:s}))})},updateBlockTextIndentLevel:function(e,t,n){var o,i,r;o=t.getBlockStyle("text-indent"),r=parseInt(t.getBlockStyle("indent"),10)||0,o||(o=0),i=o+n,(i=Math.min(i,N.MAX_LIST_ITEM_LEVEL-r))>=0&&e.executeAtomicCommand(new S({blocks:[t],styleNameValues:{"text-indent":i}}))},_isFullSelected:function(e){var t=e.block;return i.isTextBlock(t)?0===e.start&&e.end===t.getLength()||void 0:!i.isTable(t)||e.isFullSelected()},_setBlocksBlockStyles:function(e,t,n){l.isEmpty(n)||e.executeAtomicCommand(new S({blocks:t,styleNameValues:n}))},fixMergeCellBeforeRowColChange:function(e){e.isCol?this._fixMergeCellColChange(e):this._fixMergeCellRowChange(e)},_fixMergeCellRowChange:function(e){var t,n,o,i,r=e.table,s=e.isCol,a=e.insertData,l=e.isDelete,c=e.index,d=r.getCells();if(d[c])for(n=0;n<d[c].length;n++)if((t=r.getCell(c,n))&&(t.isMergePoint()&&l&&(i=this._fixMergePointCellWhenDel({cell:t,row:c,col:n,table:r,isCol:s,cmd:e.cmd})),t.isMergedCell())){if((o=this._findMergePointCell({cell:t,row:c,col:n,table:r})).row===c)continue;if((i=this._fixMergePointWithMergeCell({pointCellInfo:o,table:r,isCol:s,isDelete:l,insertData:a,cmd:e.cmd,cellInfo:{row:c,col:n}})).col<n)return void u.error("New index should more then i");n=i.col}},_fixMergeCellColChange:function(e){var t,n,o,i,r=e.table,s=e.isCol,a=e.insertData,l=e.isDelete,c=e.index,d=r.getCells();for(n=0;n<d.length;n++)if((t=r.getCell(n,c))&&(t.isMergePoint()&&l&&(n=(i=this._fixMergePointCellWhenDel({cell:t,row:n,col:c,table:r,isCol:s,cmd:e.cmd})).row),t.isMergedCell())){if((o=this._findMergePointCell({cell:t,row:n,col:c,table:r})).col===c)continue;if((i=this._fixMergePointWithMergeCell({pointCellInfo:o,table:r,isCol:s,isDelete:l,insertData:a,cmd:e.cmd,cellInfo:{row:n,col:c}})).row<n)return void u.error("New index should more then i");n=i.row}},_findMergePointCell:function(e){var t=e.row,n=e.col;return e.table.getCell(t,n,{findMergePointIfNeeded:!0,withPosition:!0})},_fixMergePointWithMergeCell:function(e){var t,n,o,i=e.table,r=e.pointCellInfo,s=e.cellInfo,a=e.isDelete,l=e.isCol,c=e.cmd,u=e.insertData,d=r.cell,h=r.row,p=r.col,g=d.getMergePointAttr(),f=s.row,m=s.col,_=0,y=0;for(a?l?_=-1:y=-1:l?_=1:y=1,c.executeAtomicCommand(new T({table:i,type:T.TYPES.POINT,value:{width:g.width+_,height:g.height+y,fireChange:!1},rect:{row:h,col:p}})),t=f;t<h+g.height;t++)for(n=m;n<p+g.width;n++)o=i.getCell(t,n).getMergedCellAttr(),n===m&&!a&&l&&u[t]&&u[t].setMergedCellAttr(o.dx,o.dy),t!==f||a||l||!u[n]||u[n].setMergedCellAttr(o.dx,o.dy),c.executeAtomicCommand(new T({table:i,type:T.TYPES.CELL,value:{dx:o.dx+_,dy:o.dy+y,fireChange:!1},rect:{row:t,col:n}}));return{row:h+g.height-1,col:p+g.width-1}},_fixMergePointCellWhenDel:function(e){var t,n,o,i,r=e.cell,s=e.row,a=e.col,l=e.table,c=e.isCol,u=e.cmd,d=r.getMergePointAttr(),h=0,p=0;for(c?p=1:h=1,t=s+h;t<s+d.height;t++)for(n=a+p;n<a+d.width;n++)(o=l.getCell(t,n))&&(t!==s+h||n!==a+p?(i=o.getMergedCellAttr(),u.executeAtomicCommand(new T({table:l,type:T.TYPES.CELL,value:{dx:i.dx-p,dy:i.dy-h},rect:{row:t,col:n}}))):u.executeAtomicCommand(new T({table:l,type:T.TYPES.POINT,value:{width:d.width-p,height:d.height-h},rect:{row:t,col:n}})));return{row:s+d.height-1,col:a+d.width-1}}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(1)],void 0===(i=function(e,t,n){"use strict";return function(){function e(){}return e.getTemplate=function(e,t){var o=e+"/"+t,i=(this&&this.JST?this:window).JST[o];if(!i){if(n.DEBUG)throw new Error("JST has no template: "+o);n.error("JST has no template: "+o)}return i},e.render=function(e,t,o){var i=this.getTemplate(e,t);if(i)return i(o);n.error("no tempalte: "+e+"/"+t+".jst","template/jst.js")},e.trimTempalte=function(e){if(e=e||""){var t,n,o=e.split(/[\r\n]/),i=o.length;for(t=0;t<i;t++)n=(n=o[t]||"").trim(),o[t]=n;return o.join("")}},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(16),n(1),n(6)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.checkStatus=function(e,o){this.resetStatus(),!1===this.queryAction(e,o)&&(this.isDisabled=this.isHidden=!0),this.isHidden||this.type===t.TYPE.SUBMENU&&(n.invoke(this.items,"checkStatus",e,o),this.isDisabled=0===this.items.filter(function(e){return!e.isHidden&&!e.isDisabled}).length)},t.prototype.onSelected=function(){this.keyHandlerName?this.editor.getController().execKeyHandler(this.keyHandlerName):this.selectAction()},t.prototype.queryAction=function(e,t){i.error("The queryAction() of "+this.name+" should be implemented by options!")},t.prototype.reset=function(){this.resetStatus()},t.prototype.select=function(){this.onSelected()},t.prototype.selectAction=function(){i.error("The selectAction() of "+this.name+" should be implemented by options!")},t.prototype.simplify=function(){var e={index:this.index,type:this.type,isDisabled:this.isDisabled,isHidden:this.isHidden,isDefault:this.isDefault,label:this.label,key:this._getKey()};return this.items&&this.items.length&&(e.items=n.map(this.items,function(e){if(e&&e.simplify)return e.simplify()})),e},t.prototype.initialize=function(e){e=e||{},this.name=e.name,this.label=e.label,this.type=e.type||t.TYPE.ITEM,this.isDefault=!!e.isDefault,this.isDisabled=!!e.isDisabled,this.isHidden=!!e.isHidden,this.key=e.key||"",this.keyHandlerName=e.keyHandlerName||"",this.items=e.items,null!=e.queryAction&&(this.queryAction=e.queryAction),null!=e.selectAction&&(this.selectAction=e.selectAction)},t.prototype.resetStatus=function(){this.isDefault=!1,this.isDisabled=!1,this.isHidden=!1},t.prototype._getKey=function(){var e=this.key||"",o=this.editor.getController().keyHandlerManager;return this.keyHandlerName&&o&&(e=o.getKey(this.keyHandlerName)),e?(e=e.replace(/[\s\uFEFF\xA0]/g,""))?(e=(e=e.toLowerCase()).replace(/mod/,t.MOD),r.IS_MAC&&n.each({meta:"⌘",ctrl:"⌃",alt:"⌥",shift:"⇧"},function(t,n){e=e.replace(n,t)}),e=(e=e.replace(/^([a-z])/g,function(e,t){return t.toUpperCase()})).replace(/\+([a-z])/g,function(e,t){return"+"+t.toUpperCase()})):"":(i.warn("no key for ContextMenuItem: "+this.name),"")},t.TYPE={ITEM:0,SUBMENU:1,SPLIT:2},t.MOD=r.IS_MAC?"meta":"ctrl",t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(19),n(99),n(36),n(8),n(16),n(1),n(6),n(2),n(271)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.create=function(e){if(e&&e.startRange&&e.endRange)return new t(e);c.warn("options is unvalid!")},t.createForHeaderFooter=function(e){return new t({blockRanges:[new i({block:e})]})},t.createMock=function(){var e={},n=new o({}),i=new r({block:n,end:0,start:0});return e.startRange=i,e.endRange=e.startRange,new t(e)},t.fromCollabJSON=function(e,n){var o=null;if(e){var i=e.startBlockRange,r=e.endBlockRange,s={};s.startRange=n.buildBlockRangeFromJSON(i),e.isInSingleBlock?s.endRange=s.startRange:s.endRange=n.buildBlockRangeFromJSON(r),s.startRange&&s.endRange&&(o=t.create(s))}return o},t.fromNativeRange=function(e,o){if(e){if(e instanceof t)return e;var i=o.parseNativeRange(e);if(i&&i.length)return new t({endRange:n.last(i),startRange:n.first(i)});c.warn("Failed to parse native range to note range!")}else c.warn("no range")},t.isNoteRange=function(e){var n=!1;return e&&e.type===t.TYPE&&e.getStartBlockRange()&&e.getEndBlockRange()&&(n=!0),n},t.isValidType=function(e){return e===t.DATA_TYPES.JSON||e===t.DATA_TYPES.HTML||e===t.DATA_TYPES.PLAIN},t._getMethodName=function(e){var n="";switch(e){case t.DATA_TYPES.JSON:n="JSON";break;case t.DATA_TYPES.HTML:n="Html";break;case t.DATA_TYPES.PLAIN:n="Plain"}return n},t.getBlockRangeMethodName=function(e){var n=t._getMethodName(e);if(n)return"getDataAs"+n},t.prototype.canDrawedByNative=function(){return!this.isInSingleBlock()||this.getStartBlockRange().canDrawedByNative()},t.prototype.clone=function(e){var n,o;return!1===e?(n=this.startRange,o=this.endRange):(n=this.startRange.clone(),o=this.isInSingleBlock()?n:this.endRange.clone()),t.create({startRange:n,endRange:o})},t.prototype.collapse=function(e){var t=!1===e?this.getEndBlockRange():this.getStartBlockRange();t&&t.collapse?(t.collapse(e),this.startRange=t,this.endRange=t):c.warn("There is no blockRange or blockRange has no `collapse` method")},t.prototype.createWalker=function(e,t){return h.create(this,e,t)},t.prototype.getStartBlockRange=function(){return this.startRange},t.prototype.getEndBlockRange=function(){return this.endRange},t.prototype.getDataAsHtml=function(e){var t=this.startRange;return this._isSingleNotFullSelectedLI()?t.block.toHtml(t.start,t.end):e.toHtml(this)},t.prototype.getDataAsJSON=function(e,n){var o=this._getDataWithType(e,t.DATA_TYPES.JSON,n);return o=o||[],JSON.stringify(o)},t.prototype.getDataAsPlain=function(e,n){var o=this._getDataWithType(e,t.DATA_TYPES.PLAIN,n),i="";return o&&o.length&&(i=o.join(u.LINE_BREAK)),i},t.prototype.getDataWithType=function(e,t,n){return this._getDataWithType(e,t,n)},t.prototype.getType=function(){return this.type},t.prototype.isCollapsed=function(){return!(!this.startRange||!this.isInSingleBlock())&&this.startRange.isCollapsed()},t.prototype.isInSingleBlock=function(){return this.startRange===this.endRange},t.prototype.isInMultiBlock=function(){return!this.isInSingleBlock()},t.prototype.isMatchBlockTypes=function(e,t){if(!e)return c.warn("The param note does not exist!"),!1;var n,o,i,r=this.startRange.block,s=this.endRange.block,a=e.getBlockIndex(r),l=e.getBlockIndex(s);if(-1===a||-1===l)return c.warn("startIndex or endIndex is -1!"),!1;for(n=e.getAllBlocks(),o=a;o<=l;o++)if(i=d.getType(n[o]),-1===t.indexOf(i))return!1;return!0},t.prototype.isSingleTableSelected=function(){var e=this.startRange;return!(!this.isInSingleBlock()||!d.isTable(e.block))},t.prototype.setBlockRanges=function(e){this.startRange=n.first(e),this.endRange=n.last(e),this._checkValid()},t.prototype.toCollabJSON=function(e){var t={};return t.startBlockRange=this.startRange.toCollabJSON(e),this.isInSingleBlock()?t.isInSingleBlock=!0:(t.isInSingleBlock=!1,t.endBlockRange=this.endRange.toCollabJSON(e)),t},t.prototype.toNativeRange=function(e){var t,n,o;if(this.canDrawedByNative())if(t=this.getStartBlockRange().toNativeRange(e)){if(this.isInSingleBlock())return t;if(n=this.getEndBlockRange().toNativeRange(e))return(o=document.createRange()).setStart(t.startContainer,t.startOffset),o.setEnd(n.endContainer,n.endOffset),o;c.warn("no native range for end block!")}else c.warn("no native range for start block!")},t.prototype.initialize=function(e){e=e||{},delete this.options,this.type="note",e.startRange||e.endRange||!e.blockRanges?this.setBlockRanges([e.startRange,e.endRange]):this.setBlockRanges(e.blockRanges)},t.prototype._checkValid=function(){var e=this.startRange,t=this.endRange;if(!e||!t)throw new Error("starRange or endRange is not valid!");if(!e.block||!t.block)throw new Error("starRange.block or endRange.block is not valid!");if(e.block===t.block&&e!==t)throw new Error("startRange and endRange should be the same object when startRange.block === endRange.block")},t.prototype._getDataWithType=function(e,n,o){if(e&&e.getBlockAt){if(t.isValidType(n)){o=o||function(){return!0};var i,r,s,l,u=[],h=this.startRange,p=t.getBlockRangeMethodName(n);if(t.DATA_TYPES.PLAIN===n&&this._isSingleNotFullSelectedLI())return i=h.block.toPlain(h.start,h.end),u.push(i),u;if(!(l=this.createWalker(e,function(e){return o(e.block)})))return[];for(s=l.next();s;)null!=(i=s[p]())?Array.isArray(i)?u=u.concat(i):(r=s.block,(a.IS_WEB_NOTE||a.IS_WEB_GROUP)&&d.isAttachment(r)&&i.resource&&!/^http/i.test(i.resource)&&(i.resource=location.protocol+"//"+location.hostname+i.resource),u.push(i)):c.warn("data is null!"),s=l.next();return u}c.warn("type is unvalid!")}else c.warn("note is unvalid!")},t.prototype._isSingleNotFullSelectedLI=function(){var e=this.startRange,t=!1;return this.isInSingleBlock()&&d.isListItem(e.block)&&(0!==e.start||e.end!==e.block.getLength())&&(t=!0),t},t.TYPE="note",t.DATA_TYPES={JSON:1,HTML:2,PLAIN:3},t}(l)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(160),i=n(1);return t=o.extend({name:"UnknownSimpleCommand",isSimple:!0,initialize:function(){t.__super__.initialize.apply(this)},apply:function(){throw"Method not implemented."},doReapply:function(e){return i.log("doReapply(): `"+this.name+"`"),this.apply(e)},doUnapply:function(){throw i.log("doReapply(): `"+this.name+"`"),"Method not implemented."},isCollabCommand:function(){var e=this.options.args;return null!=e&&null!=e.collabProperties&&!0===e.collabProperties.isCollabCmd}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(18)],void 0===(i=function(e,t,n,o){"use strict";return function(){function e(e){(e=e||{}).enableEvent&&(this.eventInst={},n.extend(this.eventInst,o.Events)),this.options=n.extend({},e),this.initialize.apply(this,[e])}return e.extend=function(e,t){var o,i,r=this;return o=e&&n.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},n.extend(o,r,t),(i=function(){this.constructor=o}).prototype=r.prototype,o.prototype=new i,e&&n.extend(o.prototype,e),o.__super__=r.prototype,o},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(16)],void 0===(i=function(e,t,n){"use strict";return function(e){function t(t){return(t=t||{}).enableEvent=!0,e.call(this,t)||this}return s(t,e),t.prototype.on=function(e,t,n){return this.eventInst.on(e,t,n)},t.prototype.off=function(e,t,n){return this.eventInst.off(e,t,n)},t.prototype.trigger=function(e){for(var t,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];return(t=this.eventInst).trigger.apply(t,[e].concat(n))},t.prototype.bind=function(e,t,n){return this.eventInst.bind(e,t,n)},t.prototype.unbind=function(e,t,n){return this.eventInst.unbind(e,t,n)},t.prototype.once=function(e,t,n){return this.eventInst.once(e,t,n)},t.prototype.listenTo=function(e,t,n){return this.eventInst.listenTo(e,t,n)},t.prototype.listenToOnce=function(e,t,n){return this.eventInst.listenToOnce(e,t,n)},t.prototype.stopListening=function(e,t,n){return this.eventInst.stopListening(e,t,n)},t}(n)}.apply(t,o))||(e.exports=i)},,function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(39),n(29),n(141),n(1),n(6),n(90),n(24),n(2),n(30),n(10),n(77),n(21)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h,p,g,f){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.createBlank=function(e){var n=new t({});return!0===e&&l.PLATFORM_LINE_HEIGHT&&l.PLATFORM_LINE_HEIGHT!==g.getDefault("line-height",d.PARAGRAPH)&&n.setBlockStyle("line-height",l.PLATFORM_LINE_HEIGHT),n},t.fromJSON=function(e,t){return this.generalFromJSON(e,!1,t)},t.fromCollabJSON=function(e){return this.generalFromJSON(e,!0)},t.fromXml=function(e){var t=this.createBlank();return t.parseIdFromXml(e),t.setText(p.fromXml(e)),$(e).children().each(function(e,n){switch(n.nodeName){case u.TAG_ID_NAME:case u.LEGACY_TAG_ID_NAME:case"text":case"inline-styles":case"language":case"theme":case"entities":break;case"styles":o.fromXml(t,n);break;default:i.appendToTree(t.unknownTree,n)}}),t},t.generalFromJSON=function(e,t,o){if(e){if(e.type=e.type||e.blockType,d.isParagraphClusterType(e.type)&&(e.text||e.richText)){var i,r=this.createBlank();return i=t?p.fromCollabJSON(e.richText):p.fromJSON(e.richText||e.text),r.setText(i),o||n.each(e.styles,function(e,t){r.setBlockStyle(t,e)}),e.blockId&&r.setId(e.blockId),r}a.warn("invalid type or text.")}else a.warn("jsonObj should not be null!")},t.prototype.append=function(e){this.richText.append(e)},t.prototype.countWords=function(e){var t,n=0,o=this.richText;return l.IS_MOBILE||!e?n=r(o):(t=this.getRangeText(e))&&(n=r(t)),n},t.prototype.deleteText=function(e,t,o){n.isObject(e)&&!n.isUndefined(e.start)&&(t=e.end,e=e.start);var i,r=this.richText,s=r.slice(0,e),a=p.createBlank();t>=0&&(i=r.slice(t)),a.append(s),a.append(i),this.setText(a,o)},t.prototype.getBlockBackColor=function(){var e=this.richText.getStyle(0,this.richText.getLength(),"back-color");return d.isParagraph(this)&&e.length&&n.all(e,function(t){return t===e[0]})?e[0]:""},t.prototype.getCommonInlineStyle=function(e,t){var n,o;return t?(n=t.start,o=t.end):(n=this.getStartOffset(),o=this.getEndOffset()),this.richText.getCommonStyle(n,o,e)},t.prototype.getCommonInlineStyles=function(e){var t,n,o=this.richText;return e?(t=e.start,n=e.end):(t=this.getStartOffset(),n=this.getEndOffset()),o.getCommonStyles(t,n)},t.prototype.getDefaultInlineStyles=function(){return f.getAllDefault()},t.prototype.getStartOffset=function(){return 0},t.prototype.getEndOffset=function(){return this.getLength()},t.prototype.getHighlight=function(e,t){if(e&&e.length){var o=this.richText,i=[];return n.each(e,function(e){for(var n=e.getLength(),r=o.indexOf(e,0,t.ignoreCase);-1!==r;)i[r]={end:r+n,start:r},r=o.indexOf(e,r+n,t.ignoreCase)}),(i=n.compact(i)).length?i:null}},t.prototype.getInlineStyleForEmpty=function(e,t){return(this.getInlineStylesForEmpty(t)||{})[e]},t.prototype.getInlineStylesForEmpty=function(e){var t=this.inlineStylesForEmpty;return e&&(t=t||f.getAllDefault()),t=n.clone(t)},t.prototype.getLength=function(e){return this.richText.getLength(e)},t.prototype.getReadOnlyText=function(){return this.richText},t.prototype.getRangeText=function(e){if(e&&null!=e.start)return this.sliceText(e.start,e.end)},t.prototype.getStyleRanges=function(e,t){return this.richText.getStyleRanges(e,t)},t.prototype.getText=function(){return this.richText.slice(0)},t.prototype.getTextStyle=function(e,t,o){var i=this.richText;return n.isObject(t)&&null!=t.start&&(o=t.end,t=t.start),i.getStyle(t,o,e)},t.prototype.getTextStylesAtIndex=function(e){return this.richText.getStylesAtIndex(e)},t.prototype.setEntity=function(e){this.richText.setEntity(e),this.trigger("content-change")},t.prototype.insertText=function(e,t){return this.richText.insert(t,e),this.trigger("content-change"),!0},t.prototype.isEmpty=function(){return this.richText.isEmpty()},t.prototype.isEmptyContent=function(){return 0===this.getLength(!1)},t.prototype.removeAllStyles=function(){e.prototype.removeAllStyles.call(this),this.richText.removeStyles(),this.trigger("content-change",this)},t.prototype.setInlineStylesForEmpty=function(e){this.inlineStylesForEmpty=e},t.prototype.setText=function(e,t){e instanceof p||(n.isString(e)||(e=String(e)),e=new p({text:e})),this.richText=e,this.trigger("content-change",t)},t.prototype.setTextStyle=function(e,t,o,i){var r,s=this.richText;d.isQuote(this)&&(r=this.getDefaultSetFont()),n.isObject(o)&&null!=o.start&&(i=o.end,o=o.start),s.setStyle(o,i,e,t,r),this.trigger("content-change")},t.prototype.sliceText=function(e,t,n){return this.richText.slice(e,t,n)},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.richText=this.richText.toCollabJSON(),t},t.prototype.toHtml=function(e,t,n){var o,i,r,s=document.createElement("div"),a=$(s);return n=!0===n,a.attr("yne-bulb-block","paragraph").css("white-space","pre-wrap"),this.applyBlockStylesOnElement(a),e=e||0,t=null==t?this.getEndOffset():t,o=this.sliceText(e,t,!1),i=h.rich2html(o,{withDefault:n}),a.html(i),r=s.outerHTML,s=a=null,r},t.prototype.toPlain=function(e,t){var n;return e=e||0,n=this.sliceText(e,t,!1).toString(),n=c(n)},t.prototype.toJSON=function(t,n){t=t||0;var o=this.sliceText(t,n,!1),i=e.prototype.toJSON.call(this);return i.richText=o.toJSON(),i},t.prototype.toXml=function(t){var n,r,s=e.prototype.toXml.apply(this,[t]),a=t.createElement("text"),l=this.richText.toString(),c=t.createTextNode(l);return a.appendChild(c),s.appendChild(a),(r=this.richText.toXml(t))&&s.appendChild(r),n=t.createElement("styles"),o.toXml(this,n,t),s.appendChild(n),i.appendToXml(this.unknownTree,s),s},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=d.PARAGRAPH,null!=t.text?this.setText(t.text):this.setText("")},t.prototype.applyBlockStylesOnElement=function(e,t){var o,i=this,r=i.getBlockStyles(),s={};n.each(r,function(e,n){switch(n){case"align":s["text-align"]=e;break;case"indent":case"text-indent":t?(e=i.getBlockStyle("indent")+i.getBlockStyle("text-indent"),o="text-indent"):(e=e>0?e:0,o="indent"===n?"margin-left":"text-indent"),s[o]=e*l.INDENT_WIDTH||"";break;case"line-height":e>0&&(s["line-height"]=String(e));break;case"back-color":s["background-color"]=String(e);break;case"padding":s.padding=String(e);break;default:a.warn("unknown block style: "+n)}}),s["line-height"]||(o=g.getDefault("line-height",d.PARAGRAPH),s["line-height"]=o),o=h.getDefaultForHtml("font-size"),s["font-size"]=o,e.css(s)},t}(u)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(){var e=navigator.userAgent.toLowerCase();return{isSafari:function(){return e&&e.indexOf("applewebkit")>-1&&e.indexOf("chrome")<=-1},isEdge:function(){return e&&e.indexOf("applewebkit")>-1&&e.indexOf("edge")>-1}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(144)],void 0===(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.getAllConfig=function(t){var o=e.getStyleNames(t),i={};return n.each(o,function(t){i[t]=e.getConfig(t)}),i},e.getAllDefault=function(t){var o=e.getStyleNames(t),i={};return n.each(o,function(t){i[t]=e.getDefault(t)}),i},e.getConfig=function(t){var i=o[t],r=e.overrideDefaults[t];return i&&r&&((i=n.clone(i)).default=r),i},e.getDefault=function(t){var n=e.overrideDefaults[t];return null!=n?n:(n=o[t])?n.default:void 0},e.getStyleNames=function(e){var t=n.keys(o);return e&&e.length?n.difference(t,e):t},e.isSupport=function(e){return null!=o[e]},e.reset=function(){e.overrideDefaults={}},e.setDefault=function(t,n){var o=e.getDefault(t);null!=n&&n!==o&&(e.overrideDefaults[t]=n)},e.overrideDefaults={},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(0),s=n(103),a=n(3);return t=o.extend({name:"atom.InsertBlocks",_note:null,_newBlks:null,_newBlkIds:null,_preBlkId:null,initialize:function(){var e=this,n=e.options.args;a.isCollabCommand(n)||(e._note=e.options.note,e._newBlks=e.options.newBlks,e.options.preBlk&&(e._preBlkId=e.options.preBlk.getId()),e._newBlkIds=[],r.each(e._newBlks,function(t){e._newBlkIds.push(t.getId())})),t.__super__.initialize.apply(e)},apply:function(){var e,t,n,o=this,i=0;if(o._preBlkId){if(n=o._note.getBlockIndexById(o._preBlkId),e=o._note.getBlockById(o._preBlkId),t=e.getBlockStyles(),-1===n)return!1;i=n+1}return r.each(o._newBlks,function(e){t&&t["back-color"]&&e.setBlockStyle("back-color",t["back-color"]),o._note.insert(i,e),i++}),!0},doUnapply:function(){var e=this;r.each(e._newBlkIds,function(t){e._note.remove(e._note.getBlockIndexById(t))})},fromCollabJSON:function(){var e=this,n=e.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(e),e._note=n.coreEditor.getNote(),o.preBlockId&&(e._preBlkId=o.preBlockId),n.isCollabUndo?e._newBlkIds=o.insertedBlocks:n.isCollabRedo&&(e._newBlks=[],r.each(o.insertedBlocks,function(t){e._newBlks.push(s.buildBlockFromJSON(t,n.coreEditor))}))},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this),n=[];return this.isCollabUndo?r.each(this._newBlks,function(e){n.push(e.getId())}):this.isCollabRedo&&r.each(this._newBlks,function(e){n.push(e.toCollabJSON())}),e.insertedBlocks=n,this._preBlkId&&(e.preBlockId=this._preBlkId),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(1),s=n(0),a=n(103),l=n(54),c=n(3);return t=o.extend({name:"atom.DeleteBlocks",_note:null,_deletedBlocks:null,_deletedBlockIds:null,_preBlockId:null,initialize:function(){var e=this,n=e.options.args;c.isCollabCommand(n)||(e._note=e.options.note,e._deletedBlocks=s.sortBy(e.options.blocks,function(t){return e._note.getBlockIndex(t)}),e._deletedBlockIds=[],s.each(e._deletedBlocks,function(t){e._deletedBlockIds.push(t.getId())})),t.__super__.initialize.apply(e)},apply:function(){var e,t,n=this;return n._deletedBlockIds&&0!==n._deletedBlockIds.length?((t=n._note.getBlockById(n._deletedBlockIds[0]))&&t instanceof l&&t.hideImageTitle(),e=n._note.getPreBlock(t),n._preBlockId=e?e.getId():0,s.each(n._deletedBlockIds,function(e,t){n._note.removeBlockById(e,n._deletedBlockIds.length===t+1)}),!0):(r.error("没有指定要删除的段落"),!1)},doUnapply:function(){var e=this,t=0;e._preBlockId&&(t=e._note.getBlockIndexById(e._preBlockId)+1),s.each(e._deletedBlocks,function(n){e._note.insert(t,n),t++})},fromCollabJSON:function(){var e=this,n=e.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(e),e._note=n.coreEditor.getNote(),o&&o.preBlockId&&(e._preBlockId=o.preBlockId),n.isCollabUndo?(e._deletedBlocks=[],s.each(o.deletedBlocks,function(t){e._deletedBlocks.push(a.buildBlockFromJSON(t,n.coreEditor))})):n.isCollabRedo&&(e._deletedBlockIds=[],s.each(o.deletedBlocks,function(t){e._deletedBlockIds.push(t)}))},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this),n=[];return this.isCollabUndo?s.each(this._deletedBlocks,function(e){n.push(e.toCollabJSON())}):this.isCollabRedo&&s.each(this._deletedBlockIds,function(e){n.push(e)}),e.preBlockId=this._preBlockId,e.deletedBlocks=n,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(3),n(8),n(17),n(1),n(77)],void 0===(i=function(e,t,n,o,i,r,a,l){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromXml=function(e){throw new Error("The fromXml should be implemented by subclass!")},t.parseResourceList=function(e){var t=[];return $(e).find(">resource-list>resource-mono>res-id").each(function(e,n){var o=$(n).text();(o=$.trim(o))&&t.push(o)}),t},t.prototype.isSupportedBlockStyle=function(e){return l.isSupport(e,this.type)},t.prototype.isEmptyContent=function(){return!1},t.prototype.isEmpty=function(){return!1},t.prototype.setBlockStyle=function(e,t){var o=l.getConfig(e,this.type),i=/^-?\d+%$/;o&&("Enum"===o.type?o.possible[t]||(t=o.default):"Number"!==o.type||n.isNumber(t)?"Boolean"!==o.type||n.isBoolean(t)?n["is"+o.type]&&t&&!n["is"+o.type](t)&&(t=t.default):t="true"===t:(t=null===t||""===t?NaN:i.test(t)?t:Number(t),i.test(t)||!isNaN(t)&&t||(t=o.default)),t=t||o.default,this.styles[e]=t,this.trigger("style-change",e,t))},t.prototype.setBlockStyles=function(e){var t=this;e&&n.each(e,function(e,n){t.setBlockStyle(n,e)})},t.prototype.getBlockStyles=function(){return n.clone(this.styles)},t.prototype.getBlockStyle=function(e,t){var n=l.getConfig(e,this.type);return n?!0===t?this.styles[e]:this.styles[e]||n.default:null},t.prototype.getDefaultBlockStyles=function(){return l.getDefaultsOfBlock(this.type)},t.prototype.removeBlockStyles=function(){this.styles={},this.trigger("styles-reset")},t.prototype.removeAllStyles=function(){this.removeBlockStyles()},t.prototype.toXml=function(e){var n,o,i,r=this.getId();if(null!=r)return n=e.createElement(this.xmlNodeName),o=e.createElement(t.TAG_ID_NAME),i=e.createTextNode(r),o.appendChild(i),n.appendChild(o),n;a.debugAlert("The block has NO id",this)},t.prototype.getType=function(){return this.type},t.prototype.parseIdFromXml=function(e){var n,o;(n=this._getChildByTagName(e,t.TAG_ID_NAME))&&(o=n.textContent),o||i.IS_ANDROID||(n=this._getChildByTagName(e,t.LEGACY_TAG_ID_NAME))&&(o=n.textContent),null==o?this.validForCollab=!1:this.blockId=o},t.prototype.toJSON=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{blockId:this.getId(),blockType:this.type,styles:this.getBlockStyles(),type:this.type}},t.prototype.toHtml=function(e,t,n){throw new Error("toHtml() should be implemented by subclass!")},t.prototype.toPlain=function(e,t){throw new Error("toPlain() should be implemented by subclass!")},t.prototype.countWords=function(e){throw new Error("countWords() should be implemented by subclass!")},t.prototype.setResourceIds=function(e){e&&e.length&&(this.resourceIds=e)},t.prototype.getResourceIds=function(){return this.resourceIds},t.prototype.getExtraInfo=function(e){var t;return this.trigger("get-extra-info",e,function(e){t=e}),t},t.prototype.getDefaultSetFont=function(){var e;return this.trigger("get-default-set-font",function(t){e=t}),e},t.prototype.highlight=function(e,t,n){this.trigger("high-light",e,t,n)},t.prototype.getId=function(){var e=this.blockId;return null==e&&a.debugAlert("The blockId should NOT be null"),e},t.prototype.setId=function(e){null!=e?this.blockId=e:a.debugAlert("The param blockId should NOT be null")},t.prototype.setLocked=function(e,t){this.locked===e&&t&&!t.lockUpdated||(this.locked=e,this.trigger("locked-change",t))},t.prototype.isLocked=function(){return this.locked},t.prototype.getUnknownTree=function(){return this.unknownTree},t.prototype.isValidForCollab=function(){return this.validForCollab},t.prototype.resetLockState=function(){this.locked=!1},t.prototype.toCollabJSON=function(){return this.toJSON()},t.prototype.setReadOnly=function(e){this.readOnly=!!e},t.prototype.isReadOnly=function(){return this.readOnly},t.prototype.initialize=function(e){e=e||{},this.styles={},this.validForCollab=!0,null==this.blockId&&(null!=e.blockId||null!=e.id?this.blockId=e.blockId||e.id:this.blockId=o.newGUID()),this.unknownTree={}},t.prototype._getChildByTagName=function(e,t){if(e)for(var n=e.childNodes[0];n;){if(n.nodeName&&n.nodeName===t)return n;n=n.nextSibling}},t.TAG_ID_NAME="coId",t.LEGACY_TAG_ID_NAME="id",t}(r)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;!function(){function i(e,t){if(t=t||{},(e=e||"")instanceof i)return e;if(!(this instanceof i))return new i(e,t);var n=function(e){var t={r:0,g:0,b:0},n=1,o=!1,i=!1;return"string"==typeof e&&(e=function(e){e=e.replace(N,"").replace(A,"").toLowerCase();var t,n=!1;if(F[e])e=F[e],n=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};return(t=U.rgb.exec(e))?{r:t[1],g:t[2],b:t[3]}:(t=U.rgba.exec(e))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=U.hsl.exec(e))?{h:t[1],s:t[2],l:t[3]}:(t=U.hsla.exec(e))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=U.hsv.exec(e))?{h:t[1],s:t[2],v:t[3]}:(t=U.hsva.exec(e))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=U.hex8.exec(e))?{a:(o=t[1],w(o)/255),r:w(t[2]),g:w(t[3]),b:w(t[4]),format:n?"name":"hex8"}:(t=U.hex6.exec(e))?{r:w(t[1]),g:w(t[2]),b:w(t[3]),format:n?"name":"hex"}:!!(t=U.hex3.exec(e))&&{r:w(t[1]+""+t[1]),g:w(t[2]+""+t[2]),b:w(t[3]+""+t[3]),format:n?"name":"hex"};var o}(e)),"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(r=e.r,s=e.g,a=e.b,t={r:255*I(r,255),g:255*I(s,255),b:255*I(a,255)},o=!0,i="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=T(e.s),e.v=T(e.v),t=function(e,t,n){e=6*I(e,360),t=I(t,100),n=I(n,100);var o=O.floor(e),i=e-o,r=n*(1-t),s=n*(1-i*t),a=n*(1-(1-i)*t),l=o%6;return{r:255*[n,s,r,r,a,n][l],g:255*[a,n,n,s,r,r][l],b:255*[r,r,a,n,n,s][l]}}(e.h,e.s,e.v),o=!0,i="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=T(e.s),e.l=T(e.l),t=function(e,t,n){function o(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+6*(t-e)*(2/3-n):e}var i,r,s;if(e=I(e,360),t=I(t,100),n=I(n,100),0===t)i=r=s=n;else{var a=.5>n?n*(1+t):n+t-n*t,l=2*n-a;i=o(l,a,e+1/3),r=o(l,a,e),s=o(l,a,e-1/3)}return{r:255*i,g:255*r,b:255*s}}(e.h,e.s,e.l),o=!0,i="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=C(n),{ok:o,format:e.format||i,r:R(255,L(t.r,0)),g:R(255,L(t.g,0)),b:R(255,L(t.b,0)),a:n};var r,s,a}(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=B(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=B(this._r)),this._g<1&&(this._g=B(this._g)),this._b<1&&(this._b=B(this._b)),this._ok=n.ok,this._tc_id=x++}function r(e,t,n){e=I(e,255),t=I(t,255),n=I(n,255);var o,i,r=L(e,t,n),s=R(e,t,n),a=(r+s)/2;if(r==s)o=i=0;else{var l=r-s;switch(i=a>.5?l/(2-r-s):l/(r+s),r){case e:o=(t-n)/l+(n>t?6:0);break;case t:o=(n-e)/l+2;break;case n:o=(e-t)/l+4}o/=6}return{h:o,s:i,l:a}}function s(e,t,n){e=I(e,255),t=I(t,255),n=I(n,255);var o,i,r=L(e,t,n),s=R(e,t,n),a=r,l=r-s;if(i=0===r?0:l/r,r==s)o=0;else{switch(r){case e:o=(t-n)/l+(n>t?6:0);break;case t:o=(n-e)/l+2;break;case n:o=(e-t)/l+4}o/=6}return{h:o,s:i,v:a}}function a(e,t,n,o){var i=[E(B(e).toString(16)),E(B(t).toString(16)),E(B(n).toString(16))];return o&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function l(e,t,n,o){var i;return[E((i=o,Math.round(255*parseFloat(i)).toString(16))),E(B(e).toString(16)),E(B(t).toString(16)),E(B(n).toString(16))].join("")}function c(e,t){t=0===t?0:t||10;var n=i(e).toHsl();return n.s-=t/100,n.s=S(n.s),i(n)}function u(e,t){t=0===t?0:t||10;var n=i(e).toHsl();return n.s+=t/100,n.s=S(n.s),i(n)}function d(e){return i(e).desaturate(100)}function h(e,t){t=0===t?0:t||10;var n=i(e).toHsl();return n.l+=t/100,n.l=S(n.l),i(n)}function p(e,t){t=0===t?0:t||10;var n=i(e).toRgb();return n.r=L(0,R(255,n.r-B(-t/100*255))),n.g=L(0,R(255,n.g-B(-t/100*255))),n.b=L(0,R(255,n.b-B(-t/100*255))),i(n)}function g(e,t){t=0===t?0:t||10;var n=i(e).toHsl();return n.l-=t/100,n.l=S(n.l),i(n)}function f(e,t){var n=i(e).toHsl(),o=(B(n.h)+t)%360;return n.h=0>o?360+o:o,i(n)}function m(e){var t=i(e).toHsl();return t.h=(t.h+180)%360,i(t)}function _(e){var t=i(e).toHsl(),n=t.h;return[i(e),i({h:(n+120)%360,s:t.s,l:t.l}),i({h:(n+240)%360,s:t.s,l:t.l})]}function y(e){var t=i(e).toHsl(),n=t.h;return[i(e),i({h:(n+90)%360,s:t.s,l:t.l}),i({h:(n+180)%360,s:t.s,l:t.l}),i({h:(n+270)%360,s:t.s,l:t.l})]}function b(e){var t=i(e).toHsl(),n=t.h;return[i(e),i({h:(n+72)%360,s:t.s,l:t.l}),i({h:(n+216)%360,s:t.s,l:t.l})]}function v(e,t,n){t=t||6,n=n||30;var o=i(e).toHsl(),r=360/n,s=[i(e)];for(o.h=(o.h-(r*t>>1)+720)%360;--t;)o.h=(o.h+r)%360,s.push(i(o));return s}function k(e,t){t=t||6;for(var n=i(e).toHsv(),o=n.h,r=n.s,s=n.v,a=[],l=1/t;t--;)a.push(i({h:o,s:r,v:s})),s=(s+l)%1;return a}function C(e){return e=parseFloat(e),(isNaN(e)||0>e||e>1)&&(e=1),e}function I(e,t){(function(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!=e.indexOf("%")}(e);return e=R(t,L(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),O.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function S(e){return R(1,L(0,e))}function w(e){return parseInt(e,16)}function E(e){return 1==e.length?"0"+e:""+e}function T(e){return 1>=e&&(e=100*e+"%"),e}var N=/^\s+/,A=/\s+$/,x=0,O=Math,B=O.round,R=O.min,L=O.max,D=O.random;i.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,n,o=this.toRgb();return e=o.r/255,t=o.g/255,n=o.b/255,.2126*(.03928>=e?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(.03928>=t?t/12.92:Math.pow((t+.055)/1.055,2.4))+.0722*(.03928>=n?n/12.92:Math.pow((n+.055)/1.055,2.4))},setAlpha:function(e){return this._a=C(e),this._roundA=B(100*this._a)/100,this},toHsv:function(){var e=s(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=s(this._r,this._g,this._b),t=B(360*e.h),n=B(100*e.s),o=B(100*e.v);return 1==this._a?"hsv("+t+", "+n+"%, "+o+"%)":"hsva("+t+", "+n+"%, "+o+"%, "+this._roundA+")"},toHsl:function(){var e=r(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=r(this._r,this._g,this._b),t=B(360*e.h),n=B(100*e.s),o=B(100*e.l);return 1==this._a?"hsl("+t+", "+n+"%, "+o+"%)":"hsla("+t+", "+n+"%, "+o+"%, "+this._roundA+")"},toHex:function(e){return a(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return l(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:B(this._r),g:B(this._g),b:B(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+B(this._r)+", "+B(this._g)+", "+B(this._b)+")":"rgba("+B(this._r)+", "+B(this._g)+", "+B(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:B(100*I(this._r,255))+"%",g:B(100*I(this._g,255))+"%",b:B(100*I(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+B(100*I(this._r,255))+"%, "+B(100*I(this._g,255))+"%, "+B(100*I(this._b,255))+"%)":"rgba("+B(100*I(this._r,255))+"%, "+B(100*I(this._g,255))+"%, "+B(100*I(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(V[a(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+l(this._r,this._g,this._b,this._a),n=t,o=this._gradientType?"GradientType = 1, ":"";e&&(n=i(e).toHex8String());return"progid:DXImageTransform.Microsoft.gradient("+o+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,o=this._a<1&&this._a>=0;return!t&&o&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e)?"name"===e&&0===this._a?this.toName():this.toRgbString():("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),("hex"===e||"hex6"===e)&&(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return i(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(h,arguments)},brighten:function(){return this._applyModification(p,arguments)},darken:function(){return this._applyModification(g,arguments)},desaturate:function(){return this._applyModification(c,arguments)},saturate:function(){return this._applyModification(u,arguments)},greyscale:function(){return this._applyModification(d,arguments)},spin:function(){return this._applyModification(f,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(v,arguments)},complement:function(){return this._applyCombination(m,arguments)},monochromatic:function(){return this._applyCombination(k,arguments)},splitcomplement:function(){return this._applyCombination(b,arguments)},triad:function(){return this._applyCombination(_,arguments)},tetrad:function(){return this._applyCombination(y,arguments)}},i.fromRatio=function(e,t){if("object"==typeof e){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]="a"===o?e[o]:T(e[o]));e=n}return i(e,t)},i.equals=function(e,t){return!(!e||!t)&&i(e).toRgbString()==i(t).toRgbString()},i.random=function(){return i.fromRatio({r:D(),g:D(),b:D()})},i.mix=function(e,t,n){n=0===n?0:n||50;var o,r=i(e).toRgb(),s=i(t).toRgb(),a=n/100,l=2*a-1,c=s.a-r.a,u=1-(o=((o=-1==l*c?l:(l+c)/(1+l*c))+1)/2);return i({r:s.r*o+r.r*u,g:s.g*o+r.g*u,b:s.b*o+r.b*u,a:s.a*a+r.a*(1-a)})},i.readability=function(e,t){var n=i(e),o=i(t);return(Math.max(n.getLuminance(),o.getLuminance())+.05)/(Math.min(n.getLuminance(),o.getLuminance())+.05)},i.isReadable=function(e,t,n){var o,r,s,a,l,c=i.readability(e,t);switch(r=!1,"AA"!==(a=((s=(s=n)||{level:"AA",size:"small"}).level||"AA").toUpperCase())&&"AAA"!==a&&(a="AA"),"small"!==(l=(s.size||"small").toLowerCase())&&"large"!==l&&(l="small"),(o={level:a,size:l}).level+o.size){case"AAsmall":case"AAAlarge":r=c>=4.5;break;case"AAlarge":r=c>=3;break;case"AAAsmall":r=c>=7}return r},i.mostReadable=function(e,t,n){var o,r,s,a,l=null,c=0;r=(n=n||{}).includeFallbackColors,s=n.level,a=n.size;for(var u=0;u<t.length;u++)(o=i.readability(e,t[u]))>c&&(c=o,l=i(t[u]));return i.isReadable(e,l,{level:s,size:a})||!r?l:(n.includeFallbackColors=!1,i.mostReadable(e,["#fff","#000"],n))};var P,M,H,F=i.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},V=i.hexNames=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}(F),U=(M="[\\s|\\(]+("+(P="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+P+")[,|\\s]+("+P+")\\s*\\)?",H="[\\s|\\(]+("+P+")[,|\\s]+("+P+")[,|\\s]+("+P+")[,|\\s]+("+P+")\\s*\\)?",{rgb:new RegExp("rgb"+M),rgba:new RegExp("rgba"+H),hsl:new RegExp("hsl"+M),hsla:new RegExp("hsla"+H),hsv:new RegExp("hsv"+M),hsva:new RegExp("hsva"+H),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});e.exports?e.exports=i:void 0===(o=function(){return i}.call(t,n,t,e))||(e.exports=o)}()},function(e,t,n){var o,i,r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};o=[n,t,n(0),n(2),n(99),n(1),n(100),n(125),n(126),n(101),n(36),n(43),n(128),n(70)],void 0===(i=function(e,t,n,o,i,s,a,l,c,u,d,h,p,g){"use strict";return function(){function e(){}return e.createRangeByBlock=function(e){if(e&&e.block){var t,n=e.block,f=n.getType(),m=0,_=0;switch(null!=e.start&&null!=e.end?(m=e.start,_=e.end):(null==e.allContent&&null==e.collapseToStart||!0===e.allContent)&&null!=n.getEndOffset?(m=0,_=n.getEndOffset()):e.collapseToStart||null==n.getEndOffset?(m=0,_=0):_=m=n.getEndOffset(),f){case o.QUOTE:case o.TODO:case o.PARAGRAPH:case o.LIST_ITEM:case o.CATALOGUE:case o.HEADING:t=new d({block:n,end:_,start:m});break;case o.IMAGE:t=new u({block:n});break;case o.ATTACHMENT:t=new a({block:n});break;case o.TABLE:e.allContent&&(e.type=h.TYPES.ALL,delete e.allContent),e.type||e.rect||s.warn("Bad tableRange options will select first table cell",e),t=new h({block:n,rect:e.rect,type:e.type});break;case o.HR:t=new c({block:n});break;case o.UNKNOWN:t=new p({block:n});break;case o.HEADER_FOOTER:t=new i({block:n});break;case o.HANDWRITE:t=new l({block:n});break;case o.CODE:t=e.hasOwnProperty("selectWholeBlock")?new g(r({block:n},e)):new g({block:n,selectWholeBlock:!0});break;default:s.error("block.type ["+f+"] is not valid!")}return t}s.warn("arguments is not valid!")},e.isBlockRange=function(e){return null!=e&&null!=e.getType&&null!=e.getType()&&n.contains(o.getAllBlockTypes(),e.getType())},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(1),o=n(0);return{bubble:function(e,n,i,r){if(e&&n&&i){var s=o.isArray(e);o.each(e,function(e,t){e&&(s?t=e:!0===e&&(e=t),!0===r&&n.off(t),n.on(t,i.trigger.bind(i,e)))})}else t.log("arguments are not valid",arguments)},addListeners:function(e,n,i,r){e&&n&&i?o.each(e,function(e,t){!0===r&&n.off(t),n.on(t,i[e].bind(i))}):t.log("arguments are not valid",arguments)}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(1),n(140)],void 0===(i=function(e,t,n,o,i){"use strict";return function(){function e(){}return e.getAllValueByFont=function(t){var n=e.getFont(t);if(n)return e.FONT_MAP[n].join(",");o.warn("Font does not exit in Font Maps: "+t)},e.getFontMap=function(){return e.FONT_MAP},e.getFont=function(t){var o,i;if((t=(t||"").toLowerCase())&&(i=e.splitFontFamily(t)))return n.some(i,function(t){if(n.some(e.FONT_MAP,function(n,i){if(i.toLowerCase()===t||e.CONTAIN_IGNORE_CASE(n,t))return o=i,!0}),o)return!0}),o},e.getFontFirstValue=function(t){var n,o=e.getFont(t);if(n=e.FONT_MAP[o])return n[0]},e.getItems=function(){var t=[];return n.each(e.FONT_MAP,function(e,n){t.push({fullValue:e.join(","),name:n,singleValue:e[0]})}),t},e.getNames=function(){return n.keys(e.FONT_MAP)},e.splitFontFamily=function(e){var t,o=[];return(e=$.trim(e||""))?(t=e.split(","),n.each(t,function(e){e=e||"",(e=$.trim(e.replace(/["']/g,"")))&&o.push(e)}),o):[]},e.CONTAIN_IGNORE_CASE=function(e,t){return n.some(e,function(e){return(e+"").toLowerCase()===t})},e.DEFAULT_FONT=i.DEFAULT_FONT,e.FONT_MAP={"微软雅黑":[i.DEFAULT_FONT,"STXihei"],"宋体":["SimSun","STSong"],"新宋体":["NSimSun"],"仿宋":["FangSong_GB2312","FangSong","STFangsong"],"楷体":["KaiTi_GB2312","KaiTi","STKaiti"],"黑体":["SimHei","STHeiti"],Arial:["Arial"],"Arial Black":["Arial Black"],"Times New Roman":["Times New Roman"],"Courier New":["Courier New"],Tahoma:["Tahoma"],Verdana:["Verdana"]},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(6),n(113),n(1)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(){function e(){}return e.appendToTree=function(e,t){if(e&&t){var n=$(t).attr(o.COMPAT);i.isCompatible(n)&&(e.unknown||(e.unknown=[]),e.unknown.push(t.cloneNode(!0)))}else r.error("arguments are not valid!")},e.appendToXml=function(e,t){e&&t?e.unknown&&e.unknown.length&&n.each(e.unknown,function(e){var n;e&&e.cloneNode&&(n=e.nodeName,$(t).find(">"+n).length>0?r.error("unknown node <"+n+"> has already exist!"):t.appendChild(e.cloneNode(!0)))}):r.error("arguments are not valid!")},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(62),n(142),n(10),n(21)],void 0===(i=function(e,t,n,o,i,r,s){"use strict";return function(){function e(){}return e.getCssRule=function(t){return e.globalInlineStyleRules[t]},e.getDefaultForHtml=function(t){var n,o,i,r=e.inlineStyleDefaultForHtml[t];return null==r&&(n=e.getCssRule(t),o=s.getDefault(t),n?((i={})[t]=o,r=n(i)):r=o,e.inlineStyleDefaultForHtml[t]=r),r},e.html2rich=function(e){return new r({text:$(e).text()})},e.rich2html=function(t,o){var r,s,a,l,c,u,d,h=t.getReadOnlyData(),p=t.getEntities(),g=h.length,f=[],m="";if(o=n.defaults(o||{},{customDefaultStyles:null,styleRules:null,withDefault:!0,styles:null}),0===g)return"<br>";for(r=t.getReadOnlyStylesList(o.withDefault,o.customDefaultStyles,o.styles),o.styleRules?(d=n.clone(o.styleRules),n.defaults(d,e.globalInlineStyleRules)):d=e.globalInlineStyleRules,d=i.getRules(d),p&&p.length&&(l=n.pluck(p,"start")),s=0;s<g;++s)a=h[s],u=r[s],e.isEqualStyles(c,u)||(e.handleEndStyles(f),m!==u.href&&(e.handleEndHref(f),e.handleStartHref(f,u.href)),e.handleStartStyles(f,u,d)),f.push(n.escape(a.toString())),l&&n.contains(l,s)&&f.push('<span class = "loading" ></span>'),c=u,m=u.href;return e.handleEndStyles(f),e.handleEndHref(f),f.join("")},e.resetCssRules=function(){e.globalInlineStyleRules={},e.resetInlineStyleDefaultForHtml()},e.resetInlineStyleDefaultForHtml=function(t){t?(t+="",delete e.inlineStyleDefaultForHtml[t]):e.inlineStyleDefaultForHtml={}},e.setCssRules=function(t){n.each(t,function(t,o){n.isFunction(t)&&(e.globalInlineStyleRules[o]=t,e.resetInlineStyleDefaultForHtml(o))})},e.anchorEndTag=function(){return"</a>"},e.anchorStartTag=function(e){return e+="",'<a href="'+o.safeHref(e)+'">'},e.handleEndHref=function(t){t.push(e.anchorEndTag())},e.handleEndStyles=function(t){t.push(e.spanEndTag())},e.handleStartHref=function(t,n){n&&t.push(e.anchorStartTag(n))},e.handleStartStyles=function(t,o,i){n.isEmpty(o)||t.push(e.spanStartTag(o,i))},e.isEqualStyles=function(t,n){if(!t||!n)return!1;var o,i=e.supportedInlineStyleNames.length;for(o=0;o<i;o++)if(t[e.supportedInlineStyleNames[o]]!==n[e.supportedInlineStyleNames[o]])return!1;return!0},e.spanEndTag=function(){return"</span>"},e.spanStartTag=function(e,t){var o=document.createElement("span");return n.each(t,function(t,n){var i=t(e);(i||0===i)&&(o.style[n]=i)}),o.outerHTML.replace(/<\/span>$/i,"")},e.globalInlineStyleRules={},e.inlineStyleDefaultForHtml={},e.supportedInlineStyleNames=s.getStyleNames(),e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.listeners=[],this.maxListeners=null}return e.prototype.addListener=function(e,t){return this.on(e,t)},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=this._filterMatchedEvent(this.listeners,e);return o.length>0&&(this._invokeListeners.apply(this,[o].concat(t)),this.listeners=this._filterNotMatchedEvent(this.listeners,e,!0)),o.length>0},e.prototype.getMaxListeners=function(){return null===this.maxListeners?e.defaultMaxListeners:this.maxListeners},e.prototype.listenerCount=function(e){return this._filterMatchedEvent(this.listeners,e).length},e.prototype.on=function(e,t){return this._register({event:e,listener:t,once:!1}),this},e.prototype.off=function(e,t){return this._unregister({event:e,listener:t}),this},e.prototype.once=function(e,t){return this._register({event:e,listener:t,once:!0}),this},e.prototype.removeAllListeners=function(e){return this.listeners=null!=e?this._filterNotMatchedEvent(this.listeners,e):[],this},e.prototype.removeListener=function(e,t){return this.listeners=this._filterNotMatchedEvent(this.listeners,e,null,t),this},e.prototype.setMaxListeners=function(e){return this.maxListeners=e,this},e.prototype._invokeListeners=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e.map(function(e){return e.listener.apply(e,t)})},e.prototype._register=function(e){if(this._checkListenerLimitReached(e.event))throw new Error("Listner Limit Reached:"+this.maxListeners);this.listeners.unshift(e)},e.prototype._unregister=function(e){this.listeners=this._filterNotMatchedEvent(this.listeners,e.event,null,e.listener)},e.prototype._returnListenerLimit=function(){return null===this.maxListeners?e.defaultMaxListeners:this.maxListeners},e.prototype._checkListenerLimitReached=function(e){return this.listenerCount(e)===this._returnListenerLimit()},e.prototype._filterMatchedEvent=function(e,t,n){return e.filter(function(e,o,i){return null==n?e.event===t:e.event===t&&e.once===n},this)},e.prototype._filterNotMatchedEvent=function(e,t,n,o){return e.filter(function(e,i,r){var s=e.event!==t;return!1===s&&null!=n&&(s=e.once!==n),!1===s&&null!=o&&(s=e.listener!==o),s},this)},e.defaultMaxListeners=10,e}();t.YEvent=n}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(1),n(41)],void 0===(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.getRange=function(t){var o,i=e.getSelection(t);return i?i.rangeCount>0?o=i.getRangeAt(0):n.warn("The selection has no range!"):n.warn("The selection is null!"),o},e.getSelection=function(e){return(e=e||window).getSelection()},e.isNodeInRange=function(t,o){if(!t)return n.warn("The param node is unvalid!"),!1;var i,r=t.ownerDocument||document,s=r.defaultView,a=s.Range;return o=o||e.getRange(s),(i=r.createRange()).selectNode(t),o.compareBoundaryPoints(a.START_TO_START,i)<1&&o.compareBoundaryPoints(a.END_TO_END,i)>-1},e.isRangeInNode=function(t,o){if(!t)return n.warn("The param node is unvalid!"),!1;var i,r=(t.ownerDocument||document).defaultView;if(!(o=o||e.getRange(r)))return n.warn("The native range is null!"),!1;for(i=o.commonAncestorContainer;i;){if(i===t)return!0;i=i.parentNode}return!1},e.isRangeInSelector=function(t,n){if(!t)return!1;var i;if(i=(n=n||e.getRange()).commonAncestorContainer,!n||!i)return!1;for(o.isText(i)&&(i=i.parentElement||i.parentNode);i&&i.webkitMatchesSelector;){if(i.webkitMatchesSelector(t))return!0;i=i.parentNode}return!1},e.removeAllRanges=function(t){var n=e.getSelection(t);n&&n.removeAllRanges()},e.setRange=function(t,o){var i=e.getSelection(o);i&&t?(i.removeAllRanges(),i.addRange(t)):n.warn("The selection or range is null!")},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(7),i=n(12),r=n(8),s=n(135),a=n(74),l=n(20);return a.extend({className:"toolbar-item toolbar-button",events:{click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp"},name:"unknown",label:"unknown",defaultState:!1,state:!1,templateName:"toolbar-button-template",editorEvents:{"yne-editing-state-change":"onEditingStateChange","yne-selection-change":"onSelectionChange"},shortcut:null,onEditingStateChange:function(){},onSelectionChange:s,initialize:function(e){this.editor=e.editor,this.render(),this.setState(this.defaultState),this.bindEditorEvents(),this.bindEvents()},render:function(){var e,t=this.$el,n=this.label;t.addClass("button-"+this.name),e=i.render("web",this.templateName,{name:this.name,label:this.label,defaultState:this.defaultState}),t.html(e),null==this.shortcut||""===this.shortcut||l.isSafari()&&!r.IS_MAC||(n="<div><span>"+this.label+'</span><span class="split"></span><span>'+this.shortcut+"</span><div>"),t.find(".button").tooltipster({animation:"",animationDuration:0,theme:["tooltipster-borderless","tooltipster-borderless-customized"],side:"bottom",delay:[800,300],content:n,contentAsHTML:!0}),this.isVisible||this.hide()},bindEvents:function(){},bindEditorEvents:function(){var e=this,n=e.editor,o=e.editorEvents;o&&t.each(o,function(t,o){n.on(o,e[t].bind(e))})},onMouseUp:function(){var e=o(window);e.is(":focus")||e.focus()},onMouseDown:function(e){e.preventDefault()},onClick:function(){},setState:function(e){var t=this.$el;e=!0===e,this.state=e,e?t.find(".button").addClass("active"):t.find(".button").removeClass("active")},reset:function(){this.setState(this.defaultState)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(63),n(17),n(1)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromCollabJSON=function(e){return new t({listId:e.id,type:e.type})},t.fromXml=function(e){var o=$(e),i=new t({listId:o.attr("id"),type:o.attr("type")});return n.each(e.attributes,function(e){switch(e.nodeName){case"id":case"type":break;default:i.unknownAttrs.push(e.cloneNode(!0))}}),i},t.prototype.addItem=function(e){e&&(this.listItems.push(e),this.updateIndexes())},t.prototype.getId=function(){return this.listProps.listId},t.prototype.getItems=function(){return this.listItems},t.prototype.getLength=function(){return this.listItems.length},t.prototype.getType=function(){return this.listProps.type},t.prototype.insertAfter=function(e,t){var n=this.listItems,o=t?n.indexOf(t):-1;this.insertItem(o+1,e)},t.prototype.insertItem=function(e,t){var n=this.listItems;return o(e>0||e<=n.length),o(!(t in n)),n.splice(e,0,t),this.updateIndexes(),e},t.prototype.isOrdered=function(){return this.listProps.type===t.ORDERED},t.prototype.isUnordered=function(){return this.listProps.type===t.UNORDERED},t.prototype.removeItem=function(e){var t=this.listItems,n=t.indexOf(e);return n>=0&&(t.splice(n,1),this.updateIndexes()),n},t.prototype.setType=function(e){o(e===t.ORDERED||e===t.UNORDERED),e!==this.listProps.type&&(this.listProps.type=e,this.updateIndexes(!0),this.trigger("type-change"))},t.prototype.toCollabJSON=function(){var e={};return e.id=this.listProps.listId,e.type=this.listProps.type,e},t.prototype.updateIndexes=function(e){var t,n,o,i=this.listItems,r=i.length,s=0,a={};for(t=0;t<r;++t)(o=(n=i[t]).getLevel())>s?a[o]=1:a[o]?a[o]++:a[o]=1,s=o,n.setIndex(a[o]),e&&n.updateListType()},t.prototype.initialize=function(e){this.listProps=n.clone(e),this.listItems=[],this.unknownAttrs=[],this.listProps.type!==t.ORDERED&&this.listProps.type!==t.UNORDERED&&(r.error("type should be ORDERED or UNORDERED",this.listProps.type),this.listProps.type=t.UNORDERED)},t.ORDERED="ordered",t.UNORDERED="unordered",t}(i)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(3),n(39),n(34),n(29),n(63),n(1),n(6),n(90),n(24),n(2),n(121),n(19),n(30),n(10)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h,p,g,f,m,_){"use strict";return function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.createBlank=function(){return new t({})},t.fromCollabJSON=function(e){return this.generalFromJSON(e,!0)},t.fromJSON=function(e){return this.generalFromJSON(e,!1)},t.fromXml=function(e){var n,o=$(e),r=parseInt(o.attr("level"),10)||1;return(n=new t({level:r})).setText(_.fromXml(e)),n.parseIdFromXml(e),$(e).children().each(function(e,t){switch(t.nodeName){case h.TAG_ID_NAME:case h.LEGACY_TAG_ID_NAME:case"text":case"inline-styles":break;case"styles":i.fromXml(n,t);break;default:a.appendToTree(n.unknownTree,t)}}),n},t.getOrCreateListById=function(e,t,n){var i,s,a=null,l=t;for(s=e.length-1;s>=0;--s)i=e[s],p.isListItem(i)&&i.getOwnerList()&&i.getOwnerList().getId()===t&&(i.getOwnerList().getType()===n?a=i.getOwnerList():l=o.newGUID());return a||(a=new r({listId:l,type:n})),a},t.generalFromJSON=function(t,n){var o=e.generalFromJSON.call(this,t,n);return o&&(t.listId&&o.setListId(t.listId),t.listType&&o.setListType(t.listType),t.level&&o.setLevel(t.level),t.index&&o.setIndex(t.index)),o},t.prototype.getIndex=function(){return this.index},t.prototype.getListId=function(){return this.ownerList?this.ownerList.getId():this.listItemProps.listId},t.prototype.getListType=function(){return this.ownerList?this.ownerList.getType():this.listItemProps.listType},t.prototype.getLevel=function(){return this.listItemProps.level},t.prototype.getOwnerList=function(){return this.ownerList},t.prototype.isOrdered=function(){return this.ownerList.isOrdered()},t.prototype.setIndex=function(e){n.isNumber(e)&&e>0&&(this.index=e,this.trigger("index-change",e))},t.prototype.setLevel=function(e){n.isNumber(e)&&(e=Math.max(e,1),e=Math.min(e,u.MAX_LIST_ITEM_LEVEL),this.listItemProps.level=e,this.ownerList&&this.ownerList.updateIndexes(),this.trigger("level-change",e))},t.prototype.setListId=function(e){this.listItemProps.listId?c.error("should not override existing listId"):this.listItemProps.listId=e},t.prototype.setListType=function(e){this.listItemProps.listType?c.error("should not override existing listType"):this.listItemProps.listType=e},t.prototype.setOwnerList=function(e){this.ownerList=e,this.ownerList&&(this.listItemProps.listId=this.ownerList.getId(),this.listItemProps.listType=this.ownerList.getType())},t.prototype.toCollabJSON=function(){return this._generalToJSON(null,null,!0)},t.prototype.toHtml=function(e,t,n){var o,i,r,s=document.createElement("li"),a=$(s);return n=!0===n,this.applyBlockStylesOnElement(a),a.css("list-style-position","inside").css("white-space","pre-wrap").css("word-break","break-word"),(r=g.makeHtmlMarker(this))&&r.listStyleType&&a.css("list-style-type",r.listStyleType),r&&r.markerStyles&&a.css(r.markerStyles),e=e||0,o=this.sliceText(e,t,!1),i=m.rich2html(o,{withDefault:n}),s.innerHTML=i,s.outerHTML},t.prototype.toJSON=function(e,t){return this._generalToJSON(e,t,!1)},t.prototype.toPlain=function(e,t){var n;return e=e||0,n=this.sliceText(e,t,!1).toString(),n=d(n)},t.prototype.toXml=function(t){var n,o=this.getOwnerList();if(o)return(n=e.prototype.toXml.apply(this,[t])).setAttribute("level",this.getLevel().toString()),n.setAttribute("list-id",this.listItemProps.listId),{listId:this.listItemProps.listId,listItem:n,listType:o.getType(),ownerList:o};c.error("The list item has no owner list!")},t.prototype.updateListType=function(){this.ownerList&&(this.listItemProps.listType=this.ownerList.getType())},t.prototype.initialize=function(t){var o=t.level||1;e.prototype.initialize.call(this,t),this.type=p.LIST_ITEM,this.listItemProps=n.clone(t),this.setLevel(o),this.setIndex(1),t.list&&(this.ownerList=t.list,this.listItemProps.listId=this.ownerList.getId(),this.listItemProps.listType=this.ownerList.getType()),!this.listItemProps.listId&&t.listId&&(this.listItemProps.listId=t.listId),!this.listItemProps.listType&&t.listType&&(this.listItemProps.listType=t.listType),t.id&&this.setId(t.id),t.text&&this.setText(t.text),this.on("attached",this._onAttached.bind(this)),this.on("detached",this._onDetached.bind(this))},t.prototype._onAttached=function(e){var n,o,i=this.getOwnerList(),r=e.getAllBlocks(),s=e.getBlockIndex(this),a=null;if(l(s>=0,"Block not attached yet.",s,this),!i&&this.getListId()&&(i=t.getOrCreateListById(r,this.getListId(),this.getListType()),this.setOwnerList(i)),0===i.getLength())i.insertAfter(this,null);else{for(n=s-1;n>=0;--n)if(o=r[n],p.isListItem(o)&&o.getOwnerList()===i){a=o;break}i.insertAfter(this,a)}},t.prototype._onDetached=function(){this.getOwnerList().removeItem(this)},t.prototype._generalToJSON=function(t,n,o){var i;return(i=o?e.prototype.toCollabJSON.call(this):e.prototype.toJSON.call(this,t,n)).level=this.getLevel(),i.index=this.getIndex(),this.listItemProps.listId&&(i.listId=this.listItemProps.listId),this.listItemProps.listType&&(i.listType=this.listItemProps.listType),i},t}(f)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(2),n(1),n(42)],void 0===(i=function(e,t,n,o,i){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.create=function(e){return new t(e)},t.fromCollabJSON=function(e,r){var s=e.rangeType;if(s===n.PARAGRAPH){var a=i.getBlockById(e.blockId,r);if(a){var l={block:a,end:e.endPosition,start:e.startPosition};return t.create(l)}}else o.error("wrong block range type:",s)},t.prototype.isCollapsed=function(){return this.start===this.end},t.prototype.clone=function(){return t.create({block:this.block,end:this.end,start:this.start})},t.prototype.collapse=function(e){void 0===e&&(e=!0),e?this.end=this.start:this.start=this.end},t.prototype.expandToStart=function(){this.start=this.block.getStartOffset()},t.prototype.expandToEnd=function(){this.end=this.block.getEndOffset()},t.prototype.getDataAsJSON=function(){return this.block.toJSON(this.start,this.end)},t.prototype.getDataAsHtml=function(e){return this.block.toHtml(this.start,this.end,e)},t.prototype.getDataAsPlain=function(){return this.block.toPlain(this.start,this.end)},t.prototype.getContent=function(){return this.block.sliceText(this.start,this.end)},t.prototype.canDrawedByNative=function(){return!0},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.startPosition=this.start,t.endPosition=this.end,t},t.prototype.initialize=function(e){this.type=n.PARAGRAPH,this.start=e.start||0,this.end=e.end||0,this.block=e.block},t}(i)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.setUnderscore=function(e){t.underscoreInst=e},e.setLogger=function(e){t.loggerInst=e},e}();t.ExternalLibs=n}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(18),o=n(7),i=n(0),r=n(6),s=n(2),a=n(1),l=n(110),c=n(458),u=o('<div class="collab-editing-view-wrapper"><div class="collab-session-view"></div></div>');return t.View.extend({className:"block-view unknown-block-view",_isReadOnly:!1,_pageInfo:null,_$pageBreakContainer:null,PAGE_HEIGHT:null,_viewHeightInlastPaging:null,block:null,_getSelector:function(){var e=this.tagName,t=this.className.split(/\s+/),n=this.id,o=this.cid,r=".note-view ";return r+=e,n&&(r+="#"+n),i.each(t,function(e){e&&(r+="."+e)}),r+='[data-yne-cid="'+o+'"]'},initialize:function(e){this.block=e.block,this._isReadOnly=e.isReadOnly,i.bindAll(this,"_onLockedChange"),this.block.on("locked-change",this._onLockedChange),e.inlineStyleViewMapper&&(this._inlineStyleViewMapper=e.inlineStyleViewMapper),this._pageInfo={},this.PAGE_HEIGHT=e.pageSize.height,i.isNumber(this.PAGE_HEIGHT)||(a.debugAlert("invalid PAGE_HEIGHT:"+this.PAGE_HEIGHT),this.PAGE_HEIGHT=r.PAGE_TYPE_NONE_HEIGHT),this._$pageBreakContainer=e.pageBreakContainer,this.noteView=e.noteView},render:function(){this.$el.attr("data-yne-cid",this.cid),this._updateLockState(this.isLocked()),s.isListItem(this.block)||this.trigger("view-height-changed",this.cid)},convertToNativeRange:function(){a.error("convertToNativeRange() should be implemented by subclass!")},parseNativeRange:function(){a.error("parseNativeRange() should be implemented by subclass!")},bindSelectionEvents:function(){i.bindAll(this,"onDrawRange"),this.on("draw-range",this.onDrawRange)},onDrawRange:function(){throw"Method not implemented."},_onLockedChange:function(e){this._updateLockState(this.isLocked()),this._updateLockIndicator(this.block.isLocked(),e),this.trigger("locked-change"),this.trigger("view-height-changed",this.cid)},isCollabLocked:function(){var e=this.block,t=!1;return e&&(t=e.isLocked()),t},isLocked:function(){var e=this.block,t=this._isReadOnly;return e&&(t=e.isLocked()||this._isReadOnly),t},_updateLockIndicator:function(e,t){var n,o,i=t&&t.lockColor,r=t&&t.nickname;null!=(n=this.$el.find(".collab-editing-view-wrapper"))&&0!==n.length||(n=u.clone(),this.$el.prepend(n)),o=n.find(".collab-session-view"),e?(this.$el.addClass("collab-editing-view"),null!=r&&o.text(r),null!=i&&o.css("background-color",i)):(this.$el.removeClass("collab-editing-view"),this.$el.find(".collab-editing-view-wrapper").remove())},_updateLockState:function(e){e?this.$el.addClass("collab-locked"):this.$el.removeClass("collab-locked")},onDestroy:function(){l.warn("onDestroy() was not implemented by "+this.block.type+" view")},clearHighlight:function(){},clearPageBreaks:function(){var e=this;i.each(e._pageInfo,function(t){t&&t.pageBreak&&e._removePageBreak(t.pageBreak)}),e._pageInfo={}},coincideAllPageBreaks:function(){var e=this;e._pageInfo?i.each(e._pageInfo,function(t){t&&t.pageBreak&&e._coincidePageBreak(t.pageBreak)}):a.debugAlert("pageInfo should not be null when coincideAllPageBreaks")},disablePageMode:function(){this.clearPageBreaks(),this.PAGE_HEIGHT=r.PAGE_HEIGHT_NONE},enablePageMode:function(e){this.clearPageBreaks(),e===r.PAGE_TYPE_A4?this.PAGE_HEIGHT=r.PAGE_HEIGHT_A4:e===r.PAGE_TYPE_B5?this.PAGE_HEIGHT=r.PAGE_HEIGHT_B5:e===r.PAGE_TYPE_TEST?this.PAGE_HEIGHT=r.PAGE_HEIGHT_TEST:this.PAGE_HEIGHT=r.PAGE_HEIGHT_NONE},getBottomPosInPage:function(e){var t;return this._pageInfo[e]?this._pageInfo[e].pageBreak?t=-1:(t=this._pageInfo[e].topPosInPage+this._getHeightInPage(e))>this.PAGE_HEIGHT&&a.warn("Unsplitted Block whose Height is more than PAGE_HEIGHT",this._pageInfo[e].topPosInPage,t,this.PAGE_HEIGHT):(a.debugAlert("should NOT invoke the getBottomPosInPage when the view is NOT on the page"),t=0),t},getFirstTransPageIndex:function(){var e={};return this._pageInfo?(i.each(this._pageInfo,function(t){t&&(null==e.pageIndex?e=t:t.pageIndex<e.pageIndex&&(e=t))}),e.pageIndex):(a.debugAlert("pageInfo should not be null when getFirstTransPageIndex"),null)},getLastTransPageIndex:function(){var e={};return this._pageInfo?(i.each(this._pageInfo,function(t){t&&(null==e.pageIndex?e=t:t.pageIndex>e.pageIndex&&(e=t))}),e.pageIndex):(a.debugAlert("pageInfo should not be null when getLastTransPageIndex"),null)},isOnFloat:function(){return"none"!==(this.$el.css("float")||"none").toLowerCase()},resetPageInfo:function(e,t){var n,o,r,s=!1;return this._pageInfo?i.isNumber(t)?null==e?(a.debugAlert("pageIndex should NOT be null"),s):null==this._$pageBreakContainer?(a.debugAlert("pageBreakContainer should not be null"),s):(this._pageInfo[e]&&(n=this._pageInfo[e].topPosInPage),t=Math.ceil(t),this.clearPageBreaks(),this._updatePageInfo(e,t),this.$el.css("height","auto"),o=this.$el.find(".page-break-placeholder"),this.$el.hasClass("quote-view")&&o.length&&this.$el.find(".para-text").css("display","inline-block"),r=this.$el.outerHeight(!0),t!==n?s=!0:this._isViewHeightChanged(r)?s=!0:this._isPagingContinue()&&(s=!0),s&&(this._viewHeightInlastPaging=r),s):(a.debugAlert("topPosInPage should be a number:"+t),s):(a.debugAlert("pageInfo should not be null when resetPageInfo"),s)},_coincidePageBreak:function(e){e.coincide(),this.trigger("pageBreak-positionChanged",e.getPageBreak().attr("data-page-id")),this._showPageBreakInfo(e)},_createPageBreak:function(e,t,n,o){return new c({pageIndex:e,topBlankHeight:t,bottomBlankHeight:n,container:this._$pageBreakContainer,noteView:this.noteView,placeholder:o})},_getContentContainer:function(){return this.$el},_getContentContainerBottomInView:function(){return this._getOffsetTopPos(this._getContentContainer())+this._getContentContainer().outerHeight()-this._getOffsetTopPos(this.$el)},_getOffsetTopPos:function(e){return e.offset().top},_getHeightInPage:function(e){var t,n,o=this._pageInfo[e-1],i=this._pageInfo[e];return i?o&&!o.pageBreak?(a.debugAlert("previous pageBreak should NOT be null"),0):o&&0===o.pageBreak.getPlaceholder().next().length?0:s.isTable(this.block)&&0===this._getContentContainer().find("tbody").children().length?0:"none"!==this.$el.css("float")?0:o&&o.pageBreak&&i&&i.pageBreak?(a.debugAlert("_getHeightInPage: should NOT there when crossing previous/current page"),this.PAGE_HEIGHT):(t=o?this._getPageBreakBottomPosInView(e-1):0,i&&i.pageBreak?(a.debugAlert("_getHeightInPage: shoud not be there when current pageBreak ready"),n=this._getPageBreakTopPosInView(e)):n=this._getContentContainerBottomInView(),Math.ceil(n-t)):(a.debugAlert("should NOT invoke the method when not on the page"),0)},_getPageBreakBottomPosInView:function(e){var t,n;return(t=this._pageInfo[e])&&t.pageBreak?(n=t.pageBreak.getPlaceholder(),this._getOffsetTopPos(n)+n.height()-this._getOffsetTopPos(this.$el)):0},_getPageBreakTopPosInView:function(e){var t;return t=this._pageInfo[e].pageBreak.getPlaceholder(),this._getOffsetTopPos(t)-this._getOffsetTopPos(this.$el)},_getTopPosInPage:function(e){var t=0;return this._pageInfo[e-1]&&this._pageInfo[e-1].pageBreak?t=0:this._pageInfo[e]?t=this._pageInfo[e].topPosInPage:a.debugAlert("should NOT invoke the _getTopPosInPage when the view is NOT on the page"),t},_handlePageOverflow:function(e,t){var n,o,i=this._getHeightInPage(e),r=this._pageInfo[e-1];return o=this.PAGE_HEIGHT-t,r&&r.pageBreak&&0!==t?(a.debugAlert("toPosInPage should be 0 when crossing the previous page"),!1):(o<0&&(o=0),0===t||this.isOnFloat()||o>i?(this._setViewMaxHeight(e),n=!1):(this._insertPageBreak(e,o),n=!0),n)},_insertPageBreak:function(e,t){var n;(n=this._createPageBreak(e,t)).getPlaceholder().prependTo(this.$el),this._pageInfo[e].pageBreak=n,this.trigger("pageBreak-inserted",n.getPageBreak().attr("data-page-id")),this._coincidePageBreak(n)},_isInPageMode:function(){return this.PAGE_HEIGHT!==r.PAGE_HEIGHT_NONE},_isPagingContinue:function(){return!1},_isViewHeightChanged:function(e){var t=!1;return(!this._viewHeightInlastPaging||Math.round(Math.abs(e-this._viewHeightInlastPaging))>r.TOLERABLE_HEIGHT_CHANGE)&&(t=!0),t},_removePageBreak:function(e){e.destroy()},_setViewMaxHeight:function(){},_showPageBreakInfo:function(e){var t,n,o,i,r,s,l=e.getPageBreak();a.DEBUG&&((t=l.find(".bottomSpan")).css("border-bottom","2px dashed #b6b9b6"),(n=l.find(".topSpan")).css("border-top","2px dashed #b6b9b6"),r=l.attr("data-page-id"),o=this._getOffsetTopPos(l),i=this._getOffsetTopPos(e.getPlaceholder()),s="Page:"+r+" OffsetTop(mark/placeholder):("+Math.round(o)+"/"+Math.round(i)+") TopBlank:"+n.outerHeight(),n.text(s),r*=1,s="TopOnPage:"+this._pageInfo[r].pageIndex+" BottomBlank:"+t.outerHeight(),t.text(s))},_updatePageInfo:function(e,t){this._pageInfo[e]={pageIndex:e,topPosInPage:t},this._handlePageOverflow(e,t)&&this._updatePageInfo(e+1,0)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(77),n(29)],void 0===(i=function(e,t,n,o,i){"use strict";return function(){function e(){}return e.toXml=function(e,t,r){var s=e.getBlockStyles(),a=e.getType(),l=o.getStyleNamesOfBlock(a);n.each(l,function(e){var n=s[e],i=o.getConfig(e,a,!1);if(null!=n&&n!==i.default){var l=r.createElement(e),c=r.createTextNode(n);l.appendChild(c),t.appendChild(l)}});var c=e.getUnknownTree();c&&c.styles&&i.appendToXml(c.styles,t)},e.fromXml=function(e,t){var r=e.getUnknownTree(),s=e.getType(),a=o.getStyleNamesOfBlock(s),l=[];$(t).children().each(function(t,n){var o,s=n.nodeName;e.isSupportedBlockStyle(s)?(o=$(n).text(),e.setBlockStyle(s,o),l.push(s)):(r.styles||(r.styles={}),i.appendToTree(r.styles,n))}),n.each(a,function(t){var n;-1===l.indexOf(t)&&(n=o.getConfig(t,s,!1),e.setBlockStyle(t,n.default))})},e}()}.apply(t,o))||(e.exports=i)},,function(e,t,n){var o;void 0===(o=function(e){var t=n(0);return{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,getType:function(e){if(e&&e.nodeType)return e.nodeType},isNode:function(e){var n=this.getType(e);return t.isNumber(n)&&n>=this.ELEMENT_NODE&&n<=this.NOTATION_NODE},isElement:function(e){return this.getType(e)===this.ELEMENT_NODE},isAttribute:function(e){return this.getType(e)===this.ATTRIBUTE_NODE},isText:function(e){return this.getType(e)===this.TEXT_NODE},isCDataSection:function(e){return this.getType(e)===this.CDATA_SECTION_NODE},isEntityReference:function(e){return this.getType(e)===this.ENTITY_REFERENCE_NODE},isEntity:function(e){return this.getType(e)===this.ENTITY_NODE},isProcessingInstruction:function(e){return this.getType(e)===this.PROCESSING_INSTRUCTION_NODE},isComment:function(e){return this.getType(e)===this.COMMENT_NODE},isDocument:function(e){return this.getType(e)===this.DOCUMENT_NODE},isDocumentType:function(e){return this.getType(e)===this.DOCUMENT_TYPE_NODE},isDocumentFragment:function(e){return this.getType(e)===this.DOCUMENT_TYPE_NODE},isNotation:function(e){return this.getType(e)===this.NOTATION_NODE}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(16),n(1)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.getBlockById=function(e,t){var n=t.getBlockById(e);return n||o.warn("Failed to find block",e),n},t.fromCollabJSON=function(e,n){var o=t.getBlockById(e.blockId,n);return o?new t({block:o}):null},t.prototype.isCollapsed=function(){throw new Error("isCollapsed () should be implemented by subclass")},t.prototype.getType=function(){return this.type},t.prototype.clone=function(e){throw new Error("Every subclass of BlockRange should implement the `clone` method")},t.prototype.collapse=function(e){throw new Error("Every subclass of BlockRange should implement the `collapse` method")},t.prototype.expandToStart=function(){},t.prototype.expandToEnd=function(){},t.prototype.getDataAsJSON=function(){throw new Error("toJSON() should be implemented by subclass!")},t.prototype.getDataAsHtml=function(e){throw new Error("toHtml() should be implemented by subclass!")},t.prototype.getDataAsPlain=function(){throw new Error("toPlain() should be implemented by subclass!")},t.prototype.canDrawedByNative=function(){throw new Error("canDrawedByNative() should be implemented by subclass!")},t.prototype.toNativeRange=function(e){if(e&&e.getBlockViewByBlock){var t=e.getBlockViewByBlock(this.block);if(t)return t.convertToNativeRange(this);o.warn("No blockView")}else o.error("note view is unvalid!")},t.prototype.extendToBlockEnd=function(){o.warn('Show sub block range do! "extendToBlockEnd"')},t.prototype.extendToBlockStart=function(){o.warn('Show sub block range do! "extendToBlockStart"')},t.prototype.getBlockId=function(){return this.block?this.block.getId():null},t.prototype.toCollabJSON=function(e){return{blockId:this.block.getId(),rangeType:this.type}},t.prototype.initialize=function(e){e=e||{block:null},this.type="block",this.block=e.block},t}(n)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(2),n(272),n(1),n(42)],void 0===(i=function(e,t,n,o,i,r,a){"use strict";var l="1",c="2",u="3",d="4",h="5";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.create=function(e){if(e&&e.block&&e.type){if(e.type!==l||t._isValidRect(e.rect))return new t(e);r.error("Failed to create TableRange, rect is NOT valid",e)}else r.error("Failed to create TableRange",e)},t.fromCollabJSON=function(e,n){var i=e.rangeType;if(i===o.TABLE){var s=a.getBlockById(e.blockId,n);return s?t.create({block:s,type:e.simpleValue2,rect:e.simpleValue1}):void 0}r.error("wrong block type:",i)},t._isValidRect=function(e){return e&&e.left>=0&&e.top>=0&&e.width>=1&&e.height>=1},t.prototype.getType=function(){return this.type},t.prototype.getAsRectRange=function(){var e,t=this.type,n=this.block;switch(t){case u:case d:e=i.create({table:n,width:1,height:1,top:t===u?0:n.getRowCount()-1,left:t===u?0:n.getColumnCount()-1});break;case c:e=i.create({table:n,top:0,left:0,width:n.getColumnCount(),height:n.getRowCount()});break;case l:if(!this.rect)return void r.warn("Bad range, please check code, range:",this);e=i.create({table:n,top:this.rect.top,left:this.rect.left,width:this.rect.width,height:this.rect.height});break;case h:return null;default:r.error("Failed to create RectRange",t)}return e},t.prototype.isCollapsed=function(){return this.type===h},t.prototype.isFullSelected=function(){return this.type===c},t.prototype.isOnCellEdit=function(){var e;return this.block.trigger("get-block-view",this.block,function(t){e=t}),e&&e.isOnCellEdit()},t.prototype.isInBlank=function(){return this.type===h},t.prototype.clone=function(){return t.create({block:this.block,type:this.type,rect:this.rect})},t.prototype.collapse=function(){},t.prototype.getDataAsJSON=function(e){var t=this.getAsRectRange();return t?t.getDataAsJSON(e):null},t.prototype.getDataAsHtml=function(){var e=this.getAsRectRange();return e?e.getDataAsHtml():null},t.prototype.getDataAsPlain=function(){var e=this.getAsRectRange();return e?e.getDataAsPlain():null},t.prototype.canDrawedByNative=function(){return!1},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.simpleValue1=this.getAsRectRange()||null,t.simpleValue2=this.getType()||null,t},t.prototype.initialize=function(i){e.prototype.initialize.call(this,i),i=n.defaults(i||{},{type:u,rect:null}),this.block=i.block,this.type=i.type||o.TABLE,this.type===l&&(t._isValidRect(i.rect)?this.rect=i.rect:this.type=u)},t.TYPES={NORMAL:"1",ALL:"2",FIRST_CELL:"3",LAST_CELL:"4",BLANK:"5"},t}(a)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(){return{LEFT:1,RIGHT:2,UP:3,DOWN:4}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(1);function i(e){this.name=e.name,this.value=e.value,this.isNative=!0===e.isNative,this.tryNativeIfNeeded=!1!==e.tryNativeIfNeeded,this.stopSelectionChange=!0===e.stopSelectionChange,this.callback=t.isFunction(e.callback)?e.callback:null}return i.prototype.isCmdBall=!0,i.prototype.clone=function(){return new i(this)},i.create=function(e){return e&&e.isCmdBall?e:e&&e.name?new i(e):void o.warn("Failed to create cmdBall",e)},i}.call(t,n,t,e))||(e.exports=o)},,function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(39),n(29),n(90),n(24),n(2),n(19),n(30),n(10)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d){"use strict";return function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.createBlank=function(){return new t({})},t.fromCollabJSON=function(e){return t.generalFromJSON(e,!0)},t.fromJSON=function(e){return t.generalFromJSON(e,!1)},t.fromXml=function(e){var n=$(e),r=new t({checked:"true"===n.find("> checked:first").text()});return r.setText(d.fromXml(e)),r.parseIdFromXml(e),n.children().each(function(e,t){switch(t.nodeName){case a.TAG_ID_NAME:case a.LEGACY_TAG_ID_NAME:case"checked":case"text":case"inline-styles":break;case"styles":o.fromXml(r,t);break;default:i.appendToTree(r.unknownTree,t)}}),r},t.getMarker=function(e){if(!e)return"";var n=e.getChecked()?t.CHECKED_MARKER:t.UNCHEKED_MARKER;return n+=" "},t.generalFromJSON=function(t,n){var o=e.generalFromJSON.call(this,t,n);return o&&o.setChecked(!!t.checked),o},t.prototype.countWords=function(){return this.richText.getLength()},t.prototype.getChecked=function(){return this.todoProps.checked},t.prototype.getLegacyResId=function(){return this.todoProps.legacyResId},t.prototype.isFromOldTodo=function(){return!!this.todoProps.legacyResId},t.prototype.setChecked=function(e){e!==this.todoProps.checked&&(this.todoProps.checked=e,this.trigger("checked-change",e))},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.checked=this.getChecked(),t},t.prototype.toHtml=function(e,t,n){var o,i=document.createElement("div"),r=$(document.createElement("div")),s=$(document.createElement("div")),a=this.getChecked(),l=$(i);return l.attr("yne-bulb-block","todo").attr("yne-bulb-checked",a.toString()).attr("id",this.getId()).css("display","table"),r.css({border:"1px solid #bbb",display:"inline-flex",height:"1em","line-height":"1",position:"relative",width:"1em"}),a&&(r.css({"background-repeat":"no-repeat","background-position":"center","background-size":"100%","background-image":"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgdmlld0JveD0iMCAwIDUwIDUwIiBzdHlsZT0iaGVpZ2h0OiAxMDAlO3dpZHRoOiAxMDAlO3N0cm9rZS13aWR0aDogMjtzdHJva2U6IGJsYWNrO3RvcDogMDtsZWZ0OiAwO3Bvc2l0aW9uOiBhYnNvbHV0ZTsiICB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbG5zOnNrZXRjaD0iaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoL25zIj4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0xNC4xIDI3LjJsNy4xIDcuMiAxNi43LTE2LjgiPjwvcGF0aD4KPC9zdmc+)"}),l.css("text-decoration","line-through")),this.applyBlockStylesOnElement(l),e=e||0,t=null==t?this.getEndOffset():t,o=this.sliceText(e,t,!1),s.html(u.rich2html(o,{withDefault:n})),s.attr("yne-bulb-todo-content","").css({display:"table-cell","word-break":"break-word","padding-left":"8px",width:"100%"}),l.append(r),l.append(s),i.outerHTML},t.prototype.toJSON=function(t,n){var o=e.prototype.toJSON.call(this,t,n);return o.checked=this.getChecked(),o},t.prototype.toPlain=function(e,t){e=e||0;var n=this.sliceText(e,t,!1);return r(n.toString())},t.prototype.toXml=function(t){var n,o;return o=e.prototype.toXml.call(this,t),(n=t.createElement("checked")).appendChild(t.createTextNode(this.getChecked().toString())),o.appendChild(n),i.appendToXml(this.unknownTree,o),o.setAttribute("compat","true"),o},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.todoProps=n.clone(t),this.type=l.TODO},t.CHECKED_MARKER="✔",t.UNCHEKED_MARKER="☐",t}(c)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(90),n(62),n(2),n(19),n(24),n(10)],void 0===(i=function(e,t,n,o,i,r,a,l){"use strict";var c,u="javascript",d="default";return(c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.createBlank=function(){return new t({})},t.fromJSON=function(e){var t=r.fromJSON.apply(this,[e]);return t.language=e.language,t.theme=e.theme,t.isSelectedBlock=e.isSelectedBlock,t},t.fromXml=function(e){var t=r.fromXml.apply(this,[e]),n=this.prototype._getChildByTagName(e,"language").textContent,o=this.prototype._getChildByTagName(e,"theme").textContent;return t.setTheme(o),t.setLanguage(n),t},t.prototype.getLanguage=function(){return this.language},t.prototype.setLanguage=function(e){this.language=e,u=e,this.trigger("content-change")},t.prototype.getTheme=function(){return this.theme},t.prototype.setTheme=function(e){this.theme=e,d=e,this.trigger("content-change")},t.prototype.getLength=function(e){return this.richText.toString().replace(t.LINE_BREAK,"").length},t.prototype.getTextStyle=function(){return[]},t.prototype.getTextStylesAtIndex=function(){return{}},t.prototype.getLineInfo=function(e){if(--e<0)return null;var n=this.richText.toString().split(t.LINE_BREAK)[e],o=n.replace(n.trimLeft(),"").length,i=n.length;return{lineStartSpacesNum:o,lineLength:i,lineText:n,lineEndChar:n[i-1]}},t.prototype.pushNewLineText=function(e){"string"==typeof e&&(e=new l({text:l})),this.richText.append(e);var n=e.toString();(n&&n[n.length-1]!==t.LINE_BREAK||""===n)&&this.richText.append(new l({text:t.LINE_BREAK})),this.trigger("content-change")},t.prototype.getCharIndex=function(e,n){for(var o=0,i=this.richText.toString();o<i.length&&e>1;)i[o]===t.LINE_BREAK&&e--,o++;return o+n},t.prototype.insertText=function(e,t,n){var o=this.richText.clone(),i=this.getCharIndex(e,t);this.richText.insert(n,i);var r=this.richText.clone();return this.trigger("content-change",{preRichText:o,newRichText:r}),!0},t.prototype.deleteText=function(t,n,o,i){var r=this.richText.clone(),s=this.getCharIndex(t,n),a=this.getCharIndex(o,i);e.prototype.deleteText.apply(this,[s,a]);var l=this.richText.clone();this.trigger("content-change",{preRichText:r,newRichText:l})},t.prototype.setText=function(e){this.richText=e},t.prototype.sliceText=function(t,n,o,i){var r=this.getCharIndex(t,n),s=this.getCharIndex(o,i);return e.prototype.sliceText.apply(this,[r,s])},t.prototype.tokenizeText=function(e){var t,n,o=this.tokenizer.tokenize(e,this.tokenizer.languages[this.language]);return t=[],n=function(e,o){Array.isArray(e.content)?e.content.forEach(function(e){n(e,!0)}):"string"==typeof e&&o?t.push({type:"tag",content:e}):t.push(e)},o.map(function(e){return n(e)}),t},t.prototype.toPlain=function(e,t,o,i){var r;return r=(e&&o?this.sliceText(e,t,o,i):this.richText).toString(),r=n(r)},t.prototype.toJSON=function(e,t,n,o){var i;i=e&&n?this.sliceText(e,t,n,o):this.richText;var r=a.prototype.toJSON.apply(this);return r.richText=i.toJSON(),r.isSelectedBlock=this.isSelectedBlock,r.theme=this.theme,r.language=this.language,r},t.prototype.code2html=function(){var e=this;return this.toCodeLines().map(function(t){return e.tokenizeText(t)}).map(function(t,n){return e.codeLineToHtml(n+1,t)}).join("")},t.prototype.toHtml=function(e,t,n){var i='<div yne-bulb-block="code" id="'+this.blockId+'" data-theme="'+this.theme+'" data-language="'+this.language+'" style="white-space: pre-wrap;">'+o.escapeHtml(this.richText.toString())+"</div>";return n&&(i='<div class="block-view code-view yne-code-theme-'+this.theme+'">\n                            <div class="para-text">\n                            '+this.code2html()+"\n                            </div>\n                          </div>"),i},t.prototype.getRichTexts=function(){var e,t,n=this.richText.getReadOnlyData(),o=[],i=n.length,r=0;for(e=0;e<i;++e)n[e].char.replace(/\n/g,"")||(t=e,o.push(this.richText.slice(r,t)),r=t+1);return o},t.prototype.toCodeLines=function(e){var n=(void 0===e?this.richText.toString():e).split(t.LINE_BREAK);return""===n[n.length-1]&&1!==n.length&&n.pop(),n},t.prototype.codeLineToHtml=function(e,n){var i=this,r=this.toCodeLines();if(e>r.length)return null;n||(n=this.tokenizeText(r[e-1]));var s=this.YNE_HEAD_CLASS+"-token",a=function(e,t){return'<span class="'+(t?s+" ":"")+(i.YNE_HEAD_CLASS+"-"+e)+'">'},l=function(e){return"<pre>"+e+"</pre>"};return n.length<=1&&""===n[0]?l('<span class="place-holder">'+t.EMPTY_LINE_TAG+"</span>"):l(n.reduce(function(e,t){if("string"==typeof t){var n=o.escapeHtml(t);return e+a(i.PLAIN_STRING_CLASS,!1)+n+"</span>"}n=o.escapeHtml(t.content);return e+a(t.type,!0)+n+"</span>"},""))},t.prototype.injectTokenizer=function(e){e.languages&&e.tokenize&&(this.tokenizer=e)},t.prototype.injectRenderParams=function(e){var t=e.YNE_HEAD_CLASS,n=e.PLAIN_STRING_CLASS;this.YNE_HEAD_CLASS=t,this.PLAIN_STRING_CLASS=n},t.prototype.toXml=function(t){var n=e.prototype.toXml.apply(this,[t]),o=function(e,o){var i=t.createElement(e),r=t.createTextNode(o);i.appendChild(r),n.appendChild(i)};return o("language",this.language),o("theme",this.theme),n},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=i.CODE,this.language=t.language||u,this.theme=t.theme||d,this.richText=t.text||new l({text:""}),this.isSelectedBlock=t.isSelectedBlock},t}(r)).LINE_BREAK="\n",c.EMPTY_LINE_TAG="&#8203;",c}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(10),s=n(3);return t=o.extend({name:"atom.DeleteBlockText",_textBlock:null,_start:null,_end:null,_deletedText:null,_inlineStyles:null,initialize:function(){var e=this.options.args;s.isCollabCommand(e)||(this._textBlock=this.options.block,this._start=this.options.start,this._end=this.options.end,this._inlineStyles=this.options.inlineStyles),t.__super__.initialize.apply(this)},apply:function(){var e=this._textBlock,t=e.sliceText(this._start,this._end);return!!t&&(this._deletedText=t,e.deleteText(this._start,this._end,this._inlineStyles),!0)},doUnapply:function(){var e=this._deletedText;this._textBlock&&this._deletedText&&this._textBlock.insertText(this._start,e)},fromCollabJSON:function(){var e=this.options.args,n=e.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),n&&(this._deletedText=r.fromCollabJSON(n.richText),this._textBlock=e.collabProperties.coreEditor.getBlockById(n.blockId),this._start=n.startPosition,this._end=n.endPosition)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._textBlock.getId(),e.richText=this._deletedText.toCollabJSON(),e.startPosition=this._start,e.endPosition=this._end,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(74),o=n(135);return t.extend({className:"toolbar-item toolbar-split",initialize:o,render:o,enable:o,disable:o,reset:o})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(16),i=n(0),r=n(1),s=n(223),a=n(112);return t=o.extend({inheritStyleHandlers:null,uninheritStyleHandlers:null,tagHandler:null,el:null,parent:null,children:null,styles:null,parser:null,options:null,constructor:function(e,t,n,o,i){this.el=e,this.children=[],this.parent=t,this.internalStylesParser=n,this.parent&&this.parent.children&&this.parent.children.push(this),this._computeStyles(),this.computeBulbStyles(),this.parser=o,this.options=i},computeBulbStyles:function(){},_findStyleHandler:function(e,n){var o,s=(e?this.inheritStyleHandlers:this.uninheritStyleHandlers)[n];if(i.isFunction(s))return{action:s};if(i.isObject(s)&&s.action)return s;if(!0===s&&(o=t.styleHandlers[n])&&o.action){if(o.inheritable===e)return o;r.error("The inheritable value of "+n+" is unvalid!")}},_computeStyles:function(){var e=this.el,n={},o=this.tagHandler||t.tagHandlers[e.tagName.toLowerCase()];o&&o(n,e),this.styles={},this._computeInheritStyles(n),this._computeUninheritStyles(n)},_computeStyle:function(e,t){var n,o,r,s=this,a=null!=s.inheritStyleHandlers[t],l=s.parent,c=s.el;null==s.styles[t]&&(a&&!l||(n=s._findStyleHandler(a,t))&&n.action&&(n.requireValues&&n.requireValues.length&&i.each(n.requireValues,function(t){s._computeStyle(e,t)}),a?(o=(l.styles||{})[t],(r=n.action(c,s.styles,o))||!1===r||(r=e[t]),r||!1===r||(r=o)):(r=n.action(c,s.styles))||!1===r||(r=e[t]),(r||!1===r)&&(s.styles[t]=r)))},_computeInheritStyles:function(e){var t=this;t.inheritStyleHandlers&&i.each(t.inheritStyleHandlers,function(n,o){n&&t._computeStyle(e,o)})},_computeUninheritStyles:function(e){var t=this;t.uninheritStyleHandlers&&i.each(t.uninheritStyleHandlers,function(n,o){n&&t._computeStyle(e,o)})},setup:function(){},capture:function(){r.warn("Function capture should be implemented by SubClass")},finish:function(){},handleChildrenBySelf:function(){return!1},emit:function(e){this.parent&&this.parent.capture(e)},getRoot:function(){if(this.parent)return this.parent.getRoot()}},{tagHandlers:s,styleHandlers:a})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(3),n(39),n(29),n(1),n(2),n(19),n(30),n(10),n(64),n(0)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.createBlank=function(){return new t({})},t.fromCollabJSON=function(e){var n=t.generalFromJSON(e,!0);return e.ownerId&&(n.oldOwnerId=e.ownerId),n},t.fromJSON=function(e){return t.generalFromJSON(e,!1)},t.fromXml=function(e){var n,r=new t({});return r.parseIdFromXml(e),r.setText(u.fromXml(e)),$(e).children().each(function(e,t){switch(t.nodeName){case l.TAG_ID_NAME:case l.LEGACY_TAG_ID_NAME:case"text":case"inline-styles":break;case"styles":o.fromXml(r,t);break;case"href":n=$(t).find("value").text(),r.setHref(n);break;default:i.appendToTree(r.unknownTree,t)}}),r},t.generalFromJSON=function(t,n){var o=e.generalFromJSON.call(this,t,n);return o&&t.href&&o.setHref(t.href),o},t.prototype.blur=function(){this.trigger("blur")},t.prototype.findAndSetOwnerList=function(e){var t,n=e.getPreBlock(this),o=e.getNextBlock(this),i=this.oldOwnerId;return i?a.isCatalogue(o)&&i===o.getOwnerId()?(t=o.getOwnerList(),this.setOwnerList(t),t.insertBefore(this,o)):a.isCatalogue(n)&&i===n.getOwnerId()?(t=n.getOwnerList(),this.setOwnerList(t),t.insertAfter(this,n)):(t=new d({id:i}),this.setOwnerList(t),t.insertAfter(this,null)):r.error("No oldOwnerId!")},t.prototype.focus=function(){this.trigger("focus")},t.prototype.getHref=function(){return this.href},t.prototype.getHtmlHref=function(){return n.isGUID(this.href)?"#"+this.href:this.href||"#"},t.prototype.getOwnerId=function(){return this.getOwnerList().getId()},t.prototype.getOwnerList=function(){return this.ownerList||r.warn('No ownerList! check have "setOwnerList"'),this.ownerList},t.prototype.getViewHref=function(){return n.isGUID(this.href)?null:this.href},t.prototype.isFirst=function(){return this.isFirstProp},t.prototype.isLast=function(){return this.isLastProp},t.prototype.removeSorting=function(){var e=!1;this.isFirstProp&&(e=!0,this.isFirstProp=null),this.isLastProp&&(e=!0,this.isLastProp=null),e&&this.trigger("sorting-change")},t.prototype.setOwnerList=function(e){this.ownerList=e},t.prototype.setFirst=function(){this.isFirstProp||(this.isFirstProp=!0,this.trigger("sorting-change"))},t.prototype.setHref=function(e){this.href=e||null,this.trigger("style-change","href",e)},t.prototype.setIndent=function(e){e>0&&this.setBlockStyle("indent",e)},t.prototype.setLast=function(){this.isLastProp||(this.isLastProp=!0,this.trigger("sorting-change"))},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.href=this.getHref(),t.ownerId=this.getOwnerId(),t},t.prototype.toJSON=function(t,n){var o=this.sliceText(t,n,!1),i=e.prototype.toJSON.call(this);return i.text=o.toJSON(),i.href=this.getHref(),i.ownerId=this.getOwnerId(),i},t.prototype.toHtml=function(e,t,n){var o,i,r=document.createElement("div"),s=this.getBlockStyles(),a=$("<a></a>"),l=$(r),u="";return n=!0===n,l.attr("yne-bulb-block","catalogue").css("white-space","pre-wrap"),this.isFirst()&&(u="first"),this.isLast()&&(u+="last"),l.attr("yne-bulb-order",u),this.applyBlockStylesOnElement(l,!0),h.each(s,function(e,t){switch(t){case"back-color":l.css("background-color","rgba(255, 255, 255, 0.7)");break;case"padding":l.css("padding",e),l.css("margin",e)}}),e=e||0,t=null==t?this.getEndOffset():t,o=this.sliceText(e,t,!1),i=c.rich2html(o,{withDefault:n}),a.attr("href",this.getHtmlHref()).html(i),l.html(a[0].outerHTML),r.outerHTML},t.prototype.toXml=function(t){var n,o,i=e.prototype.toXml.apply(this,[t]);return this.getHref()&&(n=t.createElement("href"),o=t.createElement("value"),$(o).text(this.getHref()),n.appendChild(o),i.appendChild(n)),$(i).attr("catalogue-id",this.getOwnerId()),$(i).attr("compat","true"),i},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=a.CATALOGUE,this.setHref(t.href),this.setIndent(t.indent),this.options&&this.options.ownerList&&this.setOwnerList(this.options.ownerList),this.on("attached",this._onAttached.bind(this)),this.on("detached",this._onDetached.bind(this)),this.on("select",this._onSelect.bind(this)),this.on("remove-select",this._onRemoveSelect.bind(this))},t.prototype._onAttached=function(e){var t=this.getOwnerList(),n=e.getPreBlock(this),o=e.getNextBlock(this);if(!t)return this.findAndSetOwnerList(e);n&&a.isCatalogue(n)&&n.getOwnerId()===this.getOwnerId()?t.insertAfter(this,n):o&&a.isCatalogue(o)&&o.getOwnerId()===this.getOwnerId()?t.insertBefore(this,o):t.insertAfter(this,null)},t.prototype._onDetached=function(){this.getOwnerList().removeItem(this)},t.prototype._onRemoveSelect=function(){this.getOwnerList().removeSelect()},t.prototype._onSelect=function(){this.getOwnerList().select()},t}(l)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(){return function(e,t,n,o){if(o=!0===o,e||o){var i,r,s,a,l=function(e,t){var n,o,i;if(t.implementation&&t.implementation.createHTMLDocument)return(n=t.implementation.createHTMLDocument("title")).body.innerHTML=e,n;if((i=t.defaultView||window).DOMParser){o=new i.DOMParser;try{n=o.parseFromString("","text/html")}catch(e){}if(n)return n.body.innerHTML=e,n}}(e,t=t||document);if(l){if(!1!==n)return l.body;for(i=(s=l.body.childNodes).length,a=[],r=0;r<i;r++)a.push(s[r]);return a}}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(39),n(10),n(29),n(66),n(8),n(1),n(53),n(120),n(24),n(2)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h,p){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromJSON=function(e){if(e&&e.type&&e.type===p.IMAGE&&e.source){var n=new t({source:e.source,title:e.title});return e.styles&&n.setStyles(e.styles),e.blockId&&n.setId(e.blockId),n}c.warn("jsonObj or jsonObj.source does NOT exist!")},t.fromXml=function(e){var n=$(e),i=new t({source:$.trim(n.find("> source:first").text()),title:$.trim(n.find("> text:first").text())});return i.parseIdFromXml(e),n.children().each(function(e,t){switch(t.nodeName){case h.TAG_ID_NAME:case h.LEGACY_TAG_ID_NAME:case"source":case"text":break;case"styles":o.fromXml(i,t);break;default:r.appendToTree(i.unknownTree,t)}}),i},t.prototype.countWords=function(){return 0},t.prototype.getFakeLoading=function(){return this.imageProps.fakeLoading},t.prototype.getHighlight=function(e,t){var o=this,r=[];if(null!=t.images&&t.images.length>0&&n.some(t.images,function(e){return e.resID===o.getSource()&&(r.push({imageInfo:e}),!0)}),null!=e&&e.length>0){var s=i.create(this.imageProps.title);n.each(e,function(e){for(var t=e.getLength(),n=s.indexOf(e,0,!0);-1!==n;)r.push({end:n+t,start:n}),n=s.indexOf(e,n+t,!0)})}return r.length?r:null},t.prototype.getImageInfo=function(){return this.imageInfo},t.prototype.getResId=function(){return this.imageProps.resId},t.prototype.getSource=function(e){var t,n=this.imageProps.source;return!0===e&&(t=this.getExtraInfo("pcResMap"))&&t[n]&&(n=t[n]),n},t.prototype.getStyles=function(e){return e?this.getBlockStyle(e):this.getBlockStyles()},t.prototype.getTitle=function(){return this.imageProps.title},t.prototype.setFakeLoading=function(e){this.imageProps.fakeLoading=e},t.prototype.setImageInfo=function(e){e&&e.resId&&"number"==typeof e.rawWide?this.imageInfo=e:c.error("The imageInfo is not valid in image: "+this.imageProps.resId)},t.prototype.setSource=function(e){return!(!e||e===this.imageProps.source)&&(this.imageProps.source=e+"",this.trigger("content-change"),!0)},t.prototype.setStyles=function(e,t){return n.isString(e)?this.setBlockStyle(e,t):n.isObject(e)&&this.setBlockStyles(e),!0},t.prototype.setTitle=function(e){return e!==this.imageProps.title&&(this.imageProps.title=e+"",this.trigger("content-change"),!0)},t.prototype.hideImageTitle=function(){this.trigger("hide-image-title")},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.source=this.getSource(),t.title=this.getTitle(),t},t.prototype.toHtml=function(e,t,o){var i,r,s=u("",document,!0,!0).ownerDocument,c=this.getStyles(),d=s.createElement("div"),h=$(d),p=$(s.createElement("img"));return h.attr("yne-bulb-block","image"),n.each(c,function(e,t){switch(t){case"align":h.css("text-align",e);break;case"width":null==e?p.css("width",""):p.css("width",e);break;case"float":h.css("float",e);break;case"back-color":h.css("background-color",e);break;case"padding":h.css("padding",e),"0px"===h.css("padding-top")&&h.css({"padding-top":"4px","padding-bottom":"4px"})}}),i=this.getSource(!0===o),r=this.getTitle(),l.IS_PC&&(i=a(i)),p.attr({alt:r,"data-media-type":"image",src:i}),h.append(p),d.outerHTML},t.prototype.toPlain=function(){return""},t.prototype.toXml=function(t){var n,i,s,a,l,c,u=this.getSource(),d=this.getTitle()||"";if(u)return n=e.prototype.toXml.apply(this,[t]),i=t.createElement("source"),s=t.createTextNode(u),i.appendChild(s),n.appendChild(i),a=t.createElement("text"),l=t.createTextNode(d),a.appendChild(l),n.appendChild(a),c=t.createElement("styles"),o.toXml(this,c,t),n.appendChild(c),r.appendToXml(this.unknownTree,n),n},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=p.IMAGE,this.imageProps={source:t.source,title:t.title},this.imageProps.fakeLoading=t.fakeLoading||!1,this.imageProps.resId=d.parseImgSource(this.imageProps.source).resId},t}(h)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";return{ATTACHMENT:"attachment",IMAGE:"image",TEXT:"text"}}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.WS_OPENED="WS_OPENED",e.WS_MESSAGE="WS_MESSAGE",e.WS_CLOSED="WS_CLOSED",e.SESSION_CHNAGED="SESSION_CHNAGED",e.SESSION_JOINED="SESSION_JOINED",e.SESSION_QUIT="SESSION_QUIT",e.SESSION_PROP_UPDATE="SESSION_PROP_UPDATE",e.SESSION_LOCK_UPDATE="SESSION_LOCK_UPDATE",e.SESSION_INIT_DONE="SESSION_INIT_DONE",e.SESSION_INIT_BUILT="SESSION_INIT_BUILT",e.NONDATACMD_MODIFIERS_RESULT="NONDATACMD_MODIFIERS_RESULT",e.LOCK_RELEASED="LOCK_RELEASED",e.LOCK_LOCKED="LOCK_LOCKED",e.LOCK_PROP_UPDATE="LOCK_PROP_UPDATE",e.CONFLICT_LOCKED_BY_ME="CONFLICT_LOCKED_BY_ME",e.CONFLICT_LOCKED_BY_OTHERS="CONFLICT_LOCKED_BY_OTHERS",e.CONFLICT_BLOCK_CHANGED="CONFLICT_BLOCK_CHANGED",e.DATACMD_FAILURE="DATACMD_FAILURE",e.DATACMD_NO_PENDING="DATACMD_NO_PENDING",e.DATACMD_SUCCESS="DATACMD_SUCCESS",e.ENGINE_EXCEPTION="ENGINE_EXCEPTION",e}();t.default=n}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(2),n(14),n(43),n(26)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(){function e(){}return e.buildNoteRangeFromJSON=function(e,t){return o.fromCollabJSON(e,t)},e.buildNoteRangeFromNonTextBlock=function(e){var t,s={};return s.block=e,n.isTable(e)&&(s.type=i.TYPES.ALL),t=r.createRangeByBlock(s),o.create({endRange:t,startRange:t})},e.buildNoteRangeFromParagraph=function(e,t,n){var i=r.createRangeByBlock({block:e,start:t,end:n});return o.create({endRange:i,startRange:i})},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(10),s=n(3);return t=o.extend({name:"atom.InsertBlockText",_textBlock:null,_start:null,_insertedText:null,initialize:function(){var e=this.options.args;s.isCollabCommand(e)||(this._textBlock=this.options.block,this._start=this.options.start,this._insertedText=this.options.text),t.__super__.initialize.apply(this)},apply:function(){return!!this._insertedText&&(this._textBlock.insertText(this._start,this._insertedText),!0)},doUnapply:function(){this._textBlock&&this._insertedText&&this._textBlock.deleteText(this._start,this._start+this._insertedText.getLength())},fromCollabJSON:function(){var e=this.options.args,n=e.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),n&&(this._insertedText=r.fromCollabJSON(n.richText),this._textBlock=e.collabProperties.coreEditor.getBlockById(n.blockId),this._start=n.startPosition)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._textBlock.getId(),e.richText=this._insertedText.toCollabJSON(),e.startPosition=this._start,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(33),o=n(135);return t.extend({editorEvents:{"yne-editing-state-change":"onEditingStateChange","yne-selection-change":"onSelectionChange"},onEditingStateChange:function(){},onSelectionChange:o})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(7),i=n(25),r=n(38),s=n(36),a=n(10),l=n(41),c=n(2),u=n(6),d=n(1),h=n(12),p=n(30),g=n(145),f=n(73),m=n(21),_=n(28),y=n(123);return r.extend({className:"block-view paragraph-view",_template:h.getTemplate("common","paragraph_view"),_tempPlaceholder:null,_selectToStartTimer:null,initialize:function(){r.prototype.initialize.apply(this,arguments);var e=this.block;t.bindAll(this,"_onContentChange","_onStyleChange","_onHighlight"),e.on("content-change",this._onContentChange),e.on("style-change",this._onStyleChange),e.on("high-light",this._onHighlight),this._tempPlaceholder=o("<div></div>"),this._tempPlaceholder.height(0),this._tempPlaceholder.width(this.$el.width()),this._tempPlaceholder.css("display","inline-block")},render:function(){this._renderTemplate(),this._renderText(),this._renderStyles(),r.prototype.render.apply(this,arguments)},_renderTemplate:function(){this.$el.html(this._template())},convertToNativeRange:function(e){if(e){var t,n;if(n=this._getCharacterInfo(e.start)){if((t=document.createRange()).setStart(n.node,n.offset),n=this._getCharacterInfo(e.end))return t.setEnd(n.node,n.offset),t;d.error("_getCharacterInfo blockRange.end error!")}else d.error("_getCharacterInfo blockRange.start error!")}else d.warn("block range is unvalid!")},parseNativeRange:function(e,t,n){var o,i,r;return clearTimeout(this._selectToStartTimer),n?new s({start:0,end:t.getEndOffset(),block:t}):((r=this.el.querySelector(".place-holder"))&&" "===r.innerText?(o=i=0,e.collapsed&&(this._selectToStartTimer=setTimeout(function(){e.setStart(e.startContainer,o),e.setEnd(e.endContainer,i)},150))):(o=this._getCharacterIndex(e.startContainer,e.startOffset,!0),-1===(i=this._getCharacterIndex(e.endContainer,e.endOffset,!1))&&(i=t.getEndOffset())),new s({start:o,end:i,block:t}))},_getCharacterInfo:function(e){var t,n=this.$el.find(".para-text").get(0),i=document.createNodeIterator(n,NodeFilter.SHOW_TEXT),r=i.nextNode(),s=0,a=0;if(0===e||!r)return o(n).children().first().hasClass("page-break-placeholder")&&(a=1),{node:r||n,offset:a};for(;r;){if((t=g(r.nodeValue)).length>0&&s<e&&s+t.length>=e)return{node:r,offset:t.slice(0,e-s).reduce(function(e,t){return e+t.length},0)};s+=t.length,r=i.nextNode()}},_getTextOfNode:function(e){if(l.isText(e))return e.nodeValue;var t,n=document.createNodeIterator(e,NodeFilter.SHOW_TEXT),o="";if(!n)return"";for(t=n.nextNode();t;)o+=t.nodeValue,t=n.nextNode();return o},_charArrayLengthOfNode:function(e){var t=this._getTextOfNode(e);return g(t).length},_charArrayOffset:function(e,t){var n,o=g(e);for(n=0;n<o.length&&t>0;n++)t-=o[n].length;return n},_getCharacterIndex:function(e,t,n){var i,r,s=this.$el.find(".para-text").get(0),a=0;if(!o.contains(s,e)&&e!==s)return n?0:-1;for(l.isText(e)?a+=this._charArrayOffset(e.nodeValue,t):l.isElement(e)&&t>0&&(a+=this._charArrayLengthOfNode(e)),i=e;i!==s;){for(r=i.previousSibling;r;)"page-break"!==r.className&&"page-break-placeholder"!==r.className&&(a+=this._charArrayLengthOfNode(r)),r=r.previousSibling;i=i.parentNode}return a},_createHtmlForBlankLine:function(e){var n,o,i,r=new a({text:" "}),s=document.createElement("span"),l={},c=function(e,t){["bold","italic","font-family","font-size"].indexOf(t)>-1&&(l[t]=e)};return e?t.each(e,c):t.each(this.block.getInlineStylesForEmpty(),c),n=p.rich2html(r),s.innerHTML=n,(o=s.getElementsByTagName("span"))&&o.length?1===o.length?((i=o[0]).setAttribute("class","place-holder"),n=i.outerHTML):(d.error("_createHtmlForBlankLine error",s),n='<span class="place-holder">&nbsp;</span>'):(s.setAttribute("class","place-holder"),n=s.outerHTML),n},_renderText:function(e){var n,r,a=this,l=a.block,c=l.getReadOnlyText(),u=c.getEntities(),d=a._inlineStyleViewMapper,h=a.$el.find(".para-text");if(n=c.isEmpty()?this._createHtmlForBlankLine(e):p.rich2html(c,{styleRules:{color:function(e){var t=e.color;return e.href!==m.getDefault("href")&&i.equals(e.color,"blue")?"#003884":null!=t&&d?d.valueToView("color",t):void 0},"font-family":function(e){var t,n=e["font-family"];return null!=n&&d&&(t=d.valueToView("font-family",n)),n!==t?t:_.getAllValueByFont(n)||n}}}),h.html(n),u&&u.length){var g=t.pluck(u,"type");setTimeout(function(){a.trigger("get-entity",l.blockId,g)})}r=l.getStyleRanges("href"),t.each(r,function(e){var t,n,i;t=new s({start:e.from,end:e.to,block:l}),n=a.convertToNativeRange(t),(i=a._findLinkNode(n.endContainer))&&("file://"===i.origin&&o(i).click(function(){return!1}),o(i).off("hover"),o(i).hover(function(){f.isNoteLinkUrl(i.href)||a.isCollabLocked()||a.trigger("link-menu-show",{linkNode:i,range:t,block:l})},function(){a.trigger("link-menu-hide")}))})},_findLinkNode:function(e){for(var t=e;t&&"A"!==t.tagName;)t=t.parentNode;return t},_renderStyles:function(){var e=this,n=e.block.getBlockStyles();t.each(n,function(t,n){e._setStyle(n,t)}),e._renderStylesFix()},_renderStylesFix:function(){this.$el.find(".para-text").css("fontSize",p.getDefaultForHtml("font-size"))},_setStyle:function(e,t){var n=this.$el,o=n.find(".para-text");switch(e){case"align":o.css("text-align",t);break;case"line-height":t>0?o.css("line-height",String(t)):o.css("line-height","normal");break;case"indent":t=t>0?t:0,n.css("padding-left",t*u.INDENT_WIDTH||"");break;case"text-indent":t=t>0?t:0,o.css("text-indent",t*u.INDENT_WIDTH||"");break;case"back-color":(c.isParagraph(this.block)||c.isHeading(this.block))&&o.parent().css("background-color",t);break;case"padding":(c.isParagraph(this.block)||c.isHeading(this.block))&&o.css("padding",t);break;default:d.warn("unknown block style: "+e)}},_onContentChange:function(){var e,n=!1,o=this.block;t.some(this._pageInfo,function(e){return e&&e.pageBreak&&(n=!0),n}),n&&this.$el.css("height",this.$el.height()),c.isQuote(o)&&(e=y.getQuoteDefaultStyles()),c.isCode(o)||this._renderText(e),this.trigger("view-height-changed",this.cid),n&&this.$el.css("height","auto")},_onStyleChange:function(e,t){this._setStyle(e,t),this.trigger("view-height-changed",this.cid)},_convertToData:function(e,n){var o,i=this,r=i.block;t.each(e,function(e){o=new s({block:r,start:e.start,end:e.end}),n(i.convertToNativeRange(o))})},_onHighlight:function(e,t,n){var o=this.block.getHighlight(e,t);o&&this._convertToData(o,n)},_findOverflowSpan:function(e,t){var n,o,i,r,s,a=this._pageInfo[e-1];for(a?(o=a.pageBreak.isAtViewBeginning()?this.$el.find(".para-text").children().first():a.pageBreak.getPlaceholder().next(),r=this._getOffsetTopPos(a.pageBreak.getPlaceholder())+a.pageBreak.getPlaceholder().height()):(o=this.$el.find(".para-text").children().first(),r=this._getOffsetTopPos(this.$el)),o.is("span")||o.is("pre")||(o=o.find("span").first()),n=o,i=o;n.length>0&&(n.after(this._tempPlaceholder),s=this._getOffsetTopPos(this._tempPlaceholder)-r-t,n.outerHeight(!0)>0&&(i=n),!(s>0));)n=this._tempPlaceholder.next();return this._tempPlaceholder.remove(),{textSpan:i,overflowHeight:s,isFirstSpan:o===i}},_getContentContainer:function(){return this.$el.find(".para-text")},_handlePageOverflow:function(e,t){var n,o=this._getHeightInPage(e);return!((n=this.PAGE_HEIGHT-t)>o)&&(this._insertPageBreak(e,n),!0)},_insertPageBreak:function(e,t){var n,o,i,r,s,a;this.block.isEmpty()||t<=0||this._forcePageBreakBegin?n=this._insertPageBreakAtViewBeginning(e,0):(o=this._findOverflowSpan(e,t)).overflowHeight<=0?(n=this._createPageBreak(e,Math.abs(o.overflowHeight)),0===o.textSpan.height()?o.textSpan.before(n.getPlaceholder()):o.textSpan.parent().parent().after(n.getPlaceholder())):this._isSplitAvailable(o.textSpan,o.overflowHeight)?(r=o.textSpan.height()-o.overflowHeight,i=this._splitTextSpan(o.textSpan,r),n=this._createPageBreak(e,r-i[0].height()),i[0].after(n.getPlaceholder())):o.isFirstSpan?n=this._insertPageBreakAtViewBeginning(e,t):((a=(s=this._pageInfo[e-1])&&s.pageBreak?t-(this._getOffsetTopPos(o.textSpan)-this._getOffsetTopPos(s.pageBreak.getPlaceholder())-s.pageBreak.getPlaceholder().height()):t-(this._getOffsetTopPos(o.textSpan)-this._getOffsetTopPos(this.$el)))<0&&(a=0),n=this._createPageBreak(e,a),o.textSpan.before(n.getPlaceholder())),this._coincidePageBreak(n),this._pageInfo[e].pageBreak=n},_insertPageBreakAtViewBeginning:function(e,t){var n;return(n=this._createPageBreak(e,t)).setAtViewBeginning(!0),this.$el.prepend(n.getPlaceholder()),n},_isSplitAvailable:function(e,t){var n,o,i;if(0===e.length||""===e.text())return!1;for(o=e.height()-t,n=document.createRange(),i=e[0].firstChild;null!=i&&("#text"!==i.nodeName.toLowerCase()||0===i.textContent.length);)i=i.nextSibling;return null!=i&&(n.setStart(i,0),n.setEnd(i,1),!(n.getBoundingClientRect().height>o)&&(n.setEnd(i,i.textContent.length),!(n.getBoundingClientRect().height<o)))},_splitTextSpan:function(e,t){var n,o,i,r=e[0].firstChild,s=0,a=e.text().length,l=[];for((n=document.createRange()).setStart(r,0);a-s>1&&(i=Math.ceil((a+s)/2),n.setEnd(r,i),(o=n.getBoundingClientRect().height)!==t);)o>t?a=i:s=i;if(o<=t){for(;i<e.text().length&&o<=t;)i++,n.setEnd(r,i),o=n.getBoundingClientRect().height;i-=1}else for(;i>0&&o>t;)i--,n.setEnd(r,i),o=n.getBoundingClientRect().height;return l[0]=e.clone(),l[1]=e.clone(),l[0].text(e.text().substr(0,i)),l[1].text(e.text().substr(i)),e.before(l[0]),e.before(l[1]),e.remove(),l}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0)],void 0===(i=function(e,t,n){"use strict";var o=function(e){var t=n.keys(e);return n.each(t,function(t){var n=e[t];"object"==typeof n&&null!==n&&o(n)}),Object.freeze(e)};return function(e,t){return e&&"object"==typeof e?(t=!1!==t,Object.freeze?t?o(e):Object.freeze(e):e):e}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(){var e=/</g,t=/>/g,n=/"/g,o=/&quot;/g,i=/&#([a-zA-Z0-9]*);?/gim,r=/&colon;?/gim,s=/&newline;?/gim,a=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,l=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,c=/u\s*r\s*l\s*\(.*/gi,u=/<!--[\s\S]*?-->/g;function d(n){return n.replace(e,"&lt;").replace(t,"&gt;")}function h(e){return e.replace(n,"&quot;")}function p(e){return e.replace(o,'"')}function g(e){return e.replace(i,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})}function f(e){return e.replace(r,":").replace(s," ")}function m(e){for(var t="",n=0,o=e.length;n<o;n++)t+=e.charCodeAt(n)<32?" ":e.charAt(n);return t.trim()}function _(e){return e=m(e=f(e=g(e=p(e))))}function y(e){return e=d(e=h(e))}var b={safeAttrValue:function(e,t){if(t=_(t),"href"===e||"src"===e){if("#"===(t=t.trim(t)))return"#";if("http://"!==t.substr(0,7)&&"https://"!==t.substr(0,8)&&"mailto:"!==t.substr(0,7)&&"#"!==t[0]&&"/"!==t[0])return""}else if("background"===e){if(a.lastIndex=0,a.test(t))return""}else if("style"===e){if(l.lastIndex=0,l.test(t))return"";if(c.lastIndex=0,c.test(t)&&(a.lastIndex=0,a.test(t)))return""}return t=y(t)},safeHref:function(e){return e=_(e),a.lastIndex=0,a.test(e)?"":e=y(e)}};return b.escapeHtml=d,b.escapeQuote=h,b.unescapeQuote=p,b.escapeHtmlEntities=g,b.escapeDangerHtml5Entities=f,b.clearNonPrintableCharacter=m,b.friendlyAttrValue=_,b.escapeAttrValue=y,b.onIgnoreTagStripAll=function(){return""},b.StripTagBody=function(e,t){"function"!=typeof t&&(t=function(){});var n=!Array.isArray(e),o=[],i=!1;return{onIgnoreTag:function(r,s,a){if(function(t){return!!n||-1!==e.indexOf(t)}(r)){if(a.isClosing){var l="[/removed]",c=a.position+l.length;return o.push([!1!==i?i:a.position,c]),i=!1,l}return i||(i=a.position),"[removed]"}return t(r,s,a)},remove:function(e){var t="",n=0;return o.forEach(function(o){t+=e.slice(n,o[0]),n=o[1]}),t+=e.slice(n)}}},b.stripCommentTag=function(e){return e.replace(u,"")},b.stripBlankChar=function(e){var t=e.split("");return(t=t.filter(function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)})).join("")},b}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){(function(o){var i;void 0===(i=function(e,t){"use strict";var n=this.DEBUG,o=this.console,i=function(){};return n&&o.assert&&(i=o.assert.bind(o)),i}.apply(t,[n,t]))||(e.exports=i)}).call(this,n(75))},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(3),n(63),n(17)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromXml=function(e){var o=new t({id:$(e).attr("id")});return n.each(e.attributes,function(e){switch(e.nodeName){case"id":case"type":break;default:o.unknownAttrs.push(e.cloneNode(!0))}}),o},t.prototype.getId=function(){return this.id},t.prototype.getItems=function(){return this.items},t.prototype.getLength=function(){return this.items.length},t.prototype.insertAfter=function(e,t){var n=this.items,o=t?n.indexOf(t):-1;this.insertItem(o+1,e)},t.prototype.insertBefore=function(e,t){var n=this.items,o=t?n.indexOf(t):0;this.insertItem(o,e)},t.prototype.insertItem=function(e,t){var n=this.items;return i(e>0||e<=n.length),n.splice(e,0,t),this.updateIndexes(),e},t.prototype.isLock=function(){return!!this.state},t.prototype.removeItem=function(e){var t=this.items,n=t.indexOf(e);return n>=0&&(t.splice(n,1),this.updateIndexes()),n},t.prototype.removeSelect=function(){var e=this.items;e[0]&&e[0].blur()},t.prototype.select=function(){var e=this.items;this.isLock()||e[0]&&e[0].focus()},t.prototype.updateIndexes=function(){var e=this.items;e.forEach(function(t,n){t.removeSorting(),0===n&&t.setFirst(),n===e.length-1&&t.setLast()})},t.prototype.updateLockState=function(e){this.state=e,this.state&&this.removeSelect()},t.prototype.initialize=function(e){this.id=e.id||o.newGUID(),this.items=[],this.unknownAttrs=[]},t}(r)}.apply(t,o))||(e.exports=i)},,function(e,t,n){var o;void 0===(o=function(){return function(e){if(!e||/^http/i.test(e))return e;var t,n=e.lastIndexOf("\\");return-1===n?e:(t=e.substring(n+1),e.substring(0,n+1)+encodeURIComponent(t))}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(6),n(39),n(10),n(80),n(55),n(247),n(81),n(29),n(141),n(249),n(1),n(41),n(24),n(2),n(83),n(250),n(96),n(82),n(251)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h,p,g,f,m,_,y,b,v,k,C){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.createBlankTable=function(e,n,o,i){var r,s,l,c=new t({}),u=[],d=[],h=[];for(o?c.setId(o):o=c.getId(),i&&(l=i/e),r=0;r<n;r++)for(h.push(y.DEFAULT_ROW_HEIGHT),u[r]=u[r]||[],s=0;s<e;s++)0===r&&d.push(l||y.DEFAULT_COL_WIDTH),u[r].push(k.create({cellId:k.makeCellId(o,r,s),content:a.createBlank()}));return c.setContentData(u,h,d),c},t.fromJSON=function(e,n){if(e&&e.type&&e.type===_.TABLE){var o=e.data,i=new t({colWidths:o.widths,rowHeights:o.heights,tableCells:u.cellsFromJSON({cellsJson:o.cells,height:o.heights.length,isUpdateCellId:n,resourceList:e.resourceList,width:o.widths.length})});return e.styles&&i.setBlockStyles(e.styles),e.blockId&&i.setId(e.blockId),i}g.warn("jsonObj is not valid!")},t.fromXml=function(e){var n,o,r,s,a,l=$(e),c=l.children("content:first").eq(0),u=$.trim(c.text()),h=t._resourceMapFromXml(l.children("resource-list:first").get(0)),p=new t({resourceMap:h});p.parseIdFromXml(e);try{n=JSON.parse(u)}catch(e){return void g.error(e,u)}return r=n.cells,s=t.validateRowHeights(n.heights),a=t.validateRowHeights(n.widths),o=t._tableCellsFromXml(r,s,a,{resourceMap:h,tableBlockId:p.getId()}),p.setContentData(o,s,a),l.children().each(function(e,t){switch(t.nodeName){case m.TAG_ID_NAME:case m.LEGACY_TAG_ID_NAME:case"content":case"resource-list":break;case"styles":i.fromXml(p,t);break;default:d.appendToTree(p.unknownTree,t)}}),p},t.validateRowHeights=function(e){return t._validateDimensionArray(e,y.DEFAULT_ROW_HEIGHT)},t.validColWidths=function(e){return t._validateDimensionArray(e,y.DEFAULT_COL_WIDTH)},t._resourceMapFromXml=function(e){var t={};return e?($(e).children("resource-mono").each(function(e,o){var i=$(o),r=i.find("res-id").text();r?n.some(b,function(e,n){var s,a=i.children(n+":first").get(0);if(a&&e&&e.fromXml&&(s=e.fromXml(r,a,o)),s)return t[r]=s,!0}):g.error("<resource-mono/> node has no res-id",o)}),t):t},t._tableCellsFromXml=function(e,t,n,o){var i,r,s,a=n.length,l=t.length,c=[];for(i=0;i<l;i++)for(c[i]=[],r=0;r<a;r++)s=i*a+r,c[i][r]=k.fromXml({cellRawData:e[s],colIndex:r,resourceMap:o.resourceMap,rowIndex:i,tableBlockId:o.tableBlockId});return c},t._validateDimensionArray=function(e,t){return e?n.map(e,function(e){return e>0?e:t}):[t]},t.prototype.clearCellAttr=function(e,t){if(!this.isLocked()){var n=this._getCellAt(e,t);n&&(n.clearMergePointAttr(),n.clearMergedCellAttr(),this.trigger("attribute-changed"))}},t.prototype.countWords=function(){var e=this.toPlain({filter:function(e){return e&&e.getType()===l.TEXT},returnString:!1,withLineBreak:!1}),t=0;return n.each(e,function(e){n.each(e,function(e){t+=h(e)})}),t},t.prototype.createCell=function(e){var t,n=(e=e||{}).content||a.createBlank(),o=e.styles;return t=k.create({content:n}),o&&t.setBlockStyles(o),t},t.prototype.creatRowData=function(){var e,t=this.getColumnCount(),n=[];for(e=0;e<t;e++)n.push(this.createCell());return n},t.prototype.deleteCols=function(e,t){if(!this.isLocked()){var n,o,i=[];if(!this.isLocked())return t=t||1,this.tableCells.forEach(function(n){for(o=0;o<t;o++)i[o]=i[o]||[],i[o].push(n.splice(e,1)[0])}),n=this.colWidths.splice(e,t),this.trigger("col-deleted",e,t),{colsData:i,widths:n}}},t.prototype.deleteRows=function(e,t){if(!this.isLocked()){var n,o,i=[];if(!this.isLocked()){for(t=t||1,o=0;o<t;o++)i[o]=this.tableCells.splice(e,1)[0];return n=this.rowHeights.splice(e,t),this.trigger("row-deleted",e,t),{heights:n,rowsData:i}}}},t.prototype.forEach=function(e,t){var n=this;n.forEachRow(function(o){return n.forEachColumn(function(t){return e(o,t)},t)},t)},t.prototype.forEachCell=function(e,t){var n=this,o={};n.forEach(function(t,i){var r,s=n.getCell(t,i,{findMergePointIfNeeded:!0,withPosition:!0});if(s&&(r=s.row+"-"+s.col,!0!==o[r]))return o[r]=!0,e(s.cell,s.row,s.col)},t)},t.prototype.forEachColumn=function(e,t){var n,o=this.getColumnCount();for(n=0;n<o;n++)if(!1===e(t?0+o-n:0+n))return!1},t.prototype.forEachRow=function(e,t){var n,o=this.getRowCount();for(n=0;n<o;n++)if(!1===e(t?0+o-n:0+n))return!1},t.prototype.getAllResourceInfo=function(){var e,t,n,o,i,r=this,s=[];return r.forEach(function(a,l){var c=r.getCell(a,l),u=r.getExtraInfo("pcResMap");c&&c.isImageCell()&&(e=c.getContent(),t=e.getSource(),n=e.getSource(u),t&&n&&s.push({blockId:r.getId(),extraSource:n,source:t})),c&&c.isAttachmentCell()&&(e=c.getContent(),t=e.getSource(),n=e.getSource(u),o=e.getResource(),i=e.getResource(u),t&&n&&o&&i&&s.push({extraResource:i,extraSource:n,resource:o,source:t}))}),s},t.prototype.getCell=function(e,t,o){var i,r;if(!(o=n.defaults(o||{},{findMergePointIfNeeded:!1,withPosition:!1})).findMergePointIfNeeded){if(!(r=this._getCellAt(e,t)))return;return!0===o.withPosition?{cell:r,col:t,row:e}:r}return i=this._findMergePoint(e,t),o.withPosition?i:i&&i.cell?i.cell:null},t.prototype.getCells=function(){return this.tableCells},t.prototype.getCellBlockStyles=function(e){var t,o=e.row,i=e.col,r=e.names,s=this._getCellAt(o,i);return!s.isMergedCell()&&(t=s.getBlockStyles(),r&&r.length>0?n.pick(t,r):t)},t.prototype.getCellById=function(e){if(f.isElement(e)&&(e=$(e).data("cellId")),e){var t,n,o,i=this.getRowCount(),r=this.getColumnCount();for(t=0;t<i;t++)for(n=0;n<r;n++)if((o=this.getCell(t,n))&&o.getCellId()===e)return{cell:o,col:n,row:t}}},t.prototype.getCellInlineStyles=function(e){var t=e.row,n=e.col,o=this._getCellAt(t,n);return o.isTextNoEmptyCell()?o.getInlineStyles(e.names):o.getStylesForEmpty(e.names)},t.prototype.getCellSize=function(e,t){var n=this.getCell(e,t,{findMergePointIfNeeded:!0,withPosition:!0});if(n&&n.cell)return this._getCellSize(n.cell,n.row,n.col)},t.prototype.getCellSizeById=function(e){var t=this.getCellById(e);if(t&&t.cell)return this._getCellSize(t.cell,t.row,t.col)},t.prototype.getColumnCount=function(){var e=(this.colWidths||[]).length;return Math.max(y.MIN_COL_COUNT,e)},t.prototype.getColumnWidth=function(e){return this.colWidths[e]||y.DEFAULT_COL_WIDTH},t.prototype.getCommonBlockStyle=function(e,t){var n;return t&&t.getAsRectRange&&(t=t.getAsRectRange()),t&&t.forEachCell?(t.forEachCell(function(t){var i=t.getBlockStylesAsBulb()||{};if(null==n)n=i[e];else if(n!==i[e])return n=o.INTERM,!1},!1),n===o.INTERM?null:n):(g.warn("Unvalid parameter",t),null)},t.prototype.getCommonInlineStyle=function(e,t){var n;return t&&t.getAsRectRange&&(t=t.getAsRectRange()),t&&t.forEachCell?(t.forEachCell(function(t){var i=t.getCommonInlineStyle(e);if(null==n)n=i;else if(n!==i)return n=o.INTERM,!1},!1),n===o.INTERM?null:n):(g.warn("Unvalid parameter",t),null)},t.prototype.getContentAt=function(e,t){var n=this.getCell(e,t);if(n)return{content:n.getContent(),type:n.getType()}},t.prototype.getMergedCellAttrAt=function(e,t){var n=this._getCellAt(e,t);return n?n.getMergedCellAttr():{}},t.prototype.getMergePointAttrAt=function(e,t){var n=this._getCellAt(e,t);return n?n.getMergePointAttr():{}},t.prototype.getPosition=function(e){if(e){var t,n,o=this.getRowCount(),i=this.getColumnCount();for(t=0;t<o;t++)for(n=0;n<i;n++)if(this.getCell(t,n)===e)return{col:n,row:t}}},t.prototype.getRowCount=function(){var e=(this.rowHeights||[]).length;return Math.max(y.MIN_ROW_COUNT,e)},t.prototype.highlight=function(e,t,n){this.trigger("high-light",e,t,n)},t.prototype.isEmptyContent=function(){var e=!0;return this.forEachCell(function(t){if(!t.isEmpty())return e=!1,!1}),e},t.prototype.getRowHeight=function(e){return this.rowHeights[e]||y.DEFAULT_ROW_HEIGHT},t.prototype.isMergedCell=function(e,t){var n=this.getCell(e,t);return n&&n.isMergedCell&&n.isMergedCell()},t.prototype.isMergePoint=function(e,t){var n=this.getCell(e,t);return n&&n.isMergePoint&&n.isMergePoint()},t.prototype.isMergeRect=function(e){var t;return!!this.isMergePoint(e.top,e.left)&&((t=this.getMergePointAttrAt(e.top,e.left)).width>=e.width&&t.height>=e.height)},t.prototype.insertCols=function(e,t,n){if(!this.isLocked()){var o=this,i=o.tableCells,r=e;n=n||[],t.forEach(function(e,t){i.forEach(function(t,n){t&&t.splice(r,0,e[n])}),o.colWidths.splice(r,0,n[t]||y.DEFAULT_COL_WIDTH),r+=1}),o.trigger("col-inserted",e)}},t.prototype.insertRows=function(e,t,o){if(!this.isLocked()){var i=this,r=e;o=o||[],n.forEach(t,function(e,t){i.tableCells.splice(r,0,e),i.rowHeights.splice(r,0,o[t]||y.DEFAULT_ROW_HEIGHT),r+=1}),i.trigger("row-inserted",e)}},t.prototype.setCellBlockStyles=function(e){if(!this.isLocked()){var t,o=e.row,i=e.col,r=e.styles,s=this._getCellAt(o,i);return!s.isMergedCell()&&(r&&!n.isEmpty(r)||s.clearStyles(),v.bulbStyles2TableStyles(r),s.setBlockStyles(r),t=s.getBlockStyles(),this.trigger("cell-block-style-change",o,i,r,t),!0)}},t.prototype.setCellContent=function(e,t,o){var i,s;if(!this.isLocked())if(null!=o){if(i=this.getCell(e,t))return n.isString(o)&&(o=r.create(o)),o instanceof r&&(o=a.create({richText:o})),(s=i.setContent(o))&&this.trigger("cell-content-change",i.getCellId()),s;g.warn("no cell at row/col",e,t)}else g.warn("content is not valid",o)},t.prototype.setCellInlineStyles=function(e){if(e&&e.styles&&!this.isLocked()){var t=e.row,n=e.col,o=e.styles,i=this._getCellAt(t,n);return i&&i.isTextNoEmptyCell()?(i.setInlineStyles(o),this.trigger("cell-inline-style-change",t,n)):i.setStylesForEmpty(o),!0}},t.prototype.setContentData=function(e,t,n){var o=this;e&&e.length&&t&&t.length&&n&&n.length&&(this.tableCells=e,this.rowHeights=t,this.colWidths=n,setTimeout(function(){o._checkAndFixTableData()}))},t.prototype.setColumnWidth=function(e,t){this.isLocked()||(this.colWidths[e]=t,this.trigger("col-width-set",e,t))},t.prototype.setMergedCellAttrAt=function(e,t,n,o){if(!this.isLocked()){var i=this._getCellAt(e,t);i&&(i.setMergedCellAttr(n,o),this.trigger("attribute-changed"))}},t.prototype.setMergePointAttrAt=function(e,t,n,o){if(!this.isLocked()){var i=this._getCellAt(e,t);i&&(i.setMergePointAttr(n,o),this.trigger("attribute-changed"))}},t.prototype.setRowHeight=function(e,t){this.isLocked()||(this.rowHeights[e]=t,this.trigger("row-height-set",e,t))},t.prototype.toHtml=function(e,t,o){var i=o?this.getExtraInfo("pcResMap"):null,r=c.renderTable(this,null,i),s=document.createElement("div"),a=$(s),l=this.getBlockStyles();return n.each(l,function(e,t){switch(t){case"back-color":a.css("background-color",e);break;case"padding":a.css("padding",e)}}),a.attr("yne-bulb-block","table").css({overflow:"auto"}).append(r),s.outerHTML.replace(/style="(.*?)"/g,function(e){if(e)return e.replace(/\&quot;/g,"")})},t.prototype.toJSON=function(t){var n=this,o=[].concat(n.colWidths),i=[].concat(n.rowHeights),r=[],s={},a={},l=e.prototype.toJSON.call(this);return n.forEach(function(e,o){var i,l=n.getCell(e,o);l&&l.isAttachmentCell()&&!t&&(i=l.getContent(),s[i.getResId()]=i.getInfo()),l&&l.isImageCell()&&!t&&(i=l.getContent(),a[i.getResId()]=i.getInfo()),r.push(l?l.toJSON(t):null)}),t?{cells:r,heights:i,widths:o}:(l.data={cells:r,heights:i,widths:o},l.resourceList={attachMap:s,imageMap:a},l)},t.prototype.toPlain=function(e){var t=this,o=[];return e=n.defaults(e||{},{filter:function(){return!0},returnString:!0,withLineBreak:!1}),t.forEach(function(n,i){var r=o[n],s=t.getCell(n,i),a="";r||(r=o[n]=[]),e.filter(s,n,i)&&(a=s?s.toPlain(e.withLineBreak):""),r.push(a)}),e.returnString?n.map(o,function(e){return e.join(" ")}).join("\n"):o},t.prototype.toXml=function(t){var o,r,s,a=this,l=e.prototype.toXml.call(this,t),c=t.createElement("resource-list"),u=t.createElement("content"),h={},p=[];return a.forEach(function(e,o){var i=a.getCell(e,o),r=i?i.toXml(t,c,h):{},s=n.keys(r);1===s.length&&"value"===s[0]&&""===r.value&&(r={}),p.push(r)}),l.appendChild(c),r={cells:p,heights:[].concat(a.rowHeights),widths:[].concat(a.colWidths)},s=JSON.stringify(r),u.appendChild(t.createTextNode(s)),l.appendChild(u),o=t.createElement("styles"),i.toXml(a,o,t),l.appendChild(o),d.appendToXml(a.unknownTree,l),l},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=_.TABLE,this.setContentData(t.tableCells,t.rowHeights,t.colWidths),this.resourceMap=t.resourceMap,delete this.options,n.bindAll(this,"_onDetached","_onAttached","_onLockedChange"),this.on("detached",this._onDetached),this.on("attached",this._onAttached),this.on("locked-change",this._onLockedChange)},t.prototype._checkAndFixTableData=function(){var e,t,n=this.toJSON();try{(e=C(n.data)).errors.length&&(window.console.warn("Table data fix errors:  \n"+e.errors.join("\n")),g.log(n),t=e.fixedData,this.tableCells=u.cellsFromJSON({cellsJson:t.cells,height:t.heights.length,resourceList:n.resourceList,width:t.widths.length}),this.rowHeights=t.heights,this.colWidths=t.widths,this.trigger("content-change"))}catch(e){g.error("Table data fix failed",e)}},t.prototype._getCellAt=function(e,t){var n,o=this.tableCells;return o[e]&&o[e][t]&&(n=o[e][t]),n||g.warn("Failed to get cell at row/col",e,t),n},t.prototype._findMergePoint=function(e,t){var n,o=this._getCellAt(e,t);if(o&&o.isMergedCell()&&(e-=(n=o.getMergedCellAttr()).dy,t-=n.dx,o=this._getCellAt(e,t)),o)return{cell:o,col:t,row:e};g.warn("Failed to find merge point row/col",e,t)},t.prototype._getCellSize=function(e,t,o){if(e&&!e.isMergedCell()){var i,r,s=this,a=function(e,t){return e+t};if(e&&!e.isMergedCell())return e.isMergePoint()?(i=e.getMergePointAttr())&&i.width&&i.height&&(r={cols:[],heights:[],rows:[],widths:[]},p(function(e){var t=o+e,n=s.getColumnWidth(t);r.widths.push(n),r.cols.push(t)},!1,i.width),p(function(e){var n=t+e,o=s.getRowHeight(n);r.heights.push(o),r.rows.push(n)},!1,i.height)):r={cols:[o],heights:[s.getRowHeight(t)],rows:[t],widths:[s.getColumnWidth(o)]},r&&(r.width=n.reduce(r.widths,a,0),r.height=n.reduce(r.heights,a,0)),r}},t.prototype._onDetached=function(){},t.prototype._onAttached=function(){},t.prototype._onLockedChange=function(){},t}(m)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(66),n(120),n(8),n(155),n(1),n(53),n(95)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.create=function(e){if(e&&e.source&&e.resource&&null!=e.fileLength&&e.fileName)return e.resId||l.warn("Will create resId by url!"),new t(e);l.warn("Failed to create AttachmentResource",e)},t.fromJSON=function(e,o){e.resId&&o&&o.attachMap||l.error("jsonObj or resourceList is wrong, ",e,o);var r=o.attachMap[e.resId];return r||l.error("resourceList is wrong"),r.resource&&(e.resId=i.parseImgSource(r.resource).resId),t.fromCollabJSON(n.extend(e,r))},t.fromCollabJSON=function(e){return e.fileLength&&e.fileName&&e.resId&&e.resource&&e.source||l.error("jsonObj is wrong, ",e),t.create({resId:e.resId,source:e.source,resource:e.resource,fileName:e.fileName,fileLength:e.fileLength})},t.fromXml=function(e,n){var o=$(n),i=o.children("source:first").text(),r=o.children("resource:first").text(),s=o.children("filename:first").text(),a=o.children("filelength:first").text();return a&&(a=parseInt(a,10)),t.create({resId:e,source:i,resource:r,fileName:s,fileLength:a,fakeLoading:!1,type:u.TYPE_ATTACHMENT})},t.prototype.getFileName=function(){return this.attachmentProps.fileName},t.prototype.getInfo=function(){return{fileLength:this.attachmentProps.fileLength,fileName:this.attachmentProps.fileName,resource:this.attachmentProps.resource,source:this.attachmentProps.source}},t.prototype.getResource=function(e){var t=this.attachmentProps.resource;return e&&e[t]&&(t=e[t]),t},t.prototype.getSource=function(e){var t=this.attachmentProps.source;return e&&e[t]&&(t=e[t]),t},t.prototype.toCollabJSON=function(){var e;return(e=this.getInfo()).resId=this.attachmentProps.resId,e},t.prototype.toHtml=function(e){var t,i=c("",document,!0,!0).ownerDocument,s=$(i.createElement("img"));return e=n.defaults(e||{},{resourceMap:null}),t=this.getSource(e.resourceMap)||"",r.IS_PC&&(t=o(t)),s.attr({alt:this.attachmentProps.fileName,"data-media-type":"attachment",filelength:this.attachmentProps.fileLength,filename:this.attachmentProps.fileName,path:this.getResource(),src:t,title:this.attachmentProps.fileName}),s.get(0).outerHTML},t.prototype.toJSON=function(){return{resId:this.getResId()}},t.prototype.toPlain=function(){return""},t.prototype.toXml=function(e,t){var n=e.createElement("resource-mono"),o=e.createElement("attach"),i=this.getInfo();a.appendText(e,n,"res-id",this.getResId()),a.appendText(e,o,"source",i.source),a.appendText(e,o,"resource",i.resource),a.appendText(e,o,"filename",i.fileName),a.appendText(e,o,"filelength",i.fileLength),n.appendChild(o),t.appendChild(n)},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.attachmentProps=this.resProps,this.attachmentProps.resId=t.resId||i.parseImgSource(t.resource).resId,this.attachmentProps.type=u.TYPE_ATTACHMENT},t}(u)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(66),n(120),n(8),n(155),n(1),n(53),n(95)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.create=function(e){if(e&&e.source)return e.resId&&l.warn("Will create resId by url!"),new t(e);l.warn("Failed to create ImageResource",e)},t.fromCollabJSON=function(e){return e.resId&&e.source||l.error("jsonObj is wrong , ",e),t.create({height:e.height,resId:e.resId,source:e.source,title:"",type:u.TYPE_IMAGE,width:e.width})},t.fromJSON=function(e,o){e.resId&&o&&o.imageMap||l.error("jsonObj is or resourceList wrong , ",e,o);var r=o.imageMap[e.resId];return r||l.error("resourceList wrong"),r.source&&(e.resId=i.parseImgSource(r.source).resId),t.fromCollabJSON(n.extend(e,r))},t.fromXml=function(e,n){var o=$(n),i=o.children("source:first").text(),r=o.children("width:first").text(),s=o.children("height:first").text();return r&&(r=parseInt(r,10)),s&&(s=parseInt(s,10)),t.create({height:s,resId:e,source:i,title:"",type:u.TYPE_IMAGE,width:r})},t.prototype.getInfo=function(){var e=this.getSize();return null===e.width&&null===e.height&&(e=null),n.extend({source:this.getSource()},e)},t.prototype.getSize=function(){return{height:this.imageProps.height||null,width:this.imageProps.width||null}},t.prototype.getSource=function(e){var t=this.imageProps.source;return e&&e[t]&&(t=e[t]),t},t.prototype.setSource=function(e){return!(!e||e===this.imageProps.source)&&(this.imageProps.source=e+"",!0)},t.prototype.toCollabJSON=function(){var e={};return e.source=this.getSource(),e.width=this.imageProps.width||null,e.height=this.imageProps.height||null,e.resId=this.imageProps.resId,e},t.prototype.toHtml=function(e){var t,i=c("",document,!0,!0).ownerDocument,s=$(i.createElement("img"));return e=n.defaults(e||{},{resourceMap:null}),t=this.getSource(e.resourceMap)||"",r.IS_PC&&(t=o(t)),s.attr({"data-media-type":"image",height:"auto",src:t,width:"100%"}),s.get(0).outerHTML},t.prototype.toJSON=function(){return{resId:this.getResId()}},t.prototype.toPlain=function(){return""},t.prototype.toXml=function(e,t){var o=e.createElement("resource-mono"),i=e.createElement("image"),r=this.getSize();a.appendText(e,o,"res-id",this.getResId()),a.appendText(e,i,"source",this.getSource()),r&&n.each(["width","height"],function(e){var t=r[e];t&&a.appendText(i,e,t+"")}),o.appendChild(i),t.appendChild(o)},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.imageProps=this.resProps,this.imageProps.resId=t.resId||i.parseImgSource(t.source).resId,this.imageProps.type=u.TYPE_IMAGE},t}(u)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};o=[n,t,n(2),n(42)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromCollabJSON=function(e,n){var i=o.getBlockById(e.blockId,n);return new t(a({block:i},e))},t.createSelectToEndRange=function(e,n,o){var i=e.toCodeLines();return new t({block:e,startLineIndex:n||1,endLineIndex:i.length,startLineCharIndex:o||0,endLineCharIndex:i.pop().length})},t.createBeginRange=function(e){return new t({block:e,startLineIndex:1,endLineIndex:1,startLineCharIndex:0,endLineCharIndex:0})},t.createNewRange=function(e){var t=e.preCodeRange,n=e.charOffset,o=e.lineOffset,i=e.needCollapse,r=void 0===i||i,s=t.clone();return o?(s.endLineIndex=t.startLineIndex+o,s.endLineCharIndex=0+n,r&&(s.startLineIndex=t.startLineIndex+o,s.startLineCharIndex=0+n)):(s.endLineCharIndex=t.startLineCharIndex+n,s.endLineIndex=t.startLineIndex,r&&(s.startLineCharIndex=t.startLineCharIndex+n,s.startLineIndex=t.startLineIndex)),s},t.prototype.convertToParaRangeStartEnd=function(){var e=this.block.toCodeLines(),t=function(t,n){return e.slice(0,t-1).join().length+n+t-1};return{start:t(this.startLineIndex,this.startLineCharIndex),end:t(this.endLineIndex,this.endLineCharIndex)}},t.prototype.isCollapsed=function(){return!this.selectWholeBlock&&(this.startLineIndex===this.endLineIndex&&this.startLineCharIndex===this.endLineCharIndex)},t.prototype.canDrawedByNative=function(){return!0},t.prototype.getDataAsJSON=function(){return this.block.toJSON(this.startLineIndex,this.startLineCharIndex,this.endLineIndex,this.endLineCharIndex)},t.prototype.getDataAsPlain=function(){return this.block.toPlain(this.startLineIndex,this.startLineCharIndex,this.endLineIndex,this.endLineCharIndex)},t.prototype.getDataAsHtml=function(){return this.block.toPlain(this.startLineIndex,this.startLineCharIndex,this.endLineIndex,this.endLineCharIndex)},t.prototype.collapse=function(e){void 0===e&&(e=!0),e?(this.startLineIndex=this.endLineIndex,this.startLineCharIndex=this.endLineCharIndex):(this.endLineIndex=this.startLineIndex,this.endLineCharIndex=this.startLineCharIndex)},t.prototype.clone=function(){return new t({startLineIndex:this.startLineIndex,endLineIndex:this.endLineIndex,startLineCharIndex:this.startLineCharIndex,endLineCharIndex:this.endLineCharIndex,selectWholeBlock:this.selectWholeBlock,block:this.block})},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.selectWholeBlock=!!this.selectWholeBlock,t.startLineIndex=this.startLineIndex,t.startLineCharIndex=this.startLineCharIndex,t.endLineCharIndex=this.endLineCharIndex,t.endLineIndex=this.endLineIndex,t},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.CODE,this.selectWholeBlock=t.selectWholeBlock,this.startLineIndex=t.startLineIndex,this.startLineCharIndex=t.startLineCharIndex,this.endLineCharIndex=t.endLineCharIndex,this.endLineIndex=t.endLineIndex},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.NONDATACMD_BLOCKSELECTION="nb_BlkSelection",e.NONDATACMD_CLINTPONG="nb_clientPong",e.NONDATACMD_COLLABCLOSE="nb_CollabClose",e.NONDATACMD_COLLABINFO="nb_CollabInfo",e.NONDATACMD_DATACMDFAILED="nb_dataCmdFailed",e.NONDATACMD_GETMODIFIERS="nb_getModifiers",e.NONDATACMD_NOTESAVE="nb_noteSave",e.NONDATACMD_LOCKRELEASE="nb_lockRelease",e.NONDATACMD_SESSIONINITIALIZED="nb_sessionInitialized",e.NONDATACMD_SEVERPING="nb_serverPing",e}();t.CmdNames=n,function(e){e[e.EXCEPTION=0]="EXCEPTION",e[e.NO_ERROR=1]="NO_ERROR",e[e.TIME_OUT=100]="TIME_OUT",e[e.STOP_CALL=101]="STOP_CALL"}(t.CustomResultCode||(t.CustomResultCode={})),function(e){e[e.FAILED_RECEIVE_COLLAB_CMD=4001]="FAILED_RECEIVE_COLLAB_CMD",e[e.FAILED_SEND_LOCAL_CMD=4002]="FAILED_SEND_LOCAL_CMD",e[e.MESSAGE_TOO_BIG=4003]="MESSAGE_TOO_BIG",e[e.SESSION_NOT_OPENED=4004]="SESSION_NOT_OPENED",e[e.CLOSED_BY_HOST=4500]="CLOSED_BY_HOST",e[e.COLLAB_SERVER_UNREACHABLE=9e3]="COLLAB_SERVER_UNREACHABLE",e[e.COLLAB_SERVER_SHUTDOWN=9003]="COLLAB_SERVER_SHUTDOWN",e[e.COLLAB_SESSION_CLOSED=9004]="COLLAB_SESSION_CLOSED"}(t.WSCustomCode||(t.WSCustomCode={})),function(e){e[e.LOCAL_INVALID_STARTRANGE=5001]="LOCAL_INVALID_STARTRANGE",e[e.LOCAL_INVALID_CMDJSON=5002]="LOCAL_INVALID_CMDJSON",e[e.LOCAL_TARGET_BLOCK_LOCKED=5003]="LOCAL_TARGET_BLOCK_LOCKED",e[e.LOCAL_EMPTY_CMD=5004]="LOCAL_EMPTY_CMD",e[e.LOCAL_CMD_TOO_FAST=5005]="LOCAL_CMD_TOO_FAST",e[e.LOCAL_INVALID_FOR_COLLAB=5006]="LOCAL_INVALID_FOR_COLLAB",e[e.LOCAL_BLOCKS_MISSING=5008]="LOCAL_BLOCKS_MISSING",e[e.LOCAL_NOT_READY_APPLY=5009]="LOCAL_NOT_READY_APPLY",e[e.LOCAL_DIRTY_BLOCKS=5010]="LOCAL_DIRTY_BLOCKS",e[e.COLLAB_TARGET_BLOCK_LOCKED=5500]="COLLAB_TARGET_BLOCK_LOCKED",e[e.COLLAB_NOTEVERSION_MISMATCH=5507]="COLLAB_NOTEVERSION_MISMATCH",e[e.COLLAB_BLOCKS_MISSING=5508]="COLLAB_BLOCKS_MISSING",e[e.COLLAB_DIRTY_BLOCKS=5510]="COLLAB_DIRTY_BLOCKS"}(t.DataCmdFailureCode||(t.DataCmdFailureCode={}))}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(1),s=n(83),a=n(68),l=n(3),c=n(94);return t=o.extend({name:"atom.SetTableCellContent",_table:null,_cellRect:null,_oldContent:null,effected:!1,initialize:function(){var e=this.options.args;l.isCollabCommand(e)||(this._table=this.options.table,this._cellRect=this.options.cellRect,this._content=this.options.content),t.__super__.initialize.apply(this)},_computeSizeChange:function(e){if(e){var t=this._table.getCellSize(e.row,e.col),n={rowHeight:0,rowIndex:-1,colWidth:0,colIndex:-1};if(t)return t.height<s.ATTACHMENT_MIN_HEIGHT&&(n.rowHeight=t.heights[0]+s.ATTACHMENT_MIN_HEIGHT-t.height,n.rowIndex=t.rows[0]),t.width<s.ATTACHMENT_MIN_WIDTH&&(n.colWidth=t.widths[0]+s.ATTACHMENT_MIN_WIDTH-t.width,n.colIndex=t.cols[0]),n.rowHeight||n.colWidth?n:null}},apply:function(){var e,t=this._table,n=this._getCellInfo(this._cellRect)||{},o=this._contentInfo||t.getContentAt(n.row,n.col);return!!o&&(!!t.setCellContent(n.row,n.col,this._content)&&(this._content instanceof a&&(e=this._sizeChanged||this._computeSizeChange(n)),e&&e.rowHeight&&(this._oldSize={rowIndex:e.rowIndex,rowHeight:t.getRowHeight(e.rowIndex)},t.setRowHeight(e.rowIndex,e.rowHeight)),e&&e.colWidth&&(this._oldSize=this._oldSize||{},this._oldSize.colIndex=e.colIndex,this._oldSize.colWidth=t.getColumnWidth(e.colIndex),t.setColumnWidth(e.colIndex,e.colWidth)),this._sizeChanged=e,this._oldContent=o.content,this.effected=!0,this.effected))},doUnapply:function(){var e,t=this._table,n=this._getCellInfo(this._cellRect),o=this._oldSize;if(n)return e=t.setCellContent(n.row,n.col,this._oldContent),o&&o.rowHeight&&t.setRowHeight(o.rowIndex,o.rowHeight),o&&o.colWidth&&t.setColumnWidth(o.colIndex,o.colWidth),e},_getCellInfo:function(e){var t=this._table;if(null!=e.row&&null!=e.col)return{row:e.row,col:e.col,cell:t.getCell(e.row,e.col)};r.error("No cellRect!")},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._content=c.contentFromCollabJSON(o.simpleValue1),this._oldContent=c.contentFromCollabJSON(o.simpleValue2),this._sizeChanged=o.sizeChanged,this._oldSize=o.oldSize,this._cellRect=o.newBlkId)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.simpleValue1=c.contentToCollabJSON(this._content),e.simpleValue2=c.contentToCollabJSON(this._oldContent),e.sizeChanged=this._sizeChanged,e.oldSize=this._oldSize,e.newBlkId=this._cellRect,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(7);return{isNoteLinkUrl:function(e){return/^note:\/\/[a-z0-9\-]+$/i.test(e)},getNoteId:function(e){if(e=t.trim(e||"")){var n=/^note:\/\/([a-z0-9\-]+)$/i.exec(e);if(n&&n[1])return n[1]}},fillAsUrl:function(e){if(e=t.trim(e||"")){if(this.isNoteLinkUrl(e)&&(e=this.getNoteId(e)),e)return"note://"+e}}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(18).View.extend({editorEvents:{"yne-editing-state-change":"onEditingStateChange","yne-selection-change":"onSelectionChange"},isVisible:!0,show:function(){this.$el.show(),this.isVisible=!0},hide:function(){this.$el.hide(),this.isVisible=!1},enable:function(){this.$el.removeClass("disabled")},disable:function(){this.$el.addClass("disabled")},onEditingStateChange:function(){},onSelectionChange:function(){}})}.call(t,n,t,e))||(e.exports=o)},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(39),n(29),n(114),n(2),n(19),n(30),n(10)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.createBlank=function(){return new t({})},t.fromCollabJSON=function(e){return this.generalFromJSON(e,!0)},t.fromJSON=function(e){return this.generalFromJSON(e,!1)},t.fromXml=function(e){var n=new t({});return n.parseIdFromXml(e),n.setText(u.fromXml(e)),t.fromXmlHelp(n,$(e)),$(e).children().each(function(e,t){switch(t.nodeName){case l.TAG_ID_NAME:case l.LEGACY_TAG_ID_NAME:case"text":case"inline-styles":break;case"styles":o.fromXml(n,t);break;default:i.appendToTree(n.unknownTree,t)}}),n},t.generalFromJSON=function(t,n){var o=e.generalFromJSON.call(this,t,n);return o&&t.level&&o.setLevel(t.level),o},t.toXmlHelp=function(e,t){var n=e.getLevel();n&&$(t).attr("level",n),$(t).attr("compat","true")},t.fromXmlHelp=function(e,t){var n=$(t).attr("level");e.setLevel(n)},t.prototype.getBlockStyle=function(t,n){return"heading"===t?this.level:e.prototype.getBlockStyle.call(this,t,n)},t.prototype.getDefaultBlockStyles=function(){return n.extend({},e.prototype.getDefaultBlockStyles.apply(this,[]),r.headingBlockStyles[this.level])},t.prototype.getDefaultInlineStyles=function(){return n.extend({},e.prototype.getDefaultInlineStyles.call(this),r.headingInlineStyles[this.level])},t.prototype.getInlineStylesForEmpty=function(){return n.extend({heading:this.level},this.getDefaultInlineStyles())},t.prototype.getLevel=function(){return this.level},t.prototype.setLevel=function(e){e&&(this.level=e,this.trigger("content-change",this))},t.prototype.toCollabJSON=function(){var t=e.prototype.toCollabJSON.call(this);return t.richText=this.richText.toCollabJSON(),t.level=this.getLevel(),t},t.prototype.toHtml=function(e,t,n){var o,i,r,s=document.createElement("div"),a=$(s);return n=!0===n,a.attr("yne-bulb-block","heading").attr("yne-bulb-level",this.getLevel()).attr("id",this.getId()).css("white-space","pre-wrap"),this.applyBlockStylesOnElement(a),e=e||0,t=null==t?this.getEndOffset():t,o=this.sliceText(e,t,!1),i=c.rich2html(o,{withDefault:n}),a.html(i),r=s.outerHTML,s=a=null,r},t.prototype.toJSON=function(t,n){var o=this.sliceText(t,n,!1),i=e.prototype.toJSON.call(this,t,n);return i.richText=o.toJSON(),i.level=this.getLevel(),i},t.prototype.toXml=function(n){var o=e.prototype.toXml.apply(this,[n]);return t.toXmlHelp(this,o),o},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=a.HEADING,this.setLevel(t.level)},t}(l)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(1),n(2),n(225)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(){function e(){}return e.getAllStyleNames=function(){return e.ALL_KEYS||(e.ALL_KEYS=[],n.each(r,function(t){var o=n.keys(t);n.each(o,function(t){-1===e.ALL_KEYS.indexOf(t)&&e.ALL_KEYS.push(t)})})),[].concat(e.ALL_KEYS)},e.getConfig=function(e,t,n){return(this.getConfigsOfBlock(t,n)||{})[e]},e.getConfigsOfBlock=function(t,i){if(t){var s=r[t],a={};return i=!1!==i,n.each(s,function(o,r){var s=n.clone(o);i&&e.overrideDefaults[t]&&null!=e.overrideDefaults[t][r]&&(s.default=e.overrideDefaults[t][r]),a[r]=s}),a}o.error("parameter is not valid",t)},e.getDefault=function(e,t,n){if(e&&t){var i=(this.getConfigsOfBlock(t,n)||{})[e];return i&&null!=i.default?i.default:void 0}o.error("parameter is not valid",e,t)},e.getDefaultsOfBlock=function(e,t){var o=this.getConfigsOfBlock(e,t),i={};return n.each(o,function(e,t){i[t]=e.default}),i},e.getStyleNamesOfBlock=function(t){var o=e.getConfigsOfBlock(t);return o?n.keys(o):[]},e.isSupport=function(t,n){var o=(e.getConfigsOfBlock(n)||{})[t];return o&&null!=o.type},e.reset=function(){e.overrideDefaults={}},e.setDefault=function(t,r,s){t&&null!=r||o.error("parameter is not valid",t,r);var a=[];s?a.push(s):a=i.getAllBlockTypes(),n.each(a,function(n){e.overrideDefaults[n]||(e.overrideDefaults[n]={}),e.overrideDefaults[n][t]=r})},e.overrideDefaults={},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(39),n(29),n(1),n(24),n(2)],void 0===(i=function(e,t,n,o,i,r,a,l){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromCollabJSON=function(e){var t=this.fromJSON(e);return e.blockId&&t.setId(e.blockId),t},t.fromJSON=function(e){if(e&&e.type===l.HR){var o=new t({});return n.each(e.styles,function(e,t){o.setBlockStyle(t,e)}),o}r.error("invalid jsonObj")},t.fromXml=function(e){var n=new t({}),r=$(e);return n.parseIdFromXml(e),r.children().each(function(e,t){switch(t.nodeName){case a.TAG_ID_NAME:case a.LEGACY_TAG_ID_NAME:break;case"styles":o.fromXml(n,t);break;default:i.appendToTree(n.unknownTree,t)}}),n},t.prototype.countWords=function(){return 0},t.prototype.toCollabJSON=function(){return this.toJSON()},t.prototype.toHtml=function(){var e=document.createElement("div"),t=document.createElement("div"),o=$(e),i=this.getBlockStyles();return o.attr("yne-bulb-block","hr"),n.each(i,function(e,t){switch(t){case"back-color":o.css("background-color",e);break;case"padding":o.css("padding",e),"0px"===o.css("padding-top")&&o.css({"padding-top":"4px","padding-bottom":"4px"});break;default:o.attr("yne-style-"+t,e)}}),n.each(i,function(e,t){o.attr("yne-style-"+t,e)}),$(t).css({width:"100%",height:"1px","background-color":"rgb(200, 200, 200)"}),o.append(t),o.css("clear","both"),e.outerHTML},t.prototype.toJSON=function(){return e.prototype.toJSON.call(this)},t.prototype.toPlain=function(){return new Array(81).join("-")},t.prototype.toXml=function(t){var n=e.prototype.toXml.apply(this,[t]),r=t.createElement("styles");return o.toXml(this,r,t),n.appendChild(r),i.appendToXml(this.unknownTree,n),n},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=l.HR},t}(a)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(66),n(8),n(1),n(53),n(24),n(39),n(2),n(29)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromJSON=function(e){if(e&&e.type&&e.type===u.ATTACHMENT&&e.source&&e.resource){var n=new t({fakeLoading:!!e.fakeLoading,fileLength:e.fileLength,fileName:e.fileName,resource:e.resource,source:e.source});return e.styles&&n.setStyles(e.styles),e.blockId&&n.setId(e.blockId),n}r.warn("jsonObj or jsonObj.source/resource does NOT exist!")},t.fromXml=function(e){var n,o,i=$(e),r=$.trim(i.find("source").text()),s=$.trim(i.find("resource").text()),a=$.trim(i.find("filename").text())||"无文件名",u=$.trim(i.find("filelength").text());return o=parseInt(u,10),isNaN(o)&&(o=0),(n=new t({fakeLoading:!1,fileLength:o,fileName:a,resource:s,source:r})).parseIdFromXml(e),i.children().each(function(e,t){switch(t.nodeName){case l.TAG_ID_NAME:case l.LEGACY_TAG_ID_NAME:case"source":case"resource":case"filename":case"filelength":break;case"styles":c.fromXml(n,t);break;default:d.appendToTree(n.unknownTree,t)}}),n},t.prototype.countWords=function(){return 0},t.prototype.getFakeLoading=function(){return this.attachmentProps.fakeLoading},t.prototype.getFileLength=function(){return this.attachmentProps.fileLength},t.prototype.getFileName=function(){return this.attachmentProps.fileName},t.prototype.getResource=function(e){var t,n=this.attachmentProps.resource;return!0===e&&(t=this.getExtraInfo("pcResMap"))&&t[n]&&(n=t[n]),n},t.prototype.getSource=function(e){var t,n=this.attachmentProps.source;return!0===e&&(t=this.getExtraInfo("pcResMap"))&&t[n]&&(n=t[n]),n},t.prototype.getStyles=function(e){return e?this.getBlockStyle(e,!1):this.getBlockStyles()},t.prototype.setFakeLoading=function(e){this.attachmentProps.fakeLoading=e},t.prototype.setFileLength=function(e){var t=parseInt(e,10);return!isNaN(t)&&t!==this.attachmentProps.fileLength&&(this.attachmentProps.fileLength=t,this.trigger("content-change"),!0)},t.prototype.setFileName=function(e){return!(!(e=String(e||""))||e===this.attachmentProps.fileName)&&(this.attachmentProps.fileName=e,this.trigger("content-change"),!0)},t.prototype.setResource=function(e){return!(!(e=(e||"")+"")||e===this.attachmentProps.resource)&&(this.attachmentProps.resource=e,this.trigger("content-change"),!0)},t.prototype.setSource=function(e){return!(!(e=(e||"")+"")||e===this.attachmentProps.source)&&(this.attachmentProps.source=e,this.trigger("content-change"),!0)},t.prototype.setStyles=function(e,t){var o=this;return n.isString(e)?this.setBlockStyle(e,t):n.isObject(e)&&n.each(e,function(e,t){o.setBlockStyle(t,e)}),!0},t.prototype.toHtml=function(e,t,r){var s,l,c=this.getStyles(null),u=a("",document,!0,!0).ownerDocument,d=u.createElement("div"),h=$(d),p=$(u.createElement("img"));return h.attr("yne-bulb-block","attachment"),n.each(c,function(e,t){switch(t){case"align":h.css("text-align",e);break;case"float":h.css("float",e);break;case"back-color":h.css("background-color",e);break;case"padding":h.css("padding",e)}}),l=this.getSource(!0===r),i.IS_PC&&(l=o(l)),p.attr({alt:this.attachmentProps.fileName,"data-media-type":"attachment",filelength:this.attachmentProps.fileLength,filename:this.attachmentProps.fileName,path:this.getResource(!1),src:l,title:this.attachmentProps.fileName}),h.append(p),s=d.outerHTML,d=h=p=null,s},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.source=this.getSource(!1),t.resource=this.getResource(!1),t.fileName=this.getFileName(),t.fileLength=this.getFileLength(),t},t.prototype.toPlain=function(){return""},t.prototype.toXml=function(t){var o,i,r=this;if(r.getSource(!1))return o=e.prototype.toXml.apply(r,[t]),n.each(["Source","Resource","FileName","FileLength"],function(e){var n=t.createElement(e.toLowerCase()),i=r["get"+e](),s=t.createTextNode(i);n.appendChild(s),o.appendChild(n)}),i=t.createElement("styles"),c.toXml(r,i,t),o.appendChild(i),d.appendToXml(r.unknownTree,o),o},t.prototype.initialize=function(t){if(null==t||null==t.source||null==t.resource||null==t.fileLength||null==t.fileName)throw new Error("props or prop(source, resource, fileName, fileLength) in props cannot be null");e.prototype.initialize.call(this,t),this.attachmentProps=n.clone(t),this.attachmentProps.fakeLoading=!!t.fakeLoading,this.type=u.ATTACHMENT},t}(l)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(6),n(30),n(10),n(17),n(1)],void 0===(i=function(e,t,n,o,i,r,a,l){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.create=function(e){if(e&&e.richText)return new t(e);l.warn("Failed to create Lines",e)},t.createBlank=function(e){return e?t.create({richText:r.createBlank(!1)}):new t({})},t.fromCollabJSON=function(e){var o=t.createBlank();return n.map(e,function(e){o.appendRichText(r.fromCollabJSON(e))}),o},t.fromJSON=function(e){var o=t.createBlank();return n.map(e,function(e){o.appendRichText(r.fromJSON(e))}),o},t.splitRichText=function(e){if(e){if(0===e.getLength()||!e.isKeepLineBreak())return[e];var t,o=e.getReadOnlyData(),i=[],s=[],a=0;for(a=0;a<o.length;a++)(t=o[a]).isLineBreak()?(i.push(s),s=[]):s.push(t);return s.length&&i.push(s),i=n.map(i,function(e){var t=r.create("",!1);return t.appendRichChars(e),t})}},t.prototype.appendLines=function(e){e&&(this.richTextList=this.richTextList.concat(e.getAsRichTextList()))},t.prototype.appendRichText=function(e){var n=t.splitRichText(e);n&&n.length&&(this.richTextList=this.richTextList.concat(n))},t.prototype.getAsRichTextList=function(){return[].concat(this.richTextList)},t.prototype.getCommonStyles=function(e,t,n){var o=this.toRichText();return e=e||0,t=t||o.getLength(),o.getCommonStyles(e,t,n)},t.prototype.getCommonStyle=function(e){var t;return n.some(this.richTextList,function(n){if(n&&!n.isEmpty()){var i=n.getCommonStyle(0,n.getLength(),e,!0);if(null==t)null!=i&&(t=i);else if(t!==i)return t=o.INTERM,!0}}),t===o.INTERM&&(t=null),t},t.prototype.getCount=function(){return this.richTextList.length},t.prototype.getStyle=function(e){var t=[];return n.each(this.richTextList,function(n){var o=n.getStyle(0,n.getLength(),e);t.push(o)}),t},t.prototype.isEmpty=function(){var e=this.richTextList;return!e||!e.length||n.every(e,function(e){return e&&e.isEmpty()})},t.prototype.setStyle=function(e,t){var o;n.isArray(t)?(o=t,n.each(this.richTextList,function(t,n){var i=o[n];t.setStyle(0,t.getLength(),e,i)})):n.each(this.richTextList,function(n){n.setStyle(0,n.getLength(),e,t)})},t.prototype.toCollabJSON=function(){return n.map(this.richTextList,function(e){return e.toCollabJSON()})},t.prototype.toJSON=function(){return n.map(this.richTextList,function(e){return e.toJSON()})},t.prototype.toHtml=function(e){var t=(e=n.defaults(e||{},{handleLineWrapper:function(e){e.className="table-cell-line"}})).styleRules,o=n.map(this.richTextList,function(n,o){var r=i.rich2html(n,{styleRules:t}),s=document.createElement("div");return e.handleLineWrapper(s,n,o),s.innerHTML=r,s.outerHTML});return o=o.join("")},t.prototype.toPlain=function(){return n.map(this.richTextList,function(e){return e?e.toString():""})},t.prototype.toRichText=function(){var e,t=this.getCount(),n=this.richTextList,o=r.create("",!0);for(e=0;e<t;e++)o.append(n[e]),e<t-1&&o.append(r.create("\n",!0));return o},t.prototype.toString=function(){return this.toRichText().toString()},t.prototype.initialize=function(e){e=n.defaults(e||{},{richText:null}),this.richTextList=[],this.appendRichText(e.richText)},t}(a)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(1),n(82)],void 0===(i=function(e,t,n,o,i){"use strict";return function(){function e(){}return e.cellsFromCollabJSON=function(e){return e?n.map(e,function(e){return n.map(e,function(e){return i.fromCollabJSON(e)})}):null},e.cellsFromJSON=function(e){var t,n,r,s=e.cellsJson,a=e.height,l=e.width,c=e.isUpdateCellId,u=e.resourceList,d=[];if(!s)return null;for(t=0;t<a;t++)for(d[t]=[],n=0;n<l;n++)s[r=t*l+n]||o.error("Bag json data, no cellData json, row, col: ",s,t,n),d[t][n]=i.fromJSON(s[r],c,u);return d},e.cellsToCollabJSON=function(e){return e?n.map(e,function(e){return n.map(e,function(e){return e.toCollabJSON?e.toCollabJSON():e})}):null},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(46),n(3),n(2),n(121),n(10),n(80),n(47),n(17),n(1),n(68),n(69),n(95),n(96),n(55),n(94)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h,p,g,f,m,_,y){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.blockToCell=function(e){var n,o=t.blockToCellContent(e);return o&&(n=t.create({content:o})),n},t.blockToCellContent=function(e){if(e){var t,i,s,d,f,m,_=r.getType(e);switch(_){case r.PARAGRAPH:case r.QUOTE:case r.CATALOGUE:case r.CODE:case r.HEADING:i=c.create({richText:e.getText()});break;case r.IMAGE:case r.HANDWRITE:i=g.create({source:e.getSource()});break;case r.ATTACHMENT:i=p.create({fileLength:e.getFileLength(),fileName:e.getFileName(),resource:e.getResource(),source:e.getSource()});break;case r.LIST_ITEM:(t=e.getText()).getLength()&&(m={},n.each(t.getStylesAtIndex(0),function(e,t){a.isSupportedStyle(t)&&(m[t]=e)})),d=a.makePlainMarker(e,!1),d=l.create(d,!1),m&&d.setStyles(0,d.getLength(),m),d.append(l.create(" ",!1)),s=e.getLevel()||1,f=o.repeat(" ",4*(s-1)),(f=l.create(f,!1)).append(d),f.append(t),i=c.create({richText:f});break;case r.TODO:f=u.getMarker(e),f=l.create(f,!1),t=e.getText(),e.getChecked()&&t.setStyles(0,t.getLength(),{strike:!0}),f.append(t),i=c.create({richText:f});break;default:h.warn("Failed to handle block to cell",_,e)}return i}},t.create=function(e){if(e&&e.content){var n=e.content;if(n instanceof c||n instanceof f)return new t(e);h.warn("Failed to create TableCell",e)}else h.warn("Failed to create TableCell",e)},t.createByTable=function(e,n,o,i){var r=e.getId(),s=t.makeCellId(r,n,o);return t.create({cellId:s,content:i})},t.fromCollabJSON=function(e){var n={cellId:e.cellId,content:y.contentFromCollabJSON(e.content),styles:e.styles};return e.attr&&(n.mergeWidth=e.attr.width,n.mergeHeight=e.attr.height,n.mergePointDX=e.attr.dx,n.mergePointDY=e.attr.dy),t.create(n)},t.fromJSON=function(e,o,i){e||h.error("Bad json data!");var r={};return r.styles=n.pick(e,m.getAllStyleNames()),n.extend(r,n.pick(e,t.ATTRIBUTE_NAMES),{cellId:e.cellId,content:y.contentFromJSON(e.content,!1,i)||c.createBlank()}),o&&delete r.cellId,t.create(r)},t.fromXml=function(e){if(e&&e.tableBlockId&&null!=e.rowIndex&&null!=e.colIndex){var o,i={cellId:t.makeCellId(e.tableBlockId,e.rowIndex,e.colIndex)},r=e.cellRawData,s=e.resourceMap,a=t._resourceFromJSON(r,s),l=t.ATTRIBUTE_NAMES,u=m.getAllStyleNames(),d=["value","resource","inlineStyles"].concat(l,u);return a?i.content=a:(o=t._linesFromJSON(r),i.content=o||c.createBlank()),r=r||{},i.unknown=n.omit(r,d.concat(n.keys(y.oldStyleNameMap))),i.styles=n.pick(r,u),n.extend(i,n.pick(r,l)),t.create(i)}h.warn("Failed to create TableCell from JSON",e)},t.makeCellId=function(e,t,n){return[e,"cell",t,n].join("-")},t._linesFromJSON=function(e){var n=t._richTextFromJSON(e);return n?c.create({richText:n}):c.createBlank()},t._resourceFromJSON=function(e,t){if(e&&e.resource){var n=e.resource,o=t[n];return o&&o.getResId&&o.getResId()===n?o:void 0}},t._richTextFromJSON=function(e){if(e&&e.value){var t=e.value,o=new l({text:t}),i=y.oldStyleNameMap,r=o.getLength();return n.each(i,function(t,i){var s=t,a=e[i];null!=a&&("font-size"===s&&n.isString(a)&&(a=a.replace("px","")),o.setStyle(0,r,s,a))}),e.inlineStyles&&n.each(e.inlineStyles,function(e,t){n.each(e,function(e){o.setStyle(e.from,e.to,t,e.value)})}),o}},t.prototype.clearMergedCellAttr=function(){delete this.mergePointDX,delete this.mergePointDY},t.prototype.clearMergePointAttr=function(){delete this.mergeWidth,delete this.mergeHeight},t.prototype.clearStyles=function(){this.styles={}},t.prototype.clearStylesForEmpty=function(){this.stylesForEmpty={}},t.prototype.getBlockStyles=function(){return this.styles},t.prototype.getBlockStylesAsBulb=function(){var e=n.clone(this.styles);return m.tableStyles2BulbStyles(e)},t.prototype.getCellId=function(){return this.cellId},t.prototype.getCommonInlineStyle=function(e){var t=this.getContent();return this.isTextNoEmptyCell()&&t.getCommonStyle?t.getCommonStyle(e):this.stylesForEmpty[e]},t.prototype.getCommonInlineStyles=function(){var e=this.getContent();return this.isTextNoEmptyCell()&&e.getCommonStyles?e.getCommonStyles():this.stylesForEmpty},t.prototype.getContent=function(){return this.content},t.prototype.getInlineStyles=function(e){if(this.isTextNoEmptyCell()){var t=this.getContent(),n={};return e.forEach(function(e){n[e]=t.getStyle(e)}),n}},t.prototype.getMergedCellAttr=function(){return{dx:this.mergePointDX||0,dy:this.mergePointDY||0}},t.prototype.getMergePointAttr=function(){var e=this.mergeWidth||0;return{height:this.mergeHeight||0,width:e}},t.prototype.getStylesForEmpty=function(e){var t,o=this;return e?(t={},n.each(e,function(e){t[e]=o.stylesForEmpty[e]}),t):o.stylesForEmpty},t.prototype.getType=function(){var e=_.TEXT,t=this.getContent();if(t&&t.getType)switch(t.getType()){case f.TYPE_IMAGE:e=_.IMAGE;break;case f.TYPE_ATTACHMENT:e=_.ATTACHMENT}return e},t.prototype.isAttachmentCell=function(){return this.getType()===_.ATTACHMENT},t.prototype.isEmpty=function(){var e=this.getType(),t=this.content;return e===_.TEXT&&(!t||t.isEmpty())},t.prototype.isImageCell=function(){return this.getType()===_.IMAGE},t.prototype.isLocked=function(){return this.locked},t.prototype.isMergedCell=function(){var e=this.getMergedCellAttr();return e.dx>=1||e.dy>=1},t.prototype.isMergePoint=function(){var e=this.getMergePointAttr();return e.width>1||e.height>1},t.prototype.isTextNoEmptyCell=function(){var e=this.getContent();return!!e&&(this.getType()===t.TYPE_TEXT&&!e.isEmpty())},t.prototype.setBlockStyle=function(e,t){var o=m.getConfig(e);o&&(this.isLocked()||("Enum"===o.type?o.possible[t]||(t=o.default):"Number"!==o.type||n.isNumber(t)?"Boolean"!==o.type||n.isBoolean(t)?n["is"+o.type]&&(n["is"+o.type](t)||(t=t.default)):t="true"===t:(t=null===t||""===t?NaN:Number(t),!isNaN(t)&&t||(t=o.default)),t=t||o.default,this.styles[e]=t))},t.prototype.setBlockStyles=function(e){var t=this;if(!t.isLocked())return e?(n.each(e,function(e,n){t.setBlockStyle(n,e)}),!0):void 0},t.prototype.setInlineStyles=function(e){if(e&&this.isTextNoEmptyCell()){var t=this.getContent();n.each(e,function(e,n){t.setStyle(n,e)})}},t.prototype.setContent=function(e){var t=!1;if(!this.isLocked())return e instanceof c?(this.content=e,t=!0,this.isTextNoEmptyCell()&&this.clearStylesForEmpty()):e instanceof f&&(this.content=e,t=!0),t},t.prototype.setLocked=function(e){this.locked=!0===e},t.prototype.setMergedCellAttr=function(e,t){if(null!=e&&null!=t&&e>=0&&t>=0&&(e>0||t>0))return this.mergePointDX=e,this.mergePointDY=t,this.clearMergePointAttr(),!0},t.prototype.setMergePointAttr=function(e,t){return!(!e&&!t)&&(e>=1&&!t&&(h.warn("No valid mergeHeight, will set 1"),t=1),t>=1&&!e&&(h.warn("No valid mergeWidth, will set 1"),e=1),this.mergeWidth=e,this.mergeHeight=t,this.clearMergedCellAttr(),!0)},t.prototype.setStylesForEmpty=function(e){h.log("setStylesForEmpty",e),n.extend(this.stylesForEmpty,e)},t.prototype.setUnknown=function(e){e&&(this.unknown=e)},t.prototype.toCollabJSON=function(){var e,t={};return this.isMergedCell()&&(t=n.extend(t,this.getMergedCellAttr())),this.isMergePoint()&&(t=n.extend(t,this.getMergePointAttr())),e={cellId:this.getCellId(),content:y.contentToCollabJSON(this.content),styles:n.extend({},this.styles)},n.isEmpty(t)||(e.attr=t),e},t.prototype.toHtml=function(){h.error("Should not call TabelCell.toHtml()")},t.prototype.toJSON=function(e){var t,o={},i={};return this.isMergedCell()&&(o=n.extend(o,this.getMergedCellAttr()),n.extend(i,{mergePointDX:o.dx,mergePointDY:o.dy})),this.isMergePoint()&&(o=n.extend(o,this.getMergePointAttr()),n.extend(i,{mergeHeight:o.height,mergeWidth:o.width})),this.isTextNoEmptyCell()&&(i.value=this.content.toString(),e&&(t=this.content.getCommonStyles(null,null,!0),n.extend(i,y.inlineStyle2oldCell(t)))),e?n.extend(i,y.blockStyle2oldCell(this.styles)):n.extend(i,{cellId:this.getCellId(),content:y.contentToJSON(this.content)},y.blockStyle2oldCell(this.styles)),i},t.prototype.toPlain=function(e){return this.isMergedCell()?"":y.contentToPlain(this.content,e)},t.prototype.toXml=function(e,t,o){var i,r,s,a,l,c={};if(this.isMergedCell())return{mergePointDX:(i=this.getMergedCellAttr()).dx,mergePointDY:i.dy,value:""};switch(this.isMergePoint()&&(c={mergeHeight:(i=this.getMergePointAttr()).height,mergeWidth:i.width}),r=this.getType(),s=this.getContent(),n.isEmpty(this.styles)||n.extend(c,this.styles),n.isEmpty(this.unknown)||n.extend(c,this.unknown),r){case _.TEXT:a=s.toRichText().toJSON(!0),c.value=a.text,a.inlineStyles&&(c.inlineStyles=a.inlineStyles);break;case _.IMAGE:case _.ATTACHMENT:l=s.getResId(),c.value="",c.resource=l,l&&!0===o[l]?h.warn("resource has already in <resource-list>",l,s):(s.toXml(e,t),o[l]=!0);break;default:h.error("unvalid type",r)}return c},t.prototype.initialize=function(e){e=e||{},this.styles={},this.cellId=e.cellId||i.newGUID(),this.setContent(e.content),this.setBlockStyles(e.styles),this.setMergePointAttr(e.mergeWidth,e.mergeHeight),this.setMergedCellAttr(e.mergePointDX,e.mergePointDY),this.setUnknown(e.unknown),this.stylesForEmpty={}},t.TYPE_TEXT="text",t.ATTRIBUTE_NAMES=["mergeWidth","mergeHeight","mergePointDX","mergePointDY"],t}(d)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(61)],void 0===(i=function(e,t,n){"use strict";return n({DEFAULT_ROW_HEIGHT:40,DEFAULT_COL_WIDTH:70,MIN_ROW_COUNT:1,MIN_COL_COUNT:1,MAX_ROW_COUNT:500,MAX_COL_COUNT:35,ATTACHMENT_MIN_WIDTH:285,ATTACHMENT_MIN_HEIGHT:64,DEFAULT_TABLE_WIDTH:620},!0)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(1);return{_getHref:function(e,t){if(!(t<0||t>=e.getLength()))return(e.getTextStylesAtIndex(t)||{}).href},_hasHref:function(e,t,n){var o=this._getHref(e,t);return n?o===n:o&&o.length>0},isAtHrefBorder:function(e,t,n){var o=n?t-1:t,i=this._getHref(e,o),r=this._getHref(e,n?o+1:o-1);return i&&i.length>0&&i!==r},findHrefBorder:function(e,n,o){if(!e||!e.getText)return t.error("param is not valid!"),-1;var i,r,s,a=-1,l=e.getText().getLength();if(n>l)return-1;if(o){if(i=n-1,!(s=this._getHref(e,i)))return-1;for(r=i-1;r>=-1;r--)if(!this._hasHref(e,r,s)){a=r+1;break}}else{if(i=n,!(s=this._getHref(e,i)))return-1;for(r=i+1;r<=l;r++)if(!this._hasHref(e,r,s)){a=r-1;break}}return a},completeUrl:function(e){return!e||/\:\/\//.exec(e)?e:"http://"+e}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(10),s=n(3);return t=o.extend({name:"atom.InsertCodeText",_textBlock:null,_startLineIndex:null,_insertedText:null,initialize:function(){var e=this.options.args;s.isCollabCommand(e)||(this._textBlock=this.options.block,this._startLineIndex=this.options.startBlockRange.startLineIndex,this._startLineCharIndex=this.options.startBlockRange.startLineCharIndex,this._insertedText=this.options.text),t.__super__.initialize.apply(this)},apply:function(){return!!this._insertedText&&(this._textBlock.insertText(this._startLineIndex,this._startLineCharIndex,this._insertedText),!0)},doUnapply:function(){this._textBlock&&this._insertedText&&this._textBlock.deleteText(this._startLineIndex,this._startLineCharIndex,this._startLineIndex,this._startLineCharIndex+this._insertedText.getLength())},fromCollabJSON:function(){var e=this.options.args,n=e.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),n&&(this._insertedText=r.fromCollabJSON(n.richText),this._textBlock=e.collabProperties.coreEditor.getBlockById(n.blockId),this._start=n.startPosition)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._textBlock.getId(),e.richText=this._insertedText.toCollabJSON(),e.startPosition=this._start,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(2),s=n(11),a=n(1),l=n(23),c=n(49),u=n(3);return t=o.extend({name:"abstract.comp.InsertResource",_cmdArgs:null,_note:null,_newStartBlkId:null,_newEndBlkId:null,_resourceBlock:null,_retainStartBlock:null,insertResource:function(e,t,n){throw a.error("Method not implemented with:",e,t,n),"Method not implemented"},initialize:function(){var e;this._note=this.options.note,e=this._cmdArgs=this.options.args||{},t.__super__.initialize.apply(this,arguments),u.isCollabCommand(e)||(this._newStartBlkId=u.newGUID(),this._newEndBlkId=u.newGUID(),1===e.retainStartBlock||"1"===e.retainStartBlock||!0===e.retainStartBlock?this._retainStartBlock=!0:this._retainStartBlock=!1)},apply:function(){var e=this._cmdArgs.range,t=e.getStartBlockRange().block;return e?(e.isCollapsed()||e.isSingleTableSelected()||r.isCode(t)||s.deleteSelectedContent(this,this._note,e),e.isInMultiBlock()?this._handleMultiBlockSelection(e):r.isTable(t)?this._handleSingleTableSelection(e,t):this._handleSingleBlockSelection(e)):(a.error(this.name+":note range should NOT be null"),!1)},_deleteBlocks:function(e){this.executeAtomicCommand(new l({note:this._note,blocks:e}))},_deleteBlockText:function(e,t,n){var o="";return t<n&&(o=e.sliceText(t,n),this.executeAtomicCommand(new c({block:e,start:t,end:n}))),o},_handleMultiBlockSelection:function(e){var t,n,o,i,a,l,c,u,d=[],h=[];return t=e.getStartBlockRange().block,a=(i=e.getEndBlockRange()).block,r.isListItem(t)?(u=this._note.getNextBlock(a),i.start!==a.getLength()?(c=a.getText?a.getText():"",l=s.createNewListItem(t,a.getId(),c),h.push(l.getId())):r.isTextBlock(u)||(l=s.createNewParagraph(a,a.getId(),"")),this._deleteBlocks([a]),this._resourceBlock=this.insertResource(t,null,l),h.push(a.getId(),this._resourceBlock.getId()),l||(l=u)):r.isTextBlock(t)?r.isListItem(a)||!r.isTextBlock(a)?(c=a.getText?a.getText():"",l=s.createNewParagraph(a,a.getId(),c),this._deleteBlocks([a]),this._resourceBlock=this.insertResource(t,null,l),h.push(a.getId(),this._resourceBlock.getId())):(l=a,this._resourceBlock=this.insertResource(t),h.push(this._resourceBlock.getId())):(o=this._note.getPreBlock(t),r.isTextBlock(o)&&!r.isCode(o)||(n=s.createNewParagraph(o,this._newStartBlkId,""),h.push(this._newStartBlkId)),d.push(t),h.push(t.getId()),r.isTextBlock(a)||(d.push(a),l=s.createNewParagraph(a,a.getId(),""),h.push(a.getId())),this._deleteBlocks(d),this._resourceBlock=this.insertResource(o,n,l),h.push(this._resourceBlock.getId()),l||(l=a)),s.setTextBlockAsEndingRange(this,l,0,0),this.pushAffectedBlockIds(h),!0},_handleSingleBlockSelection:function(e){var t,n,o,i,a,l,c=[];if(n=(t=e.getStartBlockRange()).block,e.getEndBlockRange().block,!r.isTextBlock(n,t)||n.isEmpty()&&!r.isCode(n))i=this._note.getPreBlock(n),(a=this._note.getNextBlock(n))&&r.isTextBlock(a)||(l=s.createNewParagraph(n,this._newEndBlkId,""),c.push(this._newEndBlkId)),this._retainStartBlock&&(r.isTable(n)||r.isAttachment(n)||r.isImage(n))||r.isCatalogue(n)?(i=n,o=s.createNewParagraph(n,this._newStartBlkId,""),c.push(this._newStartBlkId)):(i&&r.isTextBlock(i)&&!r.isCode(i)||(o=s.createNewParagraph(n,this._newStartBlkId,""),c.push(this._newStartBlkId)),this._deleteBlocks([n]),c.push(n.getId())),this._resourceBlock=this.insertResource(i,o,l);else{if(r.isCode(n))return;a=this._note.getNextBlock(n),t.start!==n.getLength()?l=this._handleSingleParaBlock(t,n):r.isTextBlock(a)||(l=s.createNewParagraph(n,this._newEndBlkId,"")),c.push(this._newEndBlkId),this._resourceBlock=this.insertResource(n,null,l)}return c.push(this._resourceBlock.getId()),l||(l=a),s.setTextBlockAsEndingRange(this,l,0,0),this.pushAffectedBlockIds(c),!0},_handleSingleParaBlock:function(e,t){var n;return n=this._deleteBlockText(t,e.start,t.getLength()),r.isHeading(t)?s.createNewHeading(t,this._newEndBlkId,n,t.getLevel()):r.isCatalogue(t)?s.createNewCatalogue(t,{paraId:this._newEndBlkId,text:n,href:t.getHref()}):r.isListItem(t)?s.createNewListItem(t,this._newEndBlkId,n):r.isQuote(t)?s.createNewQuote(t,{id:this._newEndBlkId,text:n}):r.isTodo(t)?s.createNewTodo(t,{id:this._newEndBlkId,text:n,checked:!1}):s.createNewParagraph(t,this._newEndBlkId,n)},_handleSingleTableSelection:function(e,t){return this._resourceBlock=this.insertResource(t),this.setEndingRange(e),!0},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._newStartBlkId=e.newStartBlkId,this._newEndBlkId=e.newEndBlkId,this._retainStartBlock=e.abstractSimpleValue1)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.newStartBlkId=this._newStartBlkId,e.newEndBlkId=this._newEndBlkId,e.abstractSimpleValue1=this._retainStartBlock),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){for(var t=n(0),o=n(6),i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"ins",46:"del",106:"*",107:"+",109:"-",110:".",111:"/",144:"numlock",186:";",189:"-",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},r=o.IS_MAC?{3:"enter",91:"meta",93:"meta",224:"meta"}:{91:"win",92:"win",93:"menu",224:"win",229:"ime"},s=function(e,n,o){return t.some(e,function(e,t){return e===n&&parseInt(t,10)===o})},a={},l="A".charCodeAt(0),c="Z".charCodeAt(0);l<=c;l++)i[l]=String.fromCharCode(l).toLowerCase();for(l=1;l<20;++l)i[111+l]="f"+l;for(l=0;l<=9;l++)i[48+l]=l+"";for(l=0;l<=9;++l)i[l+96]=l+"";return{isMatch:function(e,t){var n=e+"-"+t,o=a[n];return null==o&&(o=s(r,e,t)||s(i,e,t),a[n]=o),o},getKey:function(e){if(t.isNumber(e))return i[e+=""]||r[e]}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(106),o=n(7),i=n(0);return t.extend({editorEvents:{"yne-editing-state-change":"onEditingStateChange"},onChange:function(e){var t={},n=this.editor.controller.editingInlineStates;t[this.name]=e,this.editor.execCommandByToolbar("comp.ApplyStyles",{inlineStyles:t,editingInlineStates:n})},updateValueUI:function(e){var t=o(this.valueWrapperEl).find(".combo-value")[0];this.items[e]?o(t).text(this.items[e]):o(t).text(this.getUnlistedText(e)||"")},getUnlistedText:function(){return""},onEditingStateChange:function(e,t){this._isForceSelectWhenClick=!1,i.has(e,this.name)&&(t&&i.has(t,this.name)&&e[this.name]!==t[this.name]&&(this._isForceSelectWhenClick=!0),this.select(e[this.name]))}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(51),i=n(2),r=n(76),s=n(19),a=n(47),l=n(10),c=n(227),u=n(6),d=n(0),h=n(52),p=n(64),g=n(7),f=n(3);return t=null,o.extend({inheritStyleHandlers:{bold:!0,italic:!0,underline:!0,strike:!0,"font-family":!0,"font-size":!0,color:!0,"back-color":!0,"white-space":!0,align:!0,"line-height":!0,indent:!0,"text-indent":!0},computeBulbStyles:function(){var e,n=this.el,o=n.getAttribute("yne-bulb-block");this.bulbBlock=o,o===i.PARAGRAPH?(e=n.style.marginLeft,e=parseInt(e,10),isNaN(e)||(e=Math.ceil(e/u.INDENT_WIDTH),this.styles.indent=(this.styles.indent||0)+e)):o===i.TODO&&(e=n.querySelector("[yne-bulb-todo-content]"))?n.innerHTML=e.innerHTML:("catalogue-wrap"===n.getAttribute("yne-bulb-type")||!t&&o===i.CATALOGUE)&&(t=new p({}))},setup:function(){this.block=null},capture:function(e){e&&!0===e.isBr?this.emitBlock(!0):e&&!0===e.isText?this._appendText(e):e&&!0===e.isEmptyPara?this.emitBlock():this.captureBlock(e),this._hasChild=!0},captureBlock:function(e){this.emitBlock(),this.emit(e)},finish:function(){this.emitBlock(),this._hasChild||this.emit({isEmptyPara:!0})},_getBlock:function(){return this.block||(this.block=this.createBlock()),this.block},createBlock:function(){var e,n=this.el;switch(this.bulbBlock){case i.HEADING:return new r({level:n.getAttribute("yne-bulb-level"),id:n.id});case i.CATALOGUE:return e=g(n).find("a").attr("href"),/#\w+$/.test(e)&&(e=e.match(/\w+$/)[0]),new h({id:f.newGUID(),href:e,ownerList:t});case i.TODO:return new a({id:f.newGUID(),checked:"true"===n.getAttribute("yne-bulb-checked")});default:return new s}},_appendText:function(e){this.txtList=this.txtList||[],this.txtList.push(e)},emitBlock:function(e){var t,n,o,r=this,s=r.txtList;n=r._getBlock(),s&&(r.options&&r.options.holdSpaces||(s=c(s)),d.each(s,function(e){r.bulbBlock===i.CATALOGUE&&(e.styles.href=""),e.text&&(o=new l({text:e.text}),t=o.getLength(),d.each(e.styles,function(e,n){o.setStyle(0,t,n,e)}),n.append(o))})),(e||n.getLength()>0)&&(n.setBlockStyles(r.styles),r.emit(n)),r.block=null,r.txtList=null}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";return function(e){return e.replace(/\xA0/g," ")}}.apply(t,[n,t]))||(e.exports=o)},,,function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(51);return o.extend({inheritStyleHandlers:{bold:!0,italic:!0,underline:!0,strike:!0,"font-family":!0,"font-size":!0,color:!0,"back-color":!0,"white-space":!0},inheritBlockStyles:{align:!0,"line-height":!0,indent:!0,"text-indent":!0},_computeInheritStyles:function(){o.prototype._computeInheritStyles.apply(this,arguments),this._computeInheritBlockStyles()},_computeInheritBlockStyles:function(){var e,n=this,o=n.parent,i=n.inheritBlockStyles;o&&o.styles&&(e=o.styles,t.each(i,function(t,o){if(!0===t){var i=e[o];i&&(n.styles[o]=i)}}))},capture:function(e){this.emit(e)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(80),n(1),n(68),n(69),n(95),n(55)],void 0===(i=function(e,t,n,o,i,r,s,a,l){"use strict";return function(){function e(){}return e.boolean2string=function(e){return n.isBoolean(e)?String(e):e},e.blockStyle2oldCell=function(t){var o={};return n.map(t,function(t,n){o[n]=e.boolean2string(t)}),o},e.contentFromCollabJSON=function(t){return e.contentFromJSON(t,!0)},e.contentFromJSON=function(e,t,n){if(e){var a,c=e.type,u=e.data;switch(c){case l.IMAGE:a=t?s.fromCollabJSON(u):s.fromJSON(u,n);break;case l.ATTACHMENT:a=t?r.fromCollabJSON(u):r.fromJSON(u,n);break;case l.TEXT:a=t?o.fromCollabJSON(u):o.fromJSON(u);break;default:i.error("do not support type",c)}return a}},e.contentToCollabJSON=function(t){return e.contentToJSON(t,!0)},e.contentToHtml=function(e,t){if(!e)return"";var n={resourceMap:t};return e instanceof o||e instanceof s||e instanceof r?e.toHtml(n):(i.warn("unvalid content",e),"")},e.contentToJSON=function(e,t){t=!0===t;var n=l.TEXT;if(e){if(e.getType)switch(e.getType()){case a.TYPE_IMAGE:n=l.IMAGE;break;case a.TYPE_ATTACHMENT:n=l.ATTACHMENT}return{data:t?e.toCollabJSON():e.toJSON(),type:n}}},e.contentToPlain=function(e,t){return e?e instanceof o?e.toPlain().join(t?"\n":""):e instanceof s?e.toPlain():e instanceof r?e.toPlain():(i.warn("unvalid content",e),""):""},e.inlineStyle2oldCell=function(t){var o=this.oldStyleNameMap,i={};return n.map(o,function(n,o){null==t[n]||(i[o]=e.boolean2string(t[n]))}),i},e.oldStyleNameMap={bold:"bold",italic:"italic",underline:"underline",lineThrough:"strike",fontName:"font-family",fontSize:"font-size",textColor:"color",link:"href"},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(17),n(1)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromXml=function(e,t){o.error("fromXml() should be implemented by sub-class")},t.fromCollabJSON=function(e){return o.error("fromCollabJSON() should be implemented by sub-class"),null},t.prototype.getResId=function(){return this.resProps.resId||o.error("No resId"),this.resProps.resId},t.prototype.getType=function(){return this.resProps.type},t.prototype.isType=function(e){return this.resProps.type===e},t.prototype.toHtml=function(e){return o.error("toHtml() should be implemented by sub-class"),""},t.prototype.toJSON=function(){o.error("toJSON() should be implemented by sub-class")},t.prototype.toCollabJSON=function(){o.error("toCollabJSON() should be implemented by sub-class")},t.prototype.toPlain=function(){o.error("toPlain() should be implemented by sub-class")},t.prototype.toXml=function(e,t){o.error("toXml() should be implemented by sub-class")},t.prototype.initialize=function(e){this.resProps=e||{resId:"",type:t.TYPE_IMAGE}},t.TYPE_IMAGE="image",t.TYPE_ATTACHMENT="attachment",t}(n)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(248)],void 0===(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.bulbStyles2TableStyles=function(e){return e.align&&(e.textAlign=e.align,delete e.align),e},e.getAllDefaults=function(){var t={};return n.each(e.STYLE_NAMES,function(n){t[n]=e.getDefault(n)}),t},e.getAllStyleNames=function(){return[].concat(e.STYLE_NAMES)},e.getConfig=function(t){var n;return e.isSupport(t)&&(n=o[t]),n},e.getDefault=function(t){return(e.getConfig(t)||{}).default},e.isSupport=function(t){return e.STYLE_NAMES.indexOf(t)>-1},e.tableStyles2BulbStyles=function(e){return e.textAlign&&(e.align=e.textAlign,delete e.textAlign),e},e.STYLE_NAMES=n.keys(o)||[],e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(){return{test:function(e){return e=String(e),/(https?:\/\/|www\.|ssh:\/\/|ftp:\/\/)[a-z0-9&_+\-\?\/\.=\#,:,@]+$/i.test(e)||/[a-z0-9_+\-\.]+@[a-z0-9_+\-\.]+$/i.test(e)||!1},matchEnd:function(e){var t,n;return e=String(e),(t=/(https?:\/\/|www\.|ssh:\/\/|ftp:\/\/)[a-z0-9&_+\-\?\/\.=\#,:@%\(\)~]+$/i.exec(e))?{mail:!1,fullURI:0===(n=t[0]).toLowerCase().indexOf("www.")?"http://"+n:n,result:t}:(t=/[a-z0-9_+\-\.]+@[a-z0-9_+\-\.]+$/i.exec(e))?{mail:!0,fullURI:"mailto:"+(n=t[0]),result:t}:void 0}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(6),n(0),n(2),n(19),n(30),n(123)],void 0===(i=function(e,t,n,o,i,r,a,l){"use strict";var c;return(c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.createBlank=function(){return new t({})},t.prototype.getTextStylesAtIndex=function(e){return this.richText.getStylesAtIndex(e,this.getDefaultSetFont())},t.prototype.getInlineStyleForEmpty=function(e,t){return(this.getInlineStylesForEmpty(t)||this.getDefaultSetFont())[e]},t.prototype.getCommonInlineStyle=function(e,t){var n,o;return t?(n=t.start,o=t.end):(n=this.getStartOffset(),o=this.getEndOffset()),this.richText.getCommonStyle(n,o,e,l.getQuoteDefaultStyles())},t.prototype.getTextStyle=function(e,t,n){var i=this.richText;return o.isObject(t)&&null!=t.start&&(n=t.end,t=t.start),i.getStyle(t,n,e,this.getDefaultSetFont())},t.prototype.setTextStyle=function(e,t,n,i){var r=this.richText;o.isObject(n)&&null!=n.start&&(i=n.end,n=n.start),r.setStyle(n,i,e,t,this.getDefaultSetFont()),this.trigger("content-change")},t.prototype.toHtml=function(e,t,i){e=e||0,t=null==t?this.getEndOffset():t,i=!0===i;var r=document.createElement("div"),s=document.createElement("div"),l=$(r),c=$(s),u=this.getBlockStyles();return c.attr("yne-bulb-block","quote").css("white-space","pre-wrap").css("padding",n.QUOTE_PADDING).css("border-left",n.QUOTE_BORDER_LEFT).css("margin",n.QUOTE_MARGIN),u&&o.each(u,function(e,t){switch(t){case"back-color":e&&l.css("background-color",e);break;case"padding":e&&(c.css("padding",e),c.css("margin",e))}}),c.html(a.rich2html(this.sliceText(e,t,!1),{withDefault:i})),l.append(c),r.outerHTML},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=i.QUOTE},t}(r)).DEFAULT_STYLES={color:"#999999",bold:300,"font-family":"宋体","font-size":"14"},c}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(2),n(42)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.isHeaderFooterRange=function(e){return n.isHeaderFooter(e.block)},t.prototype.collapse=function(e){void 0===e&&(e=!0),e?this.end=this.start:this.start=this.end},t.prototype.isCollapsed=function(){return this.start===this.end},t.prototype.clone=function(){return new t({block:this.block,end:this.end,start:this.start})},t.prototype.getDataAsPlain=function(){return""},t.prototype.canDrawedByNative=function(){return!0},t.prototype.toNativeRange=function(e){return null},t.prototype.toCollabJSON=function(){var e=this.block.toCollabJSON();return e.rangeType=this.type,e.blockId=this.block.getId(),e},t.prototype.countWords=function(){return this.end-this.start},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.HEADER_FOOTER,this.start=t.start||0,this.end=t.end||0,this.block=t.block},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(2),n(8),n(1),n(42)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromCollabJSON=function(e,o){var s,a=e.rangeType;if(a===n.ATTACHMENT)return(s=r.getBlockById(e.blockId,o))?new t({block:s}):void 0;i.error("wrong block range type:",a)},t.prototype.canDrawedByNative=function(){return!1},t.prototype.clone=function(){return new t({block:this.block})},t.prototype.collapse=function(e){},t.prototype.getDataAsHtml=function(e){return this.block.toHtml(null,null,e)},t.prototype.getDataAsJSON=function(){var e=this.block.toJSON();return(o.IS_WEB_NOTE||o.IS_WEB_GROUP)&&e.resource&&!/^http/i.test(e.resource)&&(e.resource=location.protocol+"//"+location.hostname+e.resource),e},t.prototype.getDataAsPlain=function(){return this.block.toPlain()},t.prototype.isCollapsed=function(){return!1},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.ATTACHMENT},t}(r)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(1),n(2),n(42)],void 0===(i=function(e,t,n,o,i){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromCollabJSON=function(e,r){var s=e.rangeType;if(s===o.IMAGE){var a=i.getBlockById(e.blockId,r);return a?new t({block:a}):void 0}n.error("wrong block range type:",s)},t.prototype.isCollapsed=function(){return!1},t.prototype.clone=function(){return new t({block:this.block})},t.prototype.collapse=function(){},t.prototype.getDataAsJSON=function(){return this.block.toJSON()},t.prototype.getDataAsHtml=function(e){return this.block.toHtml(null,null,e)},t.prototype.getDataAsPlain=function(){return this.block.toPlain()},t.prototype.canDrawedByNative=function(){return!1},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=o.IMAGE},t}(i)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(10),s=n(3);return t=o.extend({name:"atom.DeleteCodeText",_textBlock:null,_startLineIndex:null,_startLineCharIndex:null,_endLineIndex:null,_endLineCharIndex:null,_deletedText:null,_inlineStyles:null,initialize:function(){var e=this.options.args;s.isCollabCommand(e)||(this._textBlock=this.options.block,this.options.startBlockRange.hasOwnProperty("startLineCharIndex")?(this._startLineIndex=this.options.startBlockRange.startLineIndex,this._startLineCharIndex=this.options.startBlockRange.startLineCharIndex):(this._startLineIndex=this.options.endBlockRange.startLineIndex,this._startLineCharIndex=this.options.endBlockRange.startLineCharIndex),this.options.endBlockRange.hasOwnProperty("endLineCharIndex")?(this._endLineIndex=this.options.endBlockRange.endLineIndex,this._endLineCharIndex=this.options.endBlockRange.endLineCharIndex):(this._endLineIndex=this.options.startBlockRange.endLineIndex,this._endLineCharIndex=this.options.startBlockRange.endLineCharIndex),this._inlineStyles=this.options.inlineStyles),t.__super__.initialize.apply(this)},apply:function(){var e=this._textBlock,t=e.sliceText(this._startLineIndex,this._startLineCharIndex,this._endLineIndex,this._endLineCharIndex);return!!t&&(this._deletedText=t,e.deleteText(this._startLineIndex,this._startLineCharIndex,this._endLineIndex,this._endLineCharIndex),!0)},doUnapply:function(){var e=this._deletedText;this._textBlock&&this._deletedText&&this._textBlock.insertText(this._startLineIndex,this._startLineCharIndex,e)},fromCollabJSON:function(){var e=this.options.args,n=e.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),n&&(this._deletedText=r.fromCollabJSON(n.richText),this._textBlock=e.collabProperties.coreEditor.getBlockById(n.blockId),this._start=n.startPosition,this._end=n.endPosition)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._textBlock.getId(),e.richText=this._deletedText.toCollabJSON(),e.startPosition=this._start,e.endPosition=this._end,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(79),n(2),n(52),n(76),n(78),n(54),n(35),n(19),n(67),n(47),n(98)],void 0===(i=function(e,t,n,o,i,r,s,a,l,c,u,d,h){"use strict";return function(){function e(){}return e.buildBlockFromJSON=function(e,t){var p=null,g=e.type;switch(g){case o.PARAGRAPH:p=c.fromCollabJSON(e);break;case o.IMAGE:p=a.fromJSON(e);break;case o.ATTACHMENT:p=n.fromJSON(e);break;case o.LIST_ITEM:p=l.fromCollabJSON(e);break;case o.TABLE:p=u.fromJSON(e);break;case o.HR:p=s.fromCollabJSON(e);break;case o.HEADING:p=r.fromCollabJSON(e);break;case o.CATALOGUE:p=i.fromCollabJSON(e);break;case o.TODO:p=d.fromCollabJSON(e);break;case o.QUOTE:p=h.fromCollabJSON(e);break;default:throw new Error("unsupported type [ "+g+"] in buildBlockFromJSON")}return p},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(0),i=n(15),r=n(4),s=n(43),a=n(3);return t=i.extend({name:"atom.SetTableCellBlockStyle",_table:null,_rect:null,_type:null,effected:!1,_oldStyles:{},_styles:null,initialize:function(){var e=this.options.args;this._oldStyles={},a.isCollabCommand(e)||(this._table=this.options.table,this._styles=this.options.styles,this._toggle=this.options.toggle,this._rect=this.options.rect,this._type=this.options.type,this._default=this.options.default),this.type===s.TYPES.ALL&&(this._rect=this._rect||{top:0,left:0,width:this._table.getColumnCount(),height:this._table.getRowCount()}),t.__super__.initialize.apply(this)},apply:function(){var e,t,n,i,r,a,l,c,u=this._table,d=this._rect,h=this._styles||{},p=this._toggle,g=!1;if(!d)return this.effected;if(e=d.top+d.height,t=d.left+d.width,p){if(!(r=s.create({block:u,type:s.TYPES.NORMAL,rect:d})))return this.effected;if(!(a=r.getAsRectRange()))return this.effected;n=u.getCommonBlockStyle(p,a),h[p]=null!=n?!n:null==this._default||!this._default}for(i=o.keys(h),l=d.top;l<e;l++)for(c=d.left;c<t;c++)this._oldStyles[l+"-"+c]=u.getCellBlockStyles({row:l,col:c,names:i}),u.setCellBlockStyles({row:l,col:c,styles:h})&&(g=!0);return this.effected=g,this.effected},doUnapply:function(){var e,t,n=this._table,o=this._rect,i=o.top+o.height,r=o.left+o.width;for(e=o.top;e<i;e++)for(t=o.left;t<r;t++)n.setCellBlockStyles({row:e,col:t,styles:this._oldStyles[e+"-"+t]})},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._styles=o.styleNameValues,this._oldStyles=o.oldStyleNameValues,this._rect=o.simpleValue1,this._type=o.simpleValue2,this._toggle=o.newBlkId)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.styleNameValues=this._styles||null,e.oldStyleNameValues=this._oldStyles,e.simpleValue1=this._rect,e.simpleValue2=this._type,e.newBlkId=this._toggle||null,e}}),r.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(0),s=n(3);return t=o.extend({name:"atom.SetListItemLevel",_listItems:null,_newLevels:null,_oldLevels:null,initialize:function(){var e=this,n=e.options,o=n.args;s.isCollabCommand(o)||(e._listItems=n.listItems,e._newLevels={},n.newLevel?r.each(e._listItems,function(t,o){e._newLevels[o]=n.newLevel}):n.deltaLevel&&r.each(e._listItems,function(t,o){e._newLevels[o]=t.getLevel()+n.deltaLevel})),t.__super__.initialize.apply(e)},apply:function(){var e=this;return e._oldLevels={},r.each(e._newLevels,function(t,n){e._oldLevels[n]=e._listItems[n].getLevel(),e._listItems[n].setLevel(t)}),!0},doUnapply:function(){var e=this;return r.each(e._oldLevels,function(t,n){e._listItems[n].setLevel(t)}),!0},fromCollabJSON:function(){var e,n=this,o=n.options.args,i=o.collabProperties.cmdJSON;i&&(e=o.collabProperties.coreEditor.getNote(),i.oldLevels&&(n._oldLevels=i.oldLevels),n._newLevels=i.newLevels,n._listItems=[],r.each(i.listItemIds,function(t){n._listItems.push(e.getBlockById(t))})),t.__super__.fromCollabJSON.apply(n)},toCollabJSON:function(){var e=[],n=t.__super__.toCollabJSON.apply(this);return this._oldLevels&&(n.oldLevels=this._oldLevels),n.newLevels=this._newLevels,r.each(this._listItems,function(t){e.push(t.getId())}),n.listItemIds=e,n}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(7),i=n(12),r=n(74),s=n(8),a=n(20),l=n(6);return r.extend({className:"toolbar-item toolbar-combo-box",events:{"click .combo-value-wrapper":"onValueWrapperElClick","click .combo-expand-wrapper":"onExpandWrapperElClick","click .combo-menu-wrapper":"onMenuWrapperClick",mousedown:"onMouseDown"},name:"unknown",label:"unknown",defaultValue:"",items:{},value:"",templateName:"toolbar-combo-box-template",_isForceSelectWhenClick:!1,initialize:function(e){this.editor=e.editor,this.render(),this.defaultSetValue?this.select(this.defaultSetValue):this.select(this.defaultValue),this.bindEvents(),this.bindDocumentEvents(),this.bindEditorEvents()},render:function(){var e,t=this.$el;if(t.addClass("combo-box-"+this.name),e=i.render("web",this.templateName,{name:this.name,label:this.label,defaultValue:this.defaultValue,items:this.items}),t.html(e),this.valueWrapperEl=t.find(".combo-value-wrapper")[0],this.expandWrapperEl=t.find(".combo-expand-wrapper")[0],this.menuWrapperEl=t.find(".combo-menu-wrapper")[0],this.displayWrapperEl=t.find(".combo-display-wrapper")[0],o(this.displayWrapperEl).tooltipster({animation:"",animationDuration:0,theme:["tooltipster-borderless","tooltipster-borderless-customized"],side:"bottom",delay:[800,300]}),this.isVisible||this.hide(),"heading"===this.name&&(!a.isSafari()||s.IS_MAC))for(var n=l.IS_MAC?"Command+":"Ctrl+",r=3;r<=6;r++)o(o(this.menuWrapperEl).find("li[data-value="+r+"]")[0]).tooltipster({animation:"",animationDuration:0,theme:["tooltipster-heading","tooltipster-heading-customized"],side:"right",delay:[800,300],content:n+(r-2)})},bindEvents:function(){},bindDocumentEvents:function(){t.bindAll(this,"onDocumentMouseDown"),o(document).on("mousedown",this.onDocumentMouseDown)},bindEditorEvents:function(){var e=this,n=e.editor,o=e.editorEvents;o&&t.each(o,function(t,o){n.on(o,e[t].bind(e))})},onValueWrapperElClick:function(){this.toggleMenu()},onExpandWrapperElClick:function(){this.toggleMenu()},onMenuWrapperClick:function(e){var t=e.target,n=o(t).closest(".combo-item")[0];n&&(this.hideMenu(),this.onItemClick(n))},onItemClick:function(e){var t,n,i=o(e).data("value"),r=this.editor.getNoteRange();i&&(i!==this.value||!0===this._isForceSelectWhenClick||r.isInMultiBlock())&&(this._isForceSelectWhenClick=!1,this.select(i),this.onChange(i)),r.isSingleTableSelected()&&(n=(t=r.startRange).getAsRectRang?t.getAsRectRang:null)&&!n.onlyOneCell()&&(this.select(i),this.onChange(i))},select:function(e){this.value=e,this.updateValueUI(e)},updateValueUI:function(){},onChange:function(){},showMenu:function(){var e=this.menuWrapperEl;o(e).removeClass("menu-position-fix"),o(e).addClass("show"),e.getBoundingClientRect().right>document.documentElement.offsetWidth&&o(e).addClass("menu-position-fix")},hideMenu:function(){o(this.menuWrapperEl).removeClass("show")},toggleMenu:function(){o(this.menuWrapperEl).hasClass("show")?this.hideMenu():this.showMenu()},onDocumentMouseDown:function(e){var t=e.target;o.contains(this.el,t)||this.hideMenu()},onMouseDown:function(e){e.preventDefault()},reset:function(){this.defaultSetValue?this.select(this.defaultSetValue):this.select(this.defaultValue)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(33),o=n(0);return t.extend({editorEvents:{"yne-editing-state-change":"onEditingStateChange"},onEditingStateChange:function(e){o.has(e,this.name)&&this.setState(e[this.name])},onClick:function(){var e={},t=this.editor.controller.editingInlineStates;e[this.name]=!this.state,this.editor.execCommandByToolbar("comp.ApplyStyles",{inlineStyles:e,editingInlineStates:t})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(106).extend({editorEvents:{"yne-selection-change":"onSelectionChange"},onChange:function(e){var t={};t[this.name]=e,this.editor.execCommandByToolbar("comp.ApplyStyles",{blockStyles:t})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(16),o=n(7),i=n(0),r=n(6),s=n(87),a=["shift","alt","ctrl","meta"],l={return:"enter",escape:"esc",plus:"+"},c={mod:r.IS_MAC?"meta":"ctrl",option:"alt",command:"meta"};return t.extend({initialize:function(e){(e=e||{}).el&&(i.bindAll(this,"_onKeyDown"),this.el=e.el,this._beforeMatch=e.beforeMatch,this._afterMatch=e.afterMatch,this._hasBindEvents=!1)},_bindEvents:function(){this._hasBindEvents||(o(this.el).on("keydown",this._onKeyDown),this._hasBindEvents=!0)},_unbindEvents:function(){this._hasBindEvents&&(o(this.el).off("keydown",this._onKeyDown),this._hasBindEvents=!1)},_prepareForBindKey:function(){this._hasBindEvents||this._bindEvents(),this._keyMap||(this._keyMap={}),this._matchCache||(this._matchCache={})},_formatKey:function(e){e=(e=(e=o.trim(e)).toLowerCase()).replace(/\s+/g,""),i.each(c,function(t,n){e=e.replace(n+"+",t+"+")});var t={},n=e.split(/\+/),r=i.last(n),s=[];return r=l[r]||r,t.key=r,i.each(a,function(n){e.indexOf(n)>-1&&(t[n]=!0,s.push(n))}),s.push(r),t.mark=s.join("-"),t},isEventMatchKey:function(e,t){var n=this._extractEventInfo(e),o=this._formatKey(t);return this._isMatch(n,o)},_extractEventInfo:function(e){var t={},n=[];return i.each(a,function(o){e[o+"Key"]&&(t[o]=!0,n.push(o))}),n.push(e.keyCode),t.keyCode=e.keyCode,t.mark=n.join("-"),t},_isMatch:function(e,t){return!(!t||!event)&&(i.every(a,function(n){return t[n]===e[n]})&&s.isMatch(t.key,e.keyCode))},_onKeyDown:function(e){var t,n,o=this,r=o._keyMap,s=o._extractEventInfo(e),a=s.mark,l=o._matchCache,c=l[a];o._beforeMatch&&o._beforeMatch(e),c||(c=l[a]={eventInfo:s},t={},n=!1,i.each(r,function(e,i){o._isMatch(s,e.keyInfo)&&(t[i]=e,n=!0)}),n&&(c.handlers=t)),i.each(c.handlers,function(t){t.callback.apply(null,[e])}),o._afterMatch&&o._afterMatch(e,n)},bind:function(e,t){var n,o,r=this,s=r._formatKey(e);s&&(r._prepareForBindKey(),o=r._keyMap["key-"+e]={keyInfo:s,callback:t},n=r._matchCache,i.each(n,function(e){if(e&&e.eventInfo){var t,n=e.handlers;n?t=!0:(n={},t=!1),r._isMatch(e.eventInfo,s)&&(n[s.mark]=o,t=!0),t&&(e.handlers=n)}}))},unbind:function(e){var t=this._keyMap,n=this._matchCache,o="key-"+e;t&&t[o]&&delete t[o],i.each(n,function(e){var t=e.handlers;t&&t[o]&&delete t[o]})},unbindAll:function(){this._unbindEvents(),this._keyMap={},this._matchCache={}},clearCache:function(){this._matchCache={}}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";var n=function(e,t,n,o,i){void 0===n&&(n="black"),void 0===o&&(o="white"),t&&1===t.length&&(t=t[0])};return{log:n,breakPointsLog:function(e,t){var o={fontColor:"white",backColor:"grey"};switch(e){case"execCommand":o.backColor="#3399FF";break;case"execEditorApi":o.backColor="#663399"}n(0,t,o.fontColor,o.backColor)},warn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];1===e.length&&(e=e[0]),n(0,e,"#333333","#FFFF33")},error:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];1===e.length&&(e=e[0]),n(0,e,"red","#FFCCCC")}}}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(139),o=n(260),i=n(263),r=n(265),s=n(1);return{parseHtml:function(e){var n=t(e);return s.log("parseHtml OK",n),n},parsePlain:function(e,t,n,i){return o(e,t,n,i)},parseJSON:function(e,t){return i(e,t)},parseOCR:function(e,t){return r(e,t)}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(46),o=n(6),i=n(0),r=n(224),s=["bold","bolder","700","800","900"],a=n(28),l={"xx-small":12,"x-small":12,small:13,medium:16,large:18,"x-large":24,"xx-large":32};return{bold:{inheritable:!0,action:function(e){var n=e.style.fontWeight;return(n=n&&t.trim(n).toLowerCase())&&"inherit"!==n?-1!==i.indexOf(s,n):null}},italic:{inheritable:!0,action:function(e){var t=e.style.fontStyle;return t?"italic"===t:null}},underline:{inheritable:!0,action:function(e,t,n){var o=e.style.textDecoration;return!!/(^|\s)underline($|\s)/i.test(o)||!(o&&!n)&&n}},strike:{inheritable:!0,action:function(e,t,n){var o=e.style.textDecoration;return!!/(^|\s)line-through($|\s)/i.test(o)||!(o&&!n)&&n}},"font-family":{inheritable:!0,action:function(e){var t=e.style.fontFamily;return 0===t.trim().indexOf("-apple-system")?a.DEFAULT_FONT:a.getFontFirstValue(t)}},"font-size":{inheritable:!0,action:function(e,n,o){var i=e.style.fontSize;if(i=t.trim(i+""),/^[\d.]+px$/.test(i)?i=parseInt(i,10):/^[\d.]+pt$/.test(i)?i=Math.floor(4*parseFloat(i,10)/3):/^[\d.]+em$/.test(i)?(i=parseFloat(i,10),i*=o||14,i=Math.floor(i)):/^[\d.]+rem$/.test(i)?(i=parseFloat(i,10),i*=10,i=Math.floor(i)):i=l[i],i&&!isNaN(i))return i}},color:{inheritable:!0,action:function(e){var t=e.style.color;return r(t,!1)}},"back-color":{inheritable:!0,action:function(e){var t=e.style.backgroundColor;return r(t,!0)}},align:{inheritable:!0,action:function(e){var n=e.style.textAlign||e.align;if((n=n&&t.trim(n).toLowerCase())&&"inherit"!==n)return n}},"line-height":{inheritable:!0,requireValues:["font-size"],action:function(e,n){var o=t.trim(e.style.lineHeight+""),i=n["font-size"]||14;if(/^[\d.]+$/.test(o)?o=parseFloat(o,10):/^[\d.]+px$/.test(o)?(o=parseFloat(o,10),o/=i):o=0,o&&!isNaN(o)&&o>1)return o}},indent:{inheritable:!0,action:function(e,t,n){var o=0;return"BLOCKQUOTE"===e.tagName&&(o=1),o+=n||0}},"text-indent":{inheritable:!0,action:function(e){var n=e.style.textIndent;if(n=t.trim(n+""),n=/^[\d.]+px$/.test(n)?parseFloat(n,10):/^[\d.]+pt$/.test(n)?4*parseFloat(n,10)/3:null)return(n=Math.floor(n/o.INDENT_WIDTH))||1}},width:{inheritable:!1,action:function(e){var n=e.style.width||e.width;if(n=t.trim(n+""),/^[\d.]+(px)?$/.test(n)&&(n=parseInt(n,10)),n&&!isNaN(n))return n}},float:{inheritable:!1,action:function(e){return e.style.float}},"white-space":{inheritable:!0,action:function(e){var t=e.style.whiteSpace;if(t&&"inherit"!==t)return t}}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0)],void 0===(i=function(e,t,n){"use strict";var o,i;return function(e){e[e.major=1]="major",e[e.minor=0]="minor",e[e.revision=3]="revision"}(o||(o={})),function(e){e[e.GRETER=1]="GRETER",e[e.EQUAL=0]="EQUAL",e[e.LESS=-1]="LESS"}(i||(i={})),function(){function e(){}return e.getDefaultAsString=function(){return o.major+"."+o.minor+"."+o.revision},e.parse=function(t){if(t){var n=(t+"").split(".");return{major:e.getAsInt(n[0]),minor:e.getAsInt(n[1]),revision:e.getAsInt(n[2])}}},e.isLessThanDefault=function(t){if(!t)return!0;var n=e.parse(t);return e.compare(n,o)===i.LESS},e.isCompatible=function(t){if(!(t=t||"")||"true"===t)return!0;var n=e.parse(t);return e.compare(o,n)!==i.LESS},e.getAsInt=function(e){e=e||"";var t=parseInt(e+"",10);return isNaN(t)?0:t},e.compareInt=function(e,t){return e===t?i.EQUAL:e>t?i.GRETER:i.LESS},e.compare=function(t,o){var r=i.EQUAL;return n.some(["major","minor","revision"],function(n){var s=e.compareInt(t[n]||0,o[n]||0);if(s!==i.EQUAL)return r=s,!0}),r},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t,o,i,r,s=n(0),a={};for(r in o=[(t={default:{name:"普通文本","font-size":14},a:{name:"标题","font-size":32,bold:!0},b:{name:"副标题","font-size":18,color:"#595959",bold:!0},1:{name:"标题1","font-size":28,bold:!0},2:{name:"标题2","font-size":20,bold:!0},3:{name:"标题3","font-size":16,bold:!0},4:{name:"标题4","font-size":14,bold:!0}}).default,t.a,t.b,t[1],t[2],t[3],t[4]],i={},t)"default"!==r&&(a[r]=s.clone(t[r]),delete a[r].name,delete a[r].align);return{headingMap:t,headingArray:o,headingBlockStyles:i,headingInlineStyles:a}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return{getNamespace:function(){return"note.youdao.com"}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(143)],void 0===(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.checkValid=function(e){var t,i,r=e.length;if(!n.isString(e))return!1;for(t=0;t<r;t++)if(!(9===(i=o(e,t))||10===i||13===i||i>=32&&i<=55295||i>=57344&&i<=65533)){if(!(i>=65536&&i<=1114111))return!1;t++}return!0},e.clear=function(e){var t,i,r="",s=e.length;if(!n.isString(e))return e;for(t=0;t<s;t++)9===(i=o(e,t))||10===i||13===i||i>=32&&i<=55295||i>=57344&&i<=65533?r+=e[t]:i>=65536&&i<=1114111&&(r+=e[t],r+=e[++t]);return r},e}()}.apply(t,o))||(e.exports=i)},,,,function(e,t,n){var o;void 0===(o=function(){return{parseImgSource:function(e){var t=e.split("?")[0].replace(/^\//,"").split("/");return{resId:t[t.length-1]}}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(1),n(0),n(142),n(21)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(){function e(){}return e.convertToCssStyle=function(e,t){if(e){var n=o.pick(e,this.SUPPORTED_STYLES);return n=o.defaults(n,r.getAllDefault()),t&&o.each(n,function(e,o){null!=e&&(n[o]=t.valueToView(o,e))}),i.convertToCssStyle(n)}},e.isSupportedStyle=function(t){return e.SUPPORTED_STYLES.indexOf(t)>-1},e.makeHtmlMarker=function(t){if(t){var o,i,r=t.getLevel(),s=t.getText();return o=t.isOrdered()?e.ORDERED_STYLE_TYPES[r%3]:e.UNORDERED_STYLE_TYPES[r%3],s.getLength()&&(i=this.convertToCssStyle(s.getStylesAtIndex(0))),{listStyleType:o,markerStyles:i}}n.warn("Failed to create marker",t)},e.makePlainMarker=function(t,o){if(!t)return n.warn("Failed to create marker",t),"";o=!1!==o;var i,r="",s=t.getLevel();if(t.isOrdered()){switch(i=t.getIndex(),s%3){case 0:r=e.toRoman(i);break;case 2:r=e.toAlphabet(i);break;default:case 1:r=i}r+="."}else switch(s%3){case 0:r="■";break;case 2:r="○";break;default:case 1:r="●"}return o&&(r+=" "),r},e.toAlphabet=function(e){if(isNaN(e))return"";var t="a".charCodeAt(0),n="z".charCodeAt(0)-t+1,o="";for(e--;e>=0;)o=String.fromCharCode(e%n+t)+o,e=Math.floor(e/n)-1;return o},e.toRoman=function(e){if(isNaN(e))return"";for(var t=[["","i","ii","iii","iv","v","vi","vii","viii","ix"],["","x","xx","xxx","xl","l","lx","lxx","lxxx","xcc"],["","c","cc","ccc","cd","d","dc","dcc","dcc","cm"]],n="",o=0,i=0,r=1e3;i<3;i++,r/=10)o=Math.floor(e%r/(r/10)),n+=t[2-i][o];return n},e.SUPPORTED_STYLES=["font-size","font-family","color","bold","italic"],e.ORDERED_STYLE_TYPES=["lower-roman","decimal","lower-alpha"],e.UNORDERED_STYLE_TYPES=["square","disc","circle"],e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";return function(){return{value:""}}}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){var e={color:"#999999",bold:300,"font-family":"宋体","font-size":"14"};return{getQuoteDefaultStyles:function(){return e},getQuoteSize:function(){return e["font-size"]},getQuoteColor:function(){return e.color}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(6);return{parseToBoolean:function(e,n){var o=null;return t.isBoolean(e)?o=e:t.isNumber(e)?0===e?o=!1:1===e&&(o=!0):t.isString(e)&&("0"===e.toLowerCase()||"false"===e.toLowerCase()?o=!1:"1"!==e.toLowerCase()&&"true"!==e.toLowerCase()||(o=!0)),null===o&&t.isBoolean(n)&&(o=n),o},parseToNumber:function(e,n){var o=null;return t.isNumber(e)?o=e:t.isString(e)&&(o=window.parseInt(e)),(isNaN(o)||null===o)&&t.isNumber(n)&&(o=n),o},parseToPageType:function(e){var t=o.PAGE_TYPE_NONE;return e&&(e.trim().toUpperCase()===o.PAGE_TYPE_B5?t=o.PAGE_TYPE_B5:e.trim().toUpperCase()===o.PAGE_TYPE_A4?t=o.PAGE_TYPE_A4:e.trim().toUpperCase()===o.PAGE_TYPE_TEST&&(t=o.PAGE_TYPE_TEST)),t}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(42),n(2),n(8)],void 0===(i=function(e,t,n,o,i){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromXml=function(e){throw new Error("HandWrite do NOT support fromXml till now")},t.prototype.canDrawedByNative=function(){return!1},t.prototype.clone=function(){return new t({block:this._rangeProps.block})},t.prototype.collapse=function(){},t.prototype.getDataAsJSON=function(){var e=this._rangeProps.block.toJSON();return(i.IS_WEB_NOTE||i.IS_WEB_GROUP)&&e.resource&&!/^http/i.test(e.resource)&&(e.resource=location.protocol+"//"+location.hostname+e.resource),e},t.prototype.getDataAsHtml=function(e){return this._rangeProps.block.toHtml(null,null,e)},t.prototype.getDataAsPlain=function(){return this._rangeProps.block.toPlain()},t.prototype.isCollapsed=function(){return!1},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=o.HANDWRITE,this._rangeProps={block:t.block}},t}(n)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(2),n(42)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.clone=function(){return new t({block:this.block})},t.prototype.collapse=function(){},t.prototype.isCollapsed=function(){return!1},t.prototype.getDataAsHtml=function(){return this.block.toHtml()},t.prototype.getDataAsJSON=function(){return this.block.toJSON()},t.prototype.getDataAsPlain=function(){return this.block.toPlain()},t.prototype.canDrawedByNative=function(){return!0},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.HR},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(){return{contains:function(e,t){if(!e||!t)return!1;var n=e.left+e.width,o=e.top+e.height,i=t.left+t.width,r=t.top+t.height;return e.left<=t.left&&e.top<=t.top&&n>=i&&o>=r},union:function(e,t){if(e&&t){var n=Math.min(e.left,t.left),o=Math.min(e.top,t.top);return e={left:n,top:o,width:Math.max(e.left+e.width,t.left+t.width)-n,height:Math.max(e.top+e.height,t.top+t.height)-o}}}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(2),n(42)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.canDrawedByNative=function(){return!1},t.prototype.clone=function(){return new t({block:this.block})},t.prototype.collapse=function(){},t.prototype.getDataAsHtml=function(){return this.block.toHtml()},t.prototype.getDataAsJSON=function(){return this.block.toJSON()},t.prototype.getDataAsPlain=function(){return this.block.toPlain()},t.prototype.isCollapsed=function(){return!1},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.UNKNOWN},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.isCmdVersionMatchNoteVersion=function(e,t){return e-t==1},e.isMessageTooLarge=function(e){return e>5e3},e.newGUID=function(){var e="";return e+=Math.floor(10*Math.random()).toString().substr(0,1),e+=Math.floor(10*Math.random()).toString().substr(0,1),e+="-",e+=Date.now().toString()},e}();t.Utils=n}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(0),s=n(3);return t=o.extend({name:"atom.SetInlineStyle",_selectedBlocks:null,_start:null,_end:null,_isFullText:!1,_oldStyleNameValues:{},_styleNameValues:null,initialize:function(){var e=this.options.args;this._oldStyleNameValues={},s.isCollabCommand(e)||(this._selectedBlocks=this.options.blocks,this._styleNameValues=this.options.styleNameValues,this._start=this.options.start,this._end=this.options.end,this._isFullText=this.options.fullText),t.__super__.initialize.apply(this)},apply:function(){var e=this;r.each(e._styleNameValues,function(t,n){e._setStyleToSelectedBlocks(n,t)})},doUnapply:function(){var e,t=this;r.each(t._selectedBlocks,function(n){e=t._oldStyleNameValues[n.getId()],t._isFullText&&(t._start=n.getStartOffset(),t._end=n.getEndOffset()),r.each(e,function(e,o){n.setTextStyle(o,e,t._start,t._end)})})},fromCollabJSON:function(){var e,n=this,o=n.options.args.collabProperties,i=o.cmdJSON;t.__super__.fromCollabJSON.apply(n),e=o.coreEditor.getNote(),i&&(n._selectedBlocks=[],r.each(i.blockIds,function(t){n._selectedBlocks.push(e.getBlockById(t))}),n._styleNameValues=i.styleNameValues,n._oldStyleNameValues=i.oldStyleNameValues,n._start=i.startPosition,n._end=i.endPosition,n._isFullText=i.simpleValue1)},toCollabJSON:function(){var e=[],n=t.__super__.toCollabJSON.apply(this);return this._selectedBlockIds=[],r.each(this._selectedBlocks,function(t){e.push(t.getId())}),n.blockIds=e,n.styleNameValues=this._styleNameValues,n.oldStyleNameValues=this._oldStyleNameValues,n.startPosition=this._start,n.endPosition=this._end,this._isFullText&&(n.simpleValue1=!0),n},_setStyleToSelectedBlocks:function(e,t){var n,o,i=this,s={};s[e]=t,r.each(i._selectedBlocks,function(r){o=r.getId(),i._isFullText&&(i._start=r.getStartOffset(),i._end=r.getEndOffset()),n=r.getTextStyle(e,i._start,i._end),i._oldStyleNameValues[o]||(i._oldStyleNameValues[o]={}),i._oldStyleNameValues[o][e]=n,s=r.getInlineStylesForEmpty(),r.isEmpty()&&r.setInlineStylesForEmpty(i.getInlineStates(s,e,t)),r.setTextStyle(e,t,i._start,i._end)})},getInlineStates:function(e,t,n){if(e)return e[t]=n,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(0),s=n(3);return t=o.extend({name:"atom.SetBlockStyle",_selectedBlocks:null,_oldStyleNameValues:{},_styleNameValues:null,initialize:function(e){var n=this.options.args;this._oldStyleNameValues={},s.isCollabCommand(n)||(this._selectedBlocks=e.blocks,this._styleNameValues=this.options.styleNameValues),t.__super__.initialize.apply(this,arguments)},apply:function(){var e=this;r.each(e._styleNameValues,function(t,n){e._setStyleToSelectedBlocks(n,t)})},doUnapply:function(){var e,t=this;r.each(t._selectedBlocks,function(n){e=t._oldStyleNameValues[n.getId()],r.each(e,function(e,t){n.setBlockStyle(t,e)})})},fromCollabJSON:function(){var e=this,n=e.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(e),e._note=n.coreEditor.getNote(),o&&(e._selectedBlocks=[],r.each(o.blockIds,function(t){e._selectedBlocks.push(e._note.getBlockById(t))}),e._styleNameValues=o.styleNameValues,e._oldStyleNameValues=o.oldStyleNameValues)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this),n=[];return r.each(this._selectedBlocks,function(e){n.push(e.getId())}),e.blockIds=n,e.styleNameValues=this._styleNameValues,e.oldStyleNameValues=this._oldStyleNameValues,e},_setStyleToSelectedBlocks:function(e,t){var n,o,i=this;r.each(i._selectedBlocks,function(r){o=r.getId(),n=r.getBlockStyle(e),i._oldStyleNameValues[o]||(i._oldStyleNameValues[o]={}),i._oldStyleNameValues[o][e]=n,r.setBlockStyle(e,t)})}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(3),s={POINT:"point",CELL:"cell"};return t=o.extend({name:"atom.SetTableCellAttr",_table:null,_rect:null,_type:null,_value:null,_oldValue:null,effected:!1,initialize:function(){var e=this.options.args;r.isCollabCommand(e)||(this._table=this.options.table,this._rect=this.options.rect,this._type=this.options.type,this._value=this.options.value),t.__super__.initialize.apply(this)},apply:function(){var e=this._type,t=this._table,n=this._rect,o=this._value;if(o)return e===s.POINT?(this._oldValue=this._getOldAttr(n.row,n.col),t.setMergePointAttrAt(n.row,n.col,o.width,o.height),void(this.effected=!0)):e===s.CELL?(this._oldValue=this._getOldAttr(n.row,n.col),t.setMergedCellAttrAt(n.row,n.col,o.dx,o.dy),void(this.effected=!0)):void 0;(t.isMergePoint(n.row,n.col)||t.isMergedCell(n.row,n.col))&&(this._oldValue=this._getOldAttr(n.row,n.col),t.clearCellAttr(n.row,n.col),this.effected=!0)},_getOldAttr:function(e,t){var n=this._table;return n.isMergedCell(e,t)?n.getMergedCellAttrAt(e,t):n.isMergePoint(e,t)?n.getMergePointAttrAt(e,t):null},doUnapply:function(){var e=this._table,t=this._rect,n=this._oldValue;n?((n.width||n.height)&&e.setMergePointAttrAt(t.row,t.col,n.width,n.height),(n.dx||n.dy)&&e.setMergedCellAttrAt(t.row,t.col,n.dx,n.dy)):e.clearCellAttr(t.row,t.col)},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._value=o.styleNameValues,this._oldValue=o.oldStyleNameValues,this._rect=o.simpleValue1,this._type=o.simpleValue2)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.styleNameValues=this._value,e.oldStyleNameValues=this._oldValue,e.simpleValue1=this._rect,e.simpleValue2=this._type,e}},{TYPES:s}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return{keyBackspace:{currentLineIsEmpty:{backToLineStart:!1,backToPreLineEnd:!0}},keyEnter:{whenEndCharIs:{",":0,")":0,"}":0,";":0,":":4,"(":4,"{":4,default:0}},keyTab:{addSpacesNum:4}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(115),o=new RegExp("^http[s]{0,1}://"+t.getNamespace()),i="//"+t.getNamespace(),r=!1;return{setUseConvert:function(e){r=!!e},isInnerResoures:function(e){return o.test(e)},getURL:function(e){return r&&this.isInnerResoures(e)?e.replace(o,i):e}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(){}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(33).extend({editorEvents:{"yne-selection-change":"onSelectionChange"},onSelectionChange:function(){this.setState(this.querySelectionState())},querySelectionState:function(){return this.editor.querySelectionInlineStyle(this.name)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(7),o=n(97),i=n(32),r=n(41);return{_container:null,getUrlInfoBeforeRange:function(e,t){var n,o,s=e.commonAncestorContainer,a={textNodeArray:[],endIndex:-1};if(i.isRangeInNode(t,e))return this._container=t,this._isInLinkElement(s)?o={alreadyUrl:!0}:(r.isElement(s)?(n=this._findLastTextNode(s))&&(a.endIndex=n.length):a.endIndex=e.endOffset,o=this._iteratorOfTextNodeBefore(a,s),this._container=null,o)},_iteratorOfTextNodeBefore:function(e,t){var n;if(r.isText(t))n=t;else{if(!r.isElement(t))return;n=this._findLastTextNode(t)}if(n)return e.textNodeArray.unshift(n),this._parseTextNodeObject(e)||this._iteratorOfTextNodeBefore(e,this._findPreviousNode(n))},_findPreviousNode:function(e){var t=e.previousSibling;return t?this._isUnvalidElement(t)?null:t:(e=e.parentNode)?this._findPreviousNode(e):null},_findLastTextNode:function(e){var t,n,o;if(e){if(r.isText(e))return e;if(0===(o=e.childNodes.length))return e=this._findPreviousNode(e),this._findLastTextNode(e);for(n=o-1;n>=0;n--)return t=e.childNodes[n],this._findLastTextNode(t)}return null},_parseTextNodeObject:function(e){var t,n,i,r,s,a="",l=e.textNodeArray[0].nodeValue,c=0,u="",d=e.endIndex,h=e.textNodeArray,p=e.textNodeArray.length;for(r=0;r<p-1;r++)u+=h[r].nodeValue;if(u+=h[p-1].nodeValue.slice(0,d),(t=o.matchEnd(u))&&t.result){for(i=t.result.index,s=0;s<p-1;s++){if(i-=a.length,a.length<=i&&l.length>i){c=s;break}a+=h[s].nodeValue,l+=h[s+1].nodeValue}n={uri:t.fullURI,startNode:h[c],startOffset:i,endNode:h[p-1],endOffset:d}}return n},_isUnvalidElement:function(e){var n,o;return!r.isText(e)&&(!r.isElement(e)||!t.contains(this._container,e)||(n=e.currentStyle||window.getComputedStyle(e,""),o="A"===e.nodeName,"block"===n.display||o))},_isInLinkElement:function(e){if(t.contains(this._container,e)){for(;e&&e!==this._container;){if("A"===e.nodeName)return!0;e=e.parentNode}return!1}}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(46),n(3),n(27),n(17),n(1),n(111),n(6),n(116),n(266),n(113),n(24),n(267),n(2),n(64),n(157),n(34),n(35),n(19),n(10),n(21),n(156),n(115)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h,p,g,f,m,_,y,b,v,k,C,I,S,w){"use strict";return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.entityCache={},t}return s(t,e),t.createBlank=function(e,n){var o=k.createBlank(e);return n||(n=new t({})),n.append(o),n},t.fromHtml=function(e,o,i,r){var s,a=c.parseHtml(e);return o||(o=new t({})),s=(r=n.defaults(r||{},{isAsync:!1,progressCallBack:function(){}})).progressCallBack,t._parseHTMLInBatch(a,0,o,i,s,r.isAsync)?o:null},t.fromOCR=function(e,o,i){var r=c.parseOCR(e,i),s=0;return o=o||new t({}),n.each(r,function(e){e&&(o.append(e),s++)}),s?o:null},t.fromXml=function(e,o,i,r){var s,a,c,h,g,f,m={},v={};return o||(o=new t({})),f=(r=n.defaults(r||{},{isAsync:!1,progressCallBack:function(){}})).progressCallBack,n.isString(e)?(e=d.clear(e),s=$.parseXML(e)):s=e,f({percent:.1}),o.setContentStatus(!0),l.log(s),(c=(a=$(s).find("note:first")).attr("schema-version"))&&o.setSchemaVersion(c),h=parseInt(a.attr("file-version"),10),isNaN(h)&&(h=0),o.setFileVersion(h),a&&a.get(0)?(a.find("head").children().each(function(e,t){var n;switch(t.nodeName){case"list":n=b.fromXml(t),m[$(t).attr("id")]=n;break;case"catalogue-wrap":n=_.fromXml(t),v[$(t).attr("id")]=n;break;case"header":n=y.fromXml(t),o.setHeaderFooter(n,!1,!0);break;case"footer":n=y.fromXml(t),o.setHeaderFooter(n,!0,!0);break;default:n=$(t).attr(u.COMPAT),p.isCompatible(n)&&(n=t.cloneNode(!0),o.headUnknownNodeList.push(n))}}),f({percent:.15}),g=a.find("body").children(),t._parseXMLBodyInBatch(g,0,o,m,v,i,f,r.isAsync),o):(o.isBlank()&&o.append(k.createBlank()),f({percent:1}),o.setContentStatus(!1),o.updateContentParseTimer(null),o)},t.unescape=function(e){var t=document.createElement("span");return t.innerHTML=e,t.textContent},t._parseHTMLInBatch=function(e,o,i,r,s,a){var l,c,u,d=Date.now(),h=!1,p=i.getExtraInfo("pcTodoMap");if(null==e&&0===e.length)return s({percent:1}),i.updateContentParseTimer(null),!1;for(;o<e.length;)if(l=e[o],m.isImage(l)&&r&&r.length>0&&n.each(r,function(e){e.resId!==l.getResId()||l.setImageInfo(e)}),m.isTodo(l)&&l.isFromOldTodo()&&((u=l.getLegacyResId())&&p&&p[u]?(l.setText(t.unescape(JSON.parse(p[u]).content)),l.setChecked(JSON.parse(JSON.parse(p[u]).checked))):l=null),l&&(i.append(l),h=!0),++o>=e.length?(s({percent:1}),i.updateContentParseTimer(null)):s({percent:.15+o/e.length*.85}),a&&Date.now()-d>100){c=setTimeout(t._parseHTMLInBatch.bind(null,e,o,i,r,s,a),10),i.updateContentParseTimer(c);break}return h},t._parseXMLBodyInBatch=function(e,o,r,s,a,l,c,d){var h,_,y,b,v,k,C,I,w=Date.now();if(null==e||0===e.length)return c({percent:1}),r.updateContentParseTimer(null),void r.setContentStatus(!1);for(;o<e.length;){if(_=(h=e[o]).nodeName,y=f[_],b=$(h).attr(u.COMPAT),(!y&&p.isCompatible(b)||y&&b&&!p.isCompatible(b))&&(y=S),y&&y.fromXml){if(!(v=y.fromXml(h)))throw r.updateContentParseTimer(null),new Error("Failed to parse block from xml node!");for(k=g.parseResourceList(h),v.setResourceIds(k),m.isListItem(v)&&v.setOwnerList(s[$(h).attr("list-id")]),m.isImage(v)&&l&&l.length>0&&n.each(l,function(e){e.resId!==v.getResId()||v.setImageInfo(e)}),m.isCatalogue(v)&&v.setOwnerList(a[$(h).attr("catalogue-id")]),r.append(v),v.isValidForCollab()||r.setValidForCollab(!1),I=v.getId();r.originalBlockIds.indexOf(I)>-1;)I=i.newGUID();I!==v.getId()&&(r.setValidForCollab(!1),v.setId(I)),r.originalBlockIds.push(I)}if(++o>=e.length)c({percent:1}),r.setContentStatus(!1),r.updateContentParseTimer(null);else if(c({percent:.15+o/e.length*.85}),d&&Date.now()-w>100){C=setTimeout(t._parseXMLBodyInBatch.bind(null,e,o,r,s,a,l,c,d),10),r.updateContentParseTimer(C);break}}},t.prototype.append=function(e){this.insert(this.blocks.length,e)},t.prototype.clearHighlight=function(){this.trigger("clear-high-light")},t.prototype.countWords=function(e,t){var n,o,i=function(e){return!m.isHr(e)};return e&&(n=!0,o=this._parseWordCountInfo(e.getDataAsPlain(this,i))),(!e||!o.all&&t)&&(n=!1,o=this._parseWordCountInfo(this.toPlain(i))),{count:o.all,detail:o,isSelected:n}},t.prototype.findAttachmentByResource=function(e,t){return n.filter(this.blocks,function(n){return m.isAttachment(n)&&n.getResource(t)===e})},t.prototype.getAllBlocks=function(){return this.blocks},t.prototype.getAllResouceIds=function(){var e=[];return n.each(this.blocks,function(t){var n=t.getResourceIds();n&&n.length&&(e=e.concat(n))}),e=n.uniq(e)},t.prototype.getAllResourceInfo=function(e,t){var o,i,r,s,a=[];return e=e||this.blocks,t=t||[m.IMAGE,m.ATTACHMENT,m.HANDWRITE,m.TABLE],n.each(this.blocks,function(e){m.isAttachment(e)&&t.indexOf(m.ATTACHMENT)>-1||m.isHandWrite(e)&&t.indexOf(m.HANDWRITE)>-1?(o=e.getSource(!1),i=e.getSource(!0),r=e.getResource(!1),s=e.getResource(!0),o&&i&&r&&s&&a.push({extraResource:s,extraSource:i,resource:r,source:o})):m.isImage(e)&&t.indexOf(m.IMAGE)>-1?(o=e.getSource(!1),i=e.getSource(!0),o&&i&&a.push({blockId:e.getId(),extraSource:i,source:o})):m.isTable(e)&&(a=a.concat(e.getAllResourceInfo()))}),a},t.prototype.getAttachmentByResource=function(e,t){return n.filter(this.blocks,function(n){return m.isAttachment(n)&&n.getResource(t)===e})},t.prototype.getBlockAt=function(e){return this.blocks[e]},t.prototype.getBlockById=function(e){return this.header&&e===this.header.getId()?this.header:this.footer&&e===this.footer.getId()?this.footer:n.find(this.blocks,function(t){return e===t.getId()})},t.prototype.getBlockIndex=function(e){return n.indexOf(this.blocks,e)},t.prototype.getBlockIndexById=function(e){var t,n=-1;return(t=this.getBlockById(e))&&(n=this.getBlockIndex(t)),n},t.prototype.getCommonInlineStyle=function(e,t){var o=this;if(e&&t){var i,r=e.getStartBlockRange(),s=e.getEndBlockRange(),a=r.block,l=s.block,c=null,d=[],h=!0;return this.isNonEmptyParaTable(a)&&(d.push(a.getCommonInlineStyle(t,r)),h=!1),a!==l&&(i=this.getInterBlocks(a,l),n.each(i,function(e){o.isNonEmptyParaTable(e)&&(d.push(e.getCommonInlineStyle(t)),h=!1)}),this.isNonEmptyParaTable(l)&&(d.push(l.getCommonInlineStyle(t,s)),h=!1)),h?(m.isTextBlock(a)&&(c=a.getInlineStyleForEmpty(t,!0)),c||I.getDefault(t)):(n.some(d,function(e){if(null===c)c=e;else if(null!=e&&c!==e)return c=u.INTERM,!0}),c)}},t.prototype.getExtraInfo=function(e){return e?(this.extraInfo||{})[e]:this.extraInfo},t.prototype.getHeaderFooter=function(e){return e?this.footer:this.header},t.prototype.getFileVersion=function(){return this.fileVersion},t.prototype.getEntityCache=function(e){var t=this.entityCache;return n.pick(t,e)},t.prototype.entityExistInCache=function(e){var t=this.getEntityCache(e);return n.keys(t).length===e.length},t.prototype.getImageBySource=function(e,t){return n.filter(this.blocks,function(n){return m.isImage(n)&&n.getSource(t)===e})},t.prototype.getInterBlocks=function(e,t,n){var o=this.blocks,i=this.getBlockIndex(e),r=this.getBlockIndex(t);return n?o.slice(i,r+1):o.slice(i+1,r)},t.prototype.getLastBlock=function(){return n.last(this.blocks)},t.prototype.getNextBlock=function(e){var t=this.getBlockIndex(e);if(t>=0)return this.getBlockAt(t+1)},t.prototype.getNoteId=function(){return this.noteId},t.prototype.getPreBlock=function(e){var t=this.getBlockIndex(e);if(t>0)return this.getBlockAt(t-1)},t.prototype.getRangeBlockStyle=function(e,t){if(e&&t){var o=e.getStartBlockRange(),i=e.getEndBlockRange(),r=o.block,s=i.block,a=this.getInterBlocks(r,s,!0),c=null;return e.isSingleTableSelected()?a[0]?a[0].getCommonBlockStyle(t,o):void l.warn("No table block find, need update noteRange"):(n.each(a,function(e){var n=e.getBlockStyle(t);c=null===c?n:c===n?c:u.INTERM}),c)}},t.prototype.getSchemaVersion=function(){return this.schemaVersion||p.getDefaultAsString()},t.prototype.hasHandWriteBlock=function(){var e=!1;return n.some(this.blocks,function(t){return m.isHandWrite(t)&&(e=!0),e}),e},t.prototype.highlight=function(e,t){var o,i,r=[];t=n.defaults(t||{},{ignoreCase:!1}),e&&e.length&&(o=[],n.each(e,function(e){if(e&&!/\s/.test(e)){var t=new C({text:e});o.push(t)}}),o=o.length?o:null),i=this.blocks.slice(),this.header&&i.unshift(this.header),this.footer&&i.push(this.footer),n.each(i,function(e){(null!=o||null!=t.images&&t.images.length>0&&(m.isImage(e)||m.isTable(e)))&&e.highlight(o,t,function(e){r.push(e)})}),this.trigger("high-light",r),n.isFunction(t.callback)&&t.callback(r.length)},t.prototype.insert=function(e,t){if(!t)throw new Error("cannot insert null block");this.blocks.splice(e,0,t),this._bindEventsForBlock(t),t.trigger("attached",this),this.trigger("insert-block",e,t)},t.prototype.isBlank=function(){return!this.blocks||0===this.blocks.length},t.prototype.isEmptyContent=function(){var e,t=this.blocks;return!!(t&&1===t.length&&(e=t[0])&&e.isEmptyContent)&&e.isEmptyContent()},t.prototype.isParsingData=function(){return null!=this.contentParseTimer},t.prototype.isReadOnly=function(){return this.readOnly},t.prototype.isSameNote=function(e){return e===this.noteId},t.prototype.isDragProhibited=function(){return this.dragProhibited},t.prototype.isCopyProhibited=function(){return this.copyProhibited},t.prototype.isSameList=function(e,t){var n,o,i,r,s,a,c,u,d,h;if(!e)return l.error("isSameList:noteRange should not be null"),!1;for(n=e.getStartBlockRange(),o=e.getEndBlockRange(),i=n.block,r=o.block,h=(s=this.getInterBlocks(i,r,!0)).length,a=0;a<h;a++)if((c=s[a])instanceof k){if(!(c instanceof v))return!1;if((u=c.getOwnerList()).getType()!==t)return!1;if(d){if(d!==c.getOwnerList())return!1}else d=u}return!!d},t.prototype.isValidForCollab=function(){return this.validForCollab},t.prototype.lastBlockIsEasyInput=function(){var e=this.getLastBlock();return m.isTextBlock(e)},t.prototype.lockBlock=function(e,t){this._setBlockLocked(e,!0,t)},t.prototype.nextHighlight=function(){this.trigger("next-high-light")},t.prototype.preHighlight=function(){this.trigger("pre-high-light")},t.prototype.remove=function(e,t){var n=this.blocks.splice(e,1)[0];n&&(n.trigger("detached",this),this._unbindEventsForBlock(n),this.trigger("remove-block",e,t))},t.prototype.removeBlock=function(e){this.remove(this.getBlockIndex(e))},t.prototype.removeBlockById=function(e,t){this.remove(this.getBlockIndexById(e),t)},t.prototype.replace=function(e,t){var n=this.blocks.splice(e,1,t)[0];return n?(n.trigger("detached",this),this._unbindEventsForBlock(n)):l.warn("oldBlock should not be null"),t&&(this._bindEventsForBlock(t),t.trigger("attached",this)),this.trigger("replace-block",e,t,n),n},t.prototype.reset=function(){this.destroy(),this.noteId=i.newGUID(),this.headUnknownNodeList=[],this.blocks=[],this.originalBlockIds=[],null!=this.contentParseTimer&&(clearTimeout(this.contentParseTimer),this.contentParseTimer=null),this.header=null,this.footer=null},t.prototype.setExtraInfo=function(e){this.extraInfo=e,this._triggerExtraInfoChange()},t.prototype.setEntityCache=function(e){this.entityCache=Object.assign(this.entityCache,e)},t.prototype.removeEntityCache=function(){this.entityCache={}},t.prototype.setEntity=function(e,t){var n;t&&(n=this.getBlockById(t))&&n instanceof k&&n.setEntity(e)},t.prototype.setExtraInfoWithKey=function(e,t,n,o){var i=this.extraInfo,r=i[e];i||(i={},o=!0),r||(i[e]=r={}),r[t]=n,!0===o?this.setExtraInfo(i):this.extraInfo=i},t.prototype.setFileVersion=function(e){this.fileVersion=e},t.prototype.setDragProhibited=function(e){e!==this.dragProhibited&&(this.dragProhibited=e)},t.prototype.setCopyProhibited=function(e){e!==this.copyProhibited&&(this.copyProhibited=e,this.trigger("copy-prohibited",e))},t.prototype.setHeaderFooter=function(e,t,n){t?this.footer=e:this.header=e,n&&this.trigger("header-footer-changed",t)},t.prototype.setReadOnly=function(e){(e=!!e)!==this.readOnly&&(this.readOnly=e,this.trigger("read-only-change",e),n.each(this.blocks,function(t){t.setReadOnly(e)}))},t.prototype.setContentStatus=function(e){this.contentStart=e},t.prototype.getContentStatus=function(){return this.contentStart},t.prototype.setSchemaVersion=function(e){p.isLessThanDefault(e)?l.warn("schema version is older than current, need upgrade!"):this.schemaVersion=e||p.getDefaultAsString()},t.prototype.setValidForCollab=function(e){this.validForCollab=e},t.prototype.toHtml=function(e,t){var n,o,i,r,s,a,l,c,u,d,h,p,g,f,_,y=this.blocks,b=y.length,v=[],k=[];for(t=!0===t,e?(a=e.getStartBlockRange(),l=e.getEndBlockRange(),c=a.block,u=l.block,d=this.getBlockIndex(c),h=this.getBlockIndex(u),_=e.isInSingleBlock()):(d=0,h=b-1),o=d;o<=h;o++)f=null,p=o===d,g=o===h,n=y[o],p&&a?(f=a,_||(f=f.clone()).expandToEnd()):g&&l&&(f=l,_||(f=f.clone()).expandToStart()),m.isListItem(n)||m.isCatalogue(n)?(s=n.getOwnerList(),r&&r!==s&&k.length&&(i=this._toHtmlWithSameOwnerList(k,t),v.push(i),k=[]),k.push({block:n,range:f||null}),r=s):(r=null,k.length&&(i=this._toHtmlWithSameOwnerList(k,t),v.push(i),k=[]),i=f?f.getDataAsHtml(t):n.toHtml(null,null,t),v.push(i));return k.length&&(i=this._toHtmlWithSameOwnerList(k,t),v.push(i)),v.join("")},t.prototype.toPlain=function(e){var t=e?n.filter(this.blocks,e):this.blocks;return n.map(t,function(e){return e.toPlain()}).join("\n")},t.prototype.toXml=function(){var e,t,i,r,s,a,c="http://"+w.getNamespace(),u=this._createXMLDocument(c,"note"),d=u.createElement("head"),h=u.createElement("body"),p={},g=this.getSchemaVersion(),f=this.getFileVersion(),m=u.documentElement,_=[];return m.appendChild(d),m.appendChild(h),g&&m.setAttribute("schema-version",g),m.setAttribute("file-version",f.toString()),n.each(this.blocks,function(e){var t,o,i,r,s,a;e&&e.toXml&&(t=e.toXml(u)),t?t.listItem?(o=t,h.appendChild(o.listItem),r=o.listId,p[r]||(p[r]=!0,i=u.createElement("list"),s=o.ownerList.unknownAttrs,n.each(s,function(e){var t=e.cloneNode(!0);i.setAttributeNode(t)}),i.setAttribute("id",r),i.setAttribute("type",o.listType),d.appendChild(i))):("catalogue"===t.tagName&&(a=t.getAttribute("catalogue-id"),-1===_.indexOf(a)&&_.push(a)),h.appendChild(t)):l.warn("block.toXml() failed!")}),n.each(this.headUnknownNodeList,function(e){if(e&&e.cloneNode){var t=e.cloneNode(!0);d.appendChild(t)}}),a=d.querySelectorAll("catalogue-wrap"),n.each(a,function(e){d.removeChild(e)}),n.each(_,function(e){e&&((s=u.createElement("catalogue-wrap")).setAttribute("id",e),s.setAttribute("compat","true"),d.appendChild(s))}),t=this.getHeaderFooter(!1),i=this.getHeaderFooter(!0),t&&(e=t.toXml(u))&&d.appendChild(e),i&&(e=i.toXml(u))&&d.appendChild(e),r=(new XMLSerializer).serializeToString(u),o.startsWith(r,"<?xml")||(r='<?xml version="1.0"?>\n'+r),r},t.prototype.unlockBlock=function(e){this._setBlockLocked(e,!1)},t.prototype.updateContentParseTimer=function(e){this.contentParseTimer!==e&&(clearTimeout(this.contentParseTimer),this.contentParseTimer=e),null==e&&this.trigger("content-parse-done")},t.prototype.initialize=function(){this.extraInfo={},this.noteId=i.newGUID(),this.blocks=[],this.originalBlockIds=[],this.headUnknownNodeList=[],this.schemaVersion=p.getDefaultAsString(),this.fileVersion=0},t.prototype.destroy=function(){var e=this;n.each(e.blocks,function(t){e._unbindEventsForBlock(t)}),e.blocks=null,e.readOnly=!1,e.validForCollab=!0},t.prototype.isNonEmptyParaTable=function(e){return e instanceof k&&!e.isEmpty()||m.isTable(e)&&!e.isEmptyContent()},t.prototype._bindEventsForBlock=function(e){var t;e&&(this._unbindEventsForBlock(e),t=this._listenerEventsForBlock(),r.addListeners(t,e,this),t=this._bubbleEventsForBlock(e),r.bubble(t,e,this))},t.prototype._bubbleEventsForBlock=function(e){var t={};return m.isTable(e)&&(t=n.extend(t,{"color-picker-show":!0,"get-block-view":!0,"yne-user-action-collection":!0})),t},t.prototype._listenerEventsForBlock=function(){return{"get-default-set-font":"_onGetDefaultSetFont","get-extra-info":"_onGetExtraInfo"}},t.prototype._onGetDefaultSetFont=function(e){this.trigger("get-default-set-font",function(t){e(t)})},t.prototype._onGetExtraInfo=function(e,t){t(this.getExtraInfo(e))},t.prototype._parseCataloguesToHtml=function(e){var t,n,o=document.createElement("div"),i=document.createElement("div"),r="";for(n=0;n<e.length;n++)r+=(t=e[n].block).toHtml();return o.innerHTML=r,i.setAttribute("yne-bulb-type","catalogue-wrap-container"),i.style.backgroundColor=t.getBlockStyle("back-color"),i.appendChild(o),i.outerHTML},t.prototype._parseWordCountInfo=function(e){var t=/[A-z0-9~!@#$%^&*()_+{}|:"<>?`\-=[\]\\;',.\/]+/g,n=e.match(t),o=e.match(/[\u4e00-\u9fa5\u3002\uff1b\uff0c\uff1a\u201c\u201d\uff08\uff09\u3001\uff1f\u300a\u300b]/g),i=e.replace(t,"").replace(/\s+/g,"").length,r=o?o.length:0,s=n?n.length:0,a=i-r;return{all:r+s+a,chinese:r,nonChinese:s+a}},t.prototype._parseListItemsToTree=function(e){var t,n,o,i,r,s,a,l,c,u=new h(0),d=e.length;for(r=u,t=0;t<d;t++){if(o=(n=e[t]).block,i=n.range||{},l=o.getLevel(),a=new h(l,o,i.start,i.end),(c=l-r.getLevel())>1)for(;l-r.getLevel()>1;)s=new h(r.getLevel()+1),r.addChildNodes([s]),r=s;else if(c<1)for(;l-r.getLevel()<1;)r=r.getParentNode();r.addChildNodes([a]),r=a}return u},t.prototype._setBlockLocked=function(e,t,o){var i,r=this;i=n.isArray(e)?e:[e],n.each(i,function(i){var s;(s=n.isString(i)?r.getBlockById(i):i)?s.setLocked(t,o):l.log("BlockLock: skip non-existing block",e)})},t.prototype._toHtmlWithSameOwnerList=function(e,t){var o,i,r=n.first(e).block;if(m.isListItem(r)){if(o=this._parseListItemsToTree(e)){i=o.toHtml(!0===t);var s=document.createElement("div");r&&r.getBlockStyle("back-color")&&(s.style.backgroundColor=r.getBlockStyle("back-color")),s.innerHTML=i,i=s.outerHTML}}else m.isCatalogue(r)&&(i=this._parseCataloguesToHtml(e));return i||""},t.prototype._triggerExtraInfoChange=function(){n.each(this.blocks,function(e){e.trigger("extra-info-change")})},t.prototype._unbindEventsForBlock=function(e){if(e){var t=function(t){t&&n.each(t,function(t,n){e.off(n)})};t(this._listenerEventsForBlock()),t(this._bubbleEventsForBlock(e))}},t.prototype._createXMLDocument=function(e,t){var n=document.implementation.createDocument(e,t,null);return n.createElement=function(e){return this.createElementNS(this.documentElement.namespaceURI,e)},n},t}(a)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(221),i=n(151),r=n(259);return function(e,n){return t||(t=new o(i)).define(".MsoListParagraph",r,o.PRIORITY.HIGH),t.parse(e,n)}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(61)],void 0===(i=function(e,t,n){"use strict";return n({DEFAULT_FONT:"Microsoft YaHei"})}.apply(t,o))||(e.exports=i)},function(e,t,n){"use strict";var o;void 0===(o=function(){return function(e){var t=0;return e?t=("string"==typeof e?e:e.toString()).replace(/(\s)/g,"").length:t}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(28)],void 0===(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.getRules=function(t){var o=t?n.clone(t):{};return n.defaults(o,e.DEFAULT_RULES),o},e.convertToCssStyle=function(t,o,i){var r={},s=e.getRules(i);return n.isArray(o)&&(s=n.pick(s,o)),n.isObject(t)&&n.each(s,function(e,n){r[n]=e(t)}),r},e.DEFAULT_RULES={"font-size":function(e){var t=e["font-size"];if(null!=t)return t+"px"},"font-family":function(e){var t=e["font-family"];return t=o.getAllValueByFont(t)||t},color:function(e){return e.color},"background-color":function(e){return e["back-color"]},"font-weight":function(e){return{true:"bold",false:"normal"}[e.bold+""]},"font-style":function(e){return{true:"italic",false:"normal"}[e.italic+""]},"text-decoration":function(e){if(!1===e.underline&&!1===e.strike)return"none";var t=[];return e.underline&&t.push("underline"),e.strike&&t.push("line-through"),t.join(" ")||""}},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";return function(e,t){if(null!=String.prototype.codePointAt)return String.prototype.codePointAt.call(e,t);if(null==e)throw new TypeError("codePointAt第一个参数必须为String");var n,o,i=(e=String(e)).length,r=isNaN(t)?0:Number(t);return r<0||r>=i?void 0:(n=e.charCodeAt(r))>=55296&&n<=56319&&i>r+1&&(o=e.charCodeAt(r+1))>=56320&&o<=57343?1024*(n-55296)+o-56320+65536:n}}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(140),n(61),n(25)],void 0===(i=function(e,t,n,o,i){"use strict";var r="transparent",s="#000000";return o({bold:{key:"b",default:!1,type:"Boolean"},italic:{key:"i",default:!1,type:"Boolean"},underline:{key:"u",default:!1,type:"Boolean"},strike:{key:"s",default:!1,type:"Boolean"},"font-family":{key:"ff",default:n.DEFAULT_FONT,type:"String"},"font-size":{key:"fs",default:14,type:"Number"},color:{key:"cl",default:s,type:"String",equalDefault:function(e){return e===s||i.equals(e,s)}},"back-color":{key:"bc",default:r,type:"String",equalDefault:function(e){return e===r||i.equals(e,r)}},href:{key:"href",default:"",type:"String"}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(143)],void 0===(i=function(e,t,n){"use strict";return function(e){var t,o=[];for(t=0;t<e.length;t++)n(e,t)>65535?(o.push(e.slice(t,t+2)),t++):o.push(e[t]);return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(21)],void 0===(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.add=function(t){t&&!o.isSupport(t)&&(n.contains(e.unknownInlineStyleNames,t)||e.unknownInlineStyleNames.push(t))},e.get=function(){return e.unknownInlineStyleNames},e.reset=function(){e.unknownInlineStyleNames=[]},e.unknownInlineStyleNames=[],e}()}.apply(t,o))||(e.exports=i)},,,,,function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(239),i=n(240),r=n(241),s={a:r.AnchorHandler,abbr:r.InlineHandler,acronym:r.InlineHandler,address:r.ParagraphHandler,applet:!1,area:!1,article:r.ParagraphHandler,aside:r.ParagraphHandler,audio:!1,b:r.InlineHandler,base:!1,basefont:!1,bdi:r.InlineHandler,bdo:r.InlineHandler,bgsound:!1,big:r.InlineHandler,blink:r.InlineHandler,blockquote:r.ParagraphHandler,body:r.ParagraphHandler,br:r.BreakHandler,button:!1,canvas:!1,center:r.ParagraphHandler,cite:r.InlineHandler,code:r.InlineHandler,command:!1,content:!1,data:!1,datalist:!1,dd:r.ParagraphHandler,del:r.InlineHandler,details:r.ParagraphHandler,dfn:r.InlineHandler,dialog:!1,dir:r.InlineHandler,div:r.ParagraphHandler,dl:r.ParagraphHandler,dt:r.ParagraphHandler,element:!1,em:r.InlineHandler,embed:!1,fieldset:r.ParagraphHandler,figcaption:r.ParagraphHandler,figure:r.ParagraphHandler,font:r.InlineHandler,footer:r.ParagraphHandler,form:r.ParagraphHandler,frame:!1,frameset:!1,h1:r.ParagraphHandler,h2:r.ParagraphHandler,h3:r.ParagraphHandler,h4:r.ParagraphHandler,h5:r.ParagraphHandler,h6:r.ParagraphHandler,header:r.ParagraphHandler,hgroup:r.ParagraphHandler,hr:r.HrHandler,html:r.ParagraphHandler,i:r.InlineHandler,iframe:!1,image:!1,img:r.ImageHandler,input:r.TodoHandler,ins:r.InlineHandler,isindex:!1,kbd:r.InlineHandler,keygen:!1,label:r.InlineHandler,legend:r.ParagraphHandler,li:r.ListItemHandler,link:!1,listing:!1,main:r.ParagraphHandler,map:!1,mark:r.InlineHandler,marquee:r.ParagraphHandler,menu:!1,menuitem:!1,meta:!1,meter:r.InlineHandler,multicol:r.ParagraphHandler,nav:r.ParagraphHandler,nobr:r.InlineHandler,noembed:!1,noframes:!1,noscript:!1,object:!1,ol:r.ListHandler,optgroup:!1,option:!1,output:r.InlineHandler,p:r.ParagraphHandler,param:!1,picture:!1,plaintext:r.ParagraphHandler,pre:r.ParagraphHandler,progress:!1,q:r.InlineHandler,rp:r.InlineHandler,rt:r.InlineHandler,rtc:r.InlineHandler,ruby:r.ParagraphHandler,s:r.InlineHandler,samp:r.InlineHandler,script:!1,section:r.ParagraphHandler,select:!1,shadow:!1,small:r.InlineHandler,source:!1,spacer:!1,span:r.InlineHandler,strike:r.InlineHandler,strong:r.InlineHandler,style:!1,sub:r.InlineHandler,summary:r.ParagraphHandler,sup:r.InlineHandler,table:r.TableHandler,template:!1,textarea:r.ParagraphHandler,time:r.InlineHandler,title:!1,track:!1,tt:r.InlineHandler,u:r.InlineHandler,ul:r.ListHandler,var:r.InlineHandler,video:!1,wbr:!1,xmp:!1},a=function(e,n){e&&e.length&&t.each(e,function(e){null==n[e]&&(n[e]=!1)})};return a(o,s),a(i,s),s}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(93),i=n(54),r=n(79),s=n(153),a=n(47),l=n(0);return t=o.extend({inheritStyleHandlers:!1,uninheritStyleHandlers:{width:!0,float:!0},inheritBlockStyles:{align:!0},_handleNoteLink:function(){var e,t,n,o=this.el;e=o.getAttribute("data-attr-noteid"),t=o.getAttribute("alt"),e&&t&&((n=this.parent&&this.parent.styles?l.clone(this.parent.styles):{}).href="note://"+e,n.color="#003884",n.underline=!0,this.emit({text:t,styles:n,isText:!0}))},_handleNoteTodo:function(){var e=this.el.getAttribute("data-res-todo"),t=new a({legacyResId:e});this.emit(t)},finish:function(){var e,n,o,a,c,u=this,d=u.el,h=d.getAttribute("src"),p=function(e,t){l.each(e,function(e,n){var o=t.style[e];o&&(u.styles[n]=o)})};t.isNoteLink(d)?u._handleNoteLink():t.isTodo(d)?u._handleNoteTodo():h&&((o=d.parentNode)&&(a=o.getAttribute("yne-bulb-block")),t.isAttachment(d)?(n=d.getAttribute("path"),e=new r({source:h,resource:n,fileName:t.getAttachmentFileName(d),fileLength:t.getAttachmentFileLength(d)}),"attachment"===a&&p({align:"textAlign",float:"float"},o)):t.isImage(d)?("image"===a&&p({align:"textAlign",width:"width",float:"float"},o),e=new i({source:h}),u.styles.width&&u.styles.width>620&&(u.styles.width=620)):t.isHandWrite(d)&&(e=(c=d.getAttribute("data-res-handwrite"))?new s({source:h,resource:c}):new i({source:h})),e&&(e.setStyles(u.styles),u.emit(e)))}},{isAttachment:function(e){var t=e.getAttribute("path"),n=e.dataset.mediaType;return t&&("attachment"===n||!n)},isImage:function(e){var t=e.dataset.mediaType;return!e.getAttribute("path")&&(!t||["image"].indexOf(t)>-1)},isHandWrite:function(e){return"handwrite"===e.dataset.mediaType},isNoteLink:function(e){return"notelink"===e.dataset.mediaType},isTodo:function(e){return"todo"===e.dataset.mediaType},getAttachmentFileName:function(e){return e.getAttribute("filename")||e.getAttribute("alt")||e.getAttribute("title")||""},getAttachmentFileLength:function(e){return e.getAttribute("filelength")||""}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(53),n(24),n(2)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.fromXml=function(e){throw new Error("HandWrite do NOT support fromXml till now")},t.fromJSON=function(e){if(!(e&&e.type&&e.type===r.HANDWRITE&&e.source&&e.resource))throw new Error("jsonObj or jsonObj.source/resource does NOT exist!");var n=new t({resource:e.resource,source:e.source});return e.blockId&&n.setId(e.blockId),n},t.prototype.getSource=function(e){var t,n=this.handWriteProps.source;return!0===e&&(t=this.getExtraInfo("pcResMap"))&&t[n]&&(n=t[n]),n},t.prototype.getResource=function(e){var t,n=this.handWriteProps.resource;return!0===e&&(t=this.getExtraInfo("pcResMap"))&&t[n]&&(n=t[n]),n},t.prototype.setStyles=function(){},t.prototype.toHtml=function(e,t,n){var i=o("",document,!0,!0).ownerDocument,r=i.createElement("div"),s=$(r),a=$(i.createElement("img"));return s.attr("yne-bulb-block","handwrite"),a.attr({"data-media-type":"handwrite","data-res-handwrite":this.handWriteProps.resource,src:this.getSource(n)}),s.append(a),r.outerHTML},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.source=this.getSource(!1),t.resource=this.getResource(!1),t},t.prototype.toPlain=function(){return""},t.prototype.toXml=function(){throw new Error("HandWrite do NOT support toXml till now")},t.prototype.initialize=function(t){if(null==t||null==t.source||null==t.resource)throw new Error("props and props.source and props.resource  cannot be null");e.prototype.initialize.apply(this,[t]),this.handWriteProps=n.clone(t),this.type=r.HANDWRITE},t}(i)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(51),i=n(34),r=n(35),s=n(0),a=n(3);return t=o.extend({list:null,level:null,type:null,_itemCounter:null,prevSimilar:null,inheritStyleHandlers:{bold:!0,italic:!0,underline:!0,strike:!0,"font-family":!0,"font-size":!0,color:!0,"back-color":!0,"white-space":!0,align:!0,"line-height":!0,indent:!0,"text-indent":!0},_parseTypeFromElement:function(){return"ul"===this.el.tagName.toLowerCase()?i.UNORDERED:i.ORDERED},_getStartIndexFromElement:function(){var e=this.type,t=this.el,n=-1;return e!==i.ORDERED?n:("list"===t.getAttribute("yne-block-type")&&(n=parseInt(t.getAttribute("start"),10),isNaN(n)&&(n=-1)),n)},increaseItemCounter:function(){var e,t=this.prevSimilar;t&&t.increaseItemCounter?t.increaseItemCounter():(e=this._itemCounter||0,e+=1,this._itemCounter=e)},getItemCounter:function(){var e=this.prevSimilar;return e?e.getItemCounter():this._itemCounter||0},setup:function(){var e,t,n,o=this._findParentListHandler();this.list=null,this.level=1,o&&(this.level=o.level+1),n=this._parseTypeFromElement(),this.type=n,(t=this._getStartIndexFromElement())>1&&(e=this._getPreviousSimilar())&&e.getItemCounter()===t-1&&(this.prevSimilar=e,this.list=e.list),this.list||(this.list=new i({type:n,listId:a.newGUID()}))},capture:function(e){var t=this.level;e instanceof r&&e.getLevel()<t&&e.setLevel(t),this.emit(e)},_findParentListHandler:function(){for(var e=this.parent;e;){if(e instanceof t)return e;e=e.parent}},_getPreviousSimilar:function(){var e,n=this.level,o=this.type,i=this.parent.children;return s.some(i,function(i){if(i instanceof t&&i.level===n&&i.type===o)return e=i,!0}),e}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(1);return{appendText:function(e,n,o,i){if(e&&n&&o&&i){var r=e.createElement(o),s=e.createTextNode(i);r.appendChild(s),n.appendChild(r)}else t.warn("unvalid parameters")}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(3),n(24),n(2)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromJSON=function(){},t.fromXml=function(e){var n=new t({xmlNode:e});return n.parseIdFromXml(e),n},t.prototype.countWords=function(){return 0},t.prototype.setBlockStyle=function(){},t.prototype.setBlockStyles=function(){},t.prototype.getBlockStyles=function(){return null},t.prototype.getBlockStyle=function(){return null},t.prototype.getDefaultBlockStyles=function(){return null},t.prototype.toJSON=function(){return null},t.prototype.toHtml=function(){return""},t.prototype.toPlain=function(){return""},t.prototype.toXml=function(e){var t,r,s=!1;return n.some(this.unknownProps.xmlNode.childNodes,function(e){return e.nodeName===i.TAG_ID_NAME&&(s=!0),s}),s||(t=e.createElement(i.TAG_ID_NAME),r=e.createTextNode(o.newGUID()),t.appendChild(r),this.unknownProps.xmlNode.appendChild(t)),this.unknownProps.xmlNode},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.unknownProps=n.clone(t),this.type=r.UNKNOWN},t}(i)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(29),n(24),n(2)],void 0===(i=function(e,t,n,o,i){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.createBlank=function(e){return new t({content:"",isFooter:!0===e})},t.format=function(e,t){return e?(null!=(t=t||{}).pageIndex&&(e=e.replace(/:p/,t.pageIndex+1)),t.pageCount&&(e=e.replace(/:n/,t.pageCount)),e):e},t.fromXml=function(e){var o=$(e),i=o.find(">text").text(),r=new t({align:o.find("styles>align").text(),content:i,isFooter:"footer"===e.nodeName});return o.children().each(function(e,t){switch(t.nodeName){case"text":break;case"styles":$(t).children().each(function(e,o){"align"!==o.nodeName&&n.appendToTree(r.unknownStyles,t)});break;default:n.appendToTree(r.unknownTree,t)}}),r},t.parse=function(e,t){return e.replace(/\d+/,function(e){return parseInt(e,10)===t.pageIndex+1?":p":e}).replace(/\d+/,function(e){return parseInt(e,10)===t.pageCount?":n":e})},t.prototype.getAlign=function(){return this.align},t.prototype.getBlockStyle=function(e){if("align"===e)return this.getAlign()||"center"},t.prototype.getContent=function(e,n){return t.format(this.content,n)},t.prototype.getInfo=function(){return{align:this.getAlign(),content:this.getContent(),isFooter:this.isFooter}},t.prototype.setAlign=function(e){this.align=e},t.prototype.setContent=function(e){this.content=e},t.prototype.setContentAndStyle=function(e,t){null!=e&&(this.content=e),null!=t&&(this.align=t),this.trigger("change",e,t)},t.prototype.toCollabJSON=function(){return{headerFooterInfo:this.getInfo()}},t.prototype.toXml=function(e){var t,o=this.isFooter?"footer":"header",i=e.createElement(o),r=e.createElement("styles"),s=e.createElement("text"),a=e.createTextNode(this.getContent());return s.appendChild(a),i.appendChild(s),(t=e.createElement("align")).appendChild(e.createTextNode(this.getAlign())),r.appendChild(t),n.appendToXml(this.unknownStyles,r),i.appendChild(r),n.appendToXml(this.unknownTree,i),i.setAttribute("compat","true"),i},t.prototype.initialize=function(t){t=t||{isFooter:!1,content:"",align:"center"},e.prototype.initialize.call(this,t),this.type=i.HEADER_FOOTER,this.blockId=t.isFooter?"footer-fixed-id":"header-fixed-id",this.content=t.content||"",this.align=t.align||"center",this.isFooter=!0===t.isFooter,this.unknownTree={},this.unknownStyles={}},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0);return{getAsArray:function(){return[9,12,14,16,18,22,26,30,36,42]},getAsList:function(){var e=this.getAsArray(),n={};return t.each(e,function(e){n[e]=e}),n},getMin:function(){return this.getAsArray()[0]},getMax:function(){var e=this.getAsArray();return e[e.length-1]}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(9),o=n(4),i=n(6),r=n(1),s=n(14),a=n(43),l=n(3),c=t.extend({name:"ManagerAdapter",effected:!0,_block:null,_dataBefore:null,_dataAfter:null,_args:null,initialize:function(e){var t;e.args=e.args||{},this._args=e.args,c.__super__.initialize.apply(this,arguments),l.isCollabCommand(this._args)||(this._block=e.block,this._dataBefore=e.dataBefore,this._dataAfter=e.dataAfter,(t=this._args.range)&&t.clone&&(this.setStartingRange(t),this.setEndingRange(t.clone(!0))))},apply:function(){var e=this._args.collabProperties||{},t=e.coreEditor;t.isCollabEnabled()&&e.isCollabCmd&&(this._block?this._NeedToSetData(t)&&this._block.setInnerData(this._dataAfter):(e.dataCmdError="Table block has been deleted",e.isOwnCmd&&t.notifyErrorToHost(i.INVALIDACTION_BLOCKS_DIRTY,e.coreEditor),this.effected=!1))},doReapply:function(e){var t,n,o=this._block,r=e.collabProperties,s=r.coreEditor;o&&(t=o.getInnerCommandManager()),s.isCollabEnabled()?(r.redoUndoEffected=!0,r.isCollabCmd?o?(o.setInnerData(this._dataAfter),r.isOwnCmd&&t&&(n=t.redoStack.pop())&&t.undoStack.push(n)):(r.dataCmdError="Table block has been deleted",r.isOwnCmd&&r.coreEditor.notifyErrorToHost(i.INVALIDACTION_BLOCKS_DIRTY,s),r.redoUndoEffected=!1):t&&t.redo()):t&&t.redo()},sendInfoToInner:function(e){var t=this._block;t&&t.sendInfoToInner?t.sendInfoToInner(e):r.error("The block or sendInfoToInner() method is not valid!")},doUnapply:function(e){var t,n,o=this._block,r=e.collabProperties||{},s=r.coreEditor;o&&(t=o.getInnerCommandManager()),s.isCollabEnabled()&&r.isCollabCmd?o?(o.setInnerData(this._dataBefore),r.isOwnCmd&&t&&(n=t.undoStack.pop())&&t.redoStack.push(n)):(r.dataCmdError="Table block has been deleted",r.isOwnCmd&&s.notifyErrorToHost(i.INVALIDACTION_BLOCKS_DIRTY,s),r.redoUndoEffected=!1):t&&t.undo()},fromCollabJSON:function(){var e=this._args.collabProperties,t=e.cmdJSON,n=e.coreEditor.getBlockById(t.blockId);this._block=n,this._dataBefore=t.dataBefore,this._dataAfter=t.dataAfter,c.__super__.fromCollabJSON.apply(this)},getBlockId:function(){var e=null;return this._block&&(e=this._block.getId()),e},toCollabJSON:function(){var e,t=this._block.getId();return this.rangeIsRequired=!1,(e=c.__super__.toCollabJSON.apply(this)).blockId=t,e.dataBefore=this._dataBefore,e.dataAfter=this._dataAfter,e},_NeedToSetData:function(e){var t=this._args.collabProperties||{},n=e.getLastNotOwnExecCmd(),o=!0;return t.isOwnCmd&&(n?n.name!==this.name?(r.log(this.name+": lastNotOwnCmd.name is "+n.name),o=!1):this._block.getId()!==this.getBlockId()?(r.log(this.name+": lastNotOwnCmd do NOT operate same table"),o=!1):this.getCmdOriginalNoteVersion()!==n.getCmdOriginalNoteVersion()?(r.log(this.name+": lastNotOwnCmd originalNoteVersion NOT same"),o=!1):r.log(this.name+": Need to set data again to resolve conflict"):(r.log(this.name+": lastNotOwnCmd is null"),o=!1)),o}},{create:function(e,t,n){var o,i,l={};if(e&&e.getInnerCommandManager&&e.setInnerData)return o=new a({block:e}),i=new s({startRange:o,endRange:o}),l.range=i,new c({args:l,block:e,dataBefore:t,dataAfter:n});r.error("The block is not valid: ",e)}});return o.add(c),c}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(16),o=n(6),i=n(3),r=n(1);return t.extend({name:"UnknownCommand",isSimple:!1,cmdError:null,cmdId:null,isCollabRedo:!1,isCollabUndo:!1,rangeIsRequired:null,initialize:function(){var e=this.options.args||{};i.isCollabCommand(e)?this.fromCollabJSON(e.collabProperties.cmdJSON):this.cmdId=i.newGUID()},apply:function(){throw"Method not implemented."},doReapply:function(){throw"Method not implemented."},doUnapply:function(){throw"Method not implemented."},fromCollabJSON:function(){var e=this.options.args.collabProperties.cmdJSON;null!=e.cmdId?this.cmdId=e.cmdId:r.debugAlert("cmdJSON.cmdId should NOT be null")},getCmdId:function(){var e=this.cmdId;return null==e&&r.debugAlert("cmdId should NOT be null"),e},setCollabRedo:function(e){this.isCollabRedo=e},setCollabUndo:function(e){this.isCollabUndo=e},toCollabJSON:function(){var e={};return e[o.CJSON_ACTION]=this.name,e.cmdId=this.getCmdId(),e}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(0),i=n(15),r=n(4),s=n(43),a=n(3);return t=i.extend({name:"atom.SetTableCellInlineStyle",_table:null,_rect:null,_type:null,effected:!1,_oldStyles:{},_styles:null,initialize:function(){var e=this.options.args;this._oldStyles={},a.isCollabCommand(e)||(this._table=this.options.table,this._styles=this.options.styles,this._rect=this.options.rect,this._type=this.options.type,this._toggle=this.options.toggle),this.type===s.TYPES.ALL&&(this._rect=this._rect||{top:0,left:0,width:this._table.getColumnCount(),height:this._table.getRowCount()}),t.__super__.initialize.apply(this)},apply:function(){var e,t,n,i,r,a=this._table,l=this._rect,c=this._styles||{},u=this._toggle,d=l.top+l.height,h=l.left+l.width;if(!l)return this.effected;if(u){if(i=s.create({block:a,type:s.TYPES.NORMAL,rect:l})){if(!(r=i.getAsRectRange()))return this.effected;e=a.getCommonInlineStyle(u,r)}c[u]=null==e||!e}for(t=l.top;t<d;t++)for(n=l.left;n<h;n++)this._oldStyles[t+"-"+n]=a.getCellInlineStyles({row:t,col:n,names:o.keys(c)}),a.setCellInlineStyles({row:t,col:n,styles:c})&&(this.effected=!0);return this.effected},doUnapply:function(){var e,t,n=this._table,o=this._rect,i=o.top+o.height,r=o.left+o.width;for(e=o.top;e<i;e++)for(t=o.left;t<r;t++)n.setCellInlineStyles({row:e,col:t,styles:this._oldStyles[e+"-"+t]})},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._styles=o.styleNameValues,this._oldStyles=o.oldStyleNameValues,this._rect=o.simpleValue1,this._type=o.simpleValue2,this._toggle=o.newBlkId)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.styleNameValues=this._styles||null,e.oldStyleNameValues=this._oldStyles,e.simpleValue1=this._rect,e.simpleValue2=this._type,e.newBlkId=this._toggle||null,e}}),r.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(11),s=n(2),a=n(1),l=n(23),c=n(49),u=n(102),d=n(70),h=n(58),p=n(130),g=n(84),f=n(57);return t=o.extend({name:"abstract.comp.DeleteNoteRange",_cmdArgs:null,_note:null,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args,t.__super__.initialize.apply(this)},apply:function(){var e,t,n,o,i,c,p=this._cmdArgs.range,g=[];if(!p)return a.error(this.name+":note range should NOT be null"),!1;if(t=(e=p.getStartBlockRange()).block,n=p.getEndBlockRange().block,o=this._note.getNextBlock(n),s.isCode(t))return e.selectWholeBlock||this._cmdArgs.isCodeDelete?(i=r.replaceBlockWithParagraph(this,this._note,t,""),r.setTextBlockAsEndingRange(this,i,0,0)):(p.isCollapsed()?(c=d.createNewRange({preCodeRange:e,charOffset:1}),this.executeAtomicCommand(new u({block:t,startBlockRange:e,endBlockRange:c}))):r.deleteSelectedContent(this,this._note,p),r.setCodeBlockAsEndingRange(this,e,0,0)),!0;if(!p.isCollapsed()&&(r.deleteSelectedContent(this,this._note,p),p.isInSingleBlock()&&s.isTextBlock(t)))return r.setTextBlockAsEndingRange(this,t,e.start,e.start),!0;if(p.isInSingleBlock()){if(s.isTextBlock(t)){if(p.isCollapsed())return e.start===t.getLength()?this._deleteAtTextBlockEnd(o,t):this._deleteAtTextBlockMiddle(t,e.start);r.setTextBlockAsEndingRange(this,t,e.start,e.start)}else o&&!s.isTable(o)?(this.executeAtomicCommand(new l({note:this._note,blocks:[t]})),t=o):t=r.replaceBlockWithParagraph(this,this._note,t,""),s.isTextBlock(t)?r.setTextBlockAsEndingRange(this,t,0,0):r.setNonTextBlockAsEndingRange(this,t);return!0}return p.isInMultiBlock(n)?(s.isTextBlock(t)&&s.isTextBlock(n)?(this.executeAtomicCommand(new h({block:t,start:t.getLength(),text:n.getText()})),g.push(n),r.setTextBlockAsEndingRange(this,t,e.start,e.start)):s.isTextBlock(t)?(g.push(n),r.setTextBlockAsEndingRange(this,t,e.start,e.start)):s.isTextBlock(n)?(g.push(t),r.setTextBlockAsEndingRange(this,n,0,0)):(g.push(t),o?g.push(n):n=r.replaceBlockWithParagraph(this,this._note,n,""),r.setTextBlockAsEndingRange(this,n,0,0)),this.executeAtomicCommand(new l({note:this._note,blocks:g})),!0):void 0},_deleteAtTextBlockEnd:function(e,t){var n;return!(e&&!s.isTable(e))||(s.isAttachment(e)||s.isImage(e)||s.isCode(e)?(this.setEndingRange(f.buildNoteRangeFromNonTextBlock(e)),!0):(n=t.getLength(),s.isTextBlock(e)&&this.executeAtomicCommand(new h({block:t,start:t.getLength(),text:e.getText()})),this.executeAtomicCommand(new l({note:this._note,blocks:[e]})),r.setTextBlockAsEndingRange(this,t,n,n),!0))},_deleteAtTextBlockMiddle:function(e,t){if(g.isAtHrefBorder(e,t,!1))return this._deleteHref(e,t,!1),!0;this.executeAtomicCommand(new c({block:e,start:t,end:t+1})),r.setTextBlockAsEndingRange(this,e,t,t)},_deleteHref:function(e,t){var n;-1!==(n=g.findHrefBorder(e,t,!1))&&this.executeAtomicCommand(new p({blocks:[e],styleNameValues:{href:"",color:"#393939",underline:!1},start:t,end:n+1}))},isSingleBlockAffected:function(){var e,n,o=this._args.range,i=t.__super__.isSingleBlockAffected.apply(this),r=0;return i&&o&&o.isCollapsed()&&(e=(n=o.getStartBlockRange()).block,r=n.start,this._note.getNextBlock(e)&&r===e.getEndOffset()&&(i=!1)),i}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(2),n(36)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.TODO},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(81),s=n(3);return t=o.extend({name:"atom.InsertTableRowCol",_table:null,_rect:null,_cellsData:null,_dataLength:null,effected:!1,initialize:function(){var e=this.options,n=e.args;s.isCollabCommand(n)||(this._cellsData=e.cellsData,this._sizes=e.sizes,this._rect=e.rect,this._table=e.table,this._dataLength=this._cellsData.length),t.__super__.initialize.apply(this)},apply:function(){var e=this._rect,t=this._table,n=this._cellsData,o=this._sizes;null!=e.row&&(t.insertRows(e.row,n,o),this.effected=!0),null!=e.col&&(t.insertCols(e.col,n,o),this.effected=!0)},doUnapply:function(){var e=this._rect,t=this._table,n=this._dataLength;null!=e.row&&t.deleteRows(e.row,n),null!=e.col&&t.deleteCols(e.col,n)},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._cellsData=r.cellsFromCollabJSON(o.dataBefore),this._rect=o.simpleValue1,this._dataLength=o.simpleValue2)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.dataBefore=r.cellsToCollabJSON(this._cellsData),e.simpleValue1=this._rect,e.simpleValue2=this._dataLength,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){"use strict";var t,o,i=n(0),r={ACTION_SHOW_ENABLE:1,ACTION_HIDE:2,ACTION_ENABLE:3,ACTION_DISABLE:4},s={RANGE_DEFAULT:1,RANGE_HEADER_FOOTER:2,RANGE_TABLE_CELL:3,RANGE_CATALOGUE:4,RANGE_IMAGE:5,RANGE_ATTACHMENT:6,RANGE_QUOTE:7,RANGE_CODE:8},a={EDITOR_BUTTON_STATE_MAP:{undo:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE}],redo:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE}],"remove-format":[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],"format-painter":[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],"no-table-split":[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE}],heading:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],"base-split":[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE}],"font-family":[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],"font-size":[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],bold:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],italic:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],underline:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],strike:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],color:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],"back-color":[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],"unordered-list":[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE},{on:s.RANGE_CATALOGUE,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],"ordered-list":[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE},{on:s.RANGE_CATALOGUE,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],todo:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE},{on:s.RANGE_CATALOGUE,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],quote:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE},{on:s.RANGE_CATALOGUE,action:r.ACTION_DISABLE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],align:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_QUOTE,action:r.ACTION_DISABLE}],"table-justify":[{on:s.RANGE_DEFAULT,action:r.ACTION_HIDE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_SHOW_ENABLE}],indent:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE},{on:s.RANGE_QUOTE,action:r.ACTION_DISABLE}],outdent:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE},{on:s.RANGE_QUOTE,action:r.ACTION_DISABLE}],code:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE},{on:s.RANGE_CATALOGUE,action:r.ACTION_DISABLE}],"code-theme":[{on:s.RANGE_DEFAULT,action:r.ACTION_HIDE},{on:s.RANGE_CODE,action:r.ACTION_SHOW_ENABLE}],"code-language":[{on:s.RANGE_DEFAULT,action:r.ACTION_HIDE},{on:s.RANGE_CODE,action:r.ACTION_SHOW_ENABLE}],"line-height":[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE},{on:s.RANGE_IMAGE,action:r.ACTION_DISABLE},{on:s.RANGE_ATTACHMENT,action:r.ACTION_DISABLE}],"table-wrap":[{on:s.RANGE_DEFAULT,action:r.ACTION_HIDE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_SHOW_ENABLE}],"table-operate":[{on:s.RANGE_DEFAULT,action:r.ACTION_HIDE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_SHOW_ENABLE}],"table-split":[{on:s.RANGE_DEFAULT,action:r.ACTION_HIDE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_SHOW_ENABLE}],"table-merge":[{on:s.RANGE_DEFAULT,action:r.ACTION_HIDE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_SHOW_ENABLE}],table:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE},{on:s.RANGE_CATALOGUE,action:r.ACTION_DISABLE}],hr:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE},{on:s.RANGE_CATALOGUE,action:r.ACTION_DISABLE}],link:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_CATALOGUE,action:r.ACTION_DISABLE}],img:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_CATALOGUE,action:r.ACTION_DISABLE}],attachment:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_CATALOGUE,action:r.ACTION_DISABLE}],catalogue:[{on:s.RANGE_DEFAULT,action:r.ACTION_SHOW_ENABLE},{on:s.RANGE_HEADER_FOOTER,action:r.ACTION_DISABLE},{on:s.RANGE_TABLE_CELL,action:r.ACTION_HIDE},{on:s.RANGE_CATALOGUE,action:r.ACTION_DISABLE}]}},l=["font-family","font-size","table","table-justify","table-wrap","table-operate","table-split","table-merge"];return t=["undo","redo","code","code-language","code-theme"].concat(l),o={on:s.RANGE_CODE,action:r.ACTION_DISABLE},Object.keys(a.EDITOR_BUTTON_STATE_MAP).forEach(function(e){t.indexOf(e)>-1||a.EDITOR_BUTTON_STATE_MAP[e].push(o)}),function(e,t){e.forEach(function(e){a.EDITOR_BUTTON_STATE_MAP[e]&&a.EDITOR_BUTTON_STATE_MAP[e].push(t)})}(l,{on:s.RANGE_CODE,action:r.ACTION_HIDE}),i.extend(a,r,s)}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(16)],void 0===(i=function(e,t,n){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.createCommandTypeEvent=function(e){return new t({data:e,type:t.EVENT_TYPES.COMMAND})},t.createUserTypeEvent=function(e){return new t({data:e,type:t.EVENT_TYPES.USER})},t.prototype.getType=function(){return this.type},t.prototype.getData=function(){return this.data},t.prototype.isCommandType=function(){return this.type===t.EVENT_TYPES.COMMAND},t.prototype.isUserType=function(){return this.type===t.EVENT_TYPES.USER},t.prototype.initialize=function(e){this.type=e.type,this.data=e.data,delete this.options},t.EVENT_TYPES={COMMAND:1,USER:2},t}(n)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){return n(168).extend({initialize:function(e){var t=e.event,n=t.originalEvent||t;this._dataTransfer=n.clipboardData}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(16),i=n(1),r=n(20).isEdge(),s=n(342),a={"text/html":!0,"text/plain":!0,"text/uri-list":!0,"text/yne-image-json":!1,"text/yne-json":!1,"text/yne-note-id":!1,"text/yne-table-json":!1};return o.extend({initialize:function(e){var t=e.event,n=t.originalEvent||t;this._dataTransfer=n.dataTransfer},_getCustomData:function(e){var t,n;if(!this._altData){t=this._dataTransfer.getData("application/json");try{n=JSON.parse(t),this._altData=n}catch(e){i.error(e),this._altData={}}}return this._altData[e]},getData:function(e){var t,n,o=this._dataTransfer;return r?(!0===(t=a[e])?(n=o.getData(e),i.log("get standard type",e,n)):!1===t?(n=this._getCustomData(e),i.log("get custom type",e,n)):i.error("type should be registered!",e),n):o.getData(e)},setDataMap:function(e){var n,o=this._dataTransfer,l=function(t,n){i.log("set data to data transfer",n,t);try{var r=t;"text/html"===n&&null!=e["text/yne-json"]&&null!=e["text/html"]&&(e["text/html"]=e["text/html"]+"\x3c!--5f39ae17-8c62-4a45-bc43-b32064c9388a:"+s.encode(e["text/yne-json"])+"--\x3e",r=e["text/html"]),o.setData(n,r)}catch(e){i.error(e)}},c={},u=0;if(r){if(t.each(e,function(e,t){var n=a[t];!0===n?l(e,t):!1===n?(i.log("set custom type",t),c[t]=e,u++):i.error("type should be registered!",t)}),u>0)try{n=JSON.stringify(c),l(n,"application/json")}catch(e){i.error(e)}}else t.each(e,l)},clearData:function(e){return this._dataTransfer.clearData(e)},setProperty:function(e,t){this._dataTransfer[e]=t}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){"use strict";return function(e){var t,n;window.getSelection?(t=window.getSelection()).getRangeAt&&t.rangeCount&&((n=t.getRangeAt(0)).deleteContents(),n.insertNode(document.createTextNode(e))):document.selection&&document.selection.createRange&&(document.selection.createRange().text=e)}}.call(t,n,t,e))||(e.exports=o)},,function(e,t,n){var o;void 0===(o=function(e){var t=n(50),o=n(0);return t.extend({name:"no-table-split",isVisible:!1,initialize:function(e){this.editor=e.editor,this.bindEditorEvents(),this.isVisible||this.hide()},editorEvents:{"yne-selection-change":"onSelectionChange"},bindEditorEvents:function(){var e=this,t=e.editor,n=e.editorEvents;n&&o.each(n,function(n,o){t.on(o,e[n].bind(e))})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(423),o=n(0);return t.extend({editorEvents:{"yne-editing-state-change":"onEditingStateChange"},onEditingStateChange:function(e){o.has(e,this.name)&&(this.selectedValue=e[this.name])}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(2),n(36)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.QUOTE},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0);return{getFileType:function(e){if(t.isUndefined(e))return null;var n=e.toLowerCase().split(".");return{table:"table",pdf:"pdf",txt:"txt",text:"txt",mht:"html",doc:"word",docx:"word",excel:"excel",xls:"excel",xlsx:"excel",csv:"excel",ppt:"ppt",pps:"ppt",pptx:"ppt",ppsx:"ppt",flash:"flash",swf:"flash",flv:"flash",compress:"compress",zip:"compress",rar:"compress","7z":"compress",audio:"audio",mp3:"music",aac:"music",ogg:"music",wav:"music",flac:"music",m4a:"music",ape:"music",wma:"music",video:"video",rm:"video",rmvb:"video",avi:"video",mkv:"video",mpg:"video",mpeg:"video",wmv:"video",ts:"video",m4v:"video",mp4:"video",image:"image",jpg:"image",jpeg:"image",gif:"image",png:"image",bmp:"image",md:"md",scan:"scan",html:"html",htm:"html"}[n[n.length-1]]||"other"},getSizeString:function(e){var t=0,n=parseInt(e);if(n=n||0,isNaN(n))return"未知大小";if(n<=0)return"";for(;n>=1024&&t<3;)t++,n/=1024;return String(Math.floor(100*n)/100)+["B","KB","MB","GB","TB"][t]},splitFileFullName:function(e){if(t.isUndefined(e))return null;var n,o,i=e.lastIndexOf(".");return i<0?(n=e,o=""):0===i?(n="",o=e):(n=e.substring(0,i-1),o=e.substring(i-1)),{fileName:n,fileType:o}},getFileIconByName:function(e){var t="src--svg--type_other_large",n=this.getFileType(e);return n&&(t="src--svg--type_"+n+"_large"),t}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(7);return{isDataUrl:function(e){return/^data:/i.test(e)},isFileUrl:function(e){return/^(file:\/\/)/i.test(e)},isHttpUrl:function(e){return/^http/i.test(e)},has:function(e){return/\?\d+$/.test(String(e))},remove:function(e){return String(e).replace(/\?\d+$/,"")},addIfNeeded:function(e,n){if(e=String(e),e=o.trim(e),this.isHttpUrl(e))return e;if(this.isDataUrl(e))return e;if(this.has(e)){if(!0!==n)return e;e=this.remove(e)}else if(/\?/.test(e))return e;return e+"?"+t.uniqueId()}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(38),i=n(12),r=n(7),s=n(25),a=n(1),l=n(27),c=n(177),u=n(468),d=n(469),h=n(43),p=n(14),g=n(55),f=n(470),m=n(491),_=n(492),y=n(5),b=n(493),v=n(127),k=n(21),C=n(28),I=n(2),S=n(54),w=n(111),E=n(82),T=n(44),N=n(8),A=n(32),x=n(73),O=n(10),B=n(167),R=n(69);return n(494),o.extend({className:"block-view table-view",_template:i.getTemplate("common","table_view"),_wrapperElClassName:"table-wrapper",_cellEditClassName:"cell-edit",_cellSelectedClassName:"cell-selected",_layoutElClassName:"table-layout",_layoutInnerElClassName:"table-layout-inner",_rectOnDragStart:null,_oldRangeType:null,_rending:null,_preSelectionRect:null,_isPasteAsText:!1,_OCRHighlightInfos:null,_OCRHighlightItem:null,events:{"mouseenter td":"_onCellMouseEnter","mouseleave td":"_onCellMouseLeave",mousedown:"_onMouseDown",dblclick:"_onDblclick",click:"_onClick","mouseenter a":"_onEnterLink","mouseleave a":"_onLeaveLink"},initialize:function(){o.prototype.initialize.apply(this,arguments),this._draggable=new c({el:this.el,disableDocSelection:!0}),this.bindSelectionEvents(),this._initEvents(),this._OCRHighlightInfos=[],this._OCRHighlightItem=[]},_initEvents:function(){var e=this.block,n=this._draggable,o={};t.bindAll(this,"_onAttributeChanged","_onDragging","_onStyleChange"),l.addListeners({"cell-inline-style-change":"_onCellInlineStyleChange","cell-block-style-change":"_onCellBlockStyleChange","row-height-set":"_onRowHeightSet","col-width-set":"_onColWidthSet","row-inserted":"_onRowInserted","col-inserted":"_onColInserted","row-deleted":"_onRowDeleted","col-deleted":"_onColDeleted","cell-content-change":"_onCellContentChange","content-change":"_reRenderCells","high-light":"onHighlight"},e,this),e.on("attribute-changed",t.throttle(this._onAttributeChanged),100),e.on("style-change",this._onStyleChange),o[c.DRAG_START]="_onDragStart",o[c.DRAG_END]="_onDragEnd",l.addListeners(o,n,this),n.on(c.DRAGGING,t.throttle(this._onDragging,100)),this._triggerResize=t.throttle(this._triggerResize,100)},_removeSubViews:function(){var e=this;t.each(["_cellEditView","_selectionView","_hiddenInputView"],function(t){var n=e[t];n&&(n.destroy?n.destroy():a.error("view has no destroy()",n),e[t]=null)})},_addSubViews:function(){var e,n=this,o=n._keyHandlerManager;n._removeSubViews(),n._cellEditView=f.create({table:n.block,tableView:n,styleRules:n._getStyleRules(),mapper:this._inlineStyleViewMapper}),l.addListeners({"set-cell-content":"_onSetCellContent",blur:"_onCellEditViewBlur","cell-edit-view-exit":"_onCellEditViewExit","cell-edit-view-enter":"_onCellEditViewEnter"},n._cellEditView,n),l.bubble({"cell-edit-view-selection-change":!0,"cell-edit-view-exit":!0,"cell-edit-view-history-change":!0,"cell-edit-view-command-executed":!0},n._cellEditView,n),n.addViewToInner(n._cellEditView),n._selectionView=new d({tableView:n}),n.addViewToInner(n._selectionView),n._cellResizeView=new _({tableView:n}),n.addViewToInner(n._cellResizeView),l.addListeners({"set-row-height":"_onSetRowHeight","set-col-width":"_onSetColWidth","set-cells-size":"_setCellsSize"},n._cellResizeView,n),n._hiddenInputView=m.create({}),o||(o=n._keyHandlerManager=new y({scope:"table-hidden-input"})),o.on("bind-key",function(e){var t=n._hiddenInputView;t&&t.bindKey(e)}),o.on("unbind-key",function(e){var t=n._hiddenInputView;t&&t.unbindKey(e)}),e=o.getAvailableHandlerNames(),t.each(e,function(e){o.bind(e)}),n.addView(n._hiddenInputView),l.addListeners({"key-monitor":"_onKey",copy:"_onCopy",cut:"_onCut",paste:"_onPaste","text-input":"_onTextInput"},n._hiddenInputView,n)},_onSetCellContent:function(e,t){var n=this.block.getCellById(e);n?this.trigger("command","comp.SetTableCellContent",{table:this.block,cellRect:{row:n.row,col:n.col},content:t}):a.error("Not find cell! by id:",e)},_onCellEditViewBlur:function(){},_onCellEditViewExit:function(){this._hiddenInputView.hideBehind()},_onKey:function(e,t){this._keyHandlerManager.execWithKey(e,this,t)},_onCopy:function(e){e.stopPropagation(),e.preventDefault(),this.trigger("copy",e)},_onCut:function(e){var t=this._getNoteRange();e.stopPropagation(),e.preventDefault(),this.trigger("cut",e),t.isSingleTableSelected()&&this._clearSelectCells()},_pasteBlobImg:function(e){var t,n,o,i=this;t=e.originalEvent.clipboardData.items,o=i._getRectOfNoteRange(),t&&1===t.length&&0===t[0].type.indexOf("image")&&o&&(n=t[0].getAsFile(),i.trigger("yne-blob-paste",{isImg:!0,data:n},function(e){e&&e.source&&i.trigger("command","comp.SetTableCellContent",{table:i.block,cellRect:{row:o.top,col:o.left},content:R.create({source:e.source})})}))},_onPaste:function(e){e.stopPropagation(),e.preventDefault();var t,n,o,i,r,s,a,l=this._isPasteAsText;N.IS_PC?this.trigger("yne-on-paste",l,e):(t=new B({event:e}),l?(r=t.getData("text/plain"))&&this._pastePlain(r):(n=t.getData("text/yne-json"))&&this._pasteJSON(n)||(o=t.getData("text/yne-table-json"))&&this._pasteYTableJson(o)||(i=t.getData("text/html"))&&this._pasteHTML(i)||(a=(s=this.noteView.options.editor)&&s.callMacNativeApi("macClipboardData",["image"]))&&this._pasteImages(a)||(r=t.getData("text/plain"))&&this._pastePlain(r)||this._pasteBlobImg(e))},_pasteHTML:function(e){var t=w.parseHtml(e);return this.pasteBlockList(t)},_pasteJSON:function(e){var t=w.parseJSON(e);return this.pasteBlockList(t)},_pasteYTableJson:function(e){if(t.isString(e))try{e=window.JSON.parse(e)}catch(e){return void a.error("parse ytable json  string error")}return this._pasteJSON([{blockType:I.TABLE,data:e}])},_pasteImages:function(e){var t,n=[];e=JSON.parse(e);for(var o=0;o<e.length;o++)(t=e[o])&&n.push(new S({source:t,title:""}));return this.pasteBlockList(n)},_pastePlain:function(e){var t=w.parsePlain(e);return this.pasteBlockList(t)},pasteBlockList:function(e){var t=this.block,n=[],o=[];return!(!e||!e.length)&&(1===e.length&&I.isTable(e[0])?(this.trigger("command","comp.InsertTableCells",{table:t,widths:e[0].colWidths,heights:e[0].rowHeights,cellsData:e[0].tableCells}),!0):(e.forEach(function(e){var t=E.blockToCell(e);t&&n.push(t)}),n.length>0?(n.forEach(function(e){o.push([e])}),this.trigger("command","comp.InsertTableCells",{table:t,cellsData:o}),!0):void 0))},deleteTable:function(){this.trigger("command","comp.DeleteNoteRange",{isTableDelete:!0})},isSelectAllRect:function(){var e=this._getRectRange().getRect(),t=this.block;return e.width*e.height==t.getColumnCount()*t.getRowCount()},_clearSelectCells:function(){var e=this.block;e.isEmptyContent()&&this.isSelectAllRect()?this.deleteTable():this.trigger("command","comp.InsertTableCells",{table:e})},_onTextInput:function(e){var t,n,o,i,r=this._getRectOfNoteRange();r?this.isLocked()||(t=this.block.getCell(r.top,r.left,{findMergePointIfNeeded:!0,withPosition:!0}))&&((n=t.cell)&&n.isEmpty()?(o=n.getStylesForEmpty(),(i=O.create(e,!1)).setStyles(0,i.getLength(),o)):i=O.create(e,!1),this._cellEditView.showAndEdit({row:t.row,col:t.col,content:i})):a.warn("Failed to show cellEditView",r)},moveWithDirection:function(e,t){var n,o=this.block,i=this._getRectOfNoteRange(),r=1,s=1;if(i){if(o.isMergePoint(i.top,i.left)&&(s=(n=o.getMergePointAttrAt(i.top,i.left)).height,r=n.width),e===T.UP){if(i.top-s<0)return this.trigger("move-caret",!1,t);this._setRange({top:i.top-s,left:i.left,width:1,height:1})}if(e===T.DOWN){if(i.top+s+i.height>o.getRowCount())return this.trigger("move-caret",!0,t);this._setRange({top:i.top+s,left:i.left,width:1,height:1})}if(e===T.LEFT)if(i.left-r<0){if(i.top-s<0)return this.trigger("move-caret",!1,t);this._setRange({top:i.top-s,left:o.getColumnCount()-1,width:1,height:1})}else this._setRange({top:i.top,left:i.left-r,width:1,height:1});if(e===T.RIGHT)if(i.left+r>o.getColumnCount()-1){if(o.isMergePoint(i.top,i.left)&&this._preSelectionRect&&o.getRowCount()-1===this._preSelectionRect.left&&this._preSelectionRect.top++,this._preSelectionRect&&this._preSelectionRect.top+1<o.getRowCount())return this._setRange({top:this._preSelectionRect.top+1,left:0,width:1,height:1});if(i.top+s+i.height>o.getRowCount())return this.trigger("move-caret",!0,t);this._setRange({top:i.top+s,left:0,width:1,height:1})}else o.isMergePoint(i.top,i.left)&&this._preSelectionRect?(o.getRowCount()-1===this._preSelectionRect.left&&this._preSelectionRect.top++,this._setRange({top:this._preSelectionRect.top,left:i.left+r,width:1,height:1})):this._setRange({top:i.top,left:i.left+r,width:1,height:1})}},toggleInlineStyle:function(e){this.trigger("command","comp.SetTableCellInlineStyle",{toggle:e})},clearSelectedCells:function(){this._clearSelectCells()},enterEditMode:function(){},selectAll:function(e){e&&this.trigger("select-all")},render:function(){var e=this.el;this._rending=!0,this._removeSubViews(),this._renderTemplate(),this.colgroupEl=e.querySelector("colgroup"),this.wrapperEl=e.querySelector("."+this._wrapperElClassName),this.tableEl=e.querySelector("table"),this._tableLayoutEl=e.querySelector("."+this._layoutElClassName),this._tableLayoutInnerEl=e.querySelector("."+this._layoutInnerElClassName),this._setTableStyles(),this._renderCells(),this._addSubViews(),o.prototype.render.apply(this,arguments),this._rending=!1,this._triggerResize()},addView:function(e){this._tableLayoutEl.appendChild(e.el),e.render()},addViewToInner:function(e){this._tableLayoutInnerEl.appendChild(e.el),e.render()},_renderTemplate:function(){this.$el.html(this._template())},_renderCells:function(){var e,t,n,o,i,s=this.block,l=this.tableEl,c=s.getRowCount(),u=s.getColumnCount(),d=l.querySelector("tbody"),h=[];for(r(d).hide(),o=0;o<c;o++){for(e=d.insertRow(o),i=0;i<u;i++)(t=s.getCell(o,i))||a.error("No find cell! row, col, block",o,i,s),t.isMergedCell()||(t.isAttachmentCell()&&h.push({row:o,col:i}),e.appendChild(this._renderCell(o,i)));n=s.getRowHeight(o),e.style.height=n?n+"px":""}r(d).show(),this._renderColumns(this.colgroupEl.querySelectorAll("col").length,u)},_loadCellImg:function(e,t){var n=this,o=e.querySelector("img");o&&r(o).load(function(){n._triggerResize(),t&&n._redrawRange()})},_createHighlightMark:function(){var e=this;e._clearHighlightMark(),t.each(e._OCRHighlightInfos,function(n){var o=r(e.getCellImageEl(n.cellId));if(null!=o&&0!==o.length){var s=o.position(),l=o.width()/n.width;t.each(n.pos,function(t){var n=r(i.render("common","high_light_item",{top:s.top+t.top*l-1,left:s.left+t.left*l-2,height:(t.bottom-t.top)*l,width:(t.right-t.left)*l}));n.appendTo(e.wrapperEl),e._OCRHighlightItem.push(n)})}else a.error("Failed to get TableCell by ID:",o)})},clearHighlight:function(){this._OCRHighlightInfos=[],this._clearHighlightMark()},_clearHighlightMark:function(){t.each(this._OCRHighlightItem,function(e){e.remove()}),this._OCRHighlightItem=[]},_replaceBlankToSymbol:function(e){var n=function(e){!e||e.length<1||t.forEach(e,function(e){e.children&&e.children.length>0&&n(e.children),e.childNodes[0]&&3===e.childNodes[0].nodeType&&(e.innerHTML=e.innerHTML.replace(/ /g,"&nbsp;"))})};e&&n(e.children)},_renderCell:function(e,t,n){var o,i,r,s,a,l=this.block,c=l.getCell(e,t,{findMergePointIfNeeded:!0,withPosition:!0});if(c){switch(o=c.cell,i=n||document.createElement("td"),r=o.getContent(),s=o.getType(),i.setAttribute("data-cell-id",o.getCellId()),this._setMergeCell(i,o),this._setCellStyles(i,o.getBlockStyles()),this._setBorder(i,e,t,o.getBlockStyles()),s){case g.TEXT:a=r.toHtml({styleRules:this._getStyleRules()});break;case g.IMAGE:a=b.renderImage(r,l.getExtraInfo("pcResMap"));break;case g.ATTACHMENT:a=b.renderAttachment(r)}return i.innerHTML=a,this._loadCellImg(i,n),n&&this._triggerResize(),i}},_getStyleRules:function(){var e=this._inlineStyleViewMapper;return{color:function(t){var n=t.color;return t.href!==k.getDefault("href")&&s.equals(t.color,"blue")?"#003884":null!=n&&e?e.valueToView("color",n):void 0},"font-family":function(t){var n,o=t["font-family"];return null!=o&&e&&(n=e.valueToView("font-family",o)),o!==n?n:C.getAllValueByFont(o)||o}}},_setMergeCell:function(e,t){if(t.isMergePoint()){var n=t.getMergePointAttr();n.width>0&&e.setAttribute("colspan",n.width),n.height>0&&e.setAttribute("rowspan",n.height)}},_reRenderCells:function(){var e=this.tableEl.querySelector("tbody");this._rending=!0,e.innerHTML="",this.colgroupEl.innerHTML="",this._renderCells(),this._rending=!1,this._triggerResize(),this._redrawRange()},_redrawRange:function(){var e=this._getRectOfNoteRange();this._setRange(e)},_onDownloadClick:function(e){var t,n,o,i=this.getCellElementByTarget(e.target),s=this.block;i&&(t=r(i).data("cellId"),(o=s.getCellById(t).cell)&&(n=o.getContent(),this.trigger("yne-download-attachment",n.getResource(),n.getFileName())))},_onClick:function(e){-1!==e.target.className.indexOf("attachment-download")&&this._onDownloadClick(e)},_onEnterLink:function(e){var t,n,o=r(e.target).closest("a").get(0),i=this.getCellElementByTarget(e.target),s=o.parentNode;t=r(i).data("cellId"),n=this.block.getCellById(t),!this.isOnCellEdit()&&n&&(s.innerText||"").trim()===(o.innerText||"").trim()&&(x.isNoteLinkUrl(o.href)||this.isCollabLocked()||!o||("file://"===o.origin&&r(o).click(function(){return!1}),this.trigger("link-menu-show",{linkNode:o,block:this.block,range:h.create({block:this.block,type:h.TYPES.NORMAL,rect:{width:1,height:1,left:n.col,top:n.row}})})))},_onLeaveLink:function(){this.trigger("link-menu-hide")},_onMouseDown:function(e){this.getCellElementByTarget(e)?this._handleDrag(e,c.DRAG_START,!0):this._setRange(h.TYPES.BLANK)},_onDblclick:function(){var e,t=this._getRectOfNoteRange();t&&!this.isLocked()&&(e=this.block.getCell(t.top,t.left,{findMergePointIfNeeded:!0,withPosition:!0}),this._cellEditView.showAndEdit(e))},_getTableRange:function(){var e,t=this._getNoteRange();if(t&&t.isInSingleBlock&&t.isInSingleBlock()&&(e=t.getStartBlockRange())&&e instanceof h&&e.block===this.block)return e},_getRectRange:function(){var e=this._getTableRange();if(e)return e.getAsRectRange()},_getRectOfNoteRange:function(){var e=this._getRectRange();return e&&e.getRect?e.getRect():null},_getNoteRange:function(){var e;return this.trigger("get-note-range",function(t){e=t}),e},_onDragStart:function(e){this._rectOnDragStart=null,this._handleDrag(e,c.DRAG_START)},_handleDrag:function(e,t,n){var o,i,s,l,u,d=this.getCellElementByTarget(e.target),h=e.shiftKey&&!e.ctrlKey&&!e.metaKey;if(o=r(d).data("cellId"),i=this.block.getCellById(o)){switch(this._preSelectionRect=null,l={width:1,height:1,left:i.col,top:i.row},t){case c.DRAG_START:if(h)u=this._getRectOfNoteRange(),this._rectOnDragStart=u,s=v.union(this._rectOnDragStart,l);else{if(n&&(u=this._getRectOfNoteRange(),v.contains(u,l)))return;s=this._rectOnDragStart=l}break;case c.DRAGGING:case c.DRAG_END:s=v.union(this._rectOnDragStart,l);break;default:a.error("unvalid drag type",t)}s&&this._setRange(s)}},_setRange:function(e){var t,n,o,i=h.TYPES.NORMAL;if(e)return e.width?o=e:i=e,t=h.create({block:this.block,type:i||h.TYPES.FIRST_CELL,rect:o}),n=new p({startRange:t,endRange:t}),this.trigger("set-range",n,!0,!0,!0),this._preSelectionRect=o,t},_onDragging:function(e){this._handleDrag(e,c.DRAGGING)},_onDragEnd:function(){this._handleDrag(event,c.DRAG_END),this._rectOnDragStart=null},_cancelEditMode:function(){a.log("hide cellEditView"),this._cellEditView.hide()},_setCellStyles:function(e,t){var n;n=t.textAlign,e.style.textAlign="center"===n||"right"===n||"left"===n?n:"",n=t.verticalAlign,e.style.verticalAlign="top"===n||"middle"===n||"bottom"===n?n:"",n=t.wrap,e.style.whiteSpace=!1===n||"false"===n?"nowrap":"pre-wrap",n=t.backColor,e.style.backgroundColor=n&&"inherit"!==n&&"transparent"!==n?n:""},_setBorder:function(e,t,n,o){var i,r=this.tableEl.querySelector("tbody"),s=o["border|vertical"],a=o["border|horizontal"];0===t?(i=e)&&(i.style.borderTop=a):(i=r.rows[t-1].cells[n])&&(i.style.borderBottom=a),0===n?(i=e)&&(i.style.borderLeft=s):(i=r.rows[t].cells[n-1])&&(i.style.borderRight=s)},_setRowHeight:function(e,t){var n=this._getRowElAt(e);n&&(n.style.height=t+"px",this._triggerResize())},_getRowElAt:function(e){var t=this.tableEl.tBodies[0];if(t)return t.rows[e]},getRowElHeight:function(e){var t=this._getRowElAt(e),n=0;return t?n=t.getBoundingClientRect().height:n},_renderColumns:function(e,n){if(!((e=e||0)>=n)){var o,i=this.block,r=i.getColumnCount(),s=this.colgroupEl,a=t.toArray(s.querySelectorAll("col"));for(n=n||r,o=e;o<n;++o)this._setColumnWidth(o,i.getColumnWidth(o));for(o=a.length-1;o>=r;--o)u(a[o])}},_setColumnWidth:function(e,t){var n=this._ensureColEl(e);n&&(n.style.width=t+"px",this._triggerResize())},_ensureColEl:function(e){var t,n=this._getColumnCount(),o=Math.max(e+1,n),i=this.colgroupEl,r=o-i.querySelectorAll("col").length,s=this._getColElAt(e);if(s)return s;for(t=0;t<r;++t)i.appendChild(document.createElement("col"));return this._getColElAt(e)},_getColumnCount:function(){var e=this.tableEl.rows[0];return e?e.cells.length:this.block.getColumnCount()},_getColElAt:function(e){if(!(e<0)){return this.colgroupEl.querySelectorAll("col")[e]}},getColElWidth:function(e){var t=this._getColElAt(e);return t?parseFloat(t.style.width):0},getCellElement:function(e){if(e&&e.getCellId&&(e=e.getCellId()),e)return this.$el.find('[data-cell-id="'+e+'"]:first').get(0)},getCellElementAt:function(e,t){var n=this.block.getCell(e,t,{findMergePointIfNeeded:!0});return this.getCellElement(n)},getCellTextElementAt:function(e,t){return this.getCellElementAt(e,t).querySelector(".table-cell-line > span")},getColumnIndex:function(e){var t=r(e).data("cellId"),n=this.block.getCellById(t);return n&&null!=n.col?n.col:null},getCellElementByTarget:function(e){if(e&&e.target&&(e=e.target),e)return r(e).closest("td").get(0)},getAbsoluteBoundingRectAt:function(e,t){var n=this.getBoundingRectAt(e,t),o=this._tableLayoutInnerEl.scrollLeft;if(n)return n.left-=o,n},getBoundingRectAt:function(e,t){var n=this.getCellElementAt(e,t);return this.getBoundingRect(n)},getBoundingRectByCell:function(e){var t=this.getCellElement(e);return this.getBoundingRect(t)},_triggerResize:function(){if(!this._rending){this._createHighlightMark()}},getBoundingRect:function(e){if(e){var t=this.wrapperEl.getBoundingClientRect(),n=this._tableLayoutInnerEl.scrollLeft,o=e.getBoundingClientRect();return{left:o.left-t.left-n,top:o.top-t.top,right:o.right-t.left-n,bottom:o.bottom-t.top,width:o.width,height:o.height}}},getEventBoundingRect:function(e){if(e){var t=this.wrapperEl.getBoundingClientRect();return{left:e.clientX-t.left,top:e.clientY-t.top}}},_onSetRowHeight:function(e,t){this._setCellsSize([{row:e,height:t}])},_onSetColWidth:function(e,t){this._setCellsSize([{col:e,width:t}])},_setCellsSize:function(e){this.trigger("command","comp.SetTableCellsSize",{table:this.block,sizes:e})},_onAttributeChanged:function(){this._reRenderCells()},_onRowHeightSet:function(e,t){this._setRowHeight(e,t)},_onColWidthSet:function(e,t){this._setColumnWidth(e,t)},_ensureRow:function(e){a.log("ensure the row has rendered",e)},_onColInserted:function(){this._reRenderCells()},_onColDeleted:function(){this._reRenderCells()},_onRowInserted:function(){this._reRenderCells()},_onRowDeleted:function(){this._reRenderCells()},_onCellInlineStyleChange:function(e,t){var n=this.getCellElementAt(e,t);this._renderCell(e,t,n)},_onCellBlockStyleChange:function(e,t,n,o){var i=this.getCellElementAt(e,t);i&&this._setCellStyles(i,o)},_onCellMouseEnter:function(e){this.trigger("cell-enter",e,this)},_onCellMouseLeave:function(e){this.trigger("cell-leave",e,this)},_onCellContentChange:function(e){var t,n=this.block.getCellById(e);n?(this._ensureRow(n.row),(t=this.getCellElement(e))?(this._renderCell(n.row,n.col,t),this._triggerResize()):this._reRenderCells()):a.error("unvalid cell info",n)},getHiddenInputView:function(){return this._hiddenInputView},getCellEditView:function(){return this._cellEditView},focusOutTbody:function(){this._setRange(h.TYPES.BLANK)},_setTableStyles:function(){var e=this,n=e.block.getBlockStyles();t.each(n,function(t,n){e._setTableStyle(n,t)})},_setTableStyle:function(e,t){var n=this.$el;switch(e){case"back-color":n.css("background-color",t);break;case"padding":t?n.css({padding:t,"padding-bottom":"5px","padding-top":"5px"}):n.css({padding:t,"padding-bottom":"","padding-top":""})}},_onStyleChange:function(e,t){this._setTableStyle(e,t)},getCellImageEl:function(e){var t=this.getCellElement(e);if(t)return t.querySelector("img")},getImageDomMapByTableRange:function(e){var t,n=e.tableRange,o=e.selectAll,i=this,r=i.block,s={};if(o&&(n=h.create({type:h.TYPES.ALL,block:r})),n&&(t=n.getAsRectRange()))return t.forEachCell(function(e){var t,n,o=e.getCellId();e.isImageCell()&&(t=i.getCellImageEl(o))&&(n=e.getContent(),s[r.getId()+"-"+n.getResId()]||(s[r.getId()+"-"+n.getResId()]={img:t,source:n.getSource()}))}),s},isLocked:function(){var e;return this._rending||this.trigger("get-read-only-status",function(t){e=t}),this.block.isLocked()||this.block.isReadOnly()||this._isReadOnly||e},selectTable:function(e){if(!this._selectionView)return a.error("No selectionView find!");if(e){if(this._getRectOfNoteRange())return;this._selectionView.draw(h.create({block:this.block,type:h.TYPES.ALL}))}else this._selectionView.draw()},onDrawRange:function(e){var t,n;if(!this._selectionView)return a.error("No selectionView find!");if(e&&!e.isInBlank()){if(this._selectionView.draw(e),!(t=e.getAsRectRange()))return;n=t.getRect(),this._hiddenInputView.focus(this.getAbsoluteBoundingRectAt(n.top,n.left))}else this._selectionView.draw()},convertToNativeRange:function(){var e=document.createRange(),t=this.$el.get(0);return e.setStart(t,0),e.setEnd(t,t.childNodes.length),e},parseNativeRange:function(e,t,n){var o,i,s,a,l,c=this.block,u=e.startContainer,d=e.endContainer;return e.collapsed||(i=this.getCellElementByTarget(d))&&(a=c.getCellById(r(i).data("cellId"))),(o=this.getCellElementByTarget(u))&&(s=c.getCellById(r(o).data("cellId"))),s?this._setRange({top:s.row,left:s.col,height:a?a.row-s.row:1,width:a?a.col-s.col:1}):n||A.isNodeInRange(this.wrapperEl,e)||A.isRangeInNode(this.el,e)?(l=new h({block:c,type:h.TYPES.ALL}),this._selectionView.draw(l),l):void 0},onHighlight:function(e,n,o){var i,r,s,a,l,c=this,u=c.block,d=u.getRowCount(),h=u.getColumnCount();function p(e){for(var t,i=e.getLength(),r=n.ignoreCase?e.toString().toLowerCase():e.toString(),s=a.indexOf(r,0);-1!==s;)(t=document.createRange()).setStart(l,s),t.setEnd(l,s+i),o(t),s=a.indexOf(r,s+i)}function g(o){a=o.textContent,a=n.ignoreCase?a.toLowerCase():a,l=o,t.each(e,p)}for(c._OCRHighlightInfos=[],r=0;r<d;r++)for(s=0;s<h;s++)if(!u.isMergedCell(r,s))if((i=u.getCell(r,s)).isImageCell())null!=n.images&&t.each(n.images,function(e){e.resID===i.getContent().getResId()&&(e.cellId=i.getCellId(),c._OCRHighlightInfos.push(e))});else{if(l=c.getCellTextElementAt(r,s),!i.isTextNoEmptyCell()||!l)continue;t.map(l.childNodes,g)}c._createHighlightMark()},editCellFromToolbar:function(e,t){return this._cellEditView.editFromToolbar(e,t)},isOnCellEdit:function(){var e=this._cellEditView,t=this._hiddenInputView;return e&&e.isOnEdit()||t&&t.isOnEdit()},_onCellEditViewEnter:function(e){e&&(e.blockId=this.block.getId()),this.trigger("cell-edit-view-enter",e)},setPasteAsText:function(e){this._isPasteAsText=e||!1}},{isRangeInCellEditArea:function(e){return f.isRangeIn(e)||m.isRangeIn(e)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(17),i=n(0);return t=o.extend({initialize:function(e){i.bindAll(this,"onMouseDown","onMouseMove","onMouseUp"),this.el=e.el,this.disableDocSelection=!0===e.disableDocSelection,this.document=this.el.ownerDocument,this._makeDraggable()},_makeDraggable:function(){var e=this.el;e.addEventListener("mousedown",this.onMouseDown),this._setUserSelect(e,"none")},_getUserSelect:function(e){return e.style.webkitUserSelect||e.style.mozUserSelect||e.style.msUserSelect||e.style.userSelect||""},_setUserSelect:function(e,t){e.style.webkitUserSelect=t,e.style.mozUserSelect=t,e.style.msUserSelect=t,e.style.userSelect=t},onMouseDown:function(e){if(1===e.which){var n=this.el,o=this.document;n.setCapture&&n.setCapture(),o.addEventListener("mousemove",this.onMouseMove),o.addEventListener("mouseup",this.onMouseUp),this.disableDocSelection&&(this._backupDocUserSelect=this._getUserSelect(o.body),this._setUserSelect(o.body,"none")),this.trigger(t.DRAG_START,e)}},onMouseMove:function(e){1===e.which&&this.trigger(t.DRAGGING,e)},cancel:function(){var e=this.el,t=this.document;e.releaseCapture&&e.releaseCapture(),t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("mouseup",this.onMouseUp),this.disableDocSelection&&this._setUserSelect(t.body,this._backupDocUserSelect)},onMouseUp:function(e){1===e.which&&(this.cancel(),this.trigger(t.DRAG_END,e))}},{DRAG_START:"drag-start",DRAGGING:"dragging",DRAG_END:"drag-end"})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t={bold:"bold",italic:"italic",strike:"strikeThrough",underline:"underline"};return{TOGGLE_INLINE_STYLES_CMD_MAP:t,INLINE_STYLES_CMD_MAP:n(0).extend({"back-color":"backColor",color:"foreColor","font-family":"fontName","font-size":"fontSize"},t)}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){n(516),n(525);var t=window.JST={},o=n(0),i=n(12);return n(180).files.forEach(function(e){var r=n(181)("./"+e+".jst");t["common/"+e]=o.template(i.trimTempalte(r))}),n(200).files.forEach(function(e){var r=n(201)("./"+e+".jst");t["web/"+e]=o.template(i.trimTempalte(r))}),n(216)}.call(t,n,t,e))||(e.exports=o)},function(e){e.exports={files:["attachment-view-attachment-container","catalogue_view","table_view","table_cell_resize","table_cell_edit","high_light_item","color_picker","handwrite-view-container","header-footer","high_light_item_image","image-title-input","image-view-image-container","link_view","list_item_view","page_break_view","paragraph_view","todo","content-load-progress"]}},function(e,t,n){var o={"./attachment-view-attachment-container.jst":182,"./catalogue_view.jst":183,"./color_picker.jst":184,"./content-load-progress.jst":185,"./handwrite-view-container.jst":186,"./header-footer.jst":187,"./high_light_item.jst":188,"./high_light_item_image.jst":189,"./image-title-input.jst":190,"./image-view-image-container.jst":191,"./link_view.jst":192,"./list_item_view.jst":193,"./page_break_view.jst":194,"./paragraph_view.jst":195,"./table_cell_edit.jst":196,"./table_cell_resize.jst":197,"./table_view.jst":198,"./todo.jst":199};function i(e){var t=r(e);return n(t)}function r(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}i.keys=function(){return Object.keys(o)},i.resolve=r,e.exports=i,i.id=181},function(e,t){e.exports='<div class="attachment-block-container">\n    <div class="attachment-container" title="<%- title %>">\n        <div class="attachment-icon svg-common <%- name %>"></div>\n        <div class="attachment-title">\n            <p class="attachment-title-name"><%- fileName %></p><p class="attachment-title-type"><%- fileType %></p>\n        </div>\n        <div class="attachment-size"><%= size %></div>\n        <div class="attachment-download svg-common"></div>\n        <div class="attachment-mask" draggable="<%-!!draggable%>">\n            <div class="attachment-icon svg-common <%- name %>"></div>\n            <div class="attachment-title">\n                <p class="attachment-title-name"><%- fileName %></p><p class="attachment-title-type"><%- fileType %></p>\n            </div>\n            <div class="attachment-size"><%= size %></div>\n            <div class="attachment-download svg-common"></div>\n        </div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="catalogue-header cannot-edit">\n    <div class="catalogue-refresh" title="刷新">\n        <i class="svg-common src--svg--catalogue-refresh"></i>\n    </div>\n    <div class="catalogue-delete" title="删除">\n        <i class="svg-common src--svg--catalogue_remove"></i>\n    </div>\n</div>\n<div class="para-text"></div>'},function(e,t){e.exports='<div class="color-picker-panel" tabindex="0">\n    <div class="color-picker-panel-inner">\n        <div class="color-picker-panel-board">\n            <div class="color-picker-panel-board-hsv" style="background-color: rgb(255, 0, 0);">\n                <div class="color-picker-panel-board-value"></div>\n                <div class="color-picker-panel-board-saturation"></div>\n            </div>\n            <span style="left: 126px; top: 93.5px;"></span>\n        </div>\n        <div class="color-picker-panel-wrap">\n            <div class="color-picker-panel-wrap-ribbon">\n                <div class="color-picker-panel-ribbon">\n                    <span style="left: 0%;"></span>\n                </div>\n            </div>\n            <div class="color-picker-panel-wrap-alpha">\n                <div class="color-picker-panel-alpha">\n                    <div class="color-picker-panel-alpha-bg" style="background: linear-gradient(to right, rgba(57, 57, 57, 0), rgb(57, 57, 57));"></div>\n                    <span style="left: 100%;"></span>\n                </div>\n            </div>\n            <div class="color-picker-panel-wrap-preview">\n                <div class="color-picker-panel-preview">\n                    <span style="background-color: rgb(57, 57, 57); opacity: 1;"></span>\n                </div>\n            </div>\n        </div>\n        <div class="color-picker-panel-wrap" style="height: 40px; margin-top: 6px;">\n            <div class="color-picker-panel-params">\n                <div class="color-picker-panel-params-input">\n                    <input type="text" class="color-picker-panel-params-hex" maxlength="6" value="393939">\n                    <input type="number" value="57">\n                    <input type="number" value="57">\n                    <input type="number" value="57">\n                    <input type="number" value="100">\n                </div>\n                <div class="color-picker-panel-params-lable">\n                    <label class="color-picker-panel-params-lable-hex">HEX</label>\n                    <label class="color-picker-panel-params-lable-number">R</label>\n                    <label class="color-picker-panel-params-lable-number">G</label>\n                    <label class="color-picker-panel-params-lable-number">B</label>\n                    <label class="color-picker-panel-params-lable-alpha">A</label>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n</div>'},function(e,t){e.exports='<div class="progressbar-layer">\n    </div>\n    <div class="progressbar-mark">\n    </div>\n    <div class="progress-message">\n    <span class="progress-message-text">\n       <span class="progress-message-number"></span>  的内容已加载完成，请稍后...\n    </span>\n</div>'},function(e,t){e.exports='<div class="handwrite-container">\n    <img  src="<%= src %>"/>\n</div>\n<% if (needCopyHack) {%>\n    <p class="handwrite-copy-hack">select me</p>\n<% } %>'},function(e,t){e.exports="<div class=\"header-footer-input\" contenteditable=\"<%= readonly ? 'false' : 'true' %>\"></div>"},function(e,t){e.exports='<div class="high-light-item" style="left: <%= left %>px; top: <%= top %>px; height: <%= height %>px; width: <%= width %>px;"></div>'},function(e,t){e.exports='<div class="high-light-item-image" style="left: <%= left %>px; top: <%= top %>px; height: <%= height %>px; width: <%= width %>px;"></div>'},function(e,t){e.exports='<div class="image-title-input" contenteditable="true"\n    style="position: absolute; left: <%- left %>px; top: <%- top %>px; width: <%- width%>px; text-align: <%- textAlign%>; min-height: <%- height%>px;"><%- title %></div>\n<div class="image-title-placeholder"\n    style="position: absolute; left: <%- left %>px; top: <%- top %>px; width: <%- width%>px; text-align: <%- textAlign%>; min-height: <%- height%>px;">\n    输入标题\n</div>\n'},function(e,t){e.exports='<div class="image-block-container">\n    <div class="image-container">\n       <% if (src) { %> \n         <img <% if (width || height) { %> class="filter-blur" <% } %> src="<%= src %>"\n            <% if (width && height) { %> style="width: <%- width%>px; height: <%- height%>px;"\n            <% } else if (width) { %> style="width: <%- width%>px; height: auto;"<% } %>/>\n            <div class="resize-handle" data-corner="0"></div>\n            <div class="resize-handle" data-corner="1"></div>\n            <div class="resize-handle" data-corner="2"></div>\n            <div class="resize-handle" data-corner="3"></div>\n            <div class="menu-wrapper">\n                <div class="yne-button-group">\n                    <div class="yne-button-item yne-last" data-button-name="menu" title="快捷菜单">\n                        <span class="yne-button svg-common">快捷菜单</span>\n                        <span class="yne-arrow-down svg-common"></span>\n                    </div>\n                    <ul class="yne-popup-menu">\n                        <li class="yne-popup-item" data-cm-name="image-title"><span>标题</span></li>\n                        <li class="yne-popup-item" data-cm-name="float-left"><span>左浮动</span></li>\n                        <li class="yne-popup-item" data-cm-name="float-right"><span>右浮动</span></li>\n                        <li class="yne-popup-item" data-cm-name="clear-float"><span>清除浮动</span></li>\n                        <li class="yne-popup-item" data-cm-name="clear-resize"><span>清除缩放</span></li>\n                        <% if (hasOCR) {%>\n                            <li class="yne-popup-item" data-cm-name="image-ocr"><span>文本识别OCR</span></li>\n                        <% } %>\n                        <li class="yne-popup-item yne-popup-split"></li>\n                        <li class="yne-popup-item" data-cm-name="delete"><span>删除图片</span></li>\n                        <li class="yne-popup-item" data-cm-name="download"><span>另存为</span></li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n        <div class="image-title"></div>\n        <div class="image-split"></div>\n         <% } else {\n            %><div class="image_error"><div class="svg-common src--svg--image_error"></div></div>\n         <% } %>\n   \n    \n    <% if (needCopyHack) {%>\n        <p class="image-copy-hack">select me</p>\n    <% } %>\n</div>\n'},function(e,t){e.exports='<div class="hover-menu hover-menu-show-link">\n    <div class="hover-menu-before"></div>\n    <div class="hover-menu-body">\n        <a href="<%= link%>" target=\'_blank\'><span><%= link%></span></a>\n        <% if (!isReadOnly) { %>\n            <div class="link-button">\n                <span class="link-modify-button">编辑</span>\n                <span class="link-split">|</span>\n                <span class="link-remove-button">移除</span>\n            </div>\n        <% } %>\n    </div>\n</div>\n<div class="hover-menu hover-menu-modify-link">\n    <div class="hover-menu-before"></div>\n    <div class="hover-menu-body">\n        <span class="link-label">链接</span>\n        <input class="link-input" type="text" name="link" value="<%= link%>" />\n        <div class="link-confirm-button">\n            <span class="link-button-text">确定</span>\n        </div>\n    </div>\n</div>'},function(e,t){e.exports='<% if (isOrdered) { %>\n    <ol class="li-box"><li><div class="para-text"></div></li></ol>\n<% } else { %>\n    <ul class="li-box"><li><div class="para-text"></div></li></ul>\n<% } %>'},function(e,t){e.exports='<div class="page-break">\r\n    <span class="spanMark topSpan"></span>\r\n    <span class="spanMark middleSpan"></span>\r\n    <span class="spanMark bottomSpan"></span>\r\n</div>'},function(e,t){e.exports='<div class="para-text"></div>'},function(e,t){e.exports='<div class="cell-edit-box" contenteditable="true"></div>'},function(e,t){e.exports='<div class="resize-up"></div>\n<div class="resize-right"></div>\n<div class="resize-down"></div>\n<div class="resize-left"></div>\n'},function(e,t){e.exports='<div class="table-layout">\n    <div class="table-layout-inner" contentEditable="false">\n        <div class="table-wrapper">\n            <table>\n                <colgroup></colgroup>\n                <tbody></tbody>   \n            </table>\n            <div class="row-resize-line"></div>\n            <div class="col-resize-line"></div>\n        </div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="todo-content">\n    <label class="todo-mark" contenteditable="false">\n        <span class="todo-inner"></span>\n    </label>\n    <div class="todo-input para-text">\n    </div>\n</div>'},function(e){e.exports={files:["toolbar-button-template","toolbar-combo-box-font-family","toolbar-combo-box-font-size","toolbar-combo-box-align","toolbar-combo-box-line-height","toolbar-combo-box-color","toolbar-combo-box-back-color","toolbar-combo-box-set-background","toolbar-combo-box-table","toolbar_view","toolbar-combo-box-show-more","toolbar-combo-box-insert-link","toolbar-combo-box-heading"],dependency:["common"]}},function(e,t,n){var o={"./toolbar-button-template.jst":202,"./toolbar-combo-box-align.jst":203,"./toolbar-combo-box-back-color.jst":204,"./toolbar-combo-box-color.jst":205,"./toolbar-combo-box-font-family.jst":206,"./toolbar-combo-box-font-size.jst":207,"./toolbar-combo-box-heading.jst":208,"./toolbar-combo-box-insert-link.jst":209,"./toolbar-combo-box-line-height.jst":210,"./toolbar-combo-box-set-background.jst":211,"./toolbar-combo-box-show-more.jst":212,"./toolbar-combo-box-table.jst":213,"./toolbar-combo-box-template.jst":214,"./toolbar_view.jst":215};function i(e){var t=r(e);return n(t)}function r(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}i.keys=function(){return Object.keys(o)},i.resolve=r,e.exports=i,i.id=201},function(e,t){e.exports='<div class="button-wrapper button-wrapper-<%=name%>">\n    <div class="button button-<%=name%> svg-common" title="<%=label%>"></div>\n</div>'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common"></span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <ul class="combo-menu combo-menu-<%=name%>">\n    <% for (key in items) { %>\n        <li class="combo-item" data-value="<%=key%>">\n            <span class="combo-item-icon-<%=name%> <%=key%> svg-common">&nbsp;</span>\n            <span class="combo-item-span-<%=name%>"><%=items[key]%></span>\n        </li>\n    <% } %>\n    </ul>\n</div>'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value svg-common combo-value-<%=name%>">\n            <span class="combo-value-buttom-color"></span>\n        </span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <div class="combo-menu combo-menu-<%=name%>">\n        <div class="color-section color-section-default combo-item" data-value="<%=defaultValue%>">\n            <div class="color-cell combo-item back-color-cell-default" data-value="<%=defaultValue%>" style="background-color:<%=defaultValue%>;"></div>\n            <div class="color-label color-label-default">默认无背景色</div>\n        </div>\n        <hr class="color-section-split">\n        <div class="color-section color-section-theme">\n            <div class="color-label color-label-theme">主题颜色</div>\n            <div class="color-row">\n            <% for (key in items.theme) { %>\n                <div class="color-cell combo-item" data-value="<%=items.theme[key]%>" style="background-color:<%=items.theme[key]%>;"></div>\n            <% } %>\n            </div>\n            <div class="color-row-split"></div>\n            <div class="color-part-theme">\n            <% for (row in items.other) { %>\n                <div class="color-row">\n                <% for (key in items.other[row]) { %>\n                    <div class="color-cell combo-item" data-value="<%=items.other[row][key]%>" style="background-color:<%=items.other[row][key]%>;"></div>\n                <% } %>\n                </div>\n            <% } %>\n            </div>\n        </div>\n        <hr class="color-section-split">\n        <div class="color-section color-section-standard">\n            <div class="color-label color-label-standard">推荐颜色</div>\n            <div class="color-row">\n            <% for (key in items.standard) { %>\n                <div class="color-cell combo-item" data-value="<%=items.standard[key]%>" style="background-color:<%=items.standard[key]%>;"></div>\n            <% } %>\n            </div>\n        </div>\n        <hr class="color-section-split">\n        <div class="color-section color-section-other combo-item">\n            <div class="color-img-other"></div>\n            <div class="color-label color-label-other">其他颜色</div>\n        <div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common">\n            <span class="combo-value-buttom-color"></span>\n        </span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <div class="combo-menu combo-menu-<%=name%>">\n        <div class="color-section color-section-default combo-item" data-value="<%=defaultValue%>">\n            <div class="color-cell combo-item color-cell-default" data-value="<%=defaultValue%>" style="background-color:<%=defaultValue%>;"></div>\n            <div class="color-label color-label-default">默认颜色</div>\n        </div>\n        <hr class="color-section-split">\n        <div class="color-section color-section-theme">\n            <div class="color-label color-label-theme">主题颜色</div>\n            <div class="color-row">\n            <% for (key in items.theme) { %>\n                <div class="color-cell combo-item" data-value="<%=items.theme[key]%>" style="background-color:<%=items.theme[key]%>;"></div>\n            <% } %>\n            </div>\n            <div class="color-row-split"></div>\n            <div class="color-part-theme">\n            <% for (row in items.other) { %>\n                <div class="color-row">\n                <% for (key in items.other[row]) { %>\n                    <div class="color-cell combo-item" data-value="<%=items.other[row][key]%>" style="background-color:<%=items.other[row][key]%>;"></div>\n                <% } %>\n                </div>\n            <% } %>\n            </div>\n        </div>\n        <hr class="color-section-split">\n        <div class="color-section color-section-standard">\n            <div class="color-label color-label-standard">推荐颜色</div>\n            <div class="color-row">\n            <% for (key in items.standard) { %>\n                <div class="color-cell combo-item" data-value="<%=items.standard[key]%>" style="background-color:<%=items.standard[key]%>;"></div>\n            <% } %>\n            </div>\n        </div>\n        <hr class="color-section-split">\n        <div class="color-section color-section-other combo-item">\n            <div class="color-img-other"></div>\n            <div class="color-label color-label-other">其他颜色</div>\n        <div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common"></span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <ul class="combo-menu combo-menu-<%=name%>">\n    <% for (font in items) { %>\n        <li class="combo-item" data-value="<%=items[font].singleValue%>">\n            <span style="font-family:<%=items[font].fullValue%>;"><%=items[font].name%></span>\n        </li>\n    <% } %>\n    </ul>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common"></span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <ul class="combo-menu combo-menu-<%=name%>">\n    <% for (key in items) { %>\n        <li class="combo-item" data-value="<%=key%>">\n            <span><%=items[key]%></span>\n        </li>\n    <% } %>\n    </ul>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%>"></span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <ul class="combo-menu combo-menu-<%=name%>">\n    <% for (key in items) { %>\n        <li class="combo-item" data-value="<%=key%>">\n            <span style="font-size: <%=items[key][\'font-size\']%>px"><%=items[key].name%></span>\n        </li>\n    <% } %>\n    </ul>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper combo-link-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper combo-value-wrapper-<%=name%>">\n        <span class="combo-value combo-value-<%=name%> svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper  wrapper-<%=name%>">\n    <div class="combo-menu combo-menu-<%=name%>">\n        <span class="link-label">链接</span>\n        <input class="link-input" type="text" name="link" placeholder="输入链接" />\n        <div class="link-button">\n            <span class="link-button-text">确定</span>\n        </div>\n    </div>\n</div>\n\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common"></span>\n    </div>\n    <div class="combo-expand-wrapper">\n        <span class="combo-expand svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <ul class="combo-menu combo-menu-<%=name%>">\n    <% for (idx in items) { %>\n        <li class="combo-item" data-value="<%=items[idx].key%>">\n            <span class="combo-item-icon-<%=name%> line-height-<%=idx%>">&nbsp;</span>\n            <span class="combo-item-span-<%=name%>"><%=items[idx].value%></span>\n        </li>\n    <% } %>\n    </ul>\n</div>\n\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common">\n        </span>\n        <span class="combo-text combo-text-<%=name%>">纸张背景</span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <div class="combo-menu combo-menu-<%=name%> svg-common">\n        <div class="background-section-top">\n            <% for (row in items.normalUser) { %>\n            <div class="background-row">\n                <% for (key in items.normalUser[row]) { %>\n                    <% if (items.normalUser[row][key] === \'NoBackground\') { %>\n                        <div class="background-cell combo-item" data-value="<%=items.normalUser[row][key]%>">\n                            <svg class="background-cell-check-mark" xmlns="http://www.w3.org/2000/svg" viewBox="-16 -16 52 52"><path d="M1.05584113,8.97696545 C0.884930054,8.78831051 0.877161369,8.59965557 1.03253508,8.41100063 L1.52196226,7.7742902 C1.6617986,7.56991402 1.84047836,7.53847153 2.05800155,7.67996273 L6.39292802,10.6748599 C6.79689966,10.9421211 7.19310261,10.9185392 7.58153688,10.6041143 L19.1180347,0.982712344 C19.3044832,0.825499894 19.4831629,0.833360516 19.654074,1.00629421 L19.9104406,1.26569475 C20.0813517,1.43862845 20.0813517,1.61942277 19.9104406,1.80807771 L7.53492477,14.5187043 C7.17756524,14.880293 6.8279744,14.8881536 6.48615224,14.5422862 L1.05584113,8.97696545 Z"/></svg>\n                        </div>\n                    <% } else { %>\n                        <div class="background-cell combo-item" data-value="<%=items.normalUser[row][key]%>" style="background-image:url(\'<%=items.normalUser[row][key]%>\');">\n                            <svg class="background-cell-check-mark" xmlns="http://www.w3.org/2000/svg" viewBox="-16 -16 52 52"><path d="M1.05584113,8.97696545 C0.884930054,8.78831051 0.877161369,8.59965557 1.03253508,8.41100063 L1.52196226,7.7742902 C1.6617986,7.56991402 1.84047836,7.53847153 2.05800155,7.67996273 L6.39292802,10.6748599 C6.79689966,10.9421211 7.19310261,10.9185392 7.58153688,10.6041143 L19.1180347,0.982712344 C19.3044832,0.825499894 19.4831629,0.833360516 19.654074,1.00629421 L19.9104406,1.26569475 C20.0813517,1.43862845 20.0813517,1.61942277 19.9104406,1.80807771 L7.53492477,14.5187043 C7.17756524,14.880293 6.8279744,14.8881536 6.48615224,14.5422862 L1.05584113,8.97696545 Z"/></svg>\n                        </div>\n                    <% } %>\n                <% } %>\n                </div>\n            <% } %>\n        </div>\n        <hr class="background-section-split">\n        <div class="background-section-bottom">\n            <div class="background-label background-label-vip">会员特权</div>\n            <% for (row in items.VIP) { %>\n                <div class="background-row">\n                <% for (key in items.VIP[row]) { %>\n                    <div class="background-cell combo-item" data-value="<%=items.VIP[row][key]%>" style="background-image:url(\'<%=items.VIP[row][key]%>\');">\n                        <svg class="background-cell-check-mark" xmlns="http://www.w3.org/2000/svg" viewBox="-16 -16 52 52"><path d="M1.05584113,8.97696545 C0.884930054,8.78831051 0.877161369,8.59965557 1.03253508,8.41100063 L1.52196226,7.7742902 C1.6617986,7.56991402 1.84047836,7.53847153 2.05800155,7.67996273 L6.39292802,10.6748599 C6.79689966,10.9421211 7.19310261,10.9185392 7.58153688,10.6041143 L19.1180347,0.982712344 C19.3044832,0.825499894 19.4831629,0.833360516 19.654074,1.00629421 L19.9104406,1.26569475 C20.0813517,1.43862845 20.0813517,1.61942277 19.9104406,1.80807771 L7.53492477,14.5187043 C7.17756524,14.880293 6.8279744,14.8881536 6.48615224,14.5422862 L1.05584113,8.97696545 Z"/></svg>\n                    </div>\n                <% } %>\n                </div>\n            <% } %>\n        </div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="toolbar-more-split"></div>\n<div class="combo-display-wrapper combo-showmore-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper combo-value-wrapper-<%=name%>">\n        <span class="combo-value combo-value-<%=name%>">更多</span>\n        <span class="combo-expand-gray svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper  wrapper-<%=name%>">\n    <div class="combo-menu combo-menu-<%=name%>">\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper" title="<%=label%>">\n    <div class="combo-value-wrapper">\n        <span class="combo-value combo-value-<%=name%> svg-common"></span>\n    </div>\n</div>\n<div class="combo-menu-wrapper">\n    <div class="combo-menu combo-menu-<%=name%>">\n    <% for (var i=0; i<maxRows; i++) { %>\n        <div class="combo-item-row">\n        <% for (var j=0; j<maxCols; j++) { %>\n            <span class="combo-item" data-row="<%=i%>" data-col="<%=j%>"></span>\n        <% } %>\n        </div>\n    <% } %>\n    <div class="combo-menu-label-<%=name%>">插入表格</div>\n    </div>\n</div>\n'},function(e,t){e.exports='<div class="combo-display-wrapper">\n    <div class="combo-value-wrapper"></div>\n    <div class="combo-expand-wrapper"></div>\n</div>\n<div class="combo-menu-wrapper"></div>\n'},function(e,t){e.exports='<div class="toolbar-container">\n    <% \n        _.each(items, function(conf, key){\n            if(conf.type === \'button\') {\n    %>\n                <button class="<%= key%>" action="<%= conf.action%>" name="<%= conf.name%>" type="button" data-yne-is-block="<%= !!conf.block%>"><%= conf.label%></button>\n    <%      \n            } else if(conf.type === \'select\') {\n    %>\n                <select class="<%= key%>" action="<%= conf.action%>" name="<%= conf.name%>" data-yne-is-block="<%= !!conf.block%>">\n    <%\n                    _.each(conf.options, function(value, key) {\n    %>\n                        <option value="<%= key%>"><%= value%></option>\n    <%                       \n                    });\n    %>\n                </select>\n    <%\n            }\n        });\n    %>\n\n</div>'},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(217),n(6),n(138),n(144),n(28),n(158),n(61),n(8),n(124),n(268),n(511),n(514)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h,p,g,f){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.xml2html=function(e){return(r.fromXml(e)||new r({})).toHtml()},t.html2xml=function(e){return(r.fromHtml(e)||new r({})).toXml()},t.html2html=function(e){return(r.fromHtml(e)||new r({})).toHtml()},t.ocr2xml=function(e){return(r.fromOCR(e)||new r({})).toXml()},t.prototype.getInstance=function(){return this.coreEditor},t.prototype.initialize=function(e){var t,o=this,r=n.extend({pageType:i.PAGE_TYPE_A4,parentEl:null,removeLocalImg:!1,render:!0,sessionType:0,useHttpsConvert:!1},e);if(r.render&&!r.parentEl)throw new Error("BulbEditor need `parentEl`!");null!=localStorage&&(r.viewMode=parseInt(localStorage.getItem(d.name+":view-mode"),10)),r.viewMode=h.parseToNumber(r.viewMode,0),0!==r.viewMode&&2!==r.viewMode&&(r.viewMode=0),o.coreEditor=t=new p(r),r.render&&t.render(),n.each(f,function(e){var n="yne-"+e;t.bind(n,function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(!o.coreEditor.isIdleTimeout()||"download-image"!==e&&"download-attachment"!==e)&&("view-mode-change"===e&&null!=localStorage&&null!=t[0]&&localStorage.setItem(d.name+":view-mode",t[0]),o.trigger.bind(o,e).apply(o,t))})})},t.FONT_NAME=u({DEFAULT:l.getFont(a["font-family"].default),LIST:l.getNames()}),t.FONT_SIZE=u({DEFAULT:a["font-size"].default,LIST:c.getAsArray()}),t}(g)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(218),n(219),n(110)],void 0===(i=function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.injectToWindow=function(){window&&(window.debugTool={breakPoints:n.default,breakPointsGroup:o.default,stopHere:function(e,t){i.breakPointsLog(e,t);var o=n.default&&n.default[e];return o&&o.enable}},window.postMessage({type:"initial-break-points",from:"inspectWindow",sender:"inspectWindow",to:"devPage",payload:{breakPoints:n.default,breakPointsGroup:o.default}},"*"))},e}();t.default=r}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={insertCode:{name:"插入代码块",enable:!1,group:["insert","code"]},insertQuote:{name:"插入引用",enable:!1,group:["insert","quote"]},insertTodo:{name:"插入代办",enable:!1,group:["insert","todo"]},insertImage:{name:"插入图片",enable:!1,group:["insert","image"]},insertLink:{name:"插入链接",enable:!1,group:["insert","link"]},insertList:{name:"插入列表",enable:!1,group:["insert","list"]},insertAttachment:{name:"插入附件",enable:!1,group:["insert","attachment"]},insertHorizontalLine:{name:"插入水平线",enable:!1,group:["insert","hr"]},insertTable:{name:"插入表格",enable:!1,group:["insert","table"]},insertCatalogue:{name:"插入目录",enable:!1,group:["insert","catalogue"]},parseNativeRange:{name:"解析原生range",enable:!1,group:["range","other"]},drawRange:{name:"绘制Range",enable:!1,group:["range","other"]},addDragHint:{name:"绘制拖拽光标",enable:!1,group:["drag","other"]},handleKey:{name:"处理key输入",enable:!1,group:["input"]},textInput:{name:"文本输入",enable:!1,group:["input"]},paste:{name:"粘贴",enable:!1,group:["paste","other"]},copy:{name:"复制",enable:!1,group:["copy","other"]},cut:{name:"剪切",enable:!1,group:["cut","other"]},dragStart:{name:"开始拖拽",enable:!1,group:["drag","other"]},dragEnd:{name:"结束拖拽",enable:!1,group:["drag","other"]},pdfPrintCSS:{name:"pdf/print样式",enable:!1,group:["style","other"]},tab:{name:"tab键",enable:!1,group:["key","other"]},codeUpdate:{name:"代码块更新",enable:!1,group:["render","code"]},codeParse:{name:"代码块解析",enable:!1,group:["code"]},codeRender:{name:"代码块渲染",enable:!1,group:["code","render"]},codeSelectAll:{name:"全选代码块",enable:!1,group:["code","style"]},pcPresentation:{name:"pc演示模式",enable:!1,group:["pc","style","other"]},scrollView:{name:"滚动视图",enable:!1,group:["scroll","other"]},setImageWidth:{name:"设置图片宽度",enable:!1,group:["image","render"]},imageHeight:{name:"图片高度溢出",enable:!1,group:["image","render"]},clickMenu:{name:"点击右键菜单",enable:!1,group:["click","menu","other"]},removeFormat:{name:"清除格式",enable:!1,group:["format","other"]},updateSelectionUI:{name:"更新选区UI",enable:!1,group:["range","render"]},execCommand:{name:"执行命令",enable:!1,group:["command","other"]},doUnapply:{name:"undo命令",enable:!1,group:["command","other"]},execEditorApi:{name:"执行api",enable:!1,group:["api","other"]}}}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={action:["insert","input","render","other"],feature:["todo","code","quote","image","link","list","attachment","hr","table","catalogue","other"]}}.apply(t,[n,t]))||(e.exports=o)},,function(e,t,n){var o;void 0===(o=function(e){var t,o=n(0),i=n(16),r=n(222),s=n(228),a=n(53),l=n(229);return t=i.extend({_mapper:{},_blackTagList:{},constructor:function(e){var t=this;t._mapper={},t._blackTagList={},o.each(e,function(e,n){!1===e?t._blackTagList[n]=!0:e&&o.isObject(e)&&t.define(n,e)})},parse:function(e,t){var n,i,s,c=new l,u=/<html[\S\s]*<\/html>/i;return e=e.replace(/<!--[\w\W]*?-->/i,""),u.test(e)&&(e=e.match(u)[0]),(n=a(e,document,!0))?i=new r(n):((n=document.createElement("div")).innerHTML=e,i=new r(n)),(s=n.getElementsByTagName("style"))&&o.each(s,function(e){c.parse(e.innerText)}),i.internalStylesParser=c,this._parseRecursively(i,this,t),i.blocks},_shouldBreak:function(e){return!e||!e.style||("none"===e.style.display||"hidden"===e.style.visibility)},_parseRecursively:function(e,t,n){var i,r,a,l,c,u=e.el;if(!0!==this._shouldBreak(u)){if(e.setup(),!0!==e.handleChildrenBySelf())for(i=u.firstChild;i;)1===i.nodeType?(c=i.tagName.toLowerCase(),this._blackTagList[c]||(a=this._findHandlers(i),l=new(a=o.isFunction(a)?a:s)(i,e,e.internalStylesParser,t,n),this._parseRecursively(l,t,n))):3===i.nodeType&&(r=i.textContent)&&e.capture({text:r,styles:e.styles,isText:!0}),i=i.nextSibling;e.finish()}},define:function(e,n,o){this._mapper[e]={Class:n,priority:o||t.PRIORITY.DEFAULT}},_findHandlers:function(e){var t=[];if(o.each(this._mapper,function(n,o){(function(e,t){if(e)return e.matches?e.matches(t):e.webkitMatchesSelector?e.webkitMatchesSelector(t):void 0})(e,o)&&t.push(n)}),0!==t.length)return t.sort(function(e,t){return t.priority-e.priority}),t[0].Class}},{PRIORITY:{HIGH:1,DEFAULT:0,LOW:-1}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(89),o=n(24);return t.extend({constructor:function(e){t.call(this,e,null),this.blocks=[]},setup:function(){t.prototype.setup.apply(this),this.blocks=[]},emit:function(e){e&&e instanceof o&&this.blocks.push(e)},finish:function(){this.emitBlock()},getRoot:function(){return this}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(1),i={1:12,2:13,3:16,4:18,5:24,6:32,7:48},r={b:function(e){e.bold=!0},i:function(e){e.italic=!0},u:function(e){e.underline=!0},strike:function(e){e.strike=!0},code:function(e){e["font-family"]="monospace"},mark:function(e){e["back-color"]="#ffff00",e.color="#000000"},font:function(e,t){var n,o=t.getAttribute("color"),r=t.getAttribute("face"),s=t.getAttribute("size");o&&(e.color=o),r&&(e["font-family"]=r),s&&(n=i[s])&&(e["font-size"]=n)},pre:function(e){e["white-space"]="pre"},a:function(e,t){t&&t.href&&(e.color="#003884",e.underline=!0)}},s=function(e,n){var i=r[e];i?t.each(n,function(e){r[e]||(r[e]=i)}):o.error("The tag handler for `"+e+"` does not exist!")};return t.each({h1:32,h2:24,h3:18,h4:16,h5:13,h6:12},function(e,t){r[t]=function(t){t.bold=!0,t["font-size"]=e}}),s("b",["strong"]),s("i",["em","cite","var","address","dfn"]),s("strike",["s","del"]),s("u",["ins"]),s("code",["tt","kbd","samp","pre","xmp","plaintext","listing"]),r}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(25),o=n(46),i={};return function(e,n){var r,s;if((e=o(e).trim().toLowerCase().value())&&"inherit"!==e){if(n&&"transparent"===e)return e;if(r=i[e])return"null"===r?void 0:r;if((s=t(e)).isValid())return 0===s.getAlpha()?void(i[e]="null"):(r=s.toHexString(),i[e]=r,r);i[e]="null"}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(2),n(61),n(1)],void 0===(i=function(e,t,n,o,i,r){"use strict";var s={align:{type:"Enum",possible:{left:!0,right:!0,center:!0,justify:!0},default:"left"},"line-height":{type:"Number",default:1.75},indent:{type:"Number",default:0},"text-indent":{type:"Number",default:0},width:{type:"Number",default:null},float:{type:"Enum",possible:{none:!0,left:!0,right:!0},default:"none"},height:{type:"Number",default:1},color:{type:"String",default:"#999999"},"back-color":{type:"String",default:""},padding:{type:"String",default:""}},a={},l={},c={};return a[o.HR]={width:{type:"Number",default:100},margin:{type:"String",default:"none"}},l[o.PARAGRAPH]=["align","indent","text-indent","line-height","back-color","padding"],l[o.LIST_ITEM]=["align","indent","text-indent","line-height","back-color","padding"],l[o.HEADING]=["align","indent","text-indent","line-height","back-color","padding"],l[o.CATALOGUE]=["align","indent","text-indent","line-height","back-color","padding"],l[o.TODO]=["align","indent","text-indent","line-height","back-color","padding"],l[o.IMAGE]=["align","width","float","height","back-color","padding"],l[o.ATTACHMENT]=["align","float","back-color","padding"],l[o.HR]=["align","width","height","color","back-color","padding","margin"],l[o.TABLE]=["back-color","padding"],l[o.QUOTE]=["line-height","back-color","padding"],l[o.CODE]=["back-color"],n.each(o.getAllBlockTypes(),function(e){l[e]||r.warn("no block style config for block["+e+"]")}),n.each(o.getAllBlockTypes(),function(e){var t={},o=l[e]||[],i=a[e];n.each(o,function(e){i&&i[e]?t[e]=i[e]:s[e]?t[e]=s[e]:r.error("no config for style named ["+e+"]")}),c[e]=t}),r.log("xml block style config",c),i(c)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(63),n(1),n(116),n(21)],void 0===(i=function(e,t,n,o,i,r,s){"use strict";return function(){function e(e){o(r.checkValid(e)),this.char=e,this.length=e.length,this.styles={}}return e.fromJSON=function(t){if(t&&t.char){var o=new e(t.char);return n.each(t.styles,function(e,t){o.setStyle(t,e)}),o}},e.prototype.clone=function(){var t=new e(this.char);return t.styles=n.clone(this.styles),this.unknownStyles&&(t.unknownStyles=n.clone(this.unknownStyles)),t},e.prototype.getStyle=function(e,t,o){void 0===t&&(t=!0);var r,a=t&&o&&void 0!==o[e]?o[e]:null,l=s.getConfig(e);return o&&o[e]&&!this.styles[e]?r=o[e]:l?null==(r=this.styles[e])?t?null===a?l.default:a:null:(n["is"+l.type](r)||(i.warn("The value `"+r+"` of `"+e+"` is not valid type!"),r=null),t?null==r?null===a?l.default:a:r:r===l.default?l.default:r):null},e.prototype.getStyles=function(e){var t=this,o={},i=s.getAllConfig();return n.each(i,function(n,i){o[i]=t.getStyle(i,!0,e)}),o},e.prototype.getUnknownStyle=function(e){var t=this.unknownStyles;if(t)return t[e]},e.prototype.isLineBreak=function(){return"\r"===this.char||"\n"===this.char},e.prototype.removeStyles=function(){this.styles={}},e.prototype.setStyle=function(e,t,o){var r=this.styles,a=s.getConfig(e);if(a){if(t&&!n["is"+a.type](t))switch(a.type){case"Number":t=Number(t),t=isNaN(t)?a.default:t;break;case"Boolean":t=t+""=="true";break;default:i.warn("The value `"+t+"` of `"+e+"` is not valid type!"),t=null}!t||(a.equalDefault?a.equalDefault(t):t===a.default)?(delete r[e],o&&o[e]&&(r[e]=t)):r[e]=t}else i.warn("The RichText does not support `"+e+"` style!")},e.prototype.setUnknownStyle=function(e,t){s.isSupport(e)?i.warn("The RichText supports `"+e+"` style!"):(this.unknownStyles||(this.unknownStyles={}),this.unknownStyles[e]=t)},e.prototype.toJSON=function(){var e=this,t={char:e.char},o={},i=!1,r=s.getAllConfig();return n.each(r,function(t,n){var r=e.getStyle(n,!1);r&&(o[n]=r,i=!0)}),i&&(t.styles=o),t},e.prototype.toString=function(){return this.char},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(46),i=["normal","nowrap","pre-line"],r=function(e,t){return t&&"normal"!==t&&"nowrap"!==t?"pre-line"===t?e.replace(/[ \t]+$/g,""):e:e.replace(/[ \t\r\n]+$/g,"")},s=function(e){var n=e.styles["white-space"];return!n||t.contains(i,n)};return function(e){var n,i,a,l,c,u,d,h;for(t.each(e,function(e){var t,n;e.text=(t=e.text,(n=e.styles["white-space"])&&"normal"!==n&&"nowrap"!==n?"pre-line"===n?t.replace(/[ \t]+/g," "):t:t.replace(/[ \t\r\n]+/g," "))}),a=e.length,n=0;n<a&&((l=e[n]).text=(d=l.text,(h=l.styles["white-space"])&&"normal"!==h&&"nowrap"!==h?"pre-line"===h?d.replace(/^[ \t]+/g,""):d:d.replace(/^[ \t\r\n]+/g,"")),!l.text);n++);for(n=0,i=1;i<a;i++)c=e[n],u=e[i],s(c)&&s(u)&&(o.endsWith(c.text," ")&&o.startsWith(u.text," ")&&(u.text=u.text.slice(1)),""===u.text)||(n=i);for(n=a-1;n>=0&&((l=e[n]).text=r(l.text,l.styles["white-space"]),!l.text);n--);return e}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(51).extend({_computeStyles:function(){var e=this.parent;e&&(this.styles=e.styles)},capture:function(e){this.emit(e)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(16),i=n(230),r=n(238),s=n(7),a=n(1);return o.extend({_internalStyles:{},constructor:function(){this._internalStyles={}},parse:function(e){var n,o,r,s={},l={};if(!0===a.DEBUG)n=i.parse(e);else try{n=i.parse(e)}catch(e){return{}}return n.cssRules?(t.each(n.cssRules,function(e){e.selectorText&&e.style&&(l={},o=e.style,t.each(o,function(e){l[e]=o[e]}),-1!==e.selectorText.indexOf(",")?(r=e.selectorText.split(","),t.each(r,function(e){e=e.trim(),s[e]={selectorText:e,style:l}})):(e.selectorText=e.selectorText.trim(),s[e.selectorText]={selectorText:e.selectorText,style:l}))}),this._internalStyles=t.extend(this._internalStyles,s),s):{}},getInternalStyles:function(){return this._internalStyles},getStylesBySpecificity:function(e,n){var o=this,i={},r=o._internalStyles,a=[],l=0;return r?(t.each(r,function(t){try{s(e).is(t.selectorText)&&a.push(t)}catch(e){}}),a.sort(function(e,t){return-1*o._specificityCompare(e.selectorText,t.selectorText)}),t.some(a,function(e){if(e.style&&t.some(e.style,function(e,o){if(l===n.length)return!0;o in i||-1===t.indexOf(n,o)||(i[o]=e,l++)}),l===n.length)return!0}),i):{}},_specificityCompare:function(e,t){return r.compare(e,t)}})}.call(t,n,t,e))||(e.exports=o)},,,,,,,,,,function(e,t,n){var o;void 0===(o=function(){return["maction","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msubsup","msup","mtable","mtd","mtext","mtr","munder","munderover","semantics"]}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"]}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return{AnchorHandler:n(242),BreakHandler:n(243),HrHandler:n(244),ImageHandler:n(152),InlineHandler:n(93),ListHandler:n(154),ListItemHandler:n(245),ParagraphHandler:n(89),TableHandler:n(246),TodoHandler:n(258)}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(51);return t.extend({inheritStyleHandlers:{bold:!0,italic:!0,underline:!0,strike:!0,"font-family":!0,"font-size":!0,color:!0,"back-color":!0,"white-space":!0},constructor:function(e,n,o){t.call(this,e,n,o)},capture:function(e){var t=this.el.getAttribute("href");t&&"#"!==t&&0!==t.indexOf("javascript")&&e&&!0===e.isText?(e.styles.href=e.styles.href||t,this.emit(e)):this.emit(e)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(93).extend({inheritStyleHandlers:!1,inheritBlockStyles:{"line-height":!0,indent:!0,"text-indent":!0},finish:function(){this.emit({isBr:!0,styles:this.styles})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(51),o=n(78),i=n(0),r=n(77),s=n(2);return t.extend({computeBulbStyles:function(){var e,t=this,n=t.el;"hr"===n.getAttribute("yne-bulb-block")&&(e=r.getStyleNamesOfBlock(s.HR),i.each(e,function(e){var o=n.getAttribute("yne-style-"+e);o&&(t.styles[e]=o)}))},finish:function(){var e=new o;this.styles&&e.setBlockStyles(this.styles),this.emit(e)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(89),o=n(35),i=n(154);return t.extend({setup:function(){this.ownerListHandler=this._findOwnerListHandler()},captureBlock:function(e){var t=null;this.emitBlock(),!this._listed&&e.getType&&"paragraph"===e.getType()?((t=this.createBlock()).append(e.getText()),this.emit(t)):this.emit(e)},emit:function(e){e instanceof o&&(this._listed=!0),t.prototype.emit.call(this,e)},createBlock:function(){var e,n,i=this.ownerListHandler;return!this._listed&&i&&i.list?(i.increaseItemCounter(),n=i.list,e=new o({list:n}),n&&n.addItem&&n.addItem(e),e):t.prototype.createBlock.call(this)},_findOwnerListHandler:function(){for(var e=this.parent;e;){if(e instanceof i)return e;e=e.parent}}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(51),o=n(67),i=n(82),r=n(80),s=n(69),a=n(68),l=n(96),c=n(152),u=n(1),d=n(7),h=n(0),p=n(257),g=n(112),f=n(2),m=function(e,t,n){if(!e)return n;var o=e.getAttribute(t);return o=parseInt(o||n,10),isNaN(o)&&(o=n),o},_=function(e,t,n){if(!e)return n;var o=e.style[t];return o=parseInt(o||n,10),isNaN(o)&&(o=n),o};return t.extend({DEFAULT_HEIGHT:40,DEFAULT_WIDTH:70,_styleHandlers:{bold:{tagList:["b","strong"],styleHandler:function(e){return g.bold.action(e,{},null)}},lineThrough:{tagList:["strike","s","del"],styleHandler:function(e){return g.strike.action(e,{},null)}},underline:{tagList:["u","ins"],styleHandler:function(e){return g.underline.action(e,{},null)}},italic:{tagList:["i","em","cite","var","address","dfn"],styleHandler:function(e){return g.italic.action(e,{},null)}},fontName:function(e){var t=g["font-family"].action(e,{},null);return t||("FONT"===e.tagName?(t=e.getAttribute("face"))||null:void 0)},fontSize:function(e){var t=g["font-size"].action(e,{},null);if(t)return t+"px"},textColor:function(e){var t=g.color.action(e,{},null);return t||("FONT"===e.tagName?(t=e.getAttribute("color"))||null:void 0)},backColor:function(e){return g["back-color"].action(e,{},null)},textAlign:function(e){return g.align.action(e,{},null)}},_tableStyleHandlers:{verticalAlign:function(e){if(e)return e.style.verticalAlign||e.getAttribute("valign")||(e.tagName&&h.contains(["THEAD","TBODY","TFOOT"],e.tagName)?"middle":void 0)},textAlign:function(e){if(e)return e.style&&e.style.textAlign?e.style.textAlign:e.getAttribute("align")},textColor:function(e){return g.color.action(e,{},null)},backColor:function(e){return e.style.backgroundColor||null},bold:function(e){return e&&e.tagName&&"TH"===e.tagName?"true":g.bold.action(e,{},null)?"true":void 0},italic:function(e){if(g.italic.action(e,{},null))return"true"},underline:function(e){if(g.underline.action(e,{},null))return"true"},lineThrough:function(e){if(g.strike.action(e,{},null))return"true"},fontName:function(e){return g["font-family"].action(e,{},null)},fontSize:function(e){var t=g["font-size"].action(e,{},null);if(t)return t+"px"}},constructor:function(e,t,n,o){this.el=e,this.parent=t,this.internalStylesParser=n,this._parser=o},handleChildrenBySelf:function(){return!0},_inheritStyles:function(e,t,n){var o={};return n=n||{},h.each(this._styleHandlers,function(i,r){var s;!1!==e[r]&&(h.isFunction(i)?s=i(t):(i.styleHandler&&(s=i.styleHandler(t)),!s&&i.tagList&&(s=function(e,t){var n;if(e&&e.tagName){if((n=(e.tagName+"").toLowerCase())===t+"")return!0;if(h.contains(t,n))return!0}}(t,i.tagList))),s&&"inherit"!==s||(s=n[r]),o[r]=s)}),o},_mergeStyles:function(e,t){var n=d.trim(e.value).length;h.each(this._styleHandlers,function(o,i){0===n?t[i]?e[i]=t[i]:e[i]=!1:e[i]&&t[i]!==e[i]&&(e[i]=!1)})},_inheritTableStyles:function(e,t){var n={};return h.contains(["TABLE","THEAD","TBODY","TFOOT","TR","TD","TH"],e.tagName+"")?(t=t||{},h.each(this._tableStyleHandlers,function(o,i){var r=o(e);null!=r&&"inherit"!==r||(r=t[i]),null!=r&&(n[i]=r)}),n):{}},_parseImage:function(e,t){var n,o,i=e.getAttribute("src");if(c.isNoteLink(e))return o=e.getAttribute("alt")||"",void(t.value+=o);i&&(c.isAttachment(e)?(n=e.getAttribute("path"),t.value=a.create({source:i,resource:n,fileLength:c.getAttachmentFileLength(e),fileName:c.getAttachmentFileName(e)})):c.isImage(e)&&(t.value=s.create({source:i})))},_shouldAddLineBreak:function(e){e=(e+"").toLowerCase();return h.contains(["article","aside","blockquote","br","button","caption","col","colgroup","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","map","ol","output","p","pre","progress","section","textarea","tfoot","ul","video"],e)},_isLinkCell:function(e){if(!e)return!1;var t,n,o,i,r,s,a=e.querySelectorAll("a"),l=function(e){return!e||(1===e.nodeType?""===d.trim(e.textContent||""):3!==e.nodeType||""===d.trim(e.nodeValue||""))};if(!a||!a.length||1!==a.length)return!1;for(t=(n=a[0]).parentNode;t&&t!==e;){for(i=(o=t.childNodes).length,r=0;r<i;r++)if((s=o[r])!==n&&!l(s))return!1;t=(n=t).parentNode}return!0},_parseCell:function(e,t,n){var o,i,l,c,u,d=this,g={value:""},_=d.internalStylesParser,y=r.createBlank(),b=!1;return u=d._parser.parse(e.innerHTML),h.any(u,f.isTextBlock.bind(f))?h.each(u,function(e){f.isTextBlock(e)?y.appendRichText(e.getText()):(f.isImage(e)||f.isAttachment(e)||f.isTable(e)||f.isHr(e))&&d._blockList.push(e)}):h.each(u,function(e){(f.isTable(e)||f.isHr(e))&&d._blockList.push(e),b?(f.isImage(e)||f.isAttachment(e))&&d._blockList.push(e):f.isImage(e)?(y=s.create({source:e.getSource(),width:e.getStyles("width"),height:e.getStyles("height")}),b=!0):f.isAttachment(e)&&(y=a.create({source:e.getSource(),resource:e.getResource(),fileLength:e.getFileLength(),fileName:e.getFileName()}),b=!0)}),(o={value:y}).value&&g.link&&(o.link=g.link),n===d.DEFAULT_HEIGHT&&(o.wrap="true"),h.each(d._styleHandlers,function(e,t){!0===g[t]?o[t]="true":g[t]&&(o[t]=g[t])}),(i=m(e,"colspan",1))>1&&(o.mergeWidth=i,o.mergeHeight=o.mergeHeight||1),(i=m(e,"rowspan",1))>1&&(o.mergeHeight=i,o.mergeWidth=o.mergeWidth||1),l=d._inheritTableStyles(e,t),h.each(l,function(e,t){null==o[t]&&e&&(o[t]=e)}),c=_.getStylesBySpecificity(e,["font-size","font-family","font-style","font-weight","color","background-color","background","text-decoration","text-align","vertical-align","white-space","word-wrap","word-space"]),h.each(c,function(t,n){var o=e.style.getPropertyValue(n);null!=o&&""!==o||e.style.setProperty(n,t)}),h.each(d._tableStyleHandlers,function(t,n){var i=t(e);null==o[n]&&null!=i&&(o[n]=i)}),p(o.backColor)&&delete o.backColor,o},_isArrayFull:function(e,t){var n;if(0===t)return!1;for(n=0;n<t;n++)if(null==e[n])return!1;return!0},_parseTbodyCells:function(e,t,n){var o,i=this,s=h.filter(t.children,i._isTableRow),a=[],l=e.widths.length,c=e.heights.length,u=0;return o=i._inheritTableStyles(t,n),h.each(s,function(t){var n=h.filter(t.children,i._isTableCell),s=i._inheritTableStyles(t,o),d=u,p=a[d];if(0!==n.length){for(;p&&i._isArrayFull(p,l);)u++,p=a[++d];for(p||(p=a[d]=[]),h.each(n,function(t){for(var n,o,l,u,h,g,f,_,y,b=0,v=p[b];v;)v=p[++b];for(n=b,u=i._parseCell(t,s,e.heights[d]),p[n]=u,o=m(t,"rowspan",1),l=m(t,"colspan",1),o>c-d&&(o=c-d,u.mergeHeight=o),h=0;h<o;h++)for((y=a[f=d+h])||(y=a[f]=[]),g=0;g<l;g++)y[_=n+g]||(y[_]={mergePointDX:g,mergePointDY:h,value:r.createBlank(!0)})});p.length<l;)p.push({value:""});u++}}),a},_isTableCell:function(e){if(!e||!e.tagName)return!1;var t=e.tagName||"";return h.contains(["TD","TH"],t)},_isTableRow:function(e){return!(!e||!e.tagName)&&"TR"===e.tagName},_getTbodySize:function(e){var t,n,o,i,r,s,a=this,l=[],c=0,u=0,d=[];for(h.each(e,function(t){var n,o,i=u,r=l[i];if(0!==(n=h.filter(t.children,a._isTableCell)).length){for(;r&&a._isArrayFull(r,c);)r=l[++i];u=i,r||(r=l[i]=[],d[i]=e[i]),h.each(n,function(t,n){var s,c,u,h,p,g=m(t,"colspan",1),f=m(t,"rowspan",1),y=_(t,"width",0)||m(t,"width",0);for(o+=g,y=Math.max(Math.round(y/g),a.DEFAULT_WIDTH),h=n;null!=r[h];)h++;for(u=0;u<g;u++)r[h+u]=y;for(s=1;s<f;s++)for((p=l[c=i+s])||(p=l[c]=[],d[c]=e[c]),u=0;u<g;u++)p[h+u]=y}),o=r.length,c<o&&(c=o)}}),t=l.length,s=[],n=0;n<c;n++){for(i=(l[0]||[])[n]||a.DEFAULT_WIDTH,o=1;o<t;o++)(r=(l[o]||[])[n])&&r>i&&(i=r);s.push(i)}return{rows:t,columns:c,columnWidthList:s,compactTrList:h.compact(d)}},_createBlankRow:function(e){for(var t=[];e>0;)t.push({value:""}),e--;return t},_parseColgroup:function(e){var t=h.filter(e.children,this._isCol);return h.map(t,function(e){return parseFloat(e.style.width)})},_isCol:function(e){return!(!e||!e.tagName)&&"COL"===e.tagName},_parseTbody:function(e,t,n){var o,i,r,s,a=this,l=h.filter(e.children,a._isTableRow),c=0,u={},d=[],p=0;for(l=(s=a._getTbodySize(l)).compactTrList,u.heights=h.map(l,function(e){if(e.style.height)return parseFloat(e.style.height);var t=h.filter(e.children,a._isTableCell),n=0;return h.some(t,function(e){if(!e.getAttribute("rowspan")){var t=_(e,"height",0)||m(e,"height",0);if(t)return n=t,!0}}),n=Math.max(n,a.DEFAULT_HEIGHT)});u.heights.length<s.rows;)u.heights.push(a.DEFAULT_HEIGHT);if(p=0,h.each(s.columnWidthList,function(e){p+=e}),p<n?(i=Math.ceil((n-p)/s.columns),d=h.map(s.columnWidthList,function(e){return e+i})):d=s.columnWidthList,u.widths=d,r=(o=a._parseTbodyCells(u,e,t)).length,(c=u.heights.length)>r)for(;r<c;)o.push(a._createBlankRow(s.columns)),r++;else if(c<r)for(;c<r;)u.heights.push(a.DEFAULT_HEIGHT),c++;return u.cells=o,u},_extendBodyInfo:function(e,t){var n,o,i,r=e.cells,s=e.heights.length;if(!(e.widths.length>=t))for(n=0;n<s;n++)for(i=(o=r[n]).length;i<t;i++)o.push({value:""})},_convertToTableCells:function(e,t){var n,o,s,a,c=e.length,d=[];for(n=0;n<c;n++)for(o=e[n],d[n]=[],s=0;s<t;s++)(a=o[s])?d[n].push(i.create({content:a.value||r.createBlank(),mergeWidth:a.mergeWidth,mergeHeight:a.mergeHeight,mergePointDX:a.mergePointDX,mergePointDY:a.mergePointDY,styles:h.pick(a,l.getAllStyleNames())})):u.error("No tdInfo  at row, col: "+n+", "+s);return d},_mergeTbody:function(e){if(e&&e.length){var t,n=this,o=0,i=[],r=[],s={};return h.each(e,function(e){var n=e.widths.length;n>o&&(o=n,t=e.widths)}),h.each(e,function(e){n._extendBodyInfo(e,o)}),h.each(e,function(e){i=i.concat(e.heights),r=r.concat(e.cells)}),r=n._convertToTableCells(r,o),s.widths=t,s.heights=i,s.cells=r,s}},_parseTable:function(e){var t,n,o=this,i=h.toArray(e.children),r=["thead","tbody","tfoot"],s={thead:[],tbody:[],tfoot:[]},a=[],l=o._blockList.length,c=o._inheritTableStyles(e,{}),u=_(e,"width",0)||m(e,"width",0);o._blockList.push(0),h.each(i,function(e){var t,i=(e.tagName||"").toLowerCase();"colgroup"===i&&(n=o._parseColgroup(e)),h.contains(r,i)&&(t=o._parseTbody(e,c,u),h.extend(t.widths,n),s[i].push(t))}),h.each(r,function(e){var t=s[e];t&&t.length&&(a=a.concat(t))}),(t=o._mergeTbody(a))&&(o._blockList[l]=t)},setup:function(){this._blockList=[]},finish:function(){var e=this;e._parseTable(e.el),h.each(e._blockList,function(t){var n;t&&t.heights&&t.cells&&t.cells.length>0?n=new o({tableCells:t.cells,rowHeights:t.heights,colWidths:t.widths}):t&&(n=t),n&&e.emit(n)})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(0),n(1),n(94)],void 0===(i=function(e,t,n,o,i){"use strict";return function(){function e(){}return e.renderTable=function(t,n,o){var i,r,s,a,l=t.getRowCount(),c=t.getColumnCount();for(i=(n=n||e._createTableEl()).querySelector("tbody"),e.table=t,s=0;s<l;s++){for(r=document.createElement("tr"),a=0;a<c;a++)t.getCell(s,a).isMergedCell()||r.appendChild(e._renderCell(s,a,null,{resourceMap:o}));r.style.height=t.getRowHeight(s)+"px",i.appendChild(r)}return e._renderColumns(n.querySelector("colgroup")),e.table=null,$(n).css({"border-collapse":"collapse","table-layout":"fixed","white-space":"nowrap",width:0}),n},e._createTableEl=function(){var e=document.createElement("table");return e.innerHTML="<colgroup></colgroup><tbody></tbody>",e},e._handleMergePointIfNeeded=function(e,t){if(t.isMergePoint()){var n=t.getMergePointAttr();n.width>0&&e.setAttribute("colspan",n.width),n.height>0&&e.setAttribute("rowspan",n.height)}},e._renderCell=function(t,o,r,s){r=r||document.createElement("td"),$(r).css({"font-size":14,color:"#393939",border:"1px solid #a7a7a7",overflow:"hidden","vertical-align":"middle","word-wrap":"break-word","background-color":"rgba(255, 255, 255, 0.3)"}),s=n.defaults(s||{},{withCellId:!0,resourceMap:null});var a,l=e.table.getCell(t,o),c=l.getContent();return s.withCellId&&r.setAttribute("data-cell-id",l.getCellId()),e._handleMergePointIfNeeded(r,l),e._setCellStyles(r,l.getBlockStyles(),!0),a=i.contentToHtml(c,s.resourceMap),r.innerHTML=a,r},e._renderColumns=function(t){var n=e.table;t?(t.innerHTML="",n.forEachColumn(function(e){var o=n.getColumnWidth(e),i=document.createElement("col");i.style.width=o+"px",t.appendChild(i)})):o.warn("parameter is not valid",t)},e._setCellStyles=function(e,t,n){var o;n=!1!==n,o=t.textAlign,e.style.textAlign="center"===o||"right"===o||"left"===o?o:"",o=t.verticalAlign,e.style.verticalAlign="top"===o||"middle"===o||"bottom"===o?o:"",n||"true"===t.wrap?e.style.whiteSpace="pre-wrap":e.style.whiteSpace="nowrap",o=t.backColor,e.style.backgroundColor=o&&"inherit"!==o&&"transparent"!==o?o:""},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(61)],void 0===(i=function(e,t,n){"use strict";return n({textAlign:{type:"Enum",possible:{left:!0,right:!0,center:!0,justify:!0},default:"left"},verticalAlign:{type:"Enum",possible:{top:!0,middle:!0,bottom:!0},default:"left"},wrap:{type:"Boolean",default:!1},backColor:{type:"String",default:"transparent"},"border|vertical":{type:"String",default:"1px solid #a7a7a7"},"border|horizontal":{type:"String",default:"1px solid #a7a7a7"}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(){return function(e,t,n,o){var i,r,s;for(i=0;i<n;i++)if(s=t?n-i-1:i,null==o){if(!1===e(s))return}else for(r=0;r<o;r++)if(!1===e(s,t?o-r-1:r))return}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(68),n(69)],void 0===(i=function(e,t,n,o){"use strict";return{attach:n,image:o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(252),n(253),n(254),n(255)],void 0===(i=function(e,t,n,o,i,r,s){"use strict";var a=[o,i,r,s];return function(e){e=e||{};var t,o,i,r=JSON.parse(JSON.stringify(e)),s=a.length,l=r,c=[],u=function(e){c.push(o.name+".js: "+e)};for(t=0;t<s;t++){if(i=(o=a[t]).checkAndFix(l),n.each(i.errors,u),!0===i.stopCheck)return{errors:c,fixedData:i.fixedData};l=i.fixedData}return{errors:c,fixedData:l}}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(122)],void 0===(i=function(e,t,n,o){"use strict";return function(){function e(){}return e.checkAndFix=function(e){var t,i,r,s=e.cells,a=s.length,l=!1,c=!1,u=[];for(t=0;t<a;t++)i=s[t],n.isObject(i)?null==(r=i.value)||n.isString(r)||(c=!0,i.value=r+""):(l=!0,s[t]=o());return l&&u.push("Some cell is NOT Object type"),c&&u.push("The value of some cell is not String type"),{errors:u,fixedData:e,stopCheck:!1}},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0)],void 0===(i=function(e,t,n){"use strict";return function(){function e(){}return e.checkAndFix=function(t){var o=t.cells,i=t.heights,r=t.widths,s=e.IS_VALID(o,i.length,r.length),a=[];return!0!==s&&(a.push(s),n.each(o,function(e){delete e.mergeWidth,delete e.mergeHeight,delete e.mergePointDX,delete e.mergePointDY})),{errors:a,fixedData:t,stopCheck:!1}},e.IS_VALID=function(e,t,o){var i={},r="";return n.some(e,function(t,s){if(!i[s+""]){var a,l,c,u,d,h,p,g,f,m,_;if(t.mergeWidth||t.mergeHeight){if(t.mergeWidth&&!n.isNumber(t.mergeWidth))return r="The mergeWidth is not Number type",!0;if(t.mergeHeight&&!n.isNumber(t.mergeHeight))return r="The mergeHeight is not Number type",!0;if(null!=t.mergePointDX||null!=t.mergePointDY)return r="The cell data is not valid, index: "+s,!0;for(a=t.mergeWidth||1,l=t.mergeHeight||1,c=Math.floor(s/o),u=s%o,g=0;g<l;g++)for(d=c+g,p=0;p<a;p++)if(g>0||p>0){if((f=e[h=d*o+(u+p)]).mergeWidth||f.mergeHeight)return r="The merged cell should not have `mergeWidth` or `mergeHeight`, merge point cell index: "+s+", merged cell index: "+h,!0;if(f.value)return r="The `value` of merged cell should be empty string,merge point cell index: "+s+", index: "+h,!0;if(m=f.mergePointDX||0,_=f.mergePointDY||0,m!==p||_!==g)return r="The `mergePointDX` or `mergePointDY` of mergedCell is not valid, merge point cell index: "+s+",  merged cell index: "+h,!0;i[h+""]=!0}}i[s+""]=!0}}),r||!0},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0)],void 0===(i=function(e,t,n){"use strict";return function(){function e(){}return e.checkAndFix=function(e){var t=e.cells,o=!1,i=[];return n.each(t,function(e){e.mergeWidth&&!e.mergeHeight?(e.mergeHeight=1,o=!0):e.mergeHeight&&!e.mergeWidth&&(e.mergeWidth=1,o=!0)}),o&&i.push("Some cell has no default value for mergeHeight or mergeWidth"),{errors:i,fixedData:e,stopCheck:!1}},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(83),n(122),n(256)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(){function e(){}return e.checkAndFix=function(e){if(!e.cells||!n.isArray(e.cells))return{errors:["The `cells` property is not Array type!"],fixedData:r(),stopCheck:!0};var t,s,a=e.cells,l=e.widths,c=e.heights,u=!0,d=!0,h=[];for(l&&n.isArray(l)||(u=!1,h.push("The `widths` property is not Array type!")),c&&n.isArray(c)||(d=!1,h.push("The `heights` property is not Array type!")),u||d?u?d||(c=[],0===l.length&&(l.length=5),c.length=Math.ceil(a.length/l.length)):(l=[],0===c.length&&(c.length=5),l.length=Math.ceil(a.length/c.length)):((l=[]).length=5,(c=[]).length=Math.ceil(a.length/l.length)),t=l.length*c.length,s=!1;t<a.length;)c.push(o.DEFAULT_ROW_HEIGHT),t=l.length*c.length,s=!0;for(s&&h.push("The widths.length * heights.length is less than cells.length"),t=l.length*c.length,s=!1;t>a.length;)a.push(i()),s=!0;return s&&h.push("The widths.length * heights.length is greater than cells.length"),s=!1,l=n.map(l,function(e){return e&&n.isNumber(e)?e:(s=!0,o.DEFAULT_COL_WIDTH)}),s&&h.push("The `widths` has unvalid value"),s=!1,c=n.map(c,function(e){return e&&n.isNumber(e)?e:(s=!0,o.DEFAULT_ROW_HEIGHT)}),s&&h.push("The `heights` has unvalid value"),{errors:h,fixedData:{cells:a,heights:c,widths:l},stopCheck:!1}},e}()}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(83),n(122)],void 0===(i=function(e,t,n,o){"use strict";return function(e,t){var i,r=[],s=[],a=[],l=(e=e||1)*(t=t||1);for(i=0;i<e;i++)s.push(n.DEFAULT_ROW_HEIGHT);for(i=0;i<t;i++)r.push(n.DEFAULT_COL_WIDTH);for(i=0;i<l;i++)a.push(o());return{cells:a,heights:s,widths:r}}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(25);return function(e){return!!e&&t.equals(e,"white")}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(47);return n(93).extend({finish:function(){var e,n,i=this.el;"todo"===i.getAttribute("data-media-type")&&(e=i.getAttribute("data-attr-content"),n=i.getAttribute("data-attr-checked"),t.isUndefined(e)&&t.isUndefined(n)||this.emit(new o({text:e||"",checked:"true"===n})))}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(89),o=n(34),i=n(35),r=n(1),s=n(0),a=n(3);return t.extend({setup:function(){var e,n,i,r,s,l,c=this.getRoot();t.prototype.setup.call(this),(e=this.el.getAttribute("style"))&&(n=/mso-list:(l\d+) (level\d+)/.exec(e))&&(r=n[1],s=n[2],(i=this._getStyles()["list "+r+":"+s])&&((l=c["mso-"+r])||(l=c["mso-"+r]=new o({type:"bullet"===i["mso-level-number-format"]?o.UNORDERED:o.ORDERED,listId:a.newGUID()})),this.list=l,this.level=Number(s.replace("level","")),this.el.querySelector('[style="mso-list:Ignore"]').remove()))},createBlock:function(){if(!this.list)return t.prototype.createBlock.call(this);var e=this.list,n=new i({list:e,level:this.level});return e&&e.addItem&&e.addItem(n),n},_getStyles:function(){var e,t=this.getRoot(),n=this.el.ownerDocument,o={};return t.msoStyles?t.msoStyles:(e=n.querySelectorAll("style"),s.each(e,function(e){var t,n,i;1===e.childNodes.length&&3===e.firstChild.nodeType&&(t=e.firstChild.textContent,n=o,null!==(i=t.match(/(@[\w_\-:\s]+)\n\s*\{(.|\n)*?\}/gm))&&i.forEach(function(e){var t=/@([\w_\-:\s]+)/.exec(e)[1].trim(),o=e.substring(e.indexOf("{")+1,e.indexOf("}")).trim(),i={};o.split(";").forEach(function(e){var t;-1!==e.indexOf(":")&&(t=e.split(":"),i[t[0].trim()]=t[1].trim())}),n[t]||(n[t]={}),s.extend(n[t],i)}))}),r.log(o),t.msoStyles=o,o)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(1),o=n(0),i=n(261);return function(e,n,r,s){var a,l=[];if(e){if((a=e.split(/\r\n?|\n/))&&a.length)return o.each(a,function(e){var t=i(e,o.clone(n),o.clone(r),s);t&&l.push(t)}),t.log("to paste text",l),l;t.warn("lines do not exist or lines.length is 0!")}else t.warn("no text when paste plain text!")}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(262),o=n(19),i=n(97),r=n(0);return function(e,n,s,a){if(null!=e){var l,c,u=new o;return a||(l=i.matchEnd(e))&&0===l.result.index&&r.extend(n||(n={}),{href:l.fullURI,underline:!0,color:"#003884"}),c=t(e,n),u.setText(c),s&&r.each(s,function(e,t){u.setBlockStyle(t,e)}),u}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(10);return function(e,n){var o;return e=(e+="").replace(/[\r\n]/g,""),o=new t({text:e}),n&&o.setStyles(0,o.getLength(),n),o}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(1),o=n(0),i=n(34),r=n(64),s=n(2),a=n(264),l=n(3);return function(e,n){var c,u,d,h=[],p={},g={},f={};if(o.isString(e))try{c=window.JSON.parse(e)}catch(n){t.error("parse json string error: ",e)}else o.isArray(e)&&(c=e);if(c&&c.length)return t.log("createBlocksFromJSON array: ",c),o.each(c,function(e){var t;(t=a(e,n))&&(e.listId&&e.listType&&s.isListItem(t)&&(u=e.listId,(d=p[u])||(d=new i({type:e.listType,listId:e.listId}),p[u]=d),t.setOwnerList(d)),e.ownerId&&s.isCatalogue(t)&&(u=e.ownerId,f[u]||(f[u]=l.newGUID(),g[f[u]]=new r({id:f[u]})),d=g[f[u]],t.setOwnerList(d)),h.push(t))}),h}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(79),o=n(2),i=n(52),r=n(76),s=n(78),a=n(54),l=n(35),c=n(19),u=n(67),d=n(47),h=n(98),p=n(48),g=n(153),f=n(1);return function(e,n){if(e&&(e.blockType||e.type)){var m,_=e.blockType||e.type;switch(_){case o.PARAGRAPH:m=c.fromJSON(e,n);break;case o.LIST_ITEM:m=l.fromJSON(e);break;case o.IMAGE:m=a.fromJSON(e);break;case o.ATTACHMENT:m=t.fromJSON(e);break;case o.TABLE:m=u.fromJSON(e,!0);break;case o.HR:m=s.fromJSON(e);break;case o.HEADING:m=r.fromJSON(e);break;case o.CATALOGUE:m=i.fromJSON(e);break;case o.TODO:m=d.fromJSON(e);break;case o.QUOTE:m=h.fromJSON(e);break;case o.CODE:m=p.fromJSON(e);break;case o.HANDWRITE:m=g.fromJSON(e);break;default:f.warn("jsonObj.blockType = "+_)}return m}f.warn("jsonObj is null or jsonObj has no `blockType` property!")}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(1),o=n(0),i=n(10),r=n(19),s={create:function(){var e={data:{},push:function(t,n){n||(n=1),e.data[t]?e.data[t]+=n:e.data[t]=n},count:function(){return Object.keys(e.data).length},mergeKeys:function(t){var n,i,r,a,l,c=s.create(),u=e.data;return o.each(e.orderedKeys(),function(e){r&&e-r<t?(a=u[r],l=u[e],n=(r*a+e*l)/(i=a+l),c.push(n,i),r=null):(r&&c.push(r,u[r]),r=e)}),r&&c.push(r,u[r]),c.count()!==e.count()?c.mergeKeys(t):c},mostFrequencyKey:function(){var t,n=0;return o.each(e.data,function(e,o){e>=n&&(n=e,t=parseInt(o))}),t},orderedKeys:function(){return Object.keys(e.data).sort(function(e,t){return e-t})}};return e}},a=function(e,t){return"yd"===t?function(e){var t={},n=e.split(",");return t.left=parseInt(n[0]),t.top=parseInt(n[1]),t.right=parseInt(n[2]),t.bottom=parseInt(n[5]),t.width=t.right-t.left,t.height=t.bottom-t.top,t}(e):function(e){var t={},n=e.split(",");return t.left=parseInt(n[0]),t.top=parseInt(n[1]),t.width=parseInt(n[2]),t.height=parseInt(n[3]),t.right=t.left+t.width,t.bottom=t.top+t.height,t}(e)},l=function(e,t){var n,i,r=e.json,s=t.type,l=[];for(r.box=a(r.boundingBox,s),o.each(r.lines,function(e){var t,i="";e.box=a(e.boundingBox,s),"ms"===s&&(o.each(e.words,function(e){e.box=a(e.boundingBox,s),function(e){return/^[a-z][a-z\d\s.,\/#!$%\^&\*;:{}=\-_`~()]*$/i.test(e)}(e.text)&&(i+=" "),i+=e.text}),e.text=i),!function(e){var t=!1;return[/Epdf/,/For Evaluation Purposes Only/].forEach(function(n){n.test(e)&&(t=!0)}),t}(e.text)?(n&&function(e,t){var n=(t.box.bottom-e.box.top)/e.box.height,o=(t.box.bottom-e.box.top)/t.box.height;return Math.max(n,o)>.8}(e,n)&&(!function(e,t){e.box.top=e.box.top<t.box.top?e.box.top:t.box.top,e.box.bottom=e.box.bottom>t.box.bottom?e.box.bottom:t.box.bottom,e.box.left=e.box.left<t.box.left?e.box.left:t.box.left,e.box.right=e.box.right>t.box.right?e.box.right:t.box.right,e.box.height=e.box.bottom-e.box.top,e.box.width=e.box.right-e.box.left,e.words=t.words.concat(e.words),e.text=t.text+"  "+e.text}(e,n),t=r.lines.indexOf(n),l.push(t)),n=e):(t=r.lines.indexOf(e),l.push(t))}),i=l.length-1;i>=0;i-=1)r.lines.splice(l[i],1)},c=function(e,t){var n={};return n.json=e,l(n,t),t.parseParagraph?(function(e){var t,n=e.json,i=s.create(),r=s.create(),a=s.create(),l=s.create(),c={};o.each(n.lines,function(e){i.push(e.box.left),r.push(e.box.right),t&&a.push(e.box.bottom-t.box.bottom),t=e,l.push(e.box.height)}),c.baseLineHeight=a.mostFrequencyKey(),c.baseFontHeight=l.mergeKeys().mostFrequencyKey(),c.regionLeft=i.mergeKeys(c.baseFontHeight).mostFrequencyKey(),c.regionRight=r.mergeKeys(c.baseFontHeight).mostFrequencyKey(),e.stat=c}(n),function(e){var t,n,o,i,r,s,a=e.json,l=[],c=e.stat.regionLeft,u=e.stat.regionRight,d=e.stat.baseFontHeight,h=e.stat.baseLineHeight,p=!1,g=!1,f="";for(t={startLineIndex:0},r=0;r<a.lines.length;r+=1){if(p=g,c+1.5*d<(i=a.lines[r]).box.left&&r!==t.startLineIndex&&(p=!0),o&&i.box.bottom-o.box.bottom>1.5*h&&(p=!0),p){for(t.endLineIndex=r-1,t.text=f.trim(),l.push(t),n=Math.floor((i.box.bottom-o.box.bottom)/h-1),s=0;s<n;s+=1)l.push({text:""});t={startLineIndex:r},f=i.text}else f+=i.text;o=i,g=u-1.5*d>i.box.right}t.endLineIndex=r,t.text=f,l.push(t),e.paragraphs=l}(n),t.parseIndent&&function(e){var t=e.json,n=e.stat,i=e.paragraphs;o.each(i,function(e){var o,i=t.lines[e.startLineIndex];i&&(Math.ceil((i.box.left-n.regionLeft)/n.baseFontHeight)/2>=1?e.text="\t"+e.text:(e.startLineIndex+1<=e.endLineIndex&&(o=t.lines[e.startLineIndex+1]),o&&Math.ceil((i.box.left-o.box.left)/n.baseFontHeight)/2>=1&&(e.text="\t"+e.text)))})}(n)):function(e){var t,n=e.json;t={startLineIndex:0,endLineIndex:n.lines.length-1,text:""},o.each(n.lines,function(e){t.text+=e.text}),e.paragraphs=[t]}(n),n};return function(e,n){var s,a,l=[];if(o.isString(e))try{s=window.JSON.parse(e)}catch(n){t.error("parse json string error: ",e)}return s&&o.each(s,function(e){o.each(e.regions,function(e){var t=c(e,n);o.each(t.paragraphs,function(e){a=function(e){var t,n,o,s=new r;return o=e.fontSize,t=(t=e.text).replace(/[\r\n]/g,""),(n=new i({text:t})).setStyle(0,n.getLength(),"font-size",o),s.setText(n),s}(e),l.push(a)})}),l.push(new r)}),l}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(17),n(1)],void 0===(i=function(e,t,n,o,i){"use strict";return function(e){function t(t,o,r,s,a){var l=e.call(this,{})||this;return l.listItemNodeProps={},i.DEBUG&&(l.listItemNodeProps.debugId=n.uniqueId()),l.listItemNodeProps.level=t||0,l.listItemNodeProps.block=o,l.listItemNodeProps.start=r,l.listItemNodeProps.end=s,l.addChildNodes(a),l}return s(t,e),t.prototype.addChildNodes=function(e){var t=this;e&&(n.isArray(e)||(e=[e]),n.each(e,function(e){e.parentNode=t,t.childNodes||(t.childNodes=[]),t.childNodes.push(e)}))},t.prototype.childrenCount=function(){return this.childNodes?this.childNodes.length:0},t.prototype.getChildStartIndex=function(){var e=(this.childNodes||[])[0];return e?e.getStartIndex():1},t.prototype.getLevel=function(){return this.listItemNodeProps.level},t.prototype.getParentNode=function(){return this.parentNode},t.prototype.getStartIndex=function(){return this.listItemNodeProps.block?this.listItemNodeProps.block.getIndex():1},t.prototype.hasChildren=function(){return this.childrenCount()>0},t.prototype.isChildOrdered=function(){var e=(this.childNodes||[])[0];return!!e&&e.isOrdered()},t.prototype.isOrdered=function(){return this.listItemNodeProps.block?this.listItemNodeProps.block.isOrdered():!!this.parentNode&&this.parentNode.isOrdered()},t.prototype.toHtml=function(e){var t,o,i,r,s,a,l=this.listItemNodeProps.block,c=[];return e=!0===e,this.hasChildren()?(s=l?l.toHtml(this.listItemNodeProps.start,this.listItemNodeProps.end,e):"",c.push(s),i="<"+(t=this.isChildOrdered()?"ol":"ul")+' yne-block-type="list" style="margin:0px " ',(o=this.getChildStartIndex())>1&&(i+=' start="'+o+'"'),i+=">",c.push(i),a=this.childNodes,n.each(a,function(t){var n=t.toHtml(e);c.push(n)}),r="</"+t+">",c.push(r)):(s=l?l.toHtml(this.listItemNodeProps.start,this.listItemNodeProps.end,e):"<li></li>",c.push(s)),c.join("")},t.prototype.initialize=function(){},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(79),n(52),n(76),n(78),n(54),n(35),n(19),n(98),n(67),n(47),n(48),n(156)],void 0===(i=function(e,t,n,o,i,r,s,a,l,c,u,d,h,p,g){"use strict";var f={attach:o,catalogue:i,heading:r,"horizontal-line":s,image:a,"list-item":l,para:c,code:p,quote:u,table:d,todo:h,unknown:g};return n.each(f,function(e,t){e.prototype.xmlNodeName=t}),f}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(6),n(269),n(48),n(270),n(273),n(290),n(138),n(10),n(28),n(158),n(27),n(134),n(73),n(377),n(378),n(379),n(1),n(380),n(403),n(405),n(448),n(451),n(510),n(2)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h,p,g,f,m,_,y,b,v,k,C,I,S,w,E,T){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.callMacNativeApi=function(e,t){return C.callNativeApi(e,t)},t.prototype.canRemoveFormat=function(){return this.controller.canRemoveFormat()},t.prototype.getNoteViewWrapper=function(){return this.$noteViewWrapper},t.prototype.getNoteViewFrame=function(){return this.$noteViewFrame},t.prototype.initNoteViewWrapper=function(){var e,t,n,o,i=this,r=$(i.editorProps.parentEl);i.$noteViewWrapper||(i.$noteViewWrapper=$('<div class="note-view-wrapper"></div>'),i.$noteViewFrame=$('<div class="note-view-frame"></div>'),i.$noteViewWrapper.append(i.$noteViewFrame),r.append(i.$noteViewWrapper),i.progressTracker=new E({}),null!=i.noteView&&i.noteView.setOptions({noteviewFrame:i.getNoteViewFrame(),noteviewWrapper:i.getNoteViewWrapper()})),i._updateNoteViewWrapperSize(),o=window.devicePixelRatio,e=function(){var s=!1;t!==r.width()&&(s=!0,t=r.width()),n!==r.height()&&(s=!0,n=r.height()),o!==window.devicePixelRatio&&(s=!0,o=window.devicePixelRatio),s&&i.onResize(),setTimeout(e,500)},setTimeout(e,500)},t.prototype.insertNoteLink=function(e,t){if(e&&t){var n,o,i=m.fillAsUrl(e);o=(n=new d({text:t})).getLength(),n.setStyles(0,o,{color:"rgb(0, 56, 132)",href:i,underline:!0}),this.insertText(n,!1)}},t.prototype.insertText=function(e,t){this.controller.insertText(e,t)},t.prototype.isLegacyHost=function(){var e=!0;return null!=this.getEditorProps().webVersion&&(e=!1),e},t.prototype.isSameList=function(e){return this.controller.isSameList(e)},t.prototype.onResize=function(){this._updateNoteViewWrapperSize(),this.noteView.trigger("resize")},t.prototype.render=function(){var e=this.noteView;e&&(this.toolbar.render(),$(this.editorProps.parentEl).append(this.toolbar.$el),this.toolbar.shrink(),this.initNoteViewWrapper(),this.$noteViewFrame.append(e.$el),this.$noteViewWrapper.append(this.linkView.$el),e.setOptions({pageType:this.editorProps.pageType}),this.setViewMode(this.editorProps.viewMode,!0,!1),e.render(),this.$noteViewWrapper.append(this.imgTitleInput.$el))},t.prototype.reset=function(){e.prototype.reset.call(this),this.toolbar.$el.find(".button-undo").removeClass("active"),this.toolbar.$el.find(".button-redo").removeClass("active"),this.toolbar&&(this.toolbar.reset(),this.toolbar.isRendered&&this.toolbar.show())},t.prototype.setDefaultFont=function(e,t,n){var o=h.getFontFirstValue(e),i=p.getAsArray();o&&(this.defaultFontName=o),i.indexOf(t)>-1&&(this.defaultFontSize=t),this.note&&(this.note.isEmptyContent()||n&&n.setNotEmptyContent)&&this.useDefaultFontAsEditingStyle()},t.prototype.setHtmlContent=function(e,t,n,o){this._setContent(!1,e,t,n,o)},t.prototype.setXmlContent=function(e,t,n,o){this._setContent(!0,e,t,n,o)},t.prototype.showToolbar=function(){this.toolbar&&this.toolbar.isRendered&&this.toolbar.show()},t.prototype.updateFormatPainterCursorUI=function(e){this.noteView.updateFormatPainterCursorUI(e)},t.prototype.useDefaultFontAsEditingStyle=function(){this.controller.setDefaultFont(this.defaultFontName,this.defaultFontSize)},t.prototype.setPrintNote=function(e){this.toPrintPage=e},t.prototype.getPrintNote=function(){return this.toPrintPage},t.prototype.getFirstLineTextContent=function(){var e,t=this._firstNotEmptyTextBlockIndex(),n="";return-1===t?"":((e=this.note.getBlockAt(t))instanceof r?e.getRichTexts().map(function(e){for(;n.length>100;)return n;n+=e.toString().replace(/\s+/g,"")}):n=e.toPlain(),n)},t.prototype.bindEventsForController=function(){this.controller?(e.prototype.bindEventsForController.call(this),g.bubble(["yne-selection-change","yne-editing-state-change","yne-replace-image","yne-replace-attachment","yne-open-link","yne-download-attachment","yne-download-image","yne-get-entity","yne-preview-image","contextmenu","yne-show-words","yne-save-content","yne-blob-paste","yne-get-image-url","yne-need-paste","yne-require-innerlink"],this.controller,this),g.bubble({find:"yne-find"},this.controller,this)):v.warn("no controller!")},t.prototype.initialize=function(t){this.editorProps=t||{},this.editorProps.theme=this.editorProps.theme||"",$(this.editorProps.parentEl).html(""),this.editorProps.theme&&$(this.editorProps.parentEl).addClass(this.editorProps.theme),f.setUseConvert(this.editorProps.useHttpsConvert),n.bindAll(this,"_updateNoteViewWrapperSize","onResize"),this.note=u.createBlank(!0),this.noteView=new w({editor:this,inlineStyleViewMapper:S,note:this.note}),this.linkView=new b({editor:this}),this.imgTitleInput=new y({editor:this}),this.controller=new c({editor:this,imgTitleInput:this.imgTitleInput,note:this.note,noteView:this.noteView,removeLocalImg:this.editorProps.removeLocalImg}),this.toolbar=new I({editor:this}),this._initContextMenu(),this._addEventListener(),e.prototype.initialize.call(this,t),this.colorpicker=new _({editor:this}),$(this.editorProps.parentEl).append(this.colorpicker.$el),g.bubble(["color-picker-show"],this,this.colorpicker)},t.prototype.updateContainerBackground=function(e){var t=this.noteView.$el;return this.currentBackground!==e&&(e&&e!==o.DEFAULT_BACKGROUND?(t.css("background-image",'url("'+e+'")'),this.currentBackground=e):(t.css("background-image",""),this.currentBackground=o.DEFAULT_BACKGROUND),!0)},t.prototype._addEventListener=function(){this.noteView.on("blur",this._onBlur.bind(this)),this.noteView.on("focus",this._onFocus.bind(this))},t.prototype._initContextMenu=function(){var e,t,o,r=this;if(!r.contextMenu&&(e=r.contextMenu=new i({editor:r}),t=n.map(k,function(e){return e()}),e.addItems(t),r.on("contextmenu",function(t){var n=a(r);e.onContextMenu(t,n)}),v.DEBUG)){if((o=(window.ynote||{}).toString())&&o.indexOf("ObjCRuntimeObject")>-1)return;r.on("yne-context-menu",function(e,t,o){var i,r,s=[];n.each(t,function(e){if(!e.isHidden)if(2!==e.type){var t=e.isDisabled?"[":" ",n=e.isDisabled?"]":" ";s.push(t+e.index+". "+e.label+n)}else s.push("------------------")}),i="context-menu: \n"+s.join("\n"),(r=window.prompt(i))&&(r=parseInt(r,10),isNaN(r)||o(r))})}},t.prototype._onBlur=function(){var e=this.controller.noteSelection;this.oldRangeWhenBlur=e.getRange()},t.prototype._onFocus=function(){var e=this.controller.noteSelection;this.oldRangeWhenBlur&&e.setRange(this.oldRangeWhenBlur)},t.prototype._setContent=function(e,t,o,i,r){var s=this,a=this,l=!0===i.isAsync,c=function(e){e.isAsync=l,a.updateContentSetProgress(e),e.percent>=1&&(a.makeReadOnly(!!a.noteProps.isReadOnly),null!=r&&r({resultCode:1}),s.getPrintNote()&&(window.print(),s.setPrintNote(!1)))};a.reset(),a.contentLoading=!0,a.updateContentSetProgress({percent:0,message:"加载中",isAsync:l}),null==i?a.noteProps=a.options||{}:(a.noteProps={},n.extend(a.noteProps,i)),a.controller.setOptions({note:a.note}),a.noteView.setOptions({isNoteSet:!0,note:a.note,pageType:a.editorProps.pageType}),a.setViewMode(a.editorProps.viewMode,!0,!1),a.setReadOnly(a.noteProps.isReadOnly),a.setBackground(a.noteProps.bgImageId),!a.noteProps.isReadOnly&&a.isCollabEnabled()&&a.makeReadOnly(!0),a.controller.setDefaultFont(a.noteProps.defaultFontName,a.noteProps.defaultFontSize),a.noteView.render(),a.updateContentSetProgress({percent:.05,isAsync:l}),e?u.fromXml(t,a.note,o,{progressCallBack:c,isAsync:l}):null==u.fromHtml(t,a.note,o,{progressCallBack:c,isAsync:l})&&(u.createBlank(!0,a.note),c({percent:1})),a.notSetContent=!1},t.prototype._updateNoteViewWrapperSize=function(){var e,t=this.$noteViewWrapper,n=$(this.editorProps.parentEl);t&&(e=$(t)).height(n.height()-this.toolbar.$el.outerHeight()-e.outerHeight()+e.height())},t.prototype._firstNotEmptyTextBlockIndex=function(){var e,t,n=this.note.blocks,o=n.length,i=-1;for(e=0;e<o;e++)if(t=n[e],T.isTextOrTableBlock(t)&&!t.isEmptyContent()){i=e;break}return i},t}(l)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(16),n(1),n(13)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.filterItems=function(e){var o=!1,i=[];return n.each(e,function(e){var s=e;switch(e&&e.simplify&&(s=e.simplify()),s.type){case r.TYPE.SPLIT:o||(o=!0,i.push(s));break;case r.TYPE.SUBMENU:s.isHidden||(o=!1,s=n.extend({},s,{items:t.filterItems(s.items)}),i.push(s));break;default:s.isHidden||(o=!1,i.push(s))}}),i},t.prototype.addItems=function(e){this.items=this.items.concat(e),n.each(e,this.prepareItem.bind(this))},t.prototype.onContextMenu=function(e,o){var i,r=this,s={left:e.pageX,top:e.pageY};r.resetAll(),n.invoke(r.items,"checkStatus",e,o||{}),i=t.filterItems(r.items),r.editor.trigger("yne-context-menu",s,i,function(e){r.select(e),r.resetAll()})},t.prototype.prepareItem=function(e){var t=e.keyHandlerName;e.index=this.indexArray.length,e.editor=this.editor,t&&!this.editor.getController().hasKeyHandler(t)&&i.error("The keyHandlerName ["+t+"] of ContextMenuItem ["+e.name+"] does not exist!"),this.indexArray.push(e),e.type===r.TYPE.SUBMENU&&n.each(e.items,this.prepareItem.bind(this))},t.prototype.resetAll=function(){var e;n.map(this.items,function(t){if((e=t.reset)&&n.isFunction(e))return e.apply(t)})},t.prototype.select=function(e){var t=this.indexArray[e];if(t&&!t.items&&t.select)return t.select()},t.prototype.initialize=function(e){this.editor=e.editor,this.items=[],this.indexArray=[]},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(2),o=n(0),i=n(46),r=n(7),s=n(14),a=n(55),l={imageBlock:function(e,n,o){var i,r=e.getNoteRange();r&&r.isInSingleBlock()&&(i=r.getStartBlockRange().block,t.isImage(i)&&(o.imgBlock=i,o.isImgAttachBlock=!0))},attachmentBlock:function(e,n,o){var i,r=e.getNoteRange();r&&r.isInSingleBlock()&&(i=r.getStartBlockRange().block,t.isAttachment(i)&&(o.attachmentBlock=i,o.isImgAttachBlock=!0))},codeBlock:function(e,n,o){var i,r=e.getNoteRange();r&&r.isInSingleBlock()&&(i=r.getStartBlockRange().block,t.isCode(i)&&(o.codeBlock=i,o.isCodeBlock=!0))},tableBlock:function(e,n,i){var r,s,l,c,u=e.getNoteRange();if(u&&u.isInSingleBlock()&&(c=(s=u.getStartBlockRange()).block,t.isTable(c))){if(!(l=s.getAsRectRange()))return;r={},l.onlyMergePointAndCell()&&(r.onlyMergePointAndCell=!0),l.isOnlyImgCell()&&o.extend(r,{cell:l.getFirstCell().cell,type:a.IMAGE}),l.isOnlyAttachCell()&&o.extend(r,{cell:l.getFirstCell().cell,type:a.ATTACHMENT}),i.tableInfo=r}},hrefInfo:function(e,t,n){var o,a,l,c,u,d,h,p,g=t.target;r(g).is(".block-view a *")&&(o=function(e,t){if(e&&e.parentNode)for(var n=e.parentNode;n;){if(n.webkitMatchesSelector&&n.webkitMatchesSelector(t))return n;n=n.parentNode}}(g,"a"))&&((a=document.createRange()).selectNodeContents(o),l=s.fromNativeRange(a,e.noteView),a.detach(),l&&l.isInSingleBlock()&&((u=(c=l.getStartBlockRange()).block)&&u.getCommonInlineStyle&&(d=u.getCommonInlineStyle("href",c)),d&&((h=function(e,t){return e=r.trim(e||""),t=r.trim(t||""),!(!e||!t)&&(e===t||i.startsWith(t,e)||i.endsWith(t,e)||i.startsWith(e,t)||i.endsWith(e,t))}(d,c.getDataAsPlain()))&&(p=u.getCommonInlineStyles(c)),n.hrefInfo={noteRange:l,href:d,hrefAsLinkText:h,commonStyles:p})))},isRangeCollapsed:function(e,t,n){var o=e.getNoteRange();o&&(n.isRangeCollapsed=o.isCollapsed())}};return function(e){var t={};return o.each(l,function(n){n(e,event,t)}),t}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(16),n(1),n(26)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.create=function(e,n,o){if(n&&e)return new t({filter:o,note:n,noteRange:e});i.error("Failed to create NoteRangeWalker, unvalid parameters",e,n,o)},t.prototype.current=function(){return this.walkerProps.blockRanges[this.walkerProps.blockRangeIndex]},t.prototype.first=function(){return this.walkerProps.blockRangeIndex=0,this._getAtIndex(this.walkerProps.blockRangeIndex)},t.prototype.last=function(){if(this._getAtIndex(this.walkerProps.endIndex),this.walkerProps.blockRangeIndex=this.walkerProps.blockRanges.length-1,-1!==this.walkerProps.blockRangeIndex)return this.walkerProps.blockRanges[this.walkerProps.blockRangeIndex]},t.prototype.next=function(){return this.walkerProps.blockRangeIndex++,this._getAtIndex(this.walkerProps.blockRangeIndex)},t.prototype.previous=function(){return this.walkerProps.blockRangeIndex--,this._getAtIndex(this.walkerProps.blockRangeIndex)},t.prototype.reset=function(){this.walkerProps.blockRangeIndex=-1},t.prototype.initialize=function(e){var t,o;e=n.defaults(e||{},{filter:function(){return!0},note:null,noteRange:null}),this.walkerProps=e,t=this.walkerProps.note=e.note,o=this.walkerProps.noteRange=e.noteRange,this.walkerProps.filter=e.filter,this.walkerProps.startRange=o.getStartBlockRange(),this.walkerProps.endRange=o.getEndBlockRange(),this.walkerProps.startIndex=t.getBlockIndex(this.walkerProps.startRange.block),this.walkerProps.endIndex=t.getBlockIndex(this.walkerProps.endRange.block),this.walkerProps.blockIndex=this.walkerProps.startIndex-1,this.walkerProps.blockRanges=[],this.walkerProps.blockRangeIndex=-1},t.prototype._getAtIndex=function(e){var t,n,o,i;if(o=this.walkerProps.blockRanges[e])return o.clone(!0);if(!this._hasWalked()){for(i=this.walkerProps.blockIndex+1;i<=this.walkerProps.endIndex&&(this.walkerProps.blockIndex=i,this.walkerProps.startIndex!==this.walkerProps.endIndex?i===this.walkerProps.startIndex?(t=this.walkerProps.startRange.clone(!0)).extendToBlockEnd():i===this.walkerProps.endIndex?(t=this.walkerProps.endRange.clone(!0)).extendToBlockStart():(n=this.walkerProps.note.getBlockAt(i),t=r.createRangeByBlock({allContent:!0,block:n})):t=this.walkerProps.startRange.clone(!0),!(!0===this.walkerProps.filter(t)&&(this.walkerProps.blockRanges.push(t),o=this.walkerProps.blockRanges[e])));i++);return o}},t.prototype._hasWalked=function(){return this.walkerProps.blockIndex>=this.walkerProps.endIndex},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(67),n(127),n(16),n(1)],void 0===(i=function(e,t,n,o,i,r,a){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.create=function(e){if(!(!e||!e.table||null==e.left||null==e.top||!e.width||!e.height||e.left<0||e.top<0||e.width<1||e.height<1))return new t(e);a.error("Failed to create RectRange",e)},t.prototype.clone=function(){var e=this.getRect();return t.create(e)},t.prototype.equals=function(e){var t=e.getRect();return this.props.table===e.getTable()&&this.props.height===t.height&&this.props.left===t.left&&this.props.top===t.top&&this.props.width===t.width},t.prototype.forEach=function(e,t){var n=this;n.forEachRow(function(o){return n.forEachColumn(function(t){return e(o,t)},t)},t)},t.prototype.forEachCell=function(e,t){var n=this,o={};n.forEach(function(t,i){var r,s=n.props.table.getCell(t,i,{findMergePointIfNeeded:!0,withPosition:!0});if(s&&(r=s.row+"-"+s.col,!0!==o[r]))return o[r]=!0,e(s.cell,s.row,s.col)},t)},t.prototype.forEachRow=function(e,t){var n;for(n=0;n<this.props.height;n++)if(!1===e(t?this.props.top+this.props.height-n:this.props.top+n))return!1},t.prototype.forEachColumn=function(e,t){var n;for(n=0;n<this.props.width;n++)if(!1===e(t?this.props.left+this.props.width-n:this.props.left+n))return!1},t.prototype.getDataAsHtml=function(){return this._getAsNewTable().toHtml()},t.prototype.getDataAsJSON=function(e){return this._getAsNewTable().toJSON(e)},t.prototype.getDataAsPlain=function(){return this._getAsNewTable().toPlain({returnString:!0})},t.prototype.getFirstCell=function(){return this.props.table.getCell(this.props.top,this.props.left,{findMergePointIfNeeded:!0,withPosition:!0})},t.prototype.getFirstCellRect=function(){return{col:this.props.left,row:this.props.top}},t.prototype.getLastCell=function(){return this.props.table.getCell(this.props.top+this.props.height-1,this.props.left+this.props.width-1,{findMergePointIfNeeded:!0,withPosition:!0})},t.prototype.getRect=function(){var e={};return e.height=this.props.height,e.left=this.props.left,e.top=this.props.top,e.width=this.props.width,e},t.prototype.getTable=function(){return this.props.table},t.prototype.isMerge=function(){},t.prototype.isOnlyAttachCell=function(){var e,t;return!(!(e=this.props.table.getCell(this.props.top,this.props.left))||!e.isAttachmentCell())&&(e.isMergePoint()?(t=e.getMergePointAttr()).width===this.props.width&&t.height===this.props.height:1===this.props.width&&1===this.props.height)},t.prototype.isOnlyImgCell=function(){var e,t;return!(!(e=this.props.table.getCell(this.props.top,this.props.left))||!e.isImageCell())&&(e.isMergePoint()?(t=e.getMergePointAttr()).width===this.props.width&&t.height===this.props.height:1===this.props.width&&1===this.props.height)},t.prototype.onlyOneCell=function(){return 1===this.props.width&&1===this.props.height},t.prototype.overlaps=function(){},t.prototype.onlyMergePointAndCell=function(){var e,t;return!!(e=this.props.table.getCell(this.props.top,this.props.left)).isMergePoint()&&(t=e.getMergePointAttr(),this.props.width===t.width&&this.props.height===t.height)},t.prototype.toJSON=function(){return this.getRect()},t.prototype.toString=function(){var e={};return e.height=this.props.height,e.left=this.props.left,e.top=this.props.top,e.width=this.props.width,"RectRange("+n.map(e,function(e,t){return t+":"+e}).join(",")+")"},t.prototype.initialize=function(e){e=e||{},this.props=this.props||{},this.props.table=e.table,this._setRect(e),this._checkBoundary(),this._fixMerge()},t.prototype._checkBoundary=function(){var e=this.props.table,t=e.getColumnCount(),n=e.getRowCount();this.props.left<0?this.props.left=0:this.props.left>=t&&(this.props.left=t-1),this.props.top<0?this.props.top=0:this.props.top>=n&&(this.props.top=n-1),this.props.width<1&&(this.props.width=1),this.props.left+this.props.width>t&&(this.props.width=t-this.props.left),this.props.height<1&&(this.props.height=1),this.props.top+this.props.height>n&&(this.props.height=n-this.props.top)},t.prototype._fixMerge=function(){this._walkToFixMergeCells({})},t.prototype._getAsNewTable=function(){var e,t,n,i,r,s=this.props.table,a=[],l=[],c=[],u=this.props.top;for(u=0;u<this.props.height;u++)for(i=[],a.push(i),t=this.props.top+u,l.push(s.getRowHeight(t)),e=0;e<this.props.width;e++)n=this.props.left+e,0===u&&c.push(s.getColumnWidth(n)),i.push(s.getCell(t,n));return(r=new o({colWidths:c,rowHeights:l,tableCells:a})).setBlockStyles(s.getBlockStyles()),r},t.prototype._markAsWalked=function(e,t){var n,o;for(n=0;n<e.width;n++)for(o=0;o<e.height;o++)t[this._makeMarkKey(e.top+o,e.left+n)]=!0},t.prototype._makeMarkKey=function(e,t){return e+","+t},t.prototype._setRect=function(e){this.props=this.props||{},this.props.height=e.height,this.props.left=e.left,this.props.top=e.top,this.props.width=e.width},t.prototype._shouldExtend=function(e,t,n){var o,r,s,l,c=this.props.table;return(!n||!n[this._makeMarkKey(e,t)])&&((s=c.getCell(e,t,{findMergePointIfNeeded:!0,withPosition:!0}))&&s.cell?(o=(l=s.cell).isMergePoint()?{height:(r=l.getMergePointAttr()).height,left:s.col,top:s.row,width:r.width}:{height:1,left:t,top:e,width:1},this._markAsWalked(o,n),!i.contains(this.props,o)&&i.union(this.props,o)):(a.warn("no table cell at row/col",e,t),!1))},t.prototype._walkToFixMergeCells=function(e){var t=this,n=function(n){var o,i,r=n?t.props.top:t.props.top+t.props.height-1;for(i=0;i<t.props.width;i++)if(o=t._shouldExtend(r,t.props.left+i,e))return o},o=function(n){var o,i,r=n?t.props.left:t.props.left+t.props.width-1;for(i=1;i<t.props.height;i++)if(o=t._shouldExtend(t.props.top+i,r,e))return o},i=n(!0)||n(!1)||o(!0)||o(!1);i&&(t._setRect(i),t._walkToFixMergeCells(e))},t}(r)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};o=[n,t,n(0),n(274),n(56),n(6),n(2),n(26),n(99),n(14),n(57),n(27),n(8),n(124),n(1),n(289)],void 0===(i=function(e,t,n,o,i,r,l,c,u,d,h,p,g,f,m,_){"use strict";return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isSessionInitDone=!1,t}return s(t,e),t.prototype.buildCollabProperties=function(){var e={};return null!=this.collabEngine?e=this.collabEngine.buildCollabProperties(null):e.coreEditor=this,e.isCollabEnabled=this.isCollabEnabled(),e},t.prototype.buildCollabSession=function(e,t){var n=this,o=e.collabServer,i=e.userInfo;null!=this.collabEngine&&(this.collabEngine.closeCollabSession(null,null),this.collabEngine=null),this._initCollabEngine(),e.collabServer=o.address,e.useWSS=!!o.useWSS,e.nickname=i.nickname,e.userId=i.userId,e.portraitUrl=i.portraitUrl,this.collabEngine.buildCollabSession(e,function(e){1===e.resultCode&&n.trigger("yne-session-built",e.isCollabStarted),t(e)})},t.prototype.canRemoveFormat=function(){throw new Error("should be overridden.")},t.prototype.closeCollabSession=function(e,t){null!=this.collabEngine&&this.collabEngine.closeCollabSession(e,t),this.collabEngine=null},t.prototype.getCollabId=function(){if(null!=this.collabEngine)return this.collabEngine.getCollabId()},t.prototype.getLastNotOwnExecCmd=function(){if(null!=this.collabEngine)return this.collabEngine.getLastNotOwnExecCmd()},t.prototype.getModifiers=function(e,t){return null!=this.collabEngine?this.collabEngine.getModifiers(e,t):{status:r.ERRORID_COLLAB_ENGINE_NULL}},t.prototype.getCollabContent=function(e,t){var n={status:0,resultCode:0},o=this;return null!=this.collabEngine?(t&&(this.isReadOnly()||this.makeReadOnly(!0),this.noteView.removeNote()),this.isContentLoading()?this.getCollabContentTimer=setTimeout(function(){o.getCollabContent(e,!1)},1e3):(n=this.collabEngine.getCollabContent(e)).status=n.resultCode,n):{status:r.ERRORID_COLLAB_ENGINE_NULL}},t.prototype.hasCachedDataCmd=function(){return null!=this.collabEngine&&this.collabEngine.hasCachedDataCmd()},t.prototype.isLastOwnDataCmdExecuted=function(){if(null!=this.collabEngine)return this.collabEngine.isLastOwnDataCmdExecuted()},t.prototype.isValidLocalDataCmd=function(e){if(null!=this.collabEngine)return this.collabEngine.isValidLocalDataCmd(e)},t.prototype.noteSetNotification=function(){var e=this;null!=this.collabEngine&&this.collabEngine.sendContentSetInfo(this.note.getFileVersion(),function(t){t.result===r.CJSON_INITIALIZE_DONE&&(e.isSessionInitDone=!0),e.trigger("yne-session-initialized",t.result,t)})},t.prototype.pushLocalDataCommand=function(e,t){null!=this.collabEngine&&this.collabEngine.pushLocalDataCommand(e,t)},t.prototype.saveNotification=function(e,t){null!=this.collabEngine&&this.collabEngine.saveNotification(e,t)},t.prototype.sendBlockLockInfo=function(e){null!=this.collabEngine&&this.collabEngine.sendOwnLockInfo(e)},t.prototype.sendCachedDataCommand=function(){null!=this.collabEngine&&this.collabEngine.sendCachedDataCmd(!1)},t.prototype.updateUserInfo=function(e){var t=this.getEditorProps();null!=e&&(n.extend(t.userInfo,e),null!=this.collabEngine&&this.collabEngine.updateSessionInfos(e))},t.prototype.applyCollabCmdRedoUndo=function(e){this.controller.cmdManager.applyCollabCmdRedoUndo(e)},t.prototype.buildNoteRangeFromJSON=function(e){return h.buildNoteRangeFromJSON(e,this)},t.prototype.createDataCommand=function(e,t){return this.controller.createCmd(e,t)},t.prototype.dropRedoCmd=function(){this.controller.cmdManager.dropRedoCmd()},t.prototype.dropUndoCmds=function(e,t,n){this.controller.cmdManager.dropUndoCmds(e,t,n)},t.prototype.getClientId=function(){return this.clientId},t.prototype.getDefaultNoteRange=function(){return this.controller.defaultNoteRange()},t.prototype.getInnerBlocksWithEdge=function(e){var t,n,o;return e&&u.isHeaderFooterRange(e.getStartBlockRange())?[e.getStartBlockRange().block]:(d.isNoteRange(e)&&(t=e.getStartBlockRange().block,n=e.getEndBlockRange().block,o=this.note.getInterBlocks(t,n,!0)),o)},t.prototype.getNextBlockById=function(e){var t=null,n=this.getBlockById(e);return n&&(t=this.note.getNextBlock(n)),t},t.prototype.getNoteVersion=function(){return this.note?this.note.getFileVersion():null},t.prototype.getPreBlockById=function(e){var t=null,n=this.getBlockById(e);return n&&(t=this.note.getPreBlock(n)),t},t.prototype.isListItem=function(e){return l.isListItem(e)},t.prototype.isNoteValidForCollab=function(){return this.controller.note.isValidForCollab()},t.prototype.isReadyForEdit=function(){return!0===this.isSessionInitDone},t.prototype.isContentLoading=function(){return!0===this.contentLoading},t.prototype.isTable=function(e){return l.isTable(e)},t.prototype.isTodo=function(e){return l.isTodo(e)},t.prototype.reset=function(){null!=this.getCollabContentTimer&&clearTimeout(this.getCollabContentTimer),e.prototype.reset.call(this)},t.prototype.setNoteVersion=function(e){m.log("SetNoteVersion:"+e),this.note.setFileVersion(e),this.trigger("yne-note-version-change",e)},t.prototype.buildBlockRangeFromJSON=function(e){var t,n;if(e&&e.blockId){if(t=e.blockId,n=this.getBlockById(t))return e.rangeType===l.CODE?c.createRangeByBlock(a({block:n},e)):c.createRangeByBlock({block:n,end:e.endPosition,rect:e.simpleValue1,start:e.startPosition,type:e.simpleValue2});m.log("block is NOT existing:",e)}else m.error("The blockRangeJSON.blockId is not valid!")},t.prototype.buildInnerCommandFromJSON=function(e,t){var o=e[r.CJSON_ACTION],i={};return i.collabProperties=n.clone(t.collabProperties),i.collabProperties.cmdJSON=e,this.createDataCommand(o,i)},t.prototype.getBlockById=function(e){return this.note.getBlockById(e)},t.prototype.getEditorProps=function(){return this.editorProps},t.prototype.getNoteProps=function(){return this.noteProps},t.prototype.getNote=function(){return this.note},t.prototype.isCollabEnabled=function(){return!(null==this.noteProps||!this.noteProps.isCollabEnabled)},t.prototype.isIdleTimeout=function(){return this.idleTimeout},t.prototype.isMyOwnLockedBlock=function(e){var t,n=!1,o=this._getMyOwnBlockId();return null!=e&&null!=o&&""!==o&&(d.isNoteRange(e)&&e.isInSingleBlock()?t=e.getStartBlockRange().getBlockId():c.isBlockRange(e)&&(t=e.getBlockId()),t&&t===o&&!this.isTable(this.getBlockById(t))&&(n=!0)),n},t.prototype.render=function(){e.prototype.render.call(this),this.isCollabEnabled()||this.updateNoteViewVisibility(!0)},t.prototype.setIdleTimeout=function(e){e&&(this.noteView.render(),this.setReadOnly(!0)),this.idleTimeout=e},t.prototype.updateEditorOptions=function(e){if(this.options||(this.options=e?n.clone(e):{}),e)for(var t in e)e.hasOwnProperty(t)&&("shareKey"===t&&this.options[t]!==e[t]&&(this.idleTimeout=!1),this.options[t]=e[t]);this.options.isCollabEnabled=f.parseToBoolean(this.options.isCollabEnabled,!0),this.options.isCollabEnabled||(this.idleTimeout=!1),this.options.hideAttendeeHint=f.parseToBoolean(this.options.hideAttendeeHint,!1),this.options.disableBackground=f.parseToBoolean(this.options.disableBackground,!1),this.options.useWSS=f.parseToBoolean(this.options.useWSS,!1),this.options.pageType=f.parseToPageType(this.options.pageType),this.options.sessionId||(this.options.sessionId=this.clientId),this.options.readOnly=f.parseToBoolean(this.options.readOnly,!1),this.options.hasOriginFile=f.parseToBoolean(this.options.hasOriginFile,!1),n.extend(this.editorProps,this.options)},t.prototype.notifyErrorToHost=function(e){this.trigger("yne-useraction-failed",e)},t.prototype.onDocSelectionChange=function(){m.log("onDocSelectionChange")},t.prototype.recoverFromIdleTimeout=function(){var e;this.idleTimeout&&this.isCollabEnabled()&&(e={code:0,customCode:8e3,shareKey:this.getCollabId()},this.trigger("yne-session-closed",e))},t.prototype.testSendMsgToCollabServer=function(e){null!=this.collabEngine&&this.collabEngine.sendMessageToCollabServer(e)},t.prototype.bindEventsForController=function(){var e=this,t=this.controller;t.on("command-exec",function(t,n){t&&t.name?e.isCollabEnabled()?((n=n||{}).collabProperties=n.collabProperties||{},n.collabProperties.finalNoteVersion&&e.setNoteVersion(n.collabProperties.finalNoteVersion),t&&t.effected&&(!n.collabProperties.isCollabCmd||n.collabProperties.isCollabCmd&&n.collabProperties.isOwnCmd&&!n.collabProperties.isLocalExecutedCmd)&&(e.contentChanged=!0,e.trigger("yne-content-change"))):t&&t.effected?(e.contentChanged=!0,e.trigger("yne-content-change")):m.warn("The command has no effected",t):m.error("The command is not valid",t)}),p.bubble(["redo-stack-change","undo-stack-change","selectstart","mouse-down","command-exec","esc","yne-clipboard-status","yne-clipboard-error","yne-get-clipboard","yne-clipboard-set","color-picker-show","yne-user-action-collection","cell-edit-view-enter","cell-edit-view-exit","cell-edit-view-history-change"],t,this)},t.prototype._getMyOwnBlockId=function(){var e=this.collabEngine.getMyOwnBlockIds();return null!=e&&e.length>0?e[0]:null},t.prototype._initCollabEngine=function(){var e=this;e.idleTimeout=!1,e.isSessionInitDone=!1,e.collabEngine=new o.default(e,n,m),e.collabEngine.on(i.default.WS_CLOSED,function(t){8e3===t.customCode&&g.IS_PC?e.setIdleTimeout(!0):e.trigger("yne-session-closed",t)}),e.collabEngine.on(i.default.DATACMD_FAILURE,function(t){e.trigger("yne-useraction-failed",t.message)}),e.collabEngine.on(i.default.DATACMD_SUCCESS,function(t){e.trigger("yne-datacommand-success",t.rawCollabJSON)}),e.collabEngine.on(i.default.LOCK_LOCKED,function(t){var n,o=t.sessionProps;null!=o&&null!=o.lockedBlkIds&&o.lockedBlkIds.length>0&&(n=o.lockedBlkIds[0],e._lockBlock(n,o))}),e.collabEngine.on(i.default.LOCK_RELEASED,function(t){e._unlockBlock(t.unlockedBlockId)}),e.collabEngine.on(i.default.SESSION_CHNAGED,function(t){null!=t&&t.length>0&&n.each(t,function(t){t.propUpdated&&null!=t.nickname&&null!=t.lockedBlkIds&&t.lockedBlkIds.length>0&&t.sessionId!==e.clientId&&(t.lockUpdated=!0,e._lockBlock(t.lockedBlkIds[0],t))}),e.trigger("yne-collabsession-change",t)})},t.prototype._lockBlock=function(e,t){var n=this.note,o=this.getBlockById(e);null==o||this.isTable(o)||n.lockBlock(e,t)},t.prototype._unlockBlock=function(e){this.note.unlockBlock(e)},t}(_)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(275),n(276),n(277),n(278),n(279),n(280),n(281),n(71),n(282),n(37),n(283),n(284),n(285),n(31),n(56)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h,p,g,f,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=function(){},b=function(e){function t(t,s,u){var d=e.call(this)||this;if(d.localCmdPerSec=0,null==s)throw new Error("Missing underscorejs");if(null==u)throw new Error("Missing logger instance");return h.ExternalLibs.setUnderscore(s),h.ExternalLibs.setLogger(u),d.isLocalCmdTooFast=!1,d.coreEditor=t,d.clientId=d.coreEditor.getClientId(),d.keyTranslator=new a.CollabKeyTranslator,d.collabPropsHandler=new o.CmdCollabPropsHandler(d.clientId,d.keyTranslator,d.coreEditor),d.wsClient=new f.WebSocketClient(d.collabPropsHandler),d.cmdMergeHandler=new i.CmdMergeHandler,d.nondataCmdHandler=new p.NonDataCmdHandler(d.wsClient),d.sessionHandler=new l.CollabSessionHandler(d.clientId,d.nondataCmdHandler),d.blockLockHandler=new n.BlockLockHandler(d.clientId,d.sessionHandler,d.nondataCmdHandler),d.conflictHandler=new r.CollabConfilctHandler(d.coreEditor,d.blockLockHandler),d.redoundoHandler=new g.RedoUndoHandler(d.coreEditor),d.dataCmdHandler=new c.DataCmdHandler(d.coreEditor,d.blockLockHandler,d.conflictHandler,d.redoundoHandler,d.cmdMergeHandler,d.keyTranslator,d.wsClient),d._createEventEmitter(),d}return s(t,e),t.prototype.buildCollabProperties=function(e){return this.collabPropsHandler.buildCollabProperties(e)},t.prototype.buildCollabSession=function(e,t){var n,o,i=this,r={resultCode:u.CustomResultCode.NO_ERROR};e.sessionId=this.clientId,t=t||y,null!=this.callbackBuildCollabSession&&(r.resultCode=u.CustomResultCode.STOP_CALL,r.message="StopPreviousCall",this.callbackBuildCollabSession(r)),this.callbackBuildCollabSession=function(e){clearTimeout(i.timeoutBuildCollabSession),i.wsClient.off(_.default.SESSION_INIT_BUILT,n),i.wsClient.off(_.default.WS_CLOSED,o),t(e)};try{o=function(e){h.loggerInst.log("WS_CLOSED Callback in buildCollabSession"),i.callbackBuildCollabSession(e)},this.wsClient.once(_.default.WS_CLOSED,o),n=function(e){h.loggerInst.log("SESSION_INIT_BUILT Callback in buildCollabSession"),i.callbackBuildCollabSession(e)},this.nondataCmdHandler.once(_.default.SESSION_INIT_BUILT,n),this.wsClient.connect(e),this.timeoutBuildCollabSession=setTimeout(function(){var e={resultCode:u.CustomResultCode.TIME_OUT,message:"TimeOut"};i.callbackBuildCollabSession(e)},5e3)}catch(e){r.resultCode=u.CustomResultCode.EXCEPTION,r.message=e.message||e,this.callbackBuildCollabSession(r)}},t.prototype.closeCollabSession=function(e,t,n){var o={resultCode:u.CustomResultCode.NO_ERROR};n=n||y;try{this.wsClient.close(e,t),this.blockLockHandler.destroy(),this.blockLockHandler=null,this.collabPropsHandler.destroy(),this.collabPropsHandler=null,this.conflictHandler.destroy(),this.conflictHandler=null,this.cmdMergeHandler.destroy(),this.cmdMergeHandler=null,this.dataCmdHandler.destroy(),this.dataCmdHandler=null,this.nondataCmdHandler.destroy(),this.nondataCmdHandler=null,this.redoundoHandler.destroy(),this.redoundoHandler=null,this.sessionHandler.destroy(),this.sessionHandler=null}catch(e){o.resultCode=u.CustomResultCode.EXCEPTION,o.message=e.message||e}n(o)},t.prototype.isLastOwnDataCmdExecuted=function(){return this.dataCmdHandler.isLastOwnCmdExecuted()},t.prototype.sendContentSetInfo=function(e,t){var n=this,o={collabId:this.wsClient.getCollabId(),isReadOnly:this.wsClient.isReadOnlySession(),nickname:this.wsClient.getNickname(),result:d.ConstValueInJSON.SESSION_INIT_DONE,resultCode:u.CustomResultCode.NO_ERROR,sessionId:this.wsClient.getSessionId(),userId:this.wsClient.getUserId()},i={};t=t||y,null!=this.callbackSendContentSetInfo&&(o.resultCode=u.CustomResultCode.STOP_CALL,o.message="StopPreviousCall",this.callbackSendContentSetInfo(o)),this.callbackSendContentSetInfo=function(e){clearTimeout(n.timeoutSendContentSetInfo),n.nondataCmdHandler.off(_.default.SESSION_INIT_DONE,n.callbackSendContentSetInfo),t(e)},this.coreEditor.isNoteValidForCollab()?(i.noteVersion=e,this.nondataCmdHandler.once(_.default.SESSION_INIT_DONE,this.callbackSendContentSetInfo),this.nondataCmdHandler.sendCollabNonDataCommand(u.CmdNames.NONDATACMD_CLINTPONG,i),this.timeoutSendContentSetInfo=setTimeout(function(){o.resultCode=u.CustomResultCode.TIME_OUT,null!=n.callbackSendContentSetInfo&&n.callbackSendContentSetInfo(o)},5e3)):(o.result=d.ConstValueInJSON.SESSION_INIT_INVALID,this.callbackSendContentSetInfo(o))},t.prototype.getCollabContent=function(e){var t=this,n={resultCode:0},o=function(n){n.resultCode===u.CustomResultCode.NO_ERROR&&(n.version=t.coreEditor.getNoteVersion(),n.content=t.coreEditor.getXmlContent(),n.sessionCount=t.sessionHandler.getSessionCount()),null!=t.callbackGetCollabContent&&t.dataCmdHandler.off(_.default.DATACMD_NO_PENDING,t.callbackGetCollabContent),t.callbackGetCollabContent=null,clearTimeout(t.timeoutGetCollabContent),e(n)};return e=e||y,this.coreEditor.isContentLoading()?(n.resultCode=0,o(n)):this.dataCmdHandler.hasPendingCmds()?this.wsClient.isOpened()?(n.resultCode=0,null==this.callbackGetCollabContent&&(this.callbackGetCollabContent=function(e){null==e&&(e={resultCode:u.CustomResultCode.NO_ERROR}),o(e)},this.dataCmdHandler.once(_.default.DATACMD_NO_PENDING,this.callbackGetCollabContent),this.timeoutGetCollabContent=setTimeout(function(){n.resultCode=u.CustomResultCode.TIME_OUT,n.message="TimeOut",null!=t.callbackGetCollabContent&&t.callbackGetCollabContent(n)},6e4))):(n.resultCode=u.WSCustomCode.COLLAB_SESSION_CLOSED,o(n)):(n.resultCode=u.CustomResultCode.NO_ERROR,o(n)),n},t.prototype.getModifiers=function(e,t){var n=this,o={status:0,resultCode:u.CustomResultCode.NO_ERROR};return t=t||y,null!=this.callbackGetModifiers&&(o.resultCode=u.CustomResultCode.STOP_CALL,o.status=2,o.message="StopPreviousCall",this.callbackGetModifiers(o)),this.callbackGetModifiers=function(e){n.nondataCmdHandler.off(_.default.NONDATACMD_MODIFIERS_RESULT,n.callbackGetModifiers),n.callbackGetModifiers=null,clearTimeout(n.timeoutGetModifiers),t(e)},0!==(o=this.nondataCmdHandler.getModifiers(e)).status?(t(o),o):(this.nondataCmdHandler.once(_.default.NONDATACMD_MODIFIERS_RESULT,this.callbackGetModifiers),this.timeoutGetModifiers=setTimeout(function(){null!=n.callbackGetModifiers&&(o.resultCode=u.CustomResultCode.TIME_OUT,o.status=2,o.message="TimeOut",n.callbackGetModifiers(o))},5e3),o)},t.prototype.saveNotification=function(e,t){var n={};n.noteVersion=e,n.isHistorySave=!!t,this.nondataCmdHandler.sendCollabNonDataCommand(u.CmdNames.NONDATACMD_NOTESAVE,n)},t.prototype.getLastNotOwnExecCmd=function(){return this.dataCmdHandler.getLastNotOwnExecCmd()},t.prototype.getMyOwnBlockIds=function(){return this.blockLockHandler.getOwnBlockIds()},t.prototype.sendOwnLockInfo=function(e){var t={};t.lockedBlockId=e,t.sessionId=this.clientId,this.nondataCmdHandler.sendCollabNonDataCommand(u.CmdNames.NONDATACMD_COLLABINFO,t)},t.prototype.sendCachedDataCmd=function(e){this.dataCmdHandler.sendCachedDataCommand(e)},t.prototype.hasCachedDataCmd=function(){return this.dataCmdHandler.hasPendingCmds()},t.prototype.pushLocalDataCommand=function(e,n){var o=u.CustomResultCode.NO_ERROR;return(o=this.dataCmdHandler.pushLocalDataCommand(e,n))===u.CustomResultCode.NO_ERROR&&1===this.dataCmdHandler.getCachedCmdCount()&&(this._checkCommandSendDelay(),this._updateCmdSpeed(!0)),o===u.CustomResultCode.NO_ERROR&&e.isLocalExecutedCmd&&(this.localCmdPerSec++,this.localCmdPerSec>t.LACAL_CMD_SPEED_LIMITATION&&(this.isLocalCmdTooFast=!0)),o},t.prototype.isValidLocalDataCmd=function(e){var t=!0,n={closeSession:!1,resultCode:u.CustomResultCode.NO_ERROR};return t&&(t=this._isLocalCommandTooFast()),t&&!1===e.isReadyToApply&&(n.message="命令不满足执行条件",n.resultCode=u.DataCmdFailureCode.LOCAL_NOT_READY_APPLY,this.emit(_.default.DATACMD_FAILURE,n),t=!1),t&&!this.wsClient.isOpened()&&(n.resultCode=u.WSCustomCode.SESSION_NOT_OPENED,n.message="协同链接已断开",this.emit(_.default.DATACMD_FAILURE,n),t=!1),t&&!this.coreEditor.isNoteValidForCollab()&&(n.resultCode=u.DataCmdFailureCode.LOCAL_INVALID_FOR_COLLAB,n.message="笔记不满足协同条件",this.emit(_.default.DATACMD_FAILURE,n),t=!1),t&&!e&&(n.message="空的本地命令，已被忽略",n.resultCode=u.DataCmdFailureCode.LOCAL_EMPTY_CMD,this.emit(_.default.DATACMD_FAILURE,n),t=!1),!t||e.isCollabRedo||e.isCollabUndo||(t=!this._isLocalCommandConflict(e)),t&&(e.isCollabRedo||e.isCollabUndo)&&!1===(t=this.redoundoHandler.ValidateLocalRedoUndo(e))&&(n.message="目标区域已经被修改，不能撤销或重做",n.resultCode=u.DataCmdFailureCode.LOCAL_DIRTY_BLOCKS,this.emit(_.default.DATACMD_FAILURE,n)),t},t.prototype.updateSessionInfos=function(e){this.nondataCmdHandler.sendCollabNonDataCommand(u.CmdNames.NONDATACMD_COLLABINFO,e)},t.prototype.sendMessageToCollabServer=function(e){this.wsClient.send(e)},t.prototype.getCollabId=function(){return this.wsClient.getCollabId()},t.prototype._sendDataCmdFailedMessage=function(e,t){var n={};n.errToClose=t,n.dataCmdErrorCode=e.toString(),this.nondataCmdHandler.sendCollabNonDataCommand(u.CmdNames.NONDATACMD_DATACMDFAILED,n)},t.prototype._createEventEmitter=function(){var e=this;e.wsClient.on(_.default.WS_CLOSED,function(t){e.emit(_.default.WS_CLOSED,t)}),e.nondataCmdHandler.on(_.default.SESSION_INIT_BUILT,function(t){e.emit(_.default.SESSION_INIT_BUILT,t)}),e.nondataCmdHandler.on(_.default.SESSION_INIT_DONE,function(t){e.emit(_.default.SESSION_INIT_DONE,t)}),e.sessionHandler.on(_.default.SESSION_CHNAGED,function(t){h.underscoreInst.each(t,function(t){if(t.propUpdated){var n=e.blockLockHandler.getLockedBlockIdsBy(t.sessionId);null!=n&&n.length>0&&(t.lockedBlkIds=n)}}),e.emit(_.default.SESSION_CHNAGED,t)}),e.blockLockHandler.on(_.default.LOCK_LOCKED,function(t){var n;t.sessionProps&&t.sessionProps.lockedBlkIds&&t.sessionProps.lockedBlkIds.length>0&&(n=t.sessionProps.lockedBlkIds[0]),null!=n&&(t.sessionId===e.wsClient.getSessionId()?e.sendOwnLockInfo(n):e.emit(_.default.LOCK_LOCKED,t))}),e.blockLockHandler.on(_.default.LOCK_RELEASED,function(t){t.sessionId!==e.wsClient.getSessionId()&&e.emit(_.default.LOCK_RELEASED,t)}),e.dataCmdHandler.on(_.default.DATACMD_FAILURE,function(t){e._sendDataCmdFailedMessage(t.resultCode,t.closeSession),e.emit(_.default.DATACMD_FAILURE,t)}),e.dataCmdHandler.on(_.default.DATACMD_SUCCESS,function(t){e.emit(_.default.DATACMD_SUCCESS,t)})},t.prototype._checkCommandSendDelay=function(){!this.isLocalCmdTooFast&&null!=this.dataCmdHandler&&this.dataCmdHandler.getCmdDelay()>t.MAX_CMD_DELAY_MILLIS?this.wsClient.close(u.WSCustomCode.FAILED_SEND_LOCAL_CMD,"ExceedMaxSendDelay"):null!=this.dataCmdHandler&&this.dataCmdHandler.getCachedCmdCount()>0&&this.wsClient.isOpened()&&window.setTimeout(this._checkCommandSendDelay.bind(this),t.MAX_CMD_DELAY_MILLIS)},t.prototype._isLocalCommandConflict=function(e){var t=!1,n=e.getStartingRange(),o=e.getCollabProps();if(n&&(t=this.conflictHandler.isNoteRangeConflict(n,e.name,o))){var i={closeSession:o.errorToClose,message:o.dataCmdError,resultCode:o.errorCode};this.emit(_.default.DATACMD_FAILURE,i)}return t},t.prototype._isLocalCommandTooFast=function(){var e=!0,t=this.dataCmdHandler.getCachedCmdCount();if(this.isLocalCmdTooFast&&t>0){e=!1;var n={closeSession:!1,message:"命令输入过快，等待执行命令个数："+(t=this.dataCmdHandler.getCachedCmdCount()),resultCode:u.DataCmdFailureCode.LOCAL_CMD_TOO_FAST};this.emit(_.default.DATACMD_FAILURE,n),this.sendCachedDataCmd(!1)}return e},t.prototype._updateCmdSpeed=function(e){var n,o=0;null!=this.dataCmdHandler&&(o=this.dataCmdHandler.getCachedCmdCount()),e&&(this.isLocalCmdTooFast=!1),o>0?((n=o/t.LACAL_CMD_SPEED_LIMITATION)<1&&(n=1),this.localCmdPerSec=0,this.wsClient.isOpened()&&window.setTimeout(this._updateCmdSpeed.bind(this,!1),1e3*n)):this.isLocalCmdTooFast=!1},t.LACAL_CMD_SPEED_LIMITATION=20,t.MAX_CMD_DELAY_MILLIS=4e3,t}(m.YEvent);t.default=b}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(71),n(37),n(31),n(56)],void 0===(i=function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,n,o){var i=e.call(this)||this;if(null==t)throw new Error("ownSID cannot be null in BlockLockHandler");return i.lockedBlocksMap={},i.sessionId=t,i.sessionHandler=n,i.nonDataCmdHandler=o,i.sessionHandler.on(r.default.SESSION_LOCK_UPDATE,i._onSessionLockChanged.bind(i)),i.sessionHandler.on(r.default.SESSION_QUIT,i._onSessionQuit.bind(i)),i.nonDataCmdHandler.on(r.default.LOCK_RELEASED,function(e){i._releaseLockOf(e.sessionId)}),i}return s(t,e),t.prototype.destroy=function(){this.lockedBlocksMap=null,this.sessionHandler=null,this.nonDataCmdHandler=null,this.removeAllListeners(null)},t.prototype.isBlockLockedBy=function(e,t){var n,o=!1;return null!=e&&null!=t&&null!=(n=this.lockedBlocksMap[e])&&n===t&&(o=!0),o},t.prototype.getOwnBlockIds=function(){var e=this,t=[];return o.underscoreInst.each(this.lockedBlocksMap,function(n,o){n===e.sessionId&&t.push(o)}),t},t.prototype.getLockedBlockIdsBy=function(e){var t=[];return o.underscoreInst.each(this.lockedBlocksMap,function(n,o){e===n&&t.push(o)}),t},t.prototype.updateLockByDataCmd=function(e){var t,n=e.getCollabProps();if(null!=(t=e.isCollabUndo?e.getStartingRange():e.getEndingRange())){var o=t.getEndBlockRange();if(null!=o){var i=o.block.getId();if(null!=i&&(this._releaseLockOf(n.cmdSessionId),null==this.lockedBlocksMap[i])){var r=this.sessionHandler.getSessionPropertiesBy(n.cmdSessionId);null!=r&&(r.lockedBlkIds=[i],this._lockBlock(r))}}}},t.prototype._releaseLockOf=function(e){var t=this,n=[];o.underscoreInst.each(this.lockedBlocksMap,function(t,o){t===e&&n.push(o)}),o.underscoreInst.each(n,function(n){t._unlockBlock(n,e)})},t.prototype._onSessionQuit=function(e){this._releaseLockOf(e.sessionId)},t.prototype._onSessionLockChanged=function(e){var t=this,n=!1;o.underscoreInst.each(e,function(e){n=!1,null!=e.lockedBlkIds&&e.lockedBlkIds.length>0&&(o.underscoreInst.some(e.lockedBlkIds,function(o){return t.lockedBlocksMap[o]!==e.sessionId&&(n=!0),n}),n&&(t._releaseLockOf(e.sessionId),t._lockBlock(e)))})},t.prototype._unlockBlock=function(e,t){delete this.lockedBlocksMap[e];var o={resultCode:n.CustomResultCode.NO_ERROR,sessionId:t,unlockedBlockId:e};this.emit(r.default.LOCK_RELEASED,o)},t.prototype._lockBlock=function(e){var t=this,n={resultCode:1,sessionId:e.sessionId,sessionProps:e},i=!1;o.underscoreInst.each(e.lockedBlkIds,function(n){t.lockedBlocksMap[n]!==e.sessionId&&(t.lockedBlocksMap[n]=e.sessionId,i=!0)}),i&&this.emit(r.default.LOCK_LOCKED,n)},t}(i.YEvent);t.BlockLockHandler=a}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(31)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n,o){var i=e.call(this)||this;return i.clientId=t,i.collabKeyTranslator=n,i.coreEditor=o,i}return s(t,e),t.prototype.destroy=function(){this.removeAllListeners(null)},t.prototype.buildCollabProperties=function(e){var t,n,o,i,r={coreEditor:this.coreEditor,isCollabEnabled:this.coreEditor.isCollabEnabled()};return e?(r.cmdSessionId=e.sessionId,t=r.cmdSessionId===this.clientId,r.isOwnCmd=t,r.finalNoteVersion=parseInt(e.finalVersion,10),r.ownerName=e.cmdOwner,r.isCollabEnabled=!0,r.isCollabCmd=!0,r.isServerCmd=!1,(n=e.collabCmds).nondataCmds?i=n.nondataCmds[0]:(this.collabKeyTranslator.decode(n),o=n.dataCommands[0]),null!=i?r.isServerCmd=!0===i.isServerCmd:null!=o&&(r.isLocalExecutedCmd=!0===o.isLocalExecutedCmd,r.cmdId=o.cmdId)):r.cmdSessionId=this.clientId,r},t}(n.YEvent);t.CmdCollabPropsHandler=o}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(37),n(31)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return e.call(this)||this}return s(t,e),t.prototype.destroy=function(){this.removeAllListeners(null)},t.prototype.mergeLocalCommands=function(e){var t,o,i=null,r=0;if(e&&e.length>0)if(1===e.length)i=e[0];else{for(i=e.shift();e.length>0&&(t=e[0],i.canBeMerged(t));)n.loggerInst.log("merge pending command:",i,t),i.mergeLocalCmd(t),e.shift(),r++;r>0&&e[0]&&e[0].isCollabUndo&&((o=n.underscoreInst.clone(i)).isLocalExecutedCmd=e[0].isLocalExecutedCmd,o.setCollabUndo(!0),o.setCollabRedo(!1),e[0]=o),e.unshift(i)}},t}(o.YEvent);t.CmdMergeHandler=i}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(2),n(71),n(37),n(31)],void 0===(i=function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,n){var o=e.call(this)||this;return o.coreEditor=t,o.lockHandler=n,o}return s(t,e),t.prototype.destroy=function(){this.lockHandler=null,this.removeAllListeners(null)},t.prototype.isConflictWithOwnLockedBlock=function(e,t,n){var r,s,a,l,c=this.lockHandler.getOwnBlockIds(),u=!1;return null!=c&&c.length>0&&(l=c[0]),i.loggerInst.log("LOCK/UNLOCK: isConflictWithOwnLockedBlock Enter"),"comp.AppendBlank"!==t&&l&&((r=this.coreEditor.getBlockById(l))&&!this.coreEditor.isTable(r)&&((s=this.coreEditor.getInnerBlocksWithEdge(e))&&0!==s.length?i.underscoreInst.some(s,function(e){return e.getId()===l&&(n.collabProperties.dataCmdError="协同命令执行失败：编辑目标段落被锁定",n.collabProperties.errorToClose=!!n.collabProperties.isLocalExecutedCmd,n.collabProperties.errorCode=o.DataCmdFailureCode.COLLAB_TARGET_BLOCK_LOCKED,u=!0),u}):i.loggerInst.warn("Failed to get the blocks from range",e)),u||null==n.dropRange||null==n.dropRange.block||(a=n.dropRange.block.getId())&&(u=a===l)&&(n.collabProperties.dataCmdError="协同命令执行失败：拖拽目标段落被锁定",n.collabProperties.errorToClose=!!n.collabProperties.isLocalExecutedCmd,n.collabProperties.errorCode=o.DataCmdFailureCode.COLLAB_TARGET_BLOCK_LOCKED)),i.loggerInst.log("LOCK/UNLOCK: isConflictWithOwnLockedBlock Exit"),u},t.prototype.isNoteRangeConflict=function(e,t,n){var r,s,a,l,c,u=this,d=!1;return i.loggerInst.log("LOCK/UNLOCK: isNoteRangeConflict Enter"),s=n.cmdSessionId,c=!n.isCollabCmd||n.isOwnCmd,"comp.AppendBlank"!==t&&"ManagerAdapter"!==t&&((r=this.coreEditor.getInnerBlocksWithEdge(e))&&0!==r.length?(i.underscoreInst.some(r,function(e){return i.loggerInst.log("LOCK/UNLOCK: "+e.getId()+" LockState:"+e.isLocked()),e.isLocked()&&(d=c||!u.lockHandler.isBlockLockedBy(e.getId(),s))&&(n.dataCmdError="目标段落已被其他用户锁定",n.isCollabCmd?(n.errorToClose=!!n.isLocalExecutedCmd,n.errorCode=o.DataCmdFailureCode.COLLAB_TARGET_BLOCK_LOCKED):n.errorCode=o.DataCmdFailureCode.LOCAL_TARGET_BLOCK_LOCKED),d}),d||(d=this._isConflictWithNeighborBlock(t,e,n))):(n.dataCmdError="目标段落不存在",n.isCollabCmd?(n.errorToClose=!0,n.errorCode=o.DataCmdFailureCode.COLLAB_BLOCKS_MISSING):n.errorCode=o.DataCmdFailureCode.LOCAL_BLOCKS_MISSING,d=!0),d||null==n.cmdJSON||null==n.cmdJSON.dropRange||((a=n.cmdJSON.dropRange.blockId)&&(l=this.coreEditor.getBlockById(a)),l&&l.isLocked()&&(d=c||!this.lockHandler.isBlockLockedBy(a,s)))),i.loggerInst.log("LOCK/UNLOCK: isNoteRangeConflict Exit"),d},t.prototype._isConflictWithNeighborBlock=function(e,t,r){var s,a,l,c,u=r.cmdSessionId,d=!1;if(!t)return i.loggerInst.warn("_isConflictWithNeighborBlock:noteRange should not be null"),!1;switch(s=t.getStartBlockRange(),a=!r.isCollabCmd||r.isOwnCmd,e){case"comp.KeyBackspace":s&&n.isTextBlock(s.block)&&0===s.start&&!this.coreEditor.isTodo(s.block)&&(l=this.coreEditor.getPreBlockById(s.getBlockId()))&&t.isCollapsed()&&!this.coreEditor.isListItem(s.block)&&0===s.block.getBlockStyle("text-indent")&&l.isLocked()&&(d=a||!this.lockHandler.isBlockLockedBy(l.getId(),u))&&(r.dataCmdError="目标段落已被其他用户锁定",r.isCollabCmd?(r.errorToClose=!0,r.errorCode=o.DataCmdFailureCode.COLLAB_TARGET_BLOCK_LOCKED):r.errorCode=o.DataCmdFailureCode.LOCAL_TARGET_BLOCK_LOCKED);break;case"comp.KeyDelete":t.isCollapsed()&&n.isTextBlock(s.block)&&s.end===s.block.getLength(!1)&&(c=this.coreEditor.getNextBlockById(s.getBlockId()))&&c.isLocked()&&(d=a||!this.lockHandler.isBlockLockedBy(c.getId(),u))&&(r.dataCmdError="目标段落已被其他用户锁定",r.isCollabCmd?(r.errorToClose=!0,r.errorCode=o.DataCmdFailureCode.COLLAB_TARGET_BLOCK_LOCKED):r.errorCode=o.DataCmdFailureCode.LOCAL_TARGET_BLOCK_LOCKED)}return d},t}(r.YEvent);t.CollabConfilctHandler=a}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(37),n(31)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.KEY_MAP_DECODE={a:{key:"sessionId",type:0},b:{key:"finalVersion",type:0},c:{key:"cmdOwner",type:0},d:{key:"collabCmds",type:1},e:{key:"dataCommands",type:1},f:{key:"action",type:0},g:{key:"cmdId",type:0},h:{key:"nondataCmds",type:1},i:{key:"updateVersion",type:0},j:{key:"startNoteRange",type:1},k:{key:"startBlockRange",type:1},l:{key:"rangeType",type:0},m:{key:"startPosition",type:0},n:{key:"endPosition",type:0},o:{key:"isInSingleBlock",type:0},p:{key:"cmdNoteVersion",type:0},q:{key:"isLocalExecutedCmd",type:0},r:{key:"skipBlockLocking",type:0},s:{key:"blockId",type:0},t:{key:"richText",type:0},u:{key:"newBlkId",type:0},v:{key:"inlineStyles",type:0},w:{key:"blockStyles",type:0},x:{key:"newStartBlkId",type:0},y:{key:"newEndBlkId",type:0},z:{key:"dropRange",type:1},0:{key:"colNums",type:0},1:{key:"rowNums",type:0},2:{key:"simpleValue1",type:0},3:{key:"src",type:0},4:{key:"simpleValue2",type:0},5:{key:"recogLink",type:0},6:{key:"attachRes",type:0},7:{key:"fileName",type:0},8:{key:"fileLen",type:0},9:{key:"innerCmds",type:1},A:{key:"affectedBlockIds",type:0},B:{key:"endNoteRange",type:1},C:{key:"isCollabUndo",type:0},D:{key:"preBlockId",type:0},E:{key:"deletedBlocks",type:0},F:{key:"insertedBlocks",type:0},G:{key:"isCollabRedo",type:0},H:{key:"resIds",type:0},J:{key:"dataBefore",type:0},K:{key:"dataAfter",type:0},L:{key:"endBlockRange",type:1},N:{key:"blockIds",type:0},O:{key:"styleNameValues",type:0},P:{key:"oldStyleNameValues",type:0},Q:{key:"abstractSimpleValue1",type:0},R:{key:"indentStep",type:0},S:{key:"listId",type:0},T:{key:"listType",type:0},U:{key:"abstractSimpleValue2",type:0},V:{key:"oldLevels",type:0},W:{key:"newLevels",type:0},X:{key:"listItemIds",type:0},Y:{key:"headerFooterInfo",type:0},aa:{key:"selectWholeBlock",type:0},ab:{key:"startLineIndex",type:0},ac:{key:"startLineCharIndex",type:0},ad:{key:"endLineCharIndex",type:0},ae:{key:"endLineIndex",type:0}},t._assembleEncodeMap(),t}return s(t,e),t.prototype.destroy=function(){},t.prototype.decode=function(e){var t,o=this;if(!1!==this.isValidKeyMap){if(n.underscoreInst.isArray(e))n.underscoreInst.each(e,function(e){o.decode(e)});else if(null!==e&&"object"==typeof e)for(var i=0,r=n.underscoreInst.keys(e);i<r.length;i++){var s=r[i];e.hasOwnProperty(s)&&(s in this.KEY_MAP_DECODE&&(e[t=this.KEY_MAP_DECODE[s].key]=e[s],delete e[s],null!==e[t]&&"object"==typeof e[t]&&1===this.KEY_MAP_DECODE[s].type&&this.decode(e[t])))}}else n.loggerInst.error("KeyMap is not valid, skip decode.")},t.prototype.encode=function(e){var t,o=this;if(!1!==this.isValidKeyMap){if(n.underscoreInst.isArray(e))n.underscoreInst.each(e,function(e){o.encode(e)});else if(null!==e&&"object"==typeof e)for(var i=0,r=n.underscoreInst.keys(e);i<r.length;i++){var s=r[i];e.hasOwnProperty(s)&&(s in this.KEY_MAP_ENCODE?(e[t=this.KEY_MAP_ENCODE[s].key]=e[s],delete e[s],null!==e[t]&&"object"==typeof e[t]&&1===this.KEY_MAP_ENCODE[s].type&&this.encode(e[t])):(n.loggerInst.log("key:",typeof s),n.loggerInst.error('Key - "',s,'" does NOT exist in COLLAB_MAP_ENCODE!')))}}else n.loggerInst.error("KeyMap is not valid, skip encode.")},t.prototype._assembleEncodeMap=function(){var e,t;for(t in this.isValidKeyMap=!0,this.KEY_MAP_ENCODE={},this.KEY_MAP_DECODE)if(this.KEY_MAP_DECODE.hasOwnProperty(t)){if(e=this.KEY_MAP_DECODE[t].key,n.underscoreInst.has(this.KEY_MAP_DECODE,e)){this.isValidKeyMap=!1,n.loggerInst.error("original JSON key is conflict with encoded key, please rename it",e);break}if(n.underscoreInst.has(this.KEY_MAP_ENCODE,e)){this.isValidKeyMap=!1,n.loggerInst.error("original JSON key is duplicated, please rename them",e);break}this.KEY_MAP_ENCODE[e]={},this.KEY_MAP_ENCODE[e].key=t,this.KEY_MAP_ENCODE[e].type=this.KEY_MAP_DECODE[t].type}},t}(o.YEvent);t.CollabKeyTranslator=i}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(37),n(31),n(56)],void 0===(i=function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n){var o=e.call(this)||this;return o.sessionsMap={},o.nondataCmdHandler=n,o.nondataCmdHandler.on(i.default.SESSION_CHNAGED,o._onSessionChanged.bind(o)),o.nondataCmdHandler.on(i.default.SESSION_QUIT,o._onSessionQuit.bind(o)),o}return s(t,e),t.prototype.destroy=function(){this.sessionsMap=null,this.removeAllListeners(null)},t.prototype.getSessionCount=function(){return n.underscoreInst.size(this.sessionsMap)},t.prototype.getSessionPropertiesBy=function(e){var t=this.sessionsMap[e];if(t)return n.underscoreInst.clone(t)},t.prototype._onSessionChanged=function(e){var t,o,r=this,s=[],a=[],l=!1;e.length>0&&(n.underscoreInst.each(this.sessionsMap,function(e){e.propUpdated=!1,s.push(e)}),n.underscoreInst.each(e,function(e){if(null==r.sessionsMap[e.sessionId]&&(r.sessionsMap[e.sessionId]={sessionId:e.sessionId},s.push(r.sessionsMap[e.sessionId]),l=!0),o=e.lockedBlkIds,delete e.lockedBlkIds,(t=r.sessionsMap[e.sessionId]).propUpdated=!1,n.underscoreInst.each(Object.keys(e),function(n){t[n]!==e[n]&&(t[n]=e[n],t.propUpdated=!0,l=!0)}),null!=o&&o.length>0){var i={lockedBlkIds:o,sessionId:e.sessionId};n.underscoreInst.defaults(i,t),a.push(i)}}),l&&this.emit(i.default.SESSION_CHNAGED,s),a.length>0&&this.emit(i.default.SESSION_LOCK_UPDATE,a))},t.prototype._onSessionQuit=function(e){var t=[];delete this.sessionsMap[e.sessionId],this.emit(i.default.SESSION_QUIT,e),n.underscoreInst.each(this.sessionsMap,function(e){e.propUpdated=!1,t.push(e)}),this.emit(i.default.SESSION_CHNAGED,t)},t}(o.YEvent);t.CollabSessionHandler=r}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(71),n(37),n(129),n(31),n(56)],void 0===(i=function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t,n,o,i,r,s,l){var c=e.call(this)||this;return c.regularCmdSendIntervalMS=2e3,c.pendingSentCmdsQueue=[],c.coreEditor=t,c.blockLockHandler=n,c.conflictHandler=o,c.redoundoHandler=i,c.cmdMergeHandler=r,c.keyTranslator=s,c.wsClient=l,c.callbackWSOnMessage=c._execCollabDataCommand.bind(c),c.wsClient.on(a.default.WS_MESSAGE,c.callbackWSOnMessage),c}return s(t,e),t.prototype.destroy=function(){this.wsClient.off(a.default.WS_MESSAGE,this.callbackWSOnMessage),this.wsClient=null,this.removeAllListeners(null),this.pendingSentCmdsQueue=[]},t.prototype.getLastNotOwnExecCmd=function(){return this.lastNotOwnExecCmd},t.prototype.hasPendingCmds=function(){return this.pendingSentCmdsQueue&&this.pendingSentCmdsQueue.length>0},t.prototype.isLastOwnCmdExecuted=function(){var e=!0;return this.pendingSentCmdsQueue.length>0&&(e=this.pendingSentCmdsQueue[0].isLocalExecutedCmd),e},t.prototype.getCachedCmdCount=function(){return this.pendingSentCmdsQueue.length},t.prototype.getCmdDelay=function(){var e=this.pendingSentCmdsQueue[0],t=0;return null!=e&&null!=e.sendingToCollabServerMillis&&(t=Date.now()-e.sendingToCollabServerMillis),t},t.prototype.pushLocalDataCommand=function(e,t){var i=n.CustomResultCode.NO_ERROR;return e.isLocalExecutedCmd||0!==this.pendingSentCmdsQueue.length||(o.loggerInst.log("Process: sending non-local-executed first command"),i=this._sendCollabDataCommand(e,!1)),!t&&e.isLocalExecutedCmd&&0===this.pendingSentCmdsQueue.length&&(o.loggerInst.log("Process: delay sending local-executed first command"),this.sendCachedDataCommand(!0)),i===n.CustomResultCode.NO_ERROR&&(this.pendingSentCmdsQueue.push(e),!this.pendingSentCmdsQueue[0].sendingToCollabServerMillis&&(t||this.pendingSentCmdsQueue.length>1&&!e.isLocalExecutedCmd)&&(i=this.sendCachedDataCommand(!1)),o.loggerInst.log("Process: enqueue Command:(len:"+this.pendingSentCmdsQueue.length+")",e)),!0===e.isLocalExecutedCmd&&this.blockLockHandler.updateLockByDataCmd(e),i},t.prototype.sendCachedDataCommand=function(e){var t=n.CustomResultCode.NO_ERROR;return e?this.cmdSendingTimer=setTimeout(this._dispatchCachedDataCommand.bind(this),this.regularCmdSendIntervalMS):(clearTimeout(this.cmdSendingTimer),t=this._dispatchCachedDataCommand()),t},t.prototype._execCollabDataCommand=function(e){var t,n=e.collabCmdsJSON,i=e.collabProps,r={collabProperties:i};try{if(this.keyTranslator.decode(n),null==n.dataCommands)return null;if(null!=this.lastCmdId&&this.lastCmdId===i.cmdId)return null;null!=i.cmdId&&(this.lastCmdId=i.cmdId);var s=n.dataCommands[0],l=s.action,c=this.coreEditor.getDefaultNoteRange(),u=!1,d=void 0,h=void 0,p=void 0;d=this.coreEditor.getNoteRange(),r.collabProperties.cmdJSON=s,this._validateCollabDataCmd(n,r)&&(t=this._executeDataCommand(l,r)),!r.collabProperties.isOwnCmd&&"comp.DeleteNoteRange"===l&&r.range.isInSingleBlock()&&d.isInSingleBlock()&&(p=r.range.getStartBlockRange().block,h=d.getStartBlockRange().block,this.coreEditor.isTable(p)&&h.getId()===p.getId()&&(u=!0)),u&&c&&this.coreEditor.setNoteRange(c),this._postCollabDataCmdExecution(t,r)}catch(e){o.loggerInst.error(e)}finally{this.pendingSentCmdsQueue.length>0?this.sendCachedDataCommand(!1):this.emit(a.default.DATACMD_NO_PENDING)}return t},t.prototype._dispatchCachedDataCommand=function(){for(var e,t;this.pendingSentCmdsQueue.length>0&&(o.loggerInst.log("Process: sending cached command from queue"),e=this.pendingSentCmdsQueue[0],this.cmdMergeHandler.mergeLocalCommands(this.pendingSentCmdsQueue),(t=this._sendCollabDataCommand(e,!0))!==n.CustomResultCode.NO_ERROR)&&!e.isLocalExecutedCmd;)o.loggerInst.warn("skip failed-sent command and try next",e),this.pendingSentCmdsQueue.shift();return t},t.prototype._sendCollabDataCommand=function(e,t){var i,r,s,l,c=[],u={};if(t){if(e.sendingToCollabServerMillis)return o.loggerInst.warn("current cmd has been sent",e),n.CustomResultCode.NO_ERROR;if(e.isLocalExecutedCmd||e.isCollabRedo||e.isCollabUndo)o.loggerInst.log("Update-Range: NoUpdate");else{if(s=this._updateLocalCmdStartRange(e),!e.isValidStartNoteRange())return this.emit(a.default.DATACMD_FAILURE,n.DataCmdFailureCode.LOCAL_INVALID_STARTRANGE),n.DataCmdFailureCode.LOCAL_INVALID_STARTRANGE;if(s&&this.conflictHandler.isNoteRangeConflict(s,e.name,e.getCollabProps()))return o.loggerInst.log("Do NOT send Conflict Local Command"),e.getCollabProps().errorCode}}if(i=e.toCollabJSON())c[0]=i,u.dataCommands=c,o.loggerInst.log("_sendCollabDataCommand(original):",JSON.stringify(u)),this.keyTranslator.encode(u),r=JSON.stringify(u),o.loggerInst.log("_sendCollabDataCommand(compressd):",r),(l=this.wsClient.send(r))===n.CustomResultCode.NO_ERROR&&(e.sendingToCollabServerMillis=Date.now());else{l=n.DataCmdFailureCode.LOCAL_INVALID_CMDJSON;var d={closeSession:e.isLocalExecutedCmd,message:"无效的命令格式，无法协同",resultCode:l};this.emit(a.default.DATACMD_FAILURE,d)}return l===n.CustomResultCode.NO_ERROR&&e.isLocalExecutedCmd&&(o.loggerInst.log("Update-Range: set local command as last executed command"),this._setLastOwnExecutedCmd(e)),l},t.prototype._updateLocalCmdStartRange=function(e){var t;return this.lastOwnExecCmd?this.lastOwnExecCmd.isLocalExecutedCmd?o.loggerInst.log("Update-Range: last own executed command is local executed"):null!=(t=this.lastOwnExecCmd.getEndingRange())&&(e.setStartingRange(t),o.loggerInst.log("Update-Range: UpdateTo-",t.getStartBlockRange())):o.loggerInst.log("Update-Range: No last own executed command"),t},t.prototype._postCollabDataCmdExecution=function(e,t){var i,r=t.collabProperties.isLocalExecutedCmd,s=t.collabProperties.isOwnCmd;if(s&&(i=this.pendingSentCmdsQueue.shift()),t.collabProperties.dataCmdError){o.loggerInst.error(t.collabProperties.dataCmdError),e&&(e.effected||r)&&(t.collabProperties.errorToClose=!0);var l={closeSession:t.collabProperties.errorToClose,message:t.collabProperties.dataCmdError,resultCode:t.collabProperties.errorCode};return s&&this.emit(a.default.DATACMD_FAILURE,l),void(null==e&&this.coreEditor.setNoteVersion(t.collabProperties.finalNoteVersion))}if(e){if(s&&this.coreEditor.isReadyForEdit()&&(o.loggerInst.log("clear sendingToCollabServerMillis:",e,i),e.sendingToCollabServerMillis=null,i.sendingToCollabServerMillis=null,o.loggerInst.log("Process: Dequeue Command(len:"+this.pendingSentCmdsQueue.length+")")),e.setCmdFinalNoteVersion(this.coreEditor.getNoteVersion()),!s&&e.effected&&(this.redoundoHandler.pushNotOwnExecCmd(e),this.lastNotOwnExecCmd=e),s){var c={rawCollabJSON:t.collabProperties.rawWSMessage,resultCode:n.CustomResultCode.NO_ERROR};this.emit(a.default.DATACMD_SUCCESS,c),r||this._setLastOwnExecutedCmd(e)}this.blockLockHandler.updateLockByDataCmd(e)}else o.loggerInst.error("execCommand should NOT be null when no dataCmdError")},t.prototype._setLastOwnExecutedCmd=function(e){this.lastOwnExecCmd=e},t.prototype._executeDataCommand=function(e,t){var n=t.collabProperties.cmdJSON,i=n.isCollabUndo,r=n.isCollabRedo;return o.loggerInst.log("Executing "+e),i||r?this.redoundoHandler.applyCollabRedoUndo(e,t):this.coreEditor.execCommand(e,t)},t.prototype._validateCollabDataCmd=function(e,t){var r,s=t.collabProperties,a=s.cmdJSON,l=this.coreEditor.getNoteVersion(),c=s.finalNoteVersion,u=!this.coreEditor.isReadyForEdit(),d=s.isLocalExecutedCmd,h=a.startNoteRange,p=!0;return o.loggerInst.log("Executing Validation Enter"),u?0===c?(p=!1,o.loggerInst.log("Executing Validation - ignore cmd whose finalVersion is 0")):o.loggerInst.log("Executing Validation - executing unsaved cmd"):i.Utils.isCmdVersionMatchNoteVersion(c,l)?d||(r=this.coreEditor.buildNoteRangeFromJSON(h),s.isOwnCmd||(p=!this.conflictHandler.isConflictWithOwnLockedBlock(r,a.action,t)),p&&(a.isCollabUndo||a.isCollabRedo?(p=this.redoundoHandler.ValidateCollabRedoUndo(a.affectedBlockIds,a.cmdNoteVersion))||(s.errorToClose=!0,s.errorCode=n.DataCmdFailureCode.COLLAB_DIRTY_BLOCKS,s.dataCmdError="协同：目标区域已经被修改，不能撤销或重做"):p=!this.conflictHandler.isNoteRangeConflict(r,a.action,s))):(p=!1,s.errorToClose=!0,s.errorCode=n.DataCmdFailureCode.COLLAB_NOTEVERSION_MISMATCH,s.dataCmdError="命令对应版本和本地笔记版本不匹配:("+l+"/"+c+")"),o.loggerInst.log("Executing Validation Exit"),p},t}(r.YEvent);t.DataCmdHandler=l}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.SESSION_INIT_DONE="done",e.SESSION_INIT_COLLABSTARTED="collabStarted",e.SESSION_INIT_TIMEOUT="timeout",e.SESSION_INIT_INVALID="notValidForCollab",e}();t.ConstValueInJSON=n}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(71),n(37),n(129),n(31),n(56)],void 0===(i=function(e,t,n,o,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var n=e.call(this)||this;if(n.retryIntervalMilliSec=1e3,n.retryMaxCount=2,null==t)throw new Error("wsClient should NOT be null");return n.wsClient=t,n.callbackWSOnMessage=n._execCollabNondataCommand.bind(n),n.wsClient.on(a.default.WS_MESSAGE,n.callbackWSOnMessage),n}return s(t,e),t.prototype._queueCollabCmdJSON=function(e){var t;return(t=this._sendCollabJSON(e))&&(e.sendingToCollabServerMillis=Date.now(),e.retryRemainedCount=this.retryMaxCount,this.retriableCmdsQueue.push(e),null==this.retryCollabJSONDispatcher&&(this.retryCollabJSONDispatcher=setTimeout(this._handleCollabJSONRetry.bind(this),this.retryIntervalMilliSec))),t},t.prototype.destroy=function(){this.wsClient.off(a.default.WS_MESSAGE,this.callbackWSOnMessage),this.wsClient=null,this.removeAllListeners(null)},t.prototype.getModifiers=function(e){return this.wsClient.isOpened()?this.modifiers&&1===this.modifiers.status&&this.modifiers.endVersion===e||(this.modifiers={resultCode:n.CustomResultCode.NO_ERROR,status:0},this._requestModifiers(e)||(this.modifiers.status=2)):this.modifiers={resultCode:n.WSCustomCode.SESSION_NOT_OPENED,status:2},this.modifiers},t.prototype.sendCollabNonDataCommand=function(e,t){var o,i=!0;return o=this._buildCollabCmdJSON(e,t),e===n.CmdNames.NONDATACMD_GETMODIFIERS?this._isModifiersReqeustSent(t.endNoteVersion)||(this._clearRetryQueueByAction(e),i=this._queueCollabCmdJSON(o)):i=e===n.CmdNames.NONDATACMD_COLLABINFO||e===n.CmdNames.NONDATACMD_NOTESAVE?this._queueCollabCmdJSON(o):this._sendCollabJSON(o),i},t.prototype._execCollabNondataCommand=function(e){var t,o=e.collabCmdsJSON,i=e.collabProps,r=i.cmdSessionId;if(null!=o.nondataCmds){switch((t=o.nondataCmds[0]).action){case n.CmdNames.NONDATACMD_BLOCKSELECTION:break;case n.CmdNames.NONDATACMD_COLLABCLOSE:var s={resultCode:n.CustomResultCode.NO_ERROR,sessionId:r};this.emit(a.default.SESSION_QUIT,s);break;case n.CmdNames.NONDATACMD_COLLABINFO:this._handleCollabInfo(t,i);break;case n.CmdNames.NONDATACMD_SESSIONINITIALIZED:var l={collabId:this.wsClient.getCollabId(),collabVersion:t.collabVersion,isReadOnly:this.wsClient.isReadOnlySession(),nickname:this.wsClient.getNickname(),result:t.initResult,resultCode:1,sessionId:this.wsClient.getSessionId(),userId:this.wsClient.getUserId()};this.emit(a.default.SESSION_INIT_DONE,l);break;case n.CmdNames.NONDATACMD_LOCKRELEASE:var c={resultCode:n.CustomResultCode.NO_ERROR,sessionId:r,unlockedBlockId:null};this.emit(a.default.LOCK_RELEASED,c);break;case n.CmdNames.NONDATACMD_SEVERPING:this._handleServerPing(t);break;case n.CmdNames.NONDATACMD_GETMODIFIERS:this._handleModifiers(t);break;case n.CmdNames.NONDATACMD_NOTESAVE:this._handleNoteSave(t);break;default:throw new Error("unknown nondata cmd:"+t.action)}this._removeFromRetryQueue(t.cmdId)}},t.prototype._requestModifiers=function(e){var t={};return t.endNoteVersion=e,this.sendCollabNonDataCommand(n.CmdNames.NONDATACMD_GETMODIFIERS,t)},t.prototype._handleCollabJSONRetry=function(){var e,t=this,i=!1;o.underscoreInst.each(this.retriableCmdsQueue,function(r){!0!==i&&null!=t.wsClient&&!1!==t.wsClient.isOpened()?Date.now()-r.sendingToCollabServerMillis>t.retryIntervalMilliSec&&((e=r.retryRemainedCount)>0?(o.loggerInst.log("NonDataCmd-Resend:",r),delete r.sendingToCollabServerMillis,delete r.retryRemainedCount,t._sendCollabJSON(r),r.sendingToCollabServerMillis=Date.now(),r.retryRemainedCount=e-1):(o.loggerInst.error("NondataCmd-Send Failed after retry:",r),t.wsClient&&t.wsClient.isOpened()&&t.wsClient.close(n.WSCustomCode.FAILED_RECEIVE_COLLAB_CMD,n.WSCustomCode[n.WSCustomCode.FAILED_RECEIVE_COLLAB_CMD]),i=!0)):i=!0}),i&&(this.retriableCmdsQueue=[]),this.retriableCmdsQueue.length>0?this.retryCollabJSONDispatcher=setTimeout(this._handleCollabJSONRetry.bind(this),this.retryIntervalMilliSec):(clearTimeout(this.retryCollabJSONDispatcher),this.retryCollabJSONDispatcher=null)},t.prototype._sendCollabJSON=function(e){return null!=e&&this.wsClient.send(JSON.stringify(e)),!0},t.prototype._isModifiersReqeustSent=function(e){var t,i;return o.underscoreInst.some(this.retriableCmdsQueue,function(o){return(t=o.nondataCmds[0]).action===n.CmdNames.NONDATACMD_GETMODIFIERS&&t.endVersion===e&&(i=!0,!0)}),i},t.prototype._buildCollabCmdJSON=function(e,t){var o,r=[],s={};switch(o={action:e,cmdId:i.Utils.newGUID()},r.push(o),s.nondataCmds=r,e){case n.CmdNames.NONDATACMD_BLOCKSELECTION:o.blockId=t.selectedBlockId;break;case n.CmdNames.NONDATACMD_COLLABINFO:var a={sessionId:t.sessionId};void 0!==t.nickname&&(a.nickname=t.nickname),void 0!==t.lockedBlockId&&(a.lockedBlkIds=[],a.lockedBlkIds.push(t.lockedBlockId)),void 0!==t.portraitUrl&&(a.portraitUrl=t.portraitUrl),this._buildSessionInfoJSON(o,a);break;case n.CmdNames.NONDATACMD_DATACMDFAILED:o.dataCmdError=t.dataCmdErrorCode,o.errToClose=!!t.errToClose;break;case n.CmdNames.NONDATACMD_CLINTPONG:o.versionUpdate=t.noteVersion;break;case n.CmdNames.NONDATACMD_GETMODIFIERS:o.endVersion=t.endNoteVersion;break;case n.CmdNames.NONDATACMD_NOTESAVE:o.versionUpdate=t.noteVersion,o.isHistorySave=t.isHistorySave;break;default:throw s=null,new Error("Unsupported NondataCmd:"+e)}return s},t.prototype._buildSessionInfoJSON=function(e,t){var n={sessionId:t.sessionId};null!=t.nickname&&(n.nickname=t.nickname),null!=t.portraitUrl&&(n.portraitUrl=t.portraitUrl),null!=t.lockedBlkIds&&t.lockedBlkIds.length>0&&(n.lockedBlkId=t.lockedBlkIds[0]),e.sessionProp=[],e.sessionProp.push(n)},t.prototype._handleCollabInfo=function(e,t){var n=e.sessionProp,i=[];o.underscoreInst.each(n,function(e){var n={sessionId:null};null!=e.lockedBlkId&&(n.lockedBlkIds=[e.lockedBlkId],delete e.lockedBlkId),o.underscoreInst.extend(n,e),null==n.sessionId&&(n.sessionId=t.cmdSessionId),i.push(n)}),this.emit(a.default.SESSION_CHNAGED,i)},t.prototype._handleServerPing=function(e){if(null!=e.collabNoteReady){var t={isCollabStarted:e.collabNoteReady,resultCode:n.CustomResultCode.NO_ERROR,sessionId:this.wsClient.getSessionId()};this.emit(a.default.SESSION_INIT_BUILT,t)}},t.prototype._handleModifiers=function(e){var t=this;this.modifiers.status=1,this.modifiers.startVersion=e.startVersion,this.modifiers.endVersion=e.endVersion,this.modifiers.modifiers=[],o.underscoreInst.each(e.modifiers,function(e){var n={userId:e.userId};t.modifiers.modifiers.push(n)}),this._clearRetryQueueByAction(n.CmdNames.NONDATACMD_GETMODIFIERS),this.emit(a.default.NONDATACMD_MODIFIERS_RESULT,this.modifiers)},t.prototype._clearRetryQueueByAction=function(e){this.retriableCmdsQueue=o.underscoreInst.reject(this.retriableCmdsQueue,function(t){return t.nondataCmds[0].action===e&&(o.loggerInst.log("remove cmd from retryQueue by actionName:",e),!0)})||[]},t.prototype._removeFromRetryQueue=function(e){this.retriableCmdsQueue=o.underscoreInst.reject(this.retriableCmdsQueue,function(t){return t.nondataCmds[0].cmdId===e&&(o.loggerInst.log("remove cmd from retryQueue:",e),!0)})||[]},t.prototype._handleNoteSave=function(e){o.loggerInst.log("SaveNotification:",e)},t}(r.YEvent);t.NonDataCmdHandler=l}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(37),n(31)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var n=e.call(this)||this;return n.coreEditor=t,n.executedNotOwnCmdQueue=[],n}return s(t,e),t.prototype.destroy=function(){this.removeAllListeners(null)},t.prototype.applyCollabRedoUndo=function(e,t){var n,o=t.collabProperties.cmdJSON,i=o.isCollabUndo,r=o.isCollabRedo;return i?(t.collabProperties.isCollabUndo=!0,t.collabProperties.isCollabRedo=!1):r&&(t.collabProperties.isCollabUndo=!1,t.collabProperties.isCollabRedo=!0),(n=this.coreEditor.createDataCommand(e,t))&&(n.isOriginalCmd=!0,this.coreEditor.applyCollabCmdRedoUndo(n)),n},t.prototype.pushNotOwnExecCmd=function(e){this.executedNotOwnCmdQueue.push(e)},t.prototype.ValidateLocalRedoUndo=function(e){var t,o=!0,i=!1;return e.isCollabUndo?t=this.lastValidUndoCmd:e.isCollabRedo&&(t=this.lastValidRedoCmd),o&&((o=!this._isConflicted(e.getAffectedBlockIds(),e.getCmdFinalNoteVersion()))||(i=!0)),o&&t&&t.cmdId===e.cmdId&&(o=!1,n.loggerInst.warn("skip duplicated redo/undo command")),o?e.isCollabRedo?(this.lastValidRedoCmd=e,this.lastValidUndoCmd=null):e.isCollabUndo&&(this.lastValidUndoCmd=e,this.lastValidRedoCmd=null):(n.loggerInst.warn("Skip invalid Redo/Undo"),i&&(n.loggerInst.warn("Drop invalid Redo/Undo"),e.isCollabRedo?this.coreEditor.dropRedoCmd():e.isCollabUndo&&this.coreEditor.dropUndoCmds(null,null,null))),o},t.prototype.ValidateCollabRedoUndo=function(e,t){return!this._isConflicted(e,t)},t.prototype._isConflicted=function(e,t){var o,i,r=this,s=!1;return(i=(i=n.underscoreInst.filter(this.executedNotOwnCmdQueue,function(e){return e.getCmdFinalNoteVersion()>t}))||[]).length>0&&n.underscoreInst.some(i,function(t){if(r._isNoteRangeOverlap(e,t.getAffectedBlockIds()))return s=!0,o=t.getCollabProps(),n.loggerInst.log("Conflict: data has been edited by "+o.ownerName),!0}),s},t.prototype._isNoteRangeOverlap=function(e,t){var o=!1;return e&&e.length>0&&t&&t.length>0&&n.underscoreInst.some(e,function(e){return n.underscoreInst.some(t,function(t){return e===t&&(o=!0),o}),o}),o},t}(o.YEvent);t.RedoUndoHandler=i}.apply(t,o))||(e.exports=i)},function(e,t,n){(function(o){var i,r,s,a=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});i=[n,t,n(71),n(37),n(129),n(31),n(56)],void 0===(r=function(e,t,i,r,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u,d="buildVersion",h="collabId",p="nickname",g="portraitUrl",f="sessionId",m="sessionType",_="userId";!function(e){e[e.normal=0]="normal",e[e.readonly=1]="readonly",e[e.owner=2]="owner"}(u||(u={}));var y=function(e){function t(t){var i=e.call(this)||this;"undefined"==typeof window&&void 0!==o&&(o.WebSocket=n(286).w3cwebsocket);return i.collabPropsHandler=t,i}return a(t,e),t.prototype.connect=function(e){var t,n=e.useWSS?"wss":"ws";if("undefined"==typeof WebSocket)throw new Error("There is NO WebSocket type in Context.");if(null==e.collabServer)throw new Error("Param of options.collabServer should not be null");if(null==e.shareKey)throw new Error("Param of options.shareKey should not be null");if(null==e.nickname)throw new Error("Param of options.nickname should not be null");if(null==e.portraitUrl)throw new Error("Param of options.portraitUrl should not be null");if(null==e.userId)throw new Error("Param of options.userId should not be null");if(null==e.sessionId)throw new Error("Param of options.sessionId should not be null");if(null==e.sessionType)throw new Error("Param of options.sessionType should not be null");if(null==e.buildVersion)throw new Error("Param of options.buildVersion should not be null");t=n+"://"+e.collabServer+"?"+h+"="+e.shareKey+"&"+p+"="+e.nickname+"&"+g+"="+e.portraitUrl+"&"+_+"="+e.userId+"&"+m+"="+e.sessionType+"&"+f+"="+e.sessionId+"&"+d+"="+e.buildVersion,this.sessionOptions=e,r.loggerInst.log("Connect to",t),this.wsInst=new WebSocket(t),this.wsInst.onopen=this._onOpen.bind(this),this.wsInst.onclose=this._onClose.bind(this),this.wsInst.onmessage=this._onMessage.bind(this),this.wsInst.onerror=this._onError.bind(this)},t.prototype.getSessionId=function(){return this.sessionOptions.sessionId},t.prototype.getNickname=function(){return this.sessionOptions.nickname},t.prototype.getPortraitUrl=function(){return this.sessionOptions.portraitUrl},t.prototype.getUserId=function(){return this.sessionOptions.userId},t.prototype.getCollabId=function(){return this.sessionOptions.shareKey},t.prototype.isReadOnlySession=function(){return this.sessionOptions.sessionType===u.readonly},t.prototype.isOpened=function(){return null!=this.wsInst&&this.wsInst.readyState===this.wsInst.OPEN},t.prototype.send=function(e){var t,n=i.CustomResultCode.NO_ERROR;return t=2*e.length/1024,s.Utils.isMessageTooLarge(t)?n=i.WSCustomCode.MESSAGE_TOO_BIG:this.wsInst&&this.wsInst.readyState===WebSocket.OPEN?(r.loggerInst.log("sending message:",e),this.wsInst.send(e)):n=i.WSCustomCode.SESSION_NOT_OPENED,n},t.prototype.close=function(e,t){this.wsInst&&this.wsInst.readyState===WebSocket.OPEN&&(this.wsInst.onopen=null,this.wsInst.onclose=null,this.wsInst.onmessage=null,this.wsInst.onerror=null,this.wsInst.close(e,t),e!==i.WSCustomCode.CLOSED_BY_HOST&&this.emit(c.default.WS_CLOSED,this._assembleSessionError(e,e)))},t.prototype.sendDataCmdErrorCode=function(e){this.send(e.toString())},t.prototype._onOpen=function(e){r.loggerInst.log("Connection is opened.");var t={resultCode:i.CustomResultCode.NO_ERROR};this.emit(c.default.WS_OPENED,t)},t.prototype._onClose=function(e){r.loggerInst.log("Connection is closed."),this.emit(c.default.WS_CLOSED,this._assembleSessionError(e.code,parseInt(e.reason,10)))},t.prototype._onMessage=function(e){r.loggerInst.log("Received Message in WSClient:",e.data);try{if(null!=e.data&&""!==e.data){var t=JSON.parse(e.data),n=this.collabPropsHandler.buildCollabProperties(t);n.rawWSMessage=e.data;var o={collabCmdsJSON:t.collabCmds,collabProps:n,resultCode:i.CustomResultCode.NO_ERROR};this.emit(c.default.WS_MESSAGE,o)}}catch(e){r.loggerInst.error("Exception in WebSocketClient._onMessage:",e)}},t.prototype._onError=function(e){r.loggerInst.log("Caught Error:",e)},t.prototype._assembleSessionError=function(e,t){var n;switch(r.underscoreInst.isNaN(t)&&(t=1006===e?i.WSCustomCode.COLLAB_SERVER_UNREACHABLE:1005===e?i.WSCustomCode.COLLAB_SERVER_SHUTDOWN:1001===e?i.WSCustomCode.COLLAB_SESSION_CLOSED:e),t){case 2e3:n="连接总数超过上限";break;case 2001:n="单个文件连接总数超过上限";break;case 2002:n="重复的session链接";break;case 2003:n="所有者链接超过上限";break;case 3e3:n="转发命令失败";break;case 3001:n="添加链接失败";break;case 3003:n="命令转发进程无响应";break;case 3004:n="创建链接失败";break;case 3005:n="创建命令转发进程失败";break;case 3006:n="广播命令失败";break;case 3007:n="初始化链接失败";break;case 3008:n="未转发命令总数超上限";break;case 4001:n="等待命令返回超时";break;case 4002:n="发送命令失败";break;case 8e3:n="笔记长时间无操作";break;case 9e3:n="链接协同服务器失败";break;case 9003:n="协同服务器被强制关闭";break;case 9004:n="协同链接异常关闭，请检测session是否初始化成功";break;case 9100:n="当前编辑器版本太低";break;case 9101:n="链接被主动强制关闭";break;case 9102:n="协同命令执行失败";break;case 9103:n="重连次数超限";break;default:n="未知错误"}return{code:e,customCode:t,reason:n,resultCode:e,shareKey:this.sessionOptions.shareKey}},t}(l.YEvent);t.WebSocketClient=y}.apply(t,i))||(e.exports=r)}).call(this,n(75))},function(e,t,n){var o=function(){return this}(),i=o.WebSocket||o.MozWebSocket,r=n(287);function s(e,t){return t?new i(e,t):new i(e)}i&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(s,e,{get:function(){return i[e]}})}),e.exports={w3cwebsocket:i?s:null,version:r}},function(e,t,n){e.exports=n(288).version},function(e){e.exports={_args:[["websocket@1.0.26","/home/cloudstorage/web-tools/tools/workplace/bulbeditor"]],_from:"websocket@1.0.26",_id:"websocket@1.0.26",_inBundle:!1,_integrity:"sha512-fjcrYDPIQxpTnqFQ9JjxUQcdvR89MFAOjPBlF+vjOt49w/XW4fJknUoMz/mDIn2eK1AdslVojcaOxOqyZZV8rw==",_location:"/websocket",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"websocket@1.0.26",name:"websocket",escapedName:"websocket",rawSpec:"1.0.26",saveSpec:null,fetchSpec:"1.0.26"},_requiredBy:["/","/ycollablib"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.26.tgz",_spec:"1.0.26",_where:"/home/cloudstorage/web-tools/tools/workplace/bulbeditor",author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},config:{verbose:!1},contributors:[{name:"Iñaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{debug:"^2.2.0",nan:"^2.3.3","typedarray-to-buffer":"^3.1.2",yaeti:"^0.0.6"},description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^1.0.0",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^2.0.4",jshint:"^2.0.0","jshint-stylish":"^2.2.1",tape:"^4.0.1"},directories:{lib:"./lib"},engines:{node:">=0.10.0"},homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",name:"websocket",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit"},version:"1.0.26"}},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(3),n(6),n(30),n(21),n(27),n(8),n(124),n(17),n(1),n(146)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h,p){"use strict";return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentBackground=i.DEFAULT_BACKGROUND,t}return s(t,e),t.prototype.canUndo=function(){return this.controller.canUndo()},t.prototype.canRedo=function(){return this.controller.canRedo()},t.prototype.clearHighlight=function(){this.note&&this.note.highlight([""]),this.note.clearHighlight()},t.prototype.countWords=function(e){var t=this.getNoteRange();return this.note.countWords(t,e)},t.prototype.execCommandByToolbar=function(e,t){var n,o,i=this.getNoteRange(),r=this.getTableOnCellEdit(i);r&&(n=this.noteView.getBlockViewByBlock(r))&&n.editCellFromToolbar&&(o=n.editCellFromToolbar(e,t)),o||("undo"===e?this.undo():"redo"===e?this.redo():this.execCommand(e,t))},t.prototype.execCommand=function(e,t){return this.controller.execCommand(e,t)},t.prototype.focus=function(){this.noteView.$el.focus()},t.prototype.getController=function(){return this.controller},t.prototype.getHtmlContent=function(e,t,n){var o;if(null!=this.getHtmlContentTimer&&(clearTimeout(this.getHtmlContentTimer),this.getHtmlContentTimer=null),!this.contentLoading||null==t)return o=this.note.toHtml(null,!0===e),null!=t&&t({status:1,content:o}),o;n&&(this.isReadOnly()||this.makeReadOnly(!0),this.noteView.removeNote()),this.getHtmlContentTimer=setTimeout(this.getHtmlContent.bind(this,e,t,n),100)},t.prototype.getNoteRange=function(){return this.controller.getNoteRange()},t.prototype.getPlainContent=function(){return this.note.toPlain()},t.prototype.getSchemaVersion=function(){return this.note.getSchemaVersion()},t.prototype.getXmlContent=function(e,t){var n;if(null!=this.getXmlContentTimer&&(clearTimeout(this.getXmlContentTimer),this.getXmlContentTimer=null),!this.contentLoading||null==e)return n=this.note.toXml(),null!=e&&e({status:1,content:n}),n;t&&(this.isReadOnly()||this.makeReadOnly(!0),this.noteView.removeNote()),this.getXmlContentTimer=setTimeout(this.getXmlContent.bind(this,e,t),100)},t.prototype.hasHandWriteBlock=function(){return this.note.hasHandWriteBlock()},t.prototype.highlight=function(e,t){this.note&&this.note.highlight(e,t)},t.prototype.insertImage=function(e){return this.controller.insertImage(e)},t.prototype.insertAttachment=function(e){return this.controller.insertAttachment(e)},t.prototype.isNotSetContent=function(){return this.notSetContent},t.prototype.isReadOnly=function(){return this.controller.isReadOnly()},t.prototype.nextHighlight=function(){this.note&&this.note.nextHighlight()},t.prototype.preHighlight=function(){this.note&&this.note.preHighlight()},t.prototype.getNoteContentStatus=function(){return!!this.note&&this.note.getContentStatus()},t.prototype.querySelectionInlineStyle=function(e){return this.controller.querySelectionInlineStyle(e)},t.prototype.querySelectionBlockStyle=function(e){return this.controller.querySelectionBlockStyle(e)},t.prototype.querySelectionInlineStyles=function(){return this.controller.querySelectionInlineStyles()},t.prototype.querySelectionBlockStyles=function(){return this.controller.querySelectionBlockStyles()},t.prototype.redo=function(){return this.controller.redo()},t.prototype.render=function(){null!=this.noteProps&&(this.noteProps.sessionType?(this.noteProps.sessionType=parseInt(this.noteProps.sessionType,10),1===this.noteProps.sessionType?this.setReadOnly(!0):this.setReadOnly(!1)):this.noteProps.readOnly?this.setReadOnly(!0):this.setReadOnly(!1))},t.prototype.rerenderNoteView=function(){this.noteView.render()},t.prototype.resetEditingInlineStates=function(){return this.controller.resetEditingInlineStates()},t.prototype.setEditingInlineStyles=function(e){return this.controller.setEditingInlineStyles(e)},t.prototype.reset=function(){var e=this.getNoteViewWrapper();this.controller&&this.controller.reset(),this.noteView&&this.noteView.reset(),this.note&&this.note.reset(),this.note.removeEntityCache(),p.reset(),this.notSetContent=!0,e&&this.noteView.isInPageMode()&&e.find(".page-break").remove(),null!=this.getHtmlContentTimer&&(clearTimeout(this.getHtmlContentTimer),this.getHtmlContentTimer=null),null!=this.getXmlContentTimer&&(clearTimeout(this.getXmlContentTimer),this.getXmlContentTimer=null),this.contentChanged=!1,this.contentLoading=!1,this.currentBackground=i.DEFAULT_BACKGROUND},t.prototype.resetFont=function(){r.resetCssRules(),a.reset(),this.noteView.reRenderTextBlockView()},t.prototype.selectAll=function(){return this.controller.selectAll()},t.prototype.setAllBackgrounds=function(e,t){this.trigger("set-all-backgrounds",n.clone(e),t),this.currentBackground=i.DEFAULT_BACKGROUND},t.prototype.setBackground=function(e){var t=this.currentBackground;this.updateContainerBackground(e)&&this.trigger("set-background",t,e)},t.prototype.setFont=function(e,t){if(e||t){var n,o={};e&&(n=a.getDefault("font-size"),o["font-size"]=function(t){var o=t["font-size"];if(null!=o)return Math.round(e*o/n)+"px"},r.setCssRules(o)),t&&(a.setDefault("font-family",t),r.resetInlineStyleDefaultForHtml("font-family")),this.noteView.reRenderTextBlockView()}},t.prototype.setNoteRange=function(e){this.controller.noteSelection.setRange(e)},t.prototype.setPasteAsText=function(e){this.controller.setPasteAsText(e)},t.prototype.setEntity=function(e,t){var n=this;this.controller.setEntity(e,t),setTimeout(function(){n.trigger("yne-content-change")})},t.prototype.setReadOnly=function(e){e=!!e,this.noteProps.isReadOnly=e,this.makeReadOnly(e)},t.prototype.setDragProhibited=function(e){e=!!e,this.noteProps.isDragProhibited=e,this.controller.setDragProhibited(e)},t.prototype.setCopyProhibited=function(e){e=!!e,this.noteProps.isCopyProhibited=e,this.controller.setCopyProhibited(e)},t.prototype.setViewMode=function(e,t,n){e=c.IS_PC?u.parseToNumber(e,1):u.parseToNumber(e,0),this.updateEditorProps({viewMode:e}),c.IS_PC&&(1===e?$(this.getNoteViewWrapper()).toggleClass("read-mode",!0):$(this.getNoteViewWrapper()).toggleClass("read-mode",!1)),this.noteView.setViewMode(e,!this.isNotSetContent()),!0===t&&this.trigger("view-mode-change",e),!0===n&&this.trigger("yne-view-mode-change",e),this.controller.resizeSpecialBlock()},t.prototype.undo=function(){return this.controller.undo()},t.prototype.updateBackground=function(e){var t=this.currentBackground;this.updateContainerBackground(e)&&(t||(t=i.DEFAULT_BACKGROUND),this.trigger("yne-background-changed",t,e))},t.prototype.updateEditorProps=function(e){null==this.editorProps&&(this.editorProps={}),n.extend(this.editorProps,e),n.extend(this.options,e)},t.prototype.updateNoteViewVisibility=function(e){e?this.noteView.$el.css("visibility","visible"):this.noteView.$el.css("visibility","hidden")},t.prototype.initialize=function(e){var t=this;this.clientId=o.newGUID(),this.notSetContent=!0,this.bindEventsForController(),this.on("background-failed-update",function(e,n){null!=n&&t.updateContainerBackground(n),0===e&&t.trigger("yne-background-failed-update",e)}),this.contentChanged=!1,this.contentLoading=!1},t.prototype.makeReadOnly=function(e){this.controller.setReadOnly(e),c.IS_PC?e?this.toolbar.toggleToolbar(!1):this.toolbar.toggleToolbar(!0):e?this.toolbar.disable():this.toolbar.enable()},t.prototype.bindEventsForController=function(){var e=this,t=this.controller;t.on("command-exec",function(t,n){t&&t.name?t&&t.effected?(e.contentChanged=!0,e.trigger("yne-content-change")):h.warn("The command has no effected",t):h.error("The command is not valid",t)}),l.bubble(["redo-stack-change","undo-stack-change","selectstart","mouse-down","command-exec","esc","yne-clipboard-status","yne-clipboard-error","yne-get-clipboard","yne-clipboard-set","color-picker-show","yne-user-action-collection","cell-edit-view-enter","cell-edit-view-exit","cell-edit-view-history-change"],t,this)},t.prototype.updateContentSetProgress=function(e){!0===this.contentLoading&&(e.isAsync&&this.progressTracker.updateContentSetProgress(e),n.isNumber(e.percent)&&e.percent>=1&&(this.isLegacyHost()&&!this.noteProps.isReadOnly&&this.makeReadOnly(!1),this.contentLoading=!1))},t.prototype.getTableOnCellEdit=function(e){var t;if(e&&e.isSingleTableSelected())return(t=e.getStartBlockRange())&&t.isOnCellEdit&&t.isOnCellEdit()?t.block:void 0},t}(d)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(46),n(3),n(35),n(32),n(291),n(27),n(8),n(17),n(1),n(111),n(292),n(340),n(6),n(2),n(19),n(10),n(77),n(21),n(96),n(5),n(26),n(14),n(341),n(166),n(167),n(168),n(20),n(343)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d,h,p,g,f,m,_,y,b,v,k,C,I,S,w,E,T,N,A,x){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.addDragHint=function(e,t){var n,o,i=this.getRangeByPoint(e,t),r=this.noteView.parseNativeRange(i)[0];return this.getNoteRange()?(n=this.getNoteRange().getStartBlockRange())&&r?!(r.block===n.block&&r.start>=n.start&&r.start<n.end)&&(this.lastDragOver?o=this.lastDragSpace.parentNode.removeChild(this.lastDragSpace):((o=document.createElement("span")).id="drop-hint",this.lastDragOver={}),this.lastDragOver.x=e,this.lastDragOver.y=t,this.lastDragSpace=o,void i.insertNode(o)):(h.error("addDragHint:startRange and dragRange should not be null",n,r),!1):(h.error("addDragHint:Failed to get NoteRange"),!1)},t.prototype.canRemoveFormat=function(){var e=this.getNoteRange();return e&&!e.isCollapsed()},t.prototype.canUndo=function(){return this.cmdManager.canUndo()},t.prototype.canRedo=function(){return this.cmdManager.canRedo()},t.prototype.createCmd=function(e,t){return this._createCmd(e,t)},t.prototype.defaultNoteRange=function(){var e,t,n=this.note;if(n&&(e=n.getBlockAt(0)))return t=S.createRangeByBlock({allContent:!1,block:e,collapseToStart:!0}),new w({endRange:t,startRange:t})},t.prototype.execBackTab=function(){this.execCommand("comp.KeyTab",{inlineStyles:this.editingInlineStates,withShiftKey:!0})},t.prototype.execCommand=function(e,t){var o,r,s=this;if(r=(t=n.defaults(t||{},{collabProperties:s.editor.buildCollabProperties()})).collabProperties.isCollabCmd,!s.isReadOnly()||r)if(t.isOriginalCmd=!0,(o=s._createCmd(e,t))&&!o.cmdError){if(!i.isInlineStateSetCommand(o))return s.isCollabEnabled()?(o.isOriginalCmd=!0,r?s._executeCollabCmd(o,t):s._handleLocalCmdInCollabMode(o,t),t.collabProperties.dataCmdError&&h.error(t.collabProperties.dataCmdError),o):s._executeLocalCmd(o,t);n.each(t.inlineStyles,function(e,t){s.setEditingInlineState(t,e)})}else h.error("Failed to create/initialize command:"+e);else s.editor.notifyErrorToHost(m.INVALIDACTION_EDIT_READ_ONLY)},t.prototype.execCmdByShortCut=function(e,t){this.editor.execCommandByToolbar(e,t)},t.prototype.execDeleteBackward=function(e){var t,n;n=(t=(e=e||this.getNoteRange()).getStartBlockRange()).block,e?(_.isHeading(n)&&e.isCollapsed()&&t.isCollapsed()&&0===t.start?this.resetEditingInlineStates():n.isEmpty()||this._updateDeleteInlineStates(this.queryBackwardFirstInlineStyles(e)),this.execCommand("comp.KeyBackspace",{inlineStyles:this.editingInlineStates})):h.error("noteRange not found")},t.prototype.execDeleteForward=function(){var e=this.getNoteRange();e?(this._updateDeleteInlineStates(this.queryForwardFirstInlineStyles(e)),this.execCommand("comp.KeyDelete")):h.error("noteRange not found")},t.prototype.execDeleteToEnd=function(){var e,t=this.getNoteRange();if(t){if(!t.isCollapsed())return this._onDeleteSelection();e=t.clone(!0),t.getEndBlockRange().expandToEnd(),this.execDeleteBackward(e)}},t.prototype.execInsertDate=function(){var e,t=new Date,n=function(e){return o.pad(e,2,"0","left")};e=" "+t.getFullYear()+"/"+n(t.getMonth()+1)+"/"+n(t.getDate())+" "+n(t.getHours())+":"+n(t.getMinutes())+" ",this.insertText(e,!1)},t.prototype.execKeyHandler=function(e){this.keyHandlerManager.execWithName(e,this,{})},t.prototype.getDefaultFont=function(){return this.defaultFont},t.prototype.getEditingInlineState=function(e){var t=this.editingInlineStates||{};return e?t[e]:t},t.prototype.getNextCaretBlockRange=function(){var e,t,n,o=this.getNoteRange().getStartBlockRange().block;return _.isTextOrTableBlock(o)||(e=this._getNextCaretBlock(o))&&(t=S.createRangeByBlock({allContent:!1,block:e,collapseToStart:!0}),n=new w({endRange:t,startRange:t}),this.noteSelection.setRange(n)),n},t.prototype.getNoteRange=function(){var e=this.noteSelection.getRange();return e||(e=this.defaultNoteRange()),e},t.prototype.getRangeByPoint=function(e,t){var n,o;return n=document.caretRangeFromPoint(e,t),(o=document.createRange()).setStart(n.startContainer,n.startOffset),o},t.prototype.hasKeyHandler=function(e){return this.keyHandlerManager.hasHandler(e)},t.prototype.innerGoto=function(e){var t,n;if(t=document.getElementById(e),this.pageViewManager&&!t&&(this.pageViewManager.activePageByBlockId(e),t=document.getElementById(e)),!t)return h.warn("No find the block!");window.location.hash="#"+e,(n=document.createRange()).setStart(t.lastChild,1),n.setEnd(t.lastChild,1),a.setRange(n,window),window.location.hash=""},t.prototype.insertAttachment=function(e){var t,n=this.getNoteRange();if(!e||!e.src)return h.log("Error: attachment data is invald! "+e);switch(t=e.resource&&e.fileName?"attachment":"image",this.noteSelection.setRange(n),t){case"attachment":this.execCommand("comp.InsertAttachment",{fileLength:e.fileLength,fileName:e.fileName,resource:e.resource,src:e.src});break;case"image":this.insertImage(e.src)}},t.prototype.insertImage=function(e){var t=this.getNoteRange();e&&(this.noteSelection.setRange(t),this.execCommand("comp.InsertImage",{src:e}))},t.prototype.insertText=function(e,t){var o,i,r=k.getAllDefault();e instanceof b?o=e:(i=this.editingInlineStates,o=new b({text:e}),n.isEqual(r,i)||o.setStyles(0,o.getLength(),i)),this.execCommand("comp.KeyTextInput",{recogLink:t,text:o})},t.prototype.isDragProhibited=function(){return this.dragProhibited},t.prototype.isCopyProhibited=function(){return this.isCopyProhibited},t.prototype.isCollabEnabled=function(){return null!=this.editor&&this.editor.isCollabEnabled&&this.editor.isCollabEnabled()},t.prototype.isReadOnly=function(){return this.readOnly},t.prototype.isSameList=function(e){var t=this.note,n=this.getNoteRange();return!!n&&t.isSameList(n,e)},t.prototype.isValidNoteRange=function(e){var t=this,n=function(e){var n;return!(!e||!e.block)&&(n=e.block,t.note.getBlockIndex(n)>-1)};return!!e&&(t.isValidHeaderFooterRange(e)||n(e.getStartBlockRange())&&n(e.getEndBlockRange()))},t.prototype.isValidHeaderFooterRange=function(e){var t=this.note,o=e.getStartBlockRange(),i=e.getEndBlockRange();return n.all([o,i],function(e){if(!e||!e.block)return!1;var n=e.block;return t.getHeaderFooter(!0)===n||t.getHeaderFooter(!1)===n})},t.prototype.moveCaretWithDirection=function(e,t){this._onMoveCaretWithDirection(e,t)},t.prototype.lockBlockById=function(e){this.isCollabEnabled()&&this._sendBlockLockInfo(e)},t.prototype.onCommand=function(e,t){this.execCommand(e,t)},t.prototype.onUpdateSelection=function(e,t,n){var o;n&&n.inlineStyles&&(o=n.inlineStyles),this.noteSelection.setRange(e,T.createCommandTypeEvent(t),o)},t.prototype.onPaste=function(e){var t,n,o,i,r,s,a;if(e.preventDefault(),u.IS_MAC)this._pasteForMac();else{if(t=new N({event:e}),this.isPasteAsText)return a=t.getData("text/plain"),void this._pastePlain(a,this.isPasteAsText);n=t.getData("text/yne-json"),o=t.getData("text/yne-image-json"),r=t.getData("text/yne-note-id"),n&&this._pasteJSON(n,o,r)||(i=t.getData("text/yne-table-json"))&&this.pasteYTableJson(i)||((s=t.getData("text/html"))&&this._pasteHTML(s)?h.log("paste html ok"):(a=t.getData("text/plain"))?this._pastePlain(a,this.isPasteAsText):this._pasteBlobImg(e))}},t.prototype.pasteForTable=function(e){var t,n=this.getNoteRange(),o=n.getStartBlockRange(),i=n.getEndBlockRange(),r=o.block,s=i.block,a=this.noteView;return!(!_.isTable(r)||r.getId()!==s.getId())&&(!(!(t=a.getBlockViewByBlock(r))||!t.pasteBlockList)&&t.pasteBlockList(e))},t.prototype.queryBackwardFirstInlineStyles=function(e,t){var n,o,i,r,s,a=k.getAllDefault();if(e=e||this.getNoteRange()){if(o=(n=e.getStartBlockRange()).block,_.isTextBlock(o))return o.isEmptyContent()?o.getInlineStylesForEmpty()||t||this.getDefaultFont()||a:(r=n.start,s=o.getLength(),(e.isCollapsed()||r>=s)&&(r=r>0?r-1:0),i=o.getTextStylesAtIndex(r),this._omitLinkStylesIfNeeded(i,e))}else h.warn("noteRange is null")},t.prototype.queryForwardFirstInlineStyles=function(e){var t,n,o,i,r;if(e=e||this.getNoteRange()){if(n=(t=e.getEndBlockRange()).block,_.isTextBlock(n))return n.isEmptyContent()?n.getInlineStylesForEmpty()||k.getAllDefault():(i=t.end,r=n.getLength(),(!e.isCollapsed()||i>=r)&&(i=i>0?i-1:0),o=n.getTextStylesAtIndex(i),this._omitLinkStylesIfNeeded(o,e))}else h.error("noteRange is null")},t.prototype.querySelectionCodeInfo=function(e){if(e=e||this.getNoteRange()){var t=e.getStartBlockRange().block;return{"code-theme":t.getTheme(),"code-language":t.getLanguage()}}h.warn("noteRange not found")},t.prototype.querySelectionInlineStyle=function(e,t){var n=this.note;if(t=t||this.getNoteRange())return n.getCommonInlineStyle(t,e);h.warn("noteRange not found")},t.prototype.querySelectionBlockStyle=function(e,t){var n=this.note;if(t=t||this.getNoteRange())return n.getRangeBlockStyle(t,e);h.warn("noteRange not found")},t.prototype.querySelectionInlineStyles=function(e){var t,o,i,r,s=this,a={},l=k.getStyleNames();if(e=e||s.getNoteRange())return t=e.getStartBlockRange(),e.isSingleTableSelected()&&t.isOnCellEdit()&&(o=t.block,i=s.noteView.getBlockViewByBlock(o))?(r=i.getCellEditView(),a=r.queryInlineStylesForBulb()):(n.each(l,function(t){a[t]=s.querySelectionInlineStyle(t,e)}),a);h.warn("noteRange not found")},t.prototype.querySelectionBlockStyles=function(e){var t,o,i=this,r={};if(e=e||i.getNoteRange())return t=v.getAllStyleNames(),o=C.getAllStyleNames(),t=t.concat(o),n.each(t,function(t){r[t]=i.querySelectionBlockStyle(t,e)}),r;h.warn("noteRange not found")},t.prototype.redo=function(){var e=this.cmdManager;if(!this.isCollabEnabled())return e.redo();var t={collabProperties:{coreEditor:this.editor,isCollabRedo:!0}};return this._redoUndoLocalCmdInCollabMode(t)},t.prototype.removeDragHint=function(){this.lastDragSpace&&this.lastDragSpace.parentNode&&this.lastDragSpace.parentNode.removeChild(this.lastDragSpace),this.lastDragOver=this.lastDragSpace=null},t.prototype.removeShortCut=function(e){var t=this.keyHandlerManager;t&&t.unbind(e)},t.prototype.reset=function(){this.cmdManager&&this.cmdManager.reset(),this.noteSelection&&this.noteSelection.reset(),this.resetEditingInlineStates(),this.defaultFont=null,this.readOnly=!1},t.prototype.resetEditingInlineStates=function(){var e=k.getAllDefault();this.setEditingInlineStates(null),this.trigger("yne-editing-state-change",e)},t.prototype.setEditingInlineStyles=function(e){this.setEditingInlineStates(e),e||(e=k.getAllDefault()),this.trigger("yne-editing-state-change",e)},t.prototype.resizeSpecialBlock=function(){var e=this.note;n.each(e.blocks,function(e){(_.isTable(e)||_.isImage(e))&&e.trigger("view-resize")})},t.prototype.selectAll=function(){return this.noteView.onSelectAll()},t.prototype.setDefaultFont=function(e,t){this.defaultFont=this.defaultFont||{},e&&(this.defaultFont["font-family"]=e,this.setEditingInlineState("font-family",e)),t&&(this.defaultFont["font-size"]=t,this.setEditingInlineState("font-size",t))},t.prototype.setEditingInlineState=function(e,t){var n={};this.isReadOnly()||(this.editingInlineStates||(this.editingInlineStates={}),this.editingInlineStates[e]=t,n[e]=t,this.trigger("yne-editing-state-change",n),this.isLinkStylesChanged=this._isLinkStyles(e))},t.prototype.setEditingInlineStates=function(e){this.editingInlineStates=e,this.isLinkStylesChanged=!1},t.prototype.setOptions=function(e){var t;this.reset(),this.readOnly=e.isReadOnly,t=this.note=e.note,c.bubble(["color-picker-show","yne-user-action-collection"],t,this,!0),c.addListeners({"get-block-view":"_onGetBlockView","get-default-set-font":"_onGetDefaultSetFont"},t,this,!0)},t.prototype.setPasteAsText=function(e){this.isPasteAsText=e},t.prototype.setEntity=function(e,t){this.note.setEntityCache(e),this.note.setEntity(e,t)},t.prototype.setDragProhibited=function(e){e=!!e,this.dragProhibited=e,this.note.setDragProhibited(e)},t.prototype.setCopyProhibited=function(e){e=!!e,this.note.setCopyProhibited(e)},t.prototype.setReadOnly=function(e){var t=this;e=!!e,t.isReadOnly()!==e&&(t.readOnly=e,n.each(["note"],function(n){var o=t[n];o&&o.setReadOnly&&o.setReadOnly(e)}))},t.prototype.toggleInlineStyle=function(e){var t,n=this.getNoteRange(),o={};n?(t=n.isCollapsed()?!this.editingInlineStates[e]:!0!==(t=this.querySelectionInlineStyle(e)),o[e]=t,this.execCommand("comp.ApplyStyles",{inlineStyles:o})):h.warn("noteRange not found")},t.prototype.undo=function(){var e=this.cmdManager;if(!this.isCollabEnabled())return e.undo();var t={collabProperties:{coreEditor:this.editor,isCollabUndo:!0}};return this._redoUndoLocalCmdInCollabMode(t)},t.prototype.updateShortCut=function(e,t){var n=this.keyHandlerManager;n&&n.updateKey(e,t)},t.prototype.zoomInEditor=function(){this.editor.setZoomPercent(1)},t.prototype.zoomOutEditor=function(){this.editor.setZoomPercent(-1)},t.prototype.zoomEditor=function(){this.editor.zoomEditor(1,!0)},t.prototype.getRangeData=function(e){var t=this.note,n={"text/yne-json":e.getDataAsJSON(t),"text/html":'<meta charset="utf-8">'+e.getDataAsHtml(t),"text/plain":e.getDataAsPlain(t),"text/yne-note-id":t.getNoteId()},o=this._getImgDomInRange(e);return n["text/yne-image-json"]=this._getImageDataAsJson(o),this._addYneTableData(t,e,n),n},t.prototype.initialize=function(e){var t=e.noteView;this.cmdManager=new f(e),this.cmdFactory=new g(e),this.removeLocalImg=e.removeLocalImg||!1,this.setOptions(e),this.noteView=t,this.noteSelection=new E({noteView:this.noteView}),this._initKeyHandlerManager(e.keyHandlerNames),this.editor=e.editor,this.imgTitleInput=e.imgTitleInput,this._bindEvents()},t.prototype.pasteYTableJson=function(e){if(n.isString(e))try{e=JSON.parse(e)}catch(e){return void h.error("parse ytable json  string error")}return this._pasteJSON([{blockType:_.TABLE,data:e}])},t.prototype._addYneTableData=function(e,t,n){if(t.isSingleTableSelected()){var o=t.getStartBlockRange().getDataAsJSON(!0);o&&(n["text/yne-table-json"]=JSON.stringify(o))}},t.prototype._bindEvents=function(){var e=this,t=e.cmdManager,n=e.noteView;c.addListeners({"update-selection":"onUpdateSelection","command-exec":"_onCommandExec"},t,e),c.bubble(["redo-stack-change","undo-stack-change"],t,e),c.addListeners({"selection-change":"_onSelectionChange"},e.noteSelection,e),c.bubble({contextmenu:!0,selectstart:!0,"mouse-down":!0,"yne-replace-image":!0,"yne-replace-attachment":!0,"yne-download-image":!0,"yne-preview-image":!0,"yne-download-attachment":!0,"yne-get-entity":!0,"yne-mac-preview":!0,"yne-open-image":!0,"yne-open-attachment":!0,"yne-on-paste":!0,"yne-blob-paste":!0,"open-link":"yne-open-link","cell-edit-view-exit":!0,"cell-edit-view-history-change":!0,"yne-image-ocr":!0},n,e),c.bubble(["link-menu-hide","locked-change"],n,e.editor.linkView),c.addListeners({"delete-selection":"_onDeleteSelection","text-input":"_onTextInput","key-pressed":"_onKey",command:"onCommand",copy:"_onCopy",cut:"_onCut",paste:"onPaste",dragstart:"_onDragStart",dragover:"_onDragOver",drop:"_onDrop",dragend:"_onDragEnd","note-append-blankparagraph":"_onAppendBlankParagraph",onCompositionStart:"_onCompositionStart","inner-goto":"innerGoto","header-footer-view-text-change":"_onHeaderFooterViewTextChange","backup-drag-range":"_onBackupDragRange","get-note-range":"_onGetNoteRange","move-caret":"_onMoveCaretWithDirection","global-redo":"redo","global-undo":"undo","cell-edit-view-enter":"_onEnterTableEdit","cell-edit-view-selection-change":"_onCellEditViewSelectionChange","cell-edit-view-command-executed":"_onCellEditViewSelectionChange","save-content":"_onSaveContent"},n,e),n.on("get-editing-styles",function(t){t(e.editingInlineStates)}),n.on("get-entity",e._getEntity),e.editor&&e.editor.onDocSelectionChange&&e.noteSelection.on("doc-change-selection",e.editor.onDocSelectionChange,e.editor),n.on("yne-click",function(){e.editor.recoverFromIdleTimeout(),e.trigger("yne-click")}),n.on("link-menu-show",function(t){e.editor.linkView.trigger("link-menu-show",t)}),n.on("get-image-items",e._getImgItems),e.imgTitleInput&&c.bubble(["img-title-edit-start","img-title-edit-end","img-title-edit-focus","img-title-edit-exit","img-title-edit-update","locked-change"],n,e.imgTitleInput)},t.prototype._createCmd=function(e,t){var n=this.cmdFactory;return t.range||i.isCollabCommand(t)||(t.range=this.getNoteRange()||w.createMock()),n.create(e,this.note,t)},t.prototype._executeCollabCmd=function(e,t){var n=this.getNoteRange();!1===this.cmdManager.exec(e,n,t)&&t.collabProperties.isOwnCmd&&this.editor.notifyErrorToHost(m.INVALIDACTION_FAILED_COLLABCMD)},t.prototype._executeLocalCmd=function(e,t){var n;if(!e||!1!==e.isReadyToApply)return n=this.getNoteRange(),this.cmdManager.exec(e,n,t)},t.prototype._getImgDomInRange=function(e){var t,o,i,r,s=this.note,a=this.noteView,l=e.getStartBlockRange(),c=e.getEndBlockRange(),u=s.getBlockIndex(l.block),d=s.getBlockIndex(c.block),h={};for(t=u;t<=d;t++)o=null,i=s.getBlockAt(t),_.isImage(i)&&(r=a.blockViews[t].getImgElement(),h[i.getId()]={img:r,source:i.getSource()}),_.isTable(i)&&(t===u&&(o=l),t===d&&(o=c),n.extend(h,a.blockViews[t].getImageDomMapByTableRange({selectAll:!o,tableRange:o})));return h},t.prototype._getImageDataAsJson=function(e){var t=l.getBase64Data(e);return JSON.stringify(t)},t.prototype._getNextCaretBlock=function(e){for(var t=this.note.getNextBlock(e);t&&(!this._isCaretBlock(t)||t.isLocked());)t=this.note.getNextBlock(t);return t},t.prototype._getImgItems=function(e){var t=this.note.blocks,o=[],i=0;n.each(t,function(t){if(t&&_.isImage(t)){var n=t.getSource().replace(location.protocol+"//"+location.hostname,"");e===t&&(i=o.length),o.push({index:o.length,name:t.getTitle(),preSrc:n,src:n})}}),this.trigger("yne-preview-image",[i,o])},t.prototype._getEntity=function(e,t){var n;if(this.note.entityExistInCache(t)){if((n=this.note.getBlockById(e))&&n instanceof y){var o=this.note.getEntityCache(t);n.setEntity(o)}}else this.trigger("yne-get-entity",t,e)},t.prototype._getPreCaretBlock=function(e){for(var t=this.note.getPreBlock(e);t&&(!this._isCaretBlock(t)||t.isLocked());)t=this.note.getPreBlock(t);return t},t.prototype._getUploadData=function(e,t,o){var i,r=0,s=[],a={},c={};if(!(n.isEmpty(e)||n.isEmpty(t)&&n.isEmpty(o)))return i=l.setBlockIds(o,e),n.each(e,function(e,t){e.base64&&(s.push({id:r,url:t,blob:l.base64ToBlob(e.base64),isGroup:u.isFromWebGroup(t)}),a[r]=e.imgBlockIds,r++)}),n.each(t,function(e){var t=e.getSource(),o=t+"_"+e.getResource(),i=e.getId();n.isUndefined(c[o])?(c[o]=r,a[r]=[i],s.push({id:r,source:t,resource:e.getResource(),isGroup:u.isFromWebGroup(t)}),r++):a[c[o]].push(i)}),{data:s,map:a,replaceImgList:i}},t.prototype._handleLocalCmdInCollabMode=function(e,t){var n,o,i,r=!0;n=this.getNoteRange(),e.setCmdOriginalNoteVersion(this.note.getFileVersion()),this.editor.isValidLocalDataCmd(e)?(o=this.noteView.isOnComposition&&"comp.KeyBackspace"===e.name,i=e.isSingleBlockAffected()&&this.editor.isMyOwnLockedBlock(t.range)&&this.editor.isLastOwnDataCmdExecuted(),o||i?!1===this.cmdManager.exec(e,n,t)?(r=!1,this.editor.notifyErrorToHost(m.INVALIDACTION_FAILED_LOCALCMD)):e.effected?e.isLocalExecutedCmd=!0:r=!1:e.isLocalExecutedCmd=!1,r?this.editor.pushLocalDataCommand(e,o):h.warn("NotReadyToSend:",e)):h.warn("skip invalid local command")},t.prototype._initKeyHandlerManager=function(e){var t=this,o=t.keyHandlerManager=new I({});o.on("bind-key",function(e){var n=t.noteView;n&&n.bindKey(e)}),o.on("unbind-key",function(e){var n=t.noteView;n&&n.unbindKey(e)}),e=e||o.getAvailableHandlerNames(),n.each(e,function(e){o.bind(e)})},t.prototype._isCaretBlock=function(e){return _.isTextBlock(e)||_.isImage(e)||_.isAttachment(e)||_.isTable(e)},t.prototype._isLinkStyles=function(e){return n.contains(["color","underline"],e)},t.prototype._isPartlyOverlapWithAnchor=function(e){var t,n,o,i,r,s,a;return!(!e||!e.isInSingleBlock())&&((n=(t=e.getStartBlockRange()).block)instanceof y&&((o=t.start)===(i=t.end)?(o>0&&(s=n.getTextStyle("href",o-1,o)[0]),o<n.getLength()&&(a=n.getTextStyle("href",o,o+1)[0]),(s||a)&&s!==a):(r=n.getCommonInlineStyle("href",{end:i,start:o}))&&r===m.INTERM))},t.prototype._onMoveCaretWithDirection=function(e,t){var n,o,i,r,s,a;(n=this.getNoteRange())?n.canDrawedByNative()?h.log("The noteRange can be drawed by native selection!"):(o=n.getStartBlockRange().block,(_.isImage(o)||_.isAttachment(o)||_.isTable(o)||_.isHr(o)||_.isUnknown(o)||_.isHandWrite(o))&&(e?(i=this._getNextCaretBlock(o),r=!0):(i=this._getPreCaretBlock(o),r=!1),i?(s=S.createRangeByBlock({allContent:!1,block:i,collapseToStart:r}),a=new w({endRange:s,startRange:s}),this.noteSelection.setRange(a),t&&t.preventDefault()):e&&this.noteView.focusLastBlankLine())):h.log("The noteRange is null!")},t.prototype._notifyEditingStatesChange=function(){var e,t,o,i=this,r=i.getNoteRange(),s=i.editingInlineStates||{},a=!1;!i.isReadOnly()&&r&&(e=r.getStartBlockRange(),r.isInSingleBlock()&&_.isTextBlock(e.block)&&e.block.getLength()<e.start&&(a=!0),(a||s&&r.isCollapsed())&&(!r.isSingleTableSelected()||e.getAsRectRange())||(s=i.querySelectionInlineStyles(r)||{}),o=n.clone(s),(t=r.clone(!0)).collapse(!0),n.each(["font-family","font-size"],function(e){var n;s[e]===m.INTERM&&(n=i.querySelectionInlineStyle(e,t),s[e]=n)}),_.isCode(e.block)&&Object.assign(s,i.querySelectionCodeInfo(r)),s.heading=null,i.trigger("yne-editing-state-change",s,o))},t.prototype._onAppendBlankParagraph=function(){this.execCommand("comp.AppendBlank",{inlineStyles:this.editingInlineStates})},t.prototype._onCellEditViewSelectionChange=function(){var e,t=this.getNoteRange().getStartBlockRange().block,n=this.noteView.getBlockViewByBlock(t);n&&(e=n.getCellEditView().queryInlineStylesForBulb(),this.trigger("yne-editing-state-change",e))},t.prototype._onCommandExec=function(e,t){this.trigger("command-exec",e,t)},t.prototype._onCompositionStart=function(e){var t,o,i=this,r=i.getNoteRange(),s=[],a=!1;if(r){if(i.isCollabEnabled()){if(o=i.note.getInterBlocks(r.getStartBlockRange().block,r.getEndBlockRange().block,!0),n.each(o,function(e){var t=i.noteView.getBlockViewByBlock(e);s.push(t),t.isCollabLocked()&&(a=!0)}),e(a,s),a)return;(t=r.getStartBlockRange())&&r.isInSingleBlock()&&_.isTextBlock(t.block)&&!i.editor.isMyOwnLockedBlock(t)&&(i.editor.sendCachedDataCommand(),i._sendBlockLockInfo(t.block.getId()))}}else h.error("_onCompositionStart:noteRange should not be null")},t.prototype._omitLinkStylesIfNeeded=function(e,t){return e&&e.href&&this._isPartlyOverlapWithAnchor(t)&&(e.href=void 0,this.isLinkStylesChanged||(e.color="#393939",e.underline=!1)),e},t.prototype._onCut=function(e){var t=this.getNoteRange();e.preventDefault(),h.log("on cut!"),this._setClipboardByRange(t,e),!t||t.isCollapsed()||t.isSingleTableSelected()||this.execCommand("comp.DeleteNoteRange",{range:t})},t.prototype._onCopy=function(e){var t=this.getNoteRange();h.DEBUG&&(h.profile("on-copy"),h.time("on-copy")),e.preventDefault(),h.log("on copy!"),this._setClipboardByRange(t,e),h.DEBUG&&(h.timeEnd("on-copy"),h.profileEnd("on-copy"))},t.prototype._onDeleteSelection=function(){var e=this.getNoteRange();e&&!e.isCollapsed()&&this.execDeleteBackward(e)},t.prototype._onGetDefaultSetFont=function(e){e(this.getDefaultFont())},t.prototype._onKey=function(e,t){var n=this.noteView,o=this.keyHandlerManager;n&&(n.directionKeyJustMoved=!1),o.execWithKey(e,this,t)},t.prototype._onBackupDragRange=function(){var e=this.getNoteRange();e&&!e.isCollapsed()&&(this.dragTextRange=e)},t.prototype._onDragStart=function(e,t){var n,o,i,r=this.getNoteRange().getStartBlockRange();n=_.isTextBlock(t,r)?this.dragTextRange:this.getNoteRange(),this.startNoteRange=n,n&&!n.isCollapsed()?(i=new A({event:e}),o={"text/html":n.getDataAsHtml(this.note),"text/plain":n.getDataAsPlain(this.note),"text/yne-json":n.getDataAsJSON(this.note)},i.setDataMap(o),i.clearData("text/uri-list"),i.setProperty("effectAllowed","move")):h.log("no note range or note range is collapsed!")},t.prototype._onDragOver=function(e,t){var o=e.clientX,i=e.clientY,r=e.dataTransfer.types;if(!n.contains(r,"text/yne-json"))return n.contains(r,"Files")&&(e.preventDefault(),e.stopPropagation()),!0;if(e.preventDefault(),e.stopPropagation(),!this.lastDragOver||this.lastDragOver.x!==o||this.lastDragOver.y!==i){if(!_.isTextBlock(t)&&!_.isListItem(t))return e.dataTransfer.dropEffect="none",void this.removeDragHint();e.dataTransfer.dropEffect="move",!1===this.addDragHint(o,i)&&(e.dataTransfer.dropEffect="none")}},t.prototype._onDrop=function(e){var t,o,r,s,a,l=e.dataTransfer,c=l.types,d=this.noteView;e.preventDefault(),e.stopPropagation(),a=d.getBlock(e.target),(u.IS_MAC||x.isSafari())&&a&&_.isTable(a)?((r=document.createRange()).setStart(e.target,0),r.collapse()):r=this.getRangeByPoint(e.clientX,e.clientY),n.contains(c,"text/yne-json")&&(t=l.getData("text/yne-json"),o=p.parseJSON(t),n.map(o,function(e){e.setId(i.newGUID())}),(s=d.parseNativeRange(r)[0])&&s.isCollapsed()&&d.trigger("command","comp.DragBlocks",{blocks:o,dropRange:s,range:this.startNoteRange})),n.contains(c,"Files")&&this.noteSelection.setRange(r),this.removeDragHint()},t.prototype._onDragEnd=function(){this.removeDragHint()},t.prototype._onHeaderFooterViewTextChange=function(e,t){this.onCommand("comp.SetHeaderFooter",{content:e,headerFooter:t,range:w.createForHeaderFooter(t)})},t.prototype._onGetNoteRange=function(e){e(this.getNoteRange())},t.prototype._onGetBlockView=function(e,t){var n=this.noteView;n&&t(n.getBlockViewByBlock(e))},t.prototype._onEnterTableEdit=function(e){e.blockId&&(this.editor.sendCachedDataCommand(),this._sendBlockLockInfo(e.blockId)),this.trigger("cell-edit-view-enter",e)},t.prototype._onSaveContent=function(){this.trigger("yne-save-content")},t.prototype._onSelectionChange=function(e,t){this.lastDeleteInlineStates?(this.setEditingInlineStates(this.lastDeleteInlineStates),this.lastDeleteInlineStates=null):this._shouldKeepEditingStates(e)||this._updateEditingStates(t),this._notifyEditingStatesChange(),this.trigger("yne-selection-change")},t.prototype._onTextInput=function(e){this.insertText(e,!1)},t.prototype._pasteBlobImg=function(e){var t,n,o=this;(t=e.originalEvent.clipboardData.items)&&1===t.length&&0===t[0].type.indexOf("image")&&(n=t[0].getAsFile(),o.trigger("yne-blob-paste",{data:n,isImg:!0},function(e){e&&e.source&&o.insertImage(e.source)}))},t.prototype._pasteForMac=function(){var e,t,o,i,r,s,a,l=this,c=l.editor,u=window.ynote;if(u&&u.macClipboardData||h.error("YNote does not exist!"),l.isPasteAsText)return e=c.callMacNativeApi("macClipboardData",["text/plain"]),void l._pastePlain(e,l.isPasteAsText);if(!((t=c.callMacNativeApi("macClipboardData",["text/yne-table-json"]))&&l.pasteYTableJson(t)||(o=c.callMacNativeApi("macClipboardData",["text/yne-json"]),i=c.callMacNativeApi("macClipboardData",["text/yne-image-json"]),r=c.callMacNativeApi("macClipboardData",["text/yne-note-id"]),o&&l._pasteJSON(o,i,r))))if((s=c.callMacNativeApi("macClipboardData",["text/html"]))&&l._pasteHTML(s))h.log("mac paste html ok");else{if(a=c.callMacNativeApi("macClipboardData",["image"]))return a=JSON.parse(a),void n.each(a,function(e){l.insertImage(e)});(e=c.callMacNativeApi("macClipboardData",["text/plain"]))&&l._pastePlain(e,l.isPasteAsText)}},t.prototype._pasteJSON=function(e,t,o){h.log("Paste JSON\n",e);var s,a,c=this,u={},d=this.getNoteRange();d.isInSingleBlock()&&_.isCode(d.getStartBlockRange().block)&&(a=!0);var g,f=l.parseImageJson(t),m=p.parseJSON(e,a),y=[],b=[],v={},k={};return n.each(m,function(e){_.isHeading(e)&&(v[e.getId()]=e)}),n.each(m,function(e){var t,n;_.isCatalogue(e)?(t=v[e.getHref()])&&(e.setIndent(t.getLevel()-1),n=i.newGUID(),k[n]=!0,t.setId(n),e.setHref(n)):_.isHeading(e)||(e.setId(i.newGUID()),_.isListItem(e)?(s=e.getListId(),u[s]||(u[s]=r.getOrCreateListById(c.note.getAllBlocks(),s,e.getListType())),e.setOwnerList(u[s])):_.isAttachment(e)?y.push(e):_.isImage(e)&&b.push(e))}),n.each(v,function(e){k[e.getId()]||e.setId(i.newGUID())}),c.note.isSameNote(o)||(g=c._uploadImageData(f||{},y,b)),c._pasteBlockList(m,g)},t.prototype._pasteHTML=function(e){h.log("Paste HTML\n",e);var t=this,o={},r={},s=p.parseHtml(e);return n.each(s,function(e){_.isHeading(e)&&(o[e.getId()]=e)}),n.each(s,function(e){var n,s;if(_.isCatalogue(e)&&(n=o[e.getHref()])&&(e.setIndent(n.getLevel()-1),s=i.newGUID(),r[s]=!0,n.setId(s),e.setHref(s)),_.isTextBlock(e)){var a=t.getNoteRange().getStartBlockRange().block;e.setBlockStyles(a.getBlockStyles())}}),n.each(o,function(e){r[e.getId()]||e.setId(i.newGUID())}),t._pasteBlockList(s)},t.prototype._pastePlain=function(e,t){var o,i,r,s=this,a=s.getNoteRange();return t&&(i=null,r=s.querySelectionBlockStyles(a)),o=p.parsePlain(e,i,r,t),n.each(o,function(e){if(_.isTextBlock(e)){var t=s.getNoteRange().getStartBlockRange().block;e.setBlockStyles(t.getBlockStyles())}}),s._pasteBlockList(o)},t.prototype._pasteBlockList=function(e,t){var o;if(e&&e.length&&(!0===this.removeLocalImg&&(e=n.filter(e,function(e){var o=/^(http:\/\/|https:\/\/|\/\/)/i;return e.getBlockStyle("back-color")&&e.setBlockStyle("back-color",""),_.isImage(e)&&-1===n.indexOf(t||[],e)?o.test(e.getSource())||/^data:.+;base64/i.test(e.getSource()):!_.isAttachment(e)||o.test(e.getResource())})),e&&e.length))return o=this.editingInlineStates,this.editingInlineStates=null,this.execCommand("comp.InsertBlocks",{blocks:e}),this.editingInlineStates=o,!0},t.prototype._redoUndoLocalCmdInCollabMode=function(e){var t;e.collabProperties.isCollabUndo?t=this.cmdManager.getUndoCmd():e.collabProperties.isCollabRedo&&(t=this.cmdManager.getRedoCmd()),t?((t=n.clone(t)).setCmdOriginalNoteVersion(this.note.getFileVersion()),t.isLocalExecutedCmd=!1,e.collabProperties.isCollabUndo?(t.setCollabUndo(!0),t.setCollabRedo(!1)):e.collabProperties.isCollabRedo&&(t.setCollabRedo(!0),t.setCollabUndo(!1)),this.editor.isValidLocalDataCmd(t)?i.isInlineStateSetCommand(t)||this.editor.pushLocalDataCommand(t,!0):h.warn("skip invalid redo/undo local command")):h.warn("skip empty redo/undo local command")},t.prototype._setClipboardByRange=function(e,t){var n,o;e&&!e.isCollapsed()?(n=this.getRangeData(e),new N({event:t}).setDataMap(n),o=e.isInSingleBlock()&&_.isAttachment((e.getStartBlockRange()||{}).block),this.trigger("yne-clipboard-set",o)):h.log("no note range or note range is collapsed!")},t.prototype._sendBlockLockInfo=function(e){this.editor.hasCachedDataCmd()?window.setTimeout(this._sendBlockLockInfo.bind(this,e),100):this.editor.sendBlockLockInfo(e)},t.prototype._shouldKeepEditingStates=function(e){var t,o,i;return!!(e&&e.isCommandType&&e.isCommandType())&&(o=(t=e.getData()||{}).cmdType,i=t.cmdName,n.contains({do:["key.Space","key.Enter","comp.ApplyStyles","comp.IndentOutdent","comp.InsertAttachment","comp.InsertHorizontalRule","comp.InsertImage","comp.InsertList","comp.InsertTable","comp.KeyTab","comp.KeyTextInput"],redo:["comp.ApplyStyles","comp.IndentOutdent","comp.InsertList"],undo:["comp.ApplyStyles","comp.IndentOutdent","comp.InsertList"]}[o],i))},t.prototype._updateDeleteInlineStates=function(e){e&&e.href&&(e=null),this.lastDeleteInlineStates=e},t.prototype._updateEditingStates=function(e){var t=this.getNoteRange(),n=this.queryBackwardFirstInlineStyles(t,e);this.setEditingInlineStates(n)},t.prototype._uploadImageData=function(e,t,o){if(!(n.isEmpty(e)||n.isEmpty(t)&&n.isEmpty(e.data))){var i,r,s,a,l=this,c=e.data,u=l.note,d=l.editor;if(s=l._getUploadData(c,t,o))return i=s.data,r=s.map,a=s.replaceImgList,d.trigger("yne-upload-image",{data:i,isImg:!0},function(e){setTimeout(function(){var t=[],o=[];n.each(e,function(e,i){n.each(r[i],function(i){var r=u.getBlockById(i);r&&(t.push(r),_.isImage(r)?o.push(n.defaults(e,{source:r.getSource()||"uploadfail"})):_.isAttachment(r)&&o.push(n.defaults(e,{resource:r.getResource(),source:r.getSource()})))})}),t.length>0&&(l.execCommand("comp.ReplaceResource",{ignoreUndoRedo:!0,resProps:o,resources:t}),n.each(t,function(e){e.trigger("content-change")}))})},function(){n.each(n.union(t,a),function(e){e.setFakeLoading(!0)})}),a}},t}(d)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(1),i=n(2),r=function(e){var t=document.createElement("CANVAS"),n=t.getContext("2d"),i=null;if(!e)return null;t.height=e.naturalHeight,t.width=e.naturalWidth,n.fillStyle="white",n.fillRect(0,0,t.width,t.height),n.drawImage(e,0,0);try{i=t.toDataURL("image/jpeg",1)}catch(e){o.warn(e.message)}return i};return{getBase64Data:function(e){if(!e)return{};var n,o={data:{}},i=o.data;return t.each(e,function(e){(n=r(e.img))&&(i[e.source]={base64:n})}),o},parseImageJson:function(e){var t=null;if(!e)return null;try{t=JSON.parse(e)}catch(e){return o.error("no imagejson or parse imagejson error"),null}return t},base64ToBlob:function(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],o=atob(t[1]),i=o.length,r=new Uint8Array(i);i--;)r[i]=o.charCodeAt(i);return new Blob([r],{type:n})},imgToBase64:r,setBlockIds:function(e,n){var o=[];return t.each(e,function(e){if(i.isImage(e)){var t=e.getSource(),r=n[t];r&&r.base64&&(o.push(e),r.imgBlockIds?r.imgBlockIds.push(e.getId()):r.imgBlockIds=[e.getId()])}}),o}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(16),o=n(1),i=n(4),r=n(14),s=n(3);return n(293),t.extend({_editor:null,initialize:function(e){this._editor=e.editor},create:function(e,t,n){var a,l=null;if(n.collabProperties=n.collabProperties||{},e+="",a=i.get(e)){if(l=new a({note:t,args:n}),!this._editor.isCollabEnabled())return l.isSimple||l.setStartingRange(n.range),l;if(n.collabProperties.dataCmdError)return o.error(n.collabProperties.dataCmdError),null;if(l.isSimple)return l;!s.isCollabCommand(n)&&l.isOriginalCmd&&(r.isNoteRange(n.range)?l.setStartingRange(n.range):(n.collabProperties.dataCmdError="original cmd args.range should be noteRange",l=null))}else o.warn("No class for `"+e+"` command");return l}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){n(159),n(294),n(295),n(296),n(297),n(298),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(308),n(309),n(311),n(312),n(313),n(314),n(315),n(316),n(317),n(318),n(319),n(320),n(322),n(323),n(324),n(326),n(328),n(330),n(332),n(333),n(335),n(337),n(338),n(339)}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(11),s=n(22),a=n(57),l=n(3);return t=o.extend({name:"comp.AppendBlank",_cmdArgs:null,_note:null,_newBlkId:null,_preBlkId:null,_preBlock:null,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args||{},l.isCollabCommand(this._cmdArgs)||(this._newBlkId=l.newGUID(),this._preBlock=this._note.getLastBlock(),this._preBlock&&(this._preBlkId=this._preBlock.getId())),t.__super__.initialize.apply(this,arguments)},apply:function(){var e,t;return e=r.createNewParagraph(this._preBlock,this._newBlkId,""),r.setBlockStyle(e,this._cmdArgs.inlineStyles),!1!==this.executeAtomicCommand(new s({note:this._note,newBlks:[e],preBlk:this._preBlock}))&&(t=a.buildNoteRangeFromParagraph(e,0,0),this.setEndingRange(t),!0)},fromCollabJSON:function(){var e=this.options.args.collabProperties.cmdJSON;e&&(this._newBlkId=e.newBlkId,e.preBlkId&&(this._preBlock=this._note.getBlockById(e.preBlkId))),t.__super__.fromCollabJSON.apply(this)},toCollabJSON:function(){var e;return this.rangeIsRequired=!1,this.resetAffectedBlockIds(),(e=t.__super__.toCollabJSON.apply(this)).newBlkId=this._newBlkId,this._preBlkId&&(e.preBlkId=this._preBlkId),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(1),s=n(0),a=n(11),l=n(3);return t=o.extend({name:"comp.ApplyStyles",_note:null,_cmdArgs:null,_blockStyleNameValues:null,_inlineStyleNameValues:null,initialize:function(){var e;if(this._note=this.options.note,this._cmdArgs=this.options.args,e=this._cmdArgs.range,t.__super__.initialize.apply(this),!l.isCollabCommand(this._cmdArgs)){if(!e)return r.error("note range should NOT be null:",this.name),void(this.isReadyToApply=!1);this._blockStyleNameValues=this._cmdArgs.blockStyles,this._inlineStyleNameValues=this._cmdArgs.inlineStyles}},apply:function(){var e=this._cmdArgs.range;return!a.setStylesOnNoteRange(this,this._note,e,s.clone(this._blockStyleNameValues),s.clone(this._inlineStyleNameValues))&&(this.setEndingRange(e),!0)},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;e&&(e.blockStyles&&(this._blockStyleNameValues=e.blockStyles),e.inlineStyles&&(this._inlineStyleNameValues=e.inlineStyles)),t.__super__.fromCollabJSON.apply(this)},isInlineStateSet:function(){var e=this._cmdArgs.range,t=!1;return e&&e.isCollapsed()&&(!this._blockStyleNameValues||s.isEmpty(this._blockStyleNameValues))&&this._inlineStyleNameValues&&!s.isEmpty(this._inlineStyleNameValues)&&(t=!0),t},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e&&(this._blockStyleNameValues&&!s.isEmpty(this._blockStyleNameValues)&&(e.blockStyles=this._blockStyleNameValues),this._inlineStyleNameValues&&!s.isEmpty(this._inlineStyleNameValues)&&(e.inlineStyles=this._inlineStyleNameValues)),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(162),i=n(4),r=n(1),s=n(3);return t=o.extend({name:"comp.DeleteNoteRange",_cmdArgs:null,_note:null,initialize:function(){var e;if(this._note=this.options.note,this._cmdArgs=this.options.args,t.__super__.initialize.apply(this),!s.isCollabCommand(this._cmdArgs)){if(!(e=this._cmdArgs.range))return this.isReadyToApply=!1,void r.error("note range should NOT be null",this.name);if(e.isCollapsed()&&!this._cmdArgs.isTableDelete&&!this._cmdArgs.isCodeDelete)return this.isReadyToApply=!1,r.error("should NOT trigger the cmd when NoteRange is collapsed",e),!1}},isSingleBlockAffected:function(){var e,n,o=this._args.range,i=t.__super__.isSingleBlockAffected.apply(this),r=0;return i&&o&&o.isCollapsed()&&(e=(n=o.getStartBlockRange()).block,r=n.start,this._note.getNextBlock(e)&&r===e.getEndOffset()&&(i=!1)),i}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(1),s=n(0),a=n(2),l=n(48),c=n(10),u=n(11),d=n(14),h=n(22),p=n(58),g=n(85),f=n(49),m=n(23),_=n(26),y=n(103),b=n(3);return t=o.extend({name:"comp.DragBlocks",_note:null,_cmdArgs:null,_dropBlockRange:null,_insertedBlocks:null,_newEndBlankParaId:null,_insertedBlocksJSON:null,initialize:function(){var e,n=this;if(n._note=n.options.note,n._cmdArgs=n.options.args,t.__super__.initialize.apply(n),!b.isCollabCommand(n._cmdArgs)){if(!(e=n._cmdArgs.range))return r.error(n.name+":note range should NOT be null"),void(n.isReadyToApply=!1);if(n._dropBlockRange=n._cmdArgs.dropRange,n._insertedBlocks=[],n._insertedBlocksJSON=[],s.each(n._cmdArgs.blocks,function(e){n._insertedBlocks.push(e),n._insertedBlocksJSON.push(e.toCollabJSON())}),n._newEndBlankParaId=b.newGUID(),!(n._dropBlockRange&&n._dropBlockRange.block&&a.isTextBlock(n._dropBlockRange.block)&&n._dropBlockRange.isCollapsed()))return n.isReadyToApply=!1,void r.error("drag destination should be a single pos in text block",n._dropBlockRange);if(n._isDropRangeInStartNoteRange(n._dropBlockRange))return n.isReadyToApply=!1,void r.error("dropBlockRange should not be in the startNoteRange",e,n._dropBlockRange)}},apply:function(){var e;return e=_.createRangeByBlock({block:this._dropBlockRange.block,start:this._dropBlockRange.start,end:this._dropBlockRange.end}),this._dropBlockRange.hasOwnProperty("startLineCharIndex")&&(e=this._dropBlockRange.clone()),e=this._handleStartNoteRangeData(e),this._insertDraggedData(e),!0},_handleStartNoteRangeData:function(e){var t,n,o,i,r,l,c,d=this._cmdArgs.range,h=[];if(n=(t=d.getStartBlockRange()).block,i=(o=d.getEndBlockRange()).block,c=this._isFullSelectionInTextBlock(t),d.isCollapsed()||t.selectWholeBlock||u.deleteSelectedContent(this,this._note,d),d.isInMultiBlock())a.isTextBlock(n)&&!n.isEmpty()||(h.push(n),n=null),a.isTextBlock(i)&&!i.isEmpty()||(h.push(i),i=null),s.isEmpty(h)&&(e.block.getId()===i.getId()&&(e=this._rebuildDropRangeWhenNoteRangeMerge(t,o,e)),a.isCode(n)||a.isCode(i)||(this.executeAtomicCommand(new p({block:n,start:n.getLength(),text:i.getText()})),h.push(i))),h.length&&this.executeAtomicCommand(new m({note:this._note,blocks:h}));else if(a.isTextBlock(n,t))c&&(r=this._note.getPreBlock(n),l=this._note.getNextBlock(n),a.isImage(r)||a.isImage(l)||a.isAttachment(r)||a.isAttachment(l)||a.isTable(r)||a.isTable(l)||(this.executeAtomicCommand(new m({note:this._note,blocks:[n]})),n=null));else{if(a.isCode(n)&&u.replaceBlockWithParagraph(this,this._note,n,""),a.isCode(e.block))return e;u.replaceBlockWithParagraph(this,this._note,n,""),n=null}return e},_insertDraggedData:function(e){var t,n,o,i,r,l,c=this._cmdArgs.range,g=this._insertedBlocks[0],y=s.last(this._insertedBlocks),b=e.block;(t=c.getStartBlockRange()).block.getId(),(n=c.getEndBlockRange()).block.getId(),this._tuneDropBlockRange(e,t,n),a.isCode(e.block)?this._handleInCode(e):(a.isTextBlock(g,t)&&!a.isHeading(g)?(this._insertedBlocks.shift(),this.executeAtomicCommand(new p({block:e.block,start:e.start,text:g.getText()})),l=r=_.createRangeByBlock({block:e.block,start:e.start,end:e.start+g.getLength()}),e.start+=g.getLength(),e.end=e.start):l=r=_.createRangeByBlock({block:this._insertedBlocks[0]}),s.isEmpty(this._insertedBlocks)||(o=e.block.sliceText(e.start,e.block.getLength()),c.isInMultiBlock()&&(l=a.isTextBlock(y)?_.createRangeByBlock({block:y,start:0,end:y.getLength()}):_.createRangeByBlock({block:y})),0===e.start?(b=this._note.getPreBlock(e.block),a.isTextBlock(y,n)?(y.append(o),this.executeAtomicCommand(new m({note:this._note,blocks:[e.block]}))):0===e.block.getLength()&&this.executeAtomicCommand(new m({note:this._note,blocks:[e.block]}))):e.start<e.block.getLength()&&(this.executeAtomicCommand(new f({block:e.block,start:e.start,end:e.block.getLength()})),a.isTextBlock(y,n)?(y.append(o),a.isCode(y)&&(this._insertedBlocks.pop(),y=u.createNewParagraph(e.block,null,y.getText()),this._insertedBlocks.push(y))):(i=a.isListItem(e.block)?u.createNewListItem(e.block,this._newEndBlankParaId,o):a.isHeading(e.block)?u.createNewHeading(e.block,this._newEndBlankParaId,o,e.block.getLevel()):a.isTodo(e.block)?u.createNewTodo(e.block,{id:this._newEndBlankParaId,text:o,checked:e.block.getChecked()}):a.isQuote(e.block)?u.createNewQuote(e.block,{id:this._newEndBlankParaId,text:o}):a.isCode(e.block)?u.createNewCode(e.block,{id:this._newEndBlankParaId,text:e.block.getText()}):u.createNewParagraph(e.block,this._newEndBlankParaId,o),this._insertedBlocks.push(i),c.isInMultiBlock()&&(l=_.createRangeByBlock({block:i,start:0,end:0})))),this.executeAtomicCommand(new h({note:this._note,newBlks:this._insertedBlocks,preBlk:b}))),this.setEndingRange(d.create({startRange:r,endRange:l})))},_isDropRangeInStartNoteRange:function(e){var t,n=this._cmdArgs.range,o=n.getStartBlockRange(),i=n.getEndBlockRange(),r=e,a=r.block.getId(),l=!1;return a===o.block.getId()&&r.start>=o.start&&r.start<=o.end&&(l=!0),!l&&n.isInMultiBlock()&&(a===i.block.getId()&&r.start>=i.start&&r.start<=i.end?l=!0:(t=this._note.getInterBlocks(o.block,i.block),s.some(t,function(e){return a===e.getId()&&(l=!0),l}))),l},_isFullSelectionInTextBlock:function(e){var t=!1,n=0;return a.isTextBlock(e.block)&&(n=e.block.getLength()),n>0&&0===e.start&&e.end===n&&(t=!0),t},_handleInCode:function(e){var t,n=e,o=[];s.each(this._insertedBlocks,function(e){a.isTextBlock(e)&&o.push(e.getText().toString())}),o.length&&(this.executeAtomicCommand(new g({block:n.block,startBlockRange:n,text:new c({text:o.join(l.LINE_BREAK)})})),(t=o.reduce(function(e,t){var n=t.split(l.LINE_BREAK);return t.length>0&&t[t.length-1]===l.LINE_BREAK&&n.pop(),e.concat(n)},[])).length>1?u.expandCodeRange(this,n,t[t.length-1].length,t.length-1):u.expandCodeRange(this,n,t[0].length))},_rebuildDropRangeWhenNoteRangeMerge:function(e,t,n){var o;return o=n.start+e.start-t.end,_.createRangeByBlock({block:e.block,start:o,end:o})},_tuneDropBlockRange:function(e,t,n){var o=t.block.getId(),i=n.block.getId();e.block.getId()===o&&e.start>t.end&&(e.start-=t.end-t.start,e.end-=e.start),o!==i&&e.block.getId()===i&&e.start>n.end&&(e.start-=n.end-n.start,e.end-=e.start)},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties.cmdJSON,i=n.collabProperties.coreEditor;t.__super__.fromCollabJSON.apply(e),o&&(e._newEndBlankParaId=o.newEndBlkId,e._dropBlockRange=i.buildBlockRangeFromJSON(o.dropRange),e._insertedBlocks=[],s.each(o.insertedBlocks,function(t){e._insertedBlocks.push(y.buildBlockFromJSON(t,i))}))},isSingleBlockAffected:function(){var e=this._cmdArgs.range,t=e.getStartBlockRange();return!(!e.isInSingleBlock()||this._dropBlockRange.block.getId()!==t.block.getId())},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e&&(e.newEndBlkId=this._newEndBlankParaId,e.dropRange=this._dropBlockRange.toCollabJSON(),e.insertedBlocks=this._insertedBlocksJSON),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(11),s=n(6),a=n(0),l=n(1),c=n(3);return t=o.extend({name:"comp.FormatPainter",_cmdArgs:null,_note:null,_inlineStyles:null,_blockStyles:null,initialize:function(){var e;if(this._note=this.options.note,this._cmdArgs=this.options.args||{},e=this._cmdArgs.range,t.__super__.initialize.apply(this,arguments),!c.isCollabCommand(this._cmdArgs)){if(!e)return l.error(this.name+":note range should NOT be null"),void(this.isReadyToApply=!1);this._inlineStyles=this._cmdArgs.data.inlineStyles,this._blockStyles=this._cmdArgs.data.blockStyles}},apply:function(){var e=this._cmdArgs.range,t={},n={};return!!e.isCollapsed()||(a.each(this._inlineStyles,function(e,n){"href"!==n&&e!==s.INTERM&&null!=e&&(t[n]=e)}),a.each(this._blockStyles,function(e,t){e!==s.INTERM&&null!=e&&(n[t]=e)}),r.resetAllStyles(this,this._note,e),r.setStylesOnNoteRange(this,this._note,e,n,t),this.setEndingRange(e),!0)},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;e&&(this._inlineStyles=e.inlineStyles,this._blockStyles=e.blockStyles),t.__super__.fromCollabJSON.apply(this)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this)).inlineStyles=this._inlineStyles,e.blockStyles=this._blockStyles,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(2),s=n(11),a=n(1),l=n(105),c=n(3);return t=o.extend({name:"comp.IndentOutdent",_cmdArgs:null,_note:null,_indentStep:null,initialize:function(){var e,n;if(this._note=this.options.note,this._cmdArgs=this.options.args||{},t.__super__.initialize.apply(this,arguments),!c.isCollabCommand(this._cmdArgs)){if(e=this._cmdArgs.range,this._indentStep=this._cmdArgs.indentStep,!e||!e.canDrawedByNative())return a.error(this.name+":note range should NOT be null or cannot be Drawed by native"),void(this.isReadyToApply=!1);if(n=e.getStartBlockRange().block,e.isInSingleBlock()&&!r.isTextBlock(n))return void(this.isReadyToApply=!1)}},apply:function(){var e,t,n,o=this._cmdArgs.range;return e=o.getStartBlockRange().block,t=o.getEndBlockRange().block,o.isInMultiBlock()?(n=this._note.getInterBlocks(e,t,!0),s.isInSameList(n)?this._isFirstListItem(n[0])?s.updateBlocksIndentLevel(this,n[0].getOwnerList().getItems(),this._indentStep):this.executeAtomicCommand(new l({listItems:n,deltaLevel:this._indentStep})):s.updateBlocksIndentLevel(this,n,this._indentStep),this.setEndingRange(o),!0):(r.isListItem(e)?this._isFirstListItem(e)?s.updateBlocksIndentLevel(this,e.getOwnerList().getItems(),this._indentStep):this.executeAtomicCommand(new l({listItems:[e],deltaLevel:this._indentStep})):s.updateBlocksIndentLevel(this,[e],this._indentStep),this.setEndingRange(o),!0)},_isFirstListItem:function(e){return 1===e.getLevel()&&1===e.getIndex()},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;e&&(this._indentStep=e.indentStep),t.__super__.fromCollabJSON.apply(this)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.indentStep=this._indentStep),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(86),i=n(4),r=n(2),s=n(79),a=n(68),l=n(22),c=n(72),u=n(3),d=n(11);return t=o.extend({name:"comp.InsertAttachment",_cmdArgs:null,_note:null,_attachBlkId:null,_attachSrc:null,_attachRes:null,_attachFileName:null,_attchFileLen:null,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args||{},t.__super__.initialize.apply(this,arguments),u.isCollabCommand(this._cmdArgs)||(this._attachBlkId=u.newGUID(),this._attachSrc=this._cmdArgs.src,this._attachRes=this._cmdArgs.resource,this._attachFileName=this._cmdArgs.fileName,this._attchFileLen=this._cmdArgs.fileLength)},insertResource:function(e,t,n){var o,i=this._cmdArgs.range,a=[];return r.isTable(e)&&i.isSingleTableSelected()?this._insertAttachmentInTable(e):(o=new s({source:this._attachSrc,resource:this._attachRes,fileName:this._attachFileName,fileLength:this._attchFileLen}),d.setResourceBlockStyleByPreBlock(o,e),t&&a.push(t),a.push(o),n&&a.push(n),o.setId(this._attachBlkId),this.executeAtomicCommand(new l({note:this._note,newBlks:a,preBlk:e})),o)},_insertAttachmentInTable:function(e){var t,n=this._cmdArgs.range.getStartBlockRange().getAsRectRange();if(n)return t=n.getFirstCellRect(),this.executeAtomicCommand(new c({table:e,cellRect:t,content:new a({source:this._attachSrc,resource:this._attachRes,fileName:this._attachFileName,fileLength:this._attchFileLen})})),e},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._attachBlkId=e.newBlkId,this._attachSrc=e.src,this._attachRes=e.attachRes,this._attachFileName=e.fileName,this._attchFileLen=e.fileLen)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.newBlkId=this._attachBlkId,e.src=this._attachSrc,e.attachRes=this._attachRes,e.fileName=this._attachFileName,e.fileLen=this._attchFileLen),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(1),s=n(0),a=n(2),l=n(11),c=n(14),u=n(22),d=n(58),h=n(85),p=n(23),g=n(49),f=n(131),m=n(26),_=n(103),y=n(10),b=n(48),v=n(3);return t=o.extend({name:"comp.InsertBlocks",_note:null,_cmdArgs:null,_insertedBlocks:null,_newEndBlankParaId:null,_insertedBlocksJSON:null,initialize:function(){var e=this;if(e._note=e.options.note,e._cmdArgs=e.options.args,t.__super__.initialize.apply(e),!v.isCollabCommand(e._cmdArgs)){if(!e._cmdArgs.range)return r.error(e.name+":note range should NOT be null"),void(e.isReadyToApply=!1);e._insertedBlocks=[],e._insertedBlocksJSON=[],s.each(e._cmdArgs.blocks,function(t){e._insertedBlocks.push(t),e._insertedBlocksJSON.push(t.toCollabJSON())}),e._newEndBlankParaId=v.newGUID()}},apply:function(){var e,t,n,o=this,i=o._note,r=o._cmdArgs.range,c=r.getStartBlockRange(),u=c.block,d=u.getBlockStyles(),h=s.last(o._insertedBlocks);return o._getCollabRequiredData(o._insertedBlocks),o._insertedBlocks=o._insertedBlocks.map(function(e){return d&&d["back-color"]&&e.setBlockStyle("back-color",d["back-color"]),e}),a.isTextBlock(h)?t=m.createRangeByBlock({block:h,start:h.getLength(),end:h.getLength()}):(n=i.getNextBlock(o.startingRange.getEndBlockRange().block),a.isTextBlock(n)&&(t=m.createRangeByBlock({block:n,start:n.getLength(),end:n.getLength()}))),r.isCollapsed()||a.isCode(u)||l.deleteSelectedContent(o,o._note,r),a.isCode(u)&&!c.selectWholeBlock?(o._handleInCode(),!0):(o._insertedBlocks=o._insertedBlocks.reduce(function(e,t,n){var i;return 0!==n&&n!==o._insertedBlocks.length-1||t.isSelectedBlock?e.push(t):(i=l.convertCodeToPara(t),Array.isArray(i)?i.map(function(t){e.push(t)}):e.push(i)),e},[]),e=r.isInMultiBlock()?o._handleMultiBlockSelection(t):o._handleSingleBlockSelection(t),o.setEndingRange(e),!0)},_handleMultiBlockSelection:function(e){var t=this._cmdArgs.range,n=t.getStartBlockRange(),o=n.block,i=t.getEndBlockRange(),r=i.block,s=this._insertedBlocks[0];return 1===this._insertedBlocks.length&&a.isTextBlock(s)&&a.isTextBlock(o)&&a.isTextBlock(r)?(this._insertedBlocks.shift(),e=m.createRangeByBlock({block:o,start:o.getLength()+s.getLength(),end:o.getLength()+s.getLength()}),s.append(r.getText()),this.executeAtomicCommand(new p({note:this._note,blocks:[r]})),this.executeAtomicCommand(new d({block:o,start:o.getLength(),text:s.getText()}))):e=this._insertBlocksBetweenStartEndBlock(n,i,e),c.create({startRange:e,endRange:e})},_getCollabRequiredData:function(e){var t=[];e&&e.length>0&&s.each(e,function(e){t.push(e.getId())}),t.push(this._newEndBlankParaId),this.pushAffectedBlockIds(t)},_handleSingleBlockSelection:function(e){var t,n=this,o=n._cmdArgs.range.getStartBlockRange(),i=o.block;return t=a.isTextBlock(i,o)?n._handleSingleTextStartBlock(i,e):n._handleSingleNonTextStartBlock(i,e),s.isEmpty(n._insertedBlocks)||(t.needToRebuildLIs&&n._rebuildListItems(n._insertedBlocks,t.refBlockForInsert,t.deltaLevel),a.isQuote(t.refBlockForInsert)&&(n._insertedBlocks=n._insertedBlocks.map(function(e){return a.isParagraph(e)?new l.createNewQuote(e,{id:e.getId(),text:e.getText(),checked:n._checked}):e})),n.executeAtomicCommand(new u({note:n._note,newBlks:n._insertedBlocks,preBlk:t.refBlockForInsert}))),c.create({startRange:t.newEndBlockRange,endRange:t.newEndBlockRange})},_handleSingleNonTextStartBlock:function(e,t){var n=this._insertedBlocks[0],o=s.last(this._insertedBlocks),i=this._note.getPreBlock(e),r=this._note.getNextBlock(e),c={};return c.refBlockForInsert=i,c.newEndBlockRange=t,c.needToRebuildLIs=!1,this.executeAtomicCommand(new p({note:this._note,blocks:[e]})),a.isTextBlock(n)||a.isTextBlock(i)||this._insertedBlocks.unshift(l.createNewParagraph(e,e.getId(),"")),a.isTextBlock(o)||a.isTextBlock(r)||(this._insertedBlocks.push(l.createNewParagraph(e,this._newEndBlankParaId,"")),c.newEndBlockRange=m.createRangeByBlock({block:s.last(this._insertedBlocks),start:0,end:0})),c},_handleSingleTextStartBlock:function(e,t){var n,o=this._cmdArgs.range.getStartBlockRange(),i=this._note.getPreBlock(e),r=this._note.getNextBlock(e),l=this._insertedBlocks[0],c=s.last(this._insertedBlocks),u="",h=1===this._insertedBlocks.length,_={};return _.refBlockForInsert=e,_.newEndBlockRange=t,_.needToRebuildLIs=!1,_.deltaLevel=0,o.start<e.getLength()&&(u=e.sliceText(o.start,e.getLength())),h&&a.isTextBlock(l)&&!a.isCode(l)||(a.isTextBlock(c)&&!a.isCode(l)?(n=u instanceof y?u:y.createBlank(),c.append(n),this.executeAtomicCommand(new g({block:e,start:o.start,end:e.getLength()}))):""===u&&a.isTextBlock(r)?_.newEndBlockRange=m.createRangeByBlock({block:r,start:0,end:0}):(this._insertedBlocks.push(this._buildNewBlockFromStartBlock(e,this._newEndBlankParaId,u)),_.newEndBlockRange=m.createRangeByBlock({block:s.last(this._insertedBlocks),start:0,end:0}),this.executeAtomicCommand(new g({block:e,start:o.start,end:e.getLength()})))),a.isTextBlock(l)&&!a.isCode(l)?e.getLength()>0||a.isListItem(e)||!a.isListItem(l)&&!a.isHeading(l)&&!a.isCatalogue(l)&&!a.isTodo(l)&&!a.isQuote(l)?(this._insertedBlocks.shift(),h&&(_.newEndBlockRange=m.createRangeByBlock({block:e,start:o.start+l.getLength(),end:o.start+l.getLength()})),this.executeAtomicCommand(new f({blocks:[e],styleNameValues:l.getBlockStyles()})),this.executeAtomicCommand(new d({block:e,start:o.start,text:l.getText()})),a.isListItem(e)&&a.isListItem(this._insertedBlocks[0])&&(_.needToRebuildLIs=!0,a.isListItem(l)&&(_.deltaLevel=this._insertedBlocks[0].getLevel()-l.getLevel()))):(_.refBlockForInsert=i,this.executeAtomicCommand(new p({note:this._note,blocks:[e]})),a.isListItem(i)&&a.isListItem(l)&&(_.needToRebuildLIs=!0,_.deltaLevel=1-i.getLevel())):0===e.getLength()&&a.isTextBlock(i)&&(_.refBlockForInsert=i,this.executeAtomicCommand(new p({note:this._note,blocks:[e]}))),_},_handleInCode:function(){var e,t=this._cmdArgs.range,n=t.getStartBlockRange(),o=[];s.each(this._insertedBlocks,function(e){a.isTextBlock(e)&&o.push(e.getText().toString())}),t.isCollapsed()||l.deleteSelectedContent(this,this._note,t),o.length&&(this.executeAtomicCommand(new h({block:n.block,startBlockRange:n,text:new y({text:o.join(b.LINE_BREAK)})})),(e=o.reduce(function(e,t){var n=t.split(b.LINE_BREAK);return t.length>0&&t[t.length-1]===b.LINE_BREAK&&n.pop(),e.concat(n)},[])).length>1?l.setCodeBlockAsEndingRange(this,n,e[e.length-1].length,e.length-1):l.setCodeBlockAsEndingRange(this,n,e[0].length))},_buildNewBlockFromStartBlock:function(e,t,n){return a.isHeading(e)?l.createNewHeading(e,t,n,e.getLevel()):a.isCatalogue(e)?l.createNewCatalogue(e,{paraId:t,text:n,href:e.getHref()}):a.isListItem(e)?l.createNewListItem(e,t,n):a.isTodo(e)?l.createNewTodo(e,{id:t,text:n,checked:e.getChecked()}):a.isQuote(e)?l.createNewQuote(e,{id:t,text:n}):l.createNewParagraph(e,t,n)},_insertBlocksBetweenStartEndBlock:function(e,t,n){var o=e.block,i=t.block,r=this._note.getPreBlock(o),c=this._note.getNextBlock(i),u=this._insertedBlocks[0],h=s.last(this._insertedBlocks),g=o,f=[],_=0;return a.isTextBlock(i)?a.isTextBlock(h)?(f.push(i),h.append(i.getText())):a.isTextBlock(h)||(n=m.createRangeByBlock({block:i,start:0,end:0})):(f.push(i),a.isTextBlock(c)||a.isTextBlock(h)?a.isTextBlock(h)||(n=m.createRangeByBlock({block:c,start:0,end:0})):(this._insertedBlocks.push(l.createNewParagraph(i,i.getId(),"")),n=m.createRangeByBlock({block:s.last(this._insertedBlocks),start:0,end:0}))),a.isTextBlock(o)?a.isTextBlock(u)?o.getLength()>0||a.isListItem(o)||!a.isListItem(u)?(this._insertedBlocks.shift(),this.executeAtomicCommand(new d({block:o,start:o.getLength(),text:u.getText()})),a.isListItem(u)&&a.isListItem(this._insertedBlocks[0])&&(_=this._insertedBlocks[0].getLevel()-u.getLevel())):(g=r,this.executeAtomicCommand(new p({note:this._note,blocks:[o]}))):0===o.getLength()&&a.isTextBlock(r)&&(g=r,this.executeAtomicCommand(new p({note:this._note,blocks:[o]}))):(f.push(o),g=r,a.isTextBlock(r)||a.isTextBlock(u)||this._insertedBlocks.unshift(l.createNewParagraph(o,o.getId(),""))),s.isEmpty(f)||this.executeAtomicCommand(new p({note:this._note,blocks:f})),this._insertedRemainedBlocks(g,_),n},_insertedRemainedBlocks:function(e,t){s.isEmpty(this._insertedBlocks)||(a.isListItem(this._insertedBlocks[0])&&a.isListItem(e)&&this._rebuildListItems(this._insertedBlocks,e,t),this.executeAtomicCommand(new u({note:this._note,newBlks:this._insertedBlocks,preBlk:e})))},_rebuildListItems:function(e,t,n){var o,i,r,l=e[0];isNaN(n)&&(n=0),i=l.listId,o=t.getOwnerList(),r=t.getLevel()-l.getLevel()+n,s.chain(e).groupBy(function(e){if(a.isListItem(e))return e.listId}).each(function(e,t){e.length>0&&t===i&&s.each(e,function(e){0!==r&&e.setLevel(e.getLevel()+r),e.setOwnerList(o)})})},fromCollabJSON:function(){var e=this,n=e.options.args,o=n.collabProperties.cmdJSON,i=n.collabProperties.coreEditor;t.__super__.fromCollabJSON.apply(e),o&&(e._newEndBlankParaId=o.newEndBlkId,e._insertedBlocks=[],s.each(o.insertedBlocks,function(t){e._insertedBlocks.push(_.buildBlockFromJSON(t,i))}))},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e&&(e.newEndBlkId=this._newEndBlankParaId,e.insertedBlocks=this._insertedBlocksJSON),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(0),i=n(86),r=n(4),s=n(52),a=n(64),l=n(6),c=n(11),u=n(22),d=n(3);return t=i.extend({name:"comp.InsertCatalogue",_cmdArgs:null,_note:null,_blkId:null,_ownerId:null,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args||{},t.__super__.initialize.apply(this,arguments),this._initBlocks()},_initBlocks:function(){var e,t,n=this,i=n._note.blocks,r=[],u=[];n._ownerId=n._ownerId||d.newGUID(),t=new a({id:n._ownerId}),o.each(i,function(e){c.isForCatalogueBlock(e)&&r.push(e)}),n._catalogueIds=n._catalogueIds||[],o.each(r,function(o,i){e=new s({indent:o.getLevel()-1,text:o.getText().toString().trim(),href:o.getId(),ownerList:t}),u.push(e),n._catalogueIds[i]?e.setId(n._catalogueIds[i]):n._catalogueIds[i]=e.getId()}),0===r.length&&(e=new s({indent:0,text:l.INSERT_BLANK_CATALOGUE_TEXT,ownerList:t}),u.push(e),n._catalogueIds[0]?e.setId(n._catalogueIds[0]):n._catalogueIds[0]=e.getId()),n._newCatalogues=u},insertResource:function(e,t,n){var i=this._newCatalogues,r=i[i.length-1];return o.each(i,function(t){c.setResourceBlockStyleByPreBlock(t,e)}),i.length<1?e:(t&&i.unshift(t),n&&i.push(n),this.executeAtomicCommand(new u({note:this._note,newBlks:i,preBlk:e})),r)},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._ownerId=e.listId,this._catalogueIds=e.blockIds)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.listId=this._ownerId,e.blockIds=this._catalogueIds),e}}),r.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(11),r=n(4),s=n(14),a=n(26),l=n(3),c=n(2);return t=o.extend({name:"comp.InsertHeading",_cmdArgs:null,_note:null,_blkId:null,_level:null,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args||{},this._level=this._cmdArgs.level,t.__super__.initialize.apply(this,arguments),l.isCollabCommand(this._cmdArgs)||(this._blkId=l.newGUID())},apply:function(){var e,t,n,o=this,r=o._cmdArgs.range,l=r.getStartBlockRange(),u=r.getEndBlockRange(),d=l.block,h=u.block;if(r.isInMultiBlock())(n=o._note.getInterBlocks(d,h,!0)).forEach(function(i,r){0!==r?r!==n.length-1?o._helpSetBlock(i):t=o._helpSetBlock(i):e=o._helpSetBlock(i)}),o.setEndingRange(new s({startRange:a.createRangeByBlock({block:e,start:l.start,end:l.end}),endRange:a.createRangeByBlock({block:t,start:u.start,end:u.end})}));else{if(!c.isTextBlock(h))return!1;t=o._helpSetBlock(h),i.setTextBlockAsEndingRange(o,t,u.start,u.end)}},_helpSetBlock:function(e){return c.isTextBlock(e)?"default"===this._level||c.isHeading(e)&&e.getLevel()===this._level?i.replaceBlockWithParagraph(this,this._note,e,e.getText(),"",!0):i.replaceBlockWithHeading(this,this._note,e,e.getText(),this._level):e},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._blkId=e.blockId,this._level=e.listType)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.blockId=this._blkId,e.listType=this._level),e}}),r.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(86),i=n(4),r=n(78),s=n(22),a=n(3);return t=o.extend({name:"comp.InsertHorizontalRule",_cmdArgs:null,_note:null,_hLineBlkId:null,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args||{},t.__super__.initialize.apply(this,arguments),a.isCollabCommand(this._cmdArgs)||(this._hLineBlkId=a.newGUID())},insertResource:function(e,t,n){var o,i,a=[];return(o=new r).setId(this._hLineBlkId),e&&((i=e.getBlockStyles())["back-color"]&&o.setBlockStyle("back-color",i["back-color"]),i.padding&&o.setBlockStyle("padding",i.padding)),t&&a.push(t),a.push(o),n&&a.push(n),this.executeAtomicCommand(new s({note:this._note,newBlks:a,preBlk:e})),o},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._hLineBlkId=e.newBlkId)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.newBlkId=this._hLineBlkId),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(86),i=n(4),r=n(2),s=n(69),a=n(54),l=n(22),c=n(72),u=n(3),d=n(11);return t=o.extend({name:"comp.InsertImage",_cmdArgs:null,_note:null,_imgBlkId:null,_imgSrc:null,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args||{},t.__super__.initialize.apply(this,arguments),u.isCollabCommand(this._cmdArgs)||(this._imgBlkId=u.newGUID(),this._imgSrc=this._cmdArgs.src)},insertResource:function(e,t,n){var o,i,s=this._cmdArgs.range,c=[];return r.isTable(e)&&s.isSingleTableSelected()?this._insertImageInTable(e):(i=new a({source:this._imgSrc}),e&&((o=e.getBlockStyles())["back-color"]&&i.setBlockStyle("back-color",o["back-color"]),o.padding&&i.setBlockStyle("padding",o.padding)),d.setResourceBlockStyleByPreBlock(i,e),t&&c.push(t),c.push(i),n&&c.push(n),i.setId(this._imgBlkId),this.executeAtomicCommand(new l({note:this._note,newBlks:c,preBlk:e})),i)},_insertImageInTable:function(e){var t,n=this._cmdArgs.range.getStartBlockRange().getAsRectRange();if(n)return t=n.getFirstCellRect(),this.executeAtomicCommand(new c({table:e,cellRect:t,content:new s({source:this._imgSrc})})),e},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._imgBlkId=e.newBlkId,this._imgSrc=e.src)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.newBlkId=this._imgBlkId,e.src=this._imgSrc),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(10),s=n(11),a=n(1),l=n(0),c=n(2),u=n(84),d=n(58),h=n(130),p=n(307),g=n(72),f=n(3);return t=o.extend({name:"comp.InsertLink",_cmdArgs:null,_note:null,_linkSrc:null,initialize:function(){var e,n;if(this._note=this.options.note,this._cmdArgs=this.options.args,t.__super__.initialize.apply(this,arguments),!f.isCollabCommand(this._cmdArgs)){if(n=(e=this._cmdArgs.range).getStartBlockRange().block,!this._cmdArgs.src)return void(this.isReadyToApply=!1);if(!c.isTable(n)){if(!e||!e.canDrawedByNative())return a.error(this.name+":note range should NOT be null or cannot be Drawed by native"),void(this.isReadyToApply=!1);if(e.isInMultiBlock()||!c.isTextBlock(n))return this.isReadyToApply=!1,void a.error("Cannot be executed in multi-selected blocks or non-text blocks:",this.name)}this._linkSrc=u.completeUrl(this._cmdArgs.src||""),this._linkStyles=this._cmdArgs.styles||{}}},apply:function(){var e,t,n,o,i,u=this._cmdArgs.range,g=l.extend(this._linkStyles,{color:"#003884",underline:!0,href:this._linkSrc});return(e=u.getStartBlockRange())?(t=e.block,c.isTable(t)?(this._setTableBlock(g,u),void this.setEndingRange(u)):c.isCatalogue(t)?(0===t.getLength()?(n=new r({text:this._linkSrc}),o=n.getLength(),this.executeAtomicCommand(new d({block:t,start:e.start,text:n})),this.executeAtomicCommand(new p({block:t,href:this._linkSrc})),s.setTextBlockAsEndingRange(this,t,o,o)):(this.executeAtomicCommand(new p({block:t,href:this._linkSrc})),this.setEndingRange(u)),!0):(e.isCollapsed()?(n=new r({text:this._linkSrc}),o=n.getLength(),n.setStyle(0,o,"href",this._linkSrc),l.each(g,function(e,t){n.setStyle(0,o,t,e)}),i=e.start+o,this.executeAtomicCommand(new d({block:t,start:e.start,text:n})),s.setTextBlockAsEndingRange(this,t,i,i)):(g.href=this._linkSrc,this.executeAtomicCommand(new h({blocks:[t],styleNameValues:g,start:e.start,end:e.end})),this.setEndingRange(u)),!0)):(a.error(this.name+":startBlockRange should not be null"),!1)},_setTableBlock:function(e,t){var n=this,o=n._linkSrc,i=t.getStartBlockRange(),s=i.block,a=i.getAsRectRange();a&&a.forEach(function(t,i){var a,l,c,u,d;(c=s.getCell(t,i)).isMergedCell()||(a=c.getContent(t,i),c.isTextNoEmptyCell()&&(d=(l=a.toRichText()).getLength()),d=d||o.length,(u=l||new r({text:o})).setStyles(0,d,e),n.executeAtomicCommand(new g({table:s,content:u,cellRect:{row:t,col:i}})))})},fromCollabJSON:function(){var e=this.options.args.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._linkSrc=e.src,this._linkStyles=e.inlineStyles)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e&&(e.src=this._linkSrc,e.inlineStyles=this._linkStyles),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(3);return t=o.extend({name:"atom.SetCatalogueHref",_href:null,_block:null,_oldHref:null,initialize:function(){var e=this.options,n=e.args;r.isCollabCommand(n)||(this._block=e.block||n.block,this._href=e.href||n.href),t.__super__.initialize.apply(this,arguments)},apply:function(){var e=this._href,t=this._block;t.setHref&&(this._oldHref=t.getHref(),t.setHref(e))},doUnapply:function(){this._block.setHref(this._oldHref)},getEndingRange:function(){return this.options.args.range},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._block=e.getBlockById(o.blockId),this._href=o.styleNameValues,this._oldHref=o.oldStyleNameValues)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.blockId=this._block.getId(),e.styleNameValues=this._href,e.oldStyleNameValues=this._oldHref),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(70),s=n(19),a=n(10),l=n(22),c=n(23),u=n(3),d=n(11),h=n(2);return t=o.extend({name:"comp.InsertCode",_cmdArgs:null,_note:null,newBlkId:null,multiResult:null,splitCodeResult:null,convertToCodeResult:null,_checked:!1,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args||{},t.__super__.initialize.apply(this,arguments),this.options.args.range&&this.calculateNewBlocks()},apply:function(){var e,t,n,o=this._cmdArgs.range,i=o.getStartBlockRange(),s=o.getEndBlockRange(),a=i.block,u=s.block,p=this._note.getPreBlock(a);if(this.multiResult||this.splitCodeResult||this.convertToCodeResult||this.calculateNewBlocks(),o.isInMultiBlock())return e=this.multiResult.selectedBlocks,n=this.multiResult.willBeInsertedBlocks,this.executeAtomicCommand(new c({note:this._note,blocks:e})),this.executeAtomicCommand(new l({note:this._note,newBlks:n,preBlk:p})),h.isCode(n[0])?(t=r.createBeginRange(n[0]),d.setCodeBlockAsEndingRange(this,t,i.start,0)):d.setTextBlockAsEndingRange(this,n[0],0,0),!0;this.handleInSingleBlock(u)},calculateNewBlocks:function(){var e,t=this.options.args.range;t&&(e=t.getEndBlockRange().block),t&&t.isInMultiBlock()?this.multiResult=this.handleInMultiBlock():h.isCode(e)?this.splitCodeResult=this.splitCodeBlock(e):this.convertToCodeResult=this.convertToCode(e)},handleInSingleBlock:function(e){var t,n,o=this._note,i=this._note.getPreBlock(e),s=this._cmdArgs.range.getStartBlockRange(),a=0;h.isCode(e)?(this.executeAtomicCommand(new c({note:this._note,blocks:[e]})),t=this.splitCodeResult,this.executeAtomicCommand(new l({note:o,newBlks:t,preBlk:i})),d.setTextBlockAsEndingRange(this,t[s.startLineIndex-1],s.startLineCharIndex,s.startLineCharIndex)):(this.executeAtomicCommand(new c({note:o,blocks:[e]})),this.executeAtomicCommand(new l({note:o,newBlks:this.convertToCodeResult.newBlocks,preBlk:i})),h.isTextBlock(s.block)&&(a=s.start),n=r.createBeginRange(this.convertToCodeResult.newCode),d.setCodeBlockAsEndingRange(this,n,a,0))},handleInMultiBlock:function(){var e,t,n,o=this,i=o._cmdArgs.range,r=i.getStartBlockRange(),l=i.getEndBlockRange(),c=r.block,u=l.block,p=o._note.getNextBlock(u);if(i.isInMultiBlock())return t=(e=o._note.getInterBlocks(c,u,!0)).map(function(e){return h.isTextBlock(e)?e.getText():e}),n=(n=t.reduce(function(t,n,i){var r,s=0===t.length?null:t[t.length-1];return n instanceof a?s&&h.isCode(s)?s.pushNewLineText(n):((r=d.createNewCode(e[i],{id:e[i].getId(),checked:o._checked})).pushNewLineText(n),t.push(r)):t.push(n),t},[])).reduce(function(e,t,o){var i=o+1<n.length?n[o+1]:p;return h.isCode(t)?(e.push(t),(!i||i&&!h.isTextBlock(i))&&e.push(s.createBlank())):e.push(t),e},[]),o.handleNewBlockIds(n),{selectedBlocks:e,willBeInsertedBlocks:n}},splitCodeBlock:function(e){var t;return t=e.getRichTexts().map(function(t){return d.createNewParagraph(e,null,t)}),this.handleNewBlockIds(t),t},convertToCode:function(e){var t,n=e.getId(),o=this._note.getPreBlock(e),i=this._note.getNextBlock(e),r=[];return t=d.createNewCode(e,{id:n,checked:this._checked}),h.isTextBlock(e)?t.pushNewLineText(e.getText()):t.pushNewLineText(""),r.push(t),!h.isCode(i)&&h.isTextBlock(i)||r.push(s.createBlank()),o&&h.isTextBlock(o)&&!h.isCode(o)||r.unshift(s.createBlank()),this.handleNewBlockIds(r),{newBlocks:r,newCode:t}},handleNewBlockIds:function(e){var t=this;t.newBlkId||(t.newBlkId=[]),t.newBlkId.length?e.forEach(function(e){e.setId(t.newBlkId.shift())}):e.forEach(function(e){var n=u.newGUID();t.newBlkId.push(n),e.setId(n)})},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this.newBlkId=e.newBlkId)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.newBlkId=this.newBlkId),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(11),s=n(1),a=n(2),l=n(0),c=n(14),u=n(26),d=n(34),h=n(35),p=n(23),g=n(22),f=n(310),m=n(3);return t=o.extend({name:"comp.InsertList",_cmdArgs:null,_note:null,_listType:null,_listId:null,initialize:function(){var e,n;if(this._note=this.options.note,this._cmdArgs=this.options.args,e=this._cmdArgs.range,t.__super__.initialize.apply(this,arguments),!m.isCollabCommand(this._cmdArgs)){if(!e)return this.isReadyToApply=!1,void s.error(this.name+":note range should NOT be null");if(n=e.getStartBlockRange().block,e.isInSingleBlock()&&!a.isTextBlock(n))return this.isReadyToApply=!1,void s.error("Single Block must be text block:",this.name,e);if(e.isInSingleBlock()&&a.isListItem(n)&&l.some(n.getOwnerList().getItems(),function(e){return e.isLocked()}))return void(this.isReadyToApply=!1);this._listType=this._cmdArgs.type,this._listId=m.newGUID()}},apply:function(){return this._cmdArgs.range.isInSingleBlock()?this._handleSingleBlockSelection():this._handleMultiBlockSelection(),!0},_handleMultiBlockSelection:function(){var e,t,n,o,i,s,f,m,_=this._cmdArgs.range,y=_.getStartBlockRange(),b=y.block,v=this._note.getPreBlock(b),k=_.getEndBlockRange(),C=k.block,I=this._note.getInterBlocks(b,C,!0),S=[],w=!0;for(o=0;o<I.length;++o)if(e=I[o],a.isListItem(e)){if(t=e.getOwnerList(),n&&n.getId()!==t.getId()){w=!1;break}n=t}else if(a.isTextBlock(e)){w=!1;break}w&&n.getType()===this._listType?l.each(I,function(e){"getLevel"in e&&e.getLevel()&&e.setBlockStyle("indent",e.getLevel()-1),a.isTextBlock(e)?S.push(r.createNewParagraph(e,e.getId(),e.getText())):S.push(e)}):(s=a.isListItem(v)&&v.getType()===this._listType?v.getOwnerList():new d({type:this._listType,listId:this._listId}),l.each(I,function(e){e.resetLockState(),a.isTextBlock(e)?a.isListItem(e)?((i=new h({id:e.getId(),level:e.getLevel(),list:s,text:e.getText()})).setBlockStyles(e.getBlockStyles()),S.push(i)):((i=new h({id:e.getId(),level:1,list:s,text:e.getText()})).setBlockStyles(e.getBlockStyles()),f=i.getBlockStyle("indent")||0,m=i.getBlockStyle("text-indent")||0,0!==f&&(i.setLevel(f+i.getLevel()),i.setBlockStyle("indent",0)),0!==m&&(i.setLevel(m+i.getLevel()),i.setBlockStyle("text-indent",0)),S.push(i)):S.push(e)})),l.isEmpty(S)||(this.executeAtomicCommand(new p({note:this._note,blocks:I})),this.executeAtomicCommand(new g({note:this._note,newBlks:S,preBlk:v})),a.isTextBlock(y.block)&&(y=u.createRangeByBlock({block:S[0],start:y.start,end:y.end})),k=S.length>1&&a.isTextBlock(k.block)?u.createRangeByBlock({block:l.last(S),start:k.start,end:k.end}):y,_=c.create({startRange:y,endRange:k})),this.setEndingRange(_)},_handleSingleBlockSelection:function(){var e,t,n,o,i=this._cmdArgs.range,s=i.getStartBlockRange().block;a.isListItem(s)?(n=s.getOwnerList()).getType()!==this._listType?(this.executeAtomicCommand(new f({lists:[n],isToggle:!0})),this.setEndingRange(i)):(o=r.replaceBlockWithParagraph(this,this._note,s,s.getText()),r.setTextBlockAsEndingRange(this,o,o.getLength(),o.getLength())):(e=this._note.getPreBlock(s),t=this._note.getNextBlock(s),e&&a.isListItem(e)&&e.getOwnerList().getType()===this._listType?o=r.replaceBlockWithListItem(this,this._note,e,s,s.getText(),e):t&&a.isListItem(t)&&t.getOwnerList().getType()===this._listType?o=r.replaceBlockWithListItem(this,this._note,t,s,s.getText(),e):(n=new d({type:this._listType,listId:this._listId}),(o=new h({id:s.getId(),level:1,list:n,text:s.getText()})).setBlockStyles(s.getBlockStyles()),this.executeAtomicCommand(new p({note:this._note,blocks:[s]})),this.executeAtomicCommand(new g({note:this._note,newBlks:[o],preBlk:e}))),r.setTextBlockAsEndingRange(this,o,o.getLength(),o.getLength()))},fromCollabJSON:function(){var e=this.options.args.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._listId=e.listId,this._listType=e.listType)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e&&(e.listId=this._listId,e.listType=this._listType),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(0),s=n(34),a=n(2),l=n(3);return t=o.extend({name:"atom.SetListType",_lists:null,_newTypes:null,_oldTypes:null,initialize:function(){var e=this,n=e.options,o=n.args;t.__super__.initialize.apply(e),l.isCollabCommand(o)||(e._lists=n.lists,e._newTypes={},n.newType?r.each(e._lists,function(t,o){e._newTypes[o]=n.newType}):n.isToggle&&r.each(e._lists,function(t,n){e._newTypes[n]=t.isOrdered()?s.UNORDERED:s.ORDERED}))},apply:function(){var e=this;return e._oldTypes={},r.each(e._newTypes,function(t,n){e._oldTypes[n]=e._lists[n].getType(),t!==e._lists[n].getType()&&e._lists[n].setType(t)}),!0},doUnapply:function(){var e=this;return r.each(e._oldTypes,function(t,n){e._lists[n].getType()!==t&&e._lists[n].setType(t)}),!0},fromCollabJSON:function(){var e,n=this.options.args,o=n.collabProperties.cmdJSON;o&&(e=n.collabProperties.coreEditor.getNote(),o.dataBefore&&(this._oldTypes=o.dataBefore),this._newTypes=o.dataAfter,this._lists=this._getListByIds(e,o.listId)),t.__super__.fromCollabJSON.apply(this)},toCollabJSON:function(){var e=[],n=t.__super__.toCollabJSON.apply(this);return this._oldTypes&&(n.dataBefore=this._oldTypes),n.dataAfter=this._newTypes,r.each(this._lists,function(t){e.push(t.getId())}),n.listId=e,n},_getListByIds:function(e,t){var n=[];return r.some(e.getAllBlocks(),function(e){return a.isListItem(e)&&e.getOwnerList()&&r.contains(t,e.getOwnerList().getId())&&n.push(e.getOwnerList()),n.length===t.length}),n}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(86),i=n(4),r=n(67),s=n(22),a=n(3),l=n(83),c=n(11);return t=o.extend({name:"comp.InsertTable",_cmdArgs:null,_note:null,_tableBlkId:null,_columnNums:null,_rowNums:null,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args||{},t.__super__.initialize.apply(this,arguments),a.isCollabCommand(this._cmdArgs)||(this._tableBlkId=a.newGUID(),this.skipBlockLocking=!0,this._columnNums=1,this._rowNums=1,this._cmdArgs.cols&&(this._columnNums=this._cmdArgs.cols),this._cmdArgs.rows&&(this._rowNums=this._cmdArgs.rows))},insertResource:function(e,t,n){var o,i=[];return o=r.createBlankTable(this._columnNums,this._rowNums,this._tableBlkId,l.DEFAULT_TABLE_WIDTH),c.setResourceBlockStyleByPreBlock(o,e),t&&i.push(t),i.push(o),n&&i.push(n),this.executeAtomicCommand(new s({note:this._note,newBlks:i,preBlk:e})),o},_initArray:function(e,t){for(var n=[];e--;)n[e]=t;return n},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._tableBlkId=e.newBlkId,this._columnNums=e.colNums,this._rowNums=e.rowNums)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.newBlkId=this._tableBlkId,e.colNums=this._columnNums,e.rowNums=this._rowNums),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(26),s=n(14),a=n(22),l=n(23),c=n(3),u=n(11),d=n(2);return t=o.extend({name:"comp.InsertTodo",_cmdArgs:null,_note:null,_todoBlkId:null,_checked:!1,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args||{},t.__super__.initialize.apply(this,arguments),c.isCollabCommand(this._cmdArgs)||(this._todoBlkId=c.newGUID(),this._checked=this._cmdArgs.checked)},apply:function(){var e,t,n,o,i=this,a=i._cmdArgs.range,l=a.getStartBlockRange(),c=a.getEndBlockRange(),h=l.block,p=c.block;a.isInMultiBlock()?(o=i._note.getInterBlocks(h,p,!0),n=o.every(function(e){return d.isTodo(e)||!d.isTextBlock(e)}),o.forEach(function(r,s){0!==s?s!==o.length-1?i._helpSetBlock(r,n):t=i._helpSetBlock(r,n):e=i._helpSetBlock(r,n)}),l=r.createRangeByBlock({block:e,start:l.start,end:l.end}),c=r.createRangeByBlock({block:t,start:c.start,end:c.end}),a=s.create({startRange:l,endRange:c}),i.setEndingRange(a)):(t=i._helpSetBlock(p,!0),u.setTextBlockAsEndingRange(i,t,c.start,c.end))},_helpSetBlock:function(e,t){var n,o,i=this._note,r=e.getId();return d.isTodo(e)?n=t?u.replaceBlockWithParagraph(this,this._note,e,e.getText()):e:d.isTextBlock(e)&&(o=i.getPreBlock(e),n=u.createNewTodo(e,{id:r,text:e.getText(),checked:this._checked}),this.executeAtomicCommand(new l({note:i,blocks:[e]})),this.executeAtomicCommand(new a({note:i,newBlks:[n],preBlk:o}))),n},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._todoBlkId=e.newBlkId,this._checked=e.simpleValue1)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.newBlkId=this._todoBlkId,e.simpleValue1=this._checked),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(26),s=n(14),a=n(22),l=n(23),c=n(3),u=n(11),d=n(2);return t=o.extend({name:"comp.InsertQuote",_cmdArgs:null,_note:null,_quoteBlkId:null,_checked:!1,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args||{},t.__super__.initialize.apply(this,arguments),c.isCollabCommand(this._cmdArgs)||(this._quoteBlkId=c.newGUID())},apply:function(){var e,t,n,o,i=this,a=i._cmdArgs.range,l=a.getStartBlockRange(),c=a.getEndBlockRange(),h=l.block,p=c.block;a.isInMultiBlock()?(o=i._note.getInterBlocks(h,p,!0),n=o.every(function(e){return d.isQuote(e)||!d.isTextBlock(e)}),o.forEach(function(r,s){0!==s?s!==o.length-1?i._helpSetBlock(r,n):t=i._helpSetBlock(r,n):e=i._helpSetBlock(r,n)}),l=r.createRangeByBlock({block:e,start:l.start,end:l.end}),c=r.createRangeByBlock({block:t,start:c.start,end:c.end}),a=s.create({startRange:l,endRange:c}),i.setEndingRange(a)):(t=i._helpSetBlock(p,!0),u.setTextBlockAsEndingRange(i,t,c.start,c.end))},_helpSetBlock:function(e,t){var n,o,i=this._note,r=e.getId();return d.isQuote(e)?n=t?u.replaceBlockWithParagraph(this,this._note,e,e.getText()):e:d.isTextBlock(e)&&(o=i.getPreBlock(e),n=u.createNewQuote(e,{id:r,text:e.getText(),checked:this._checked}),this.executeAtomicCommand(new l({note:i,blocks:[e]})),this.executeAtomicCommand(new a({note:i,newBlks:[n],preBlk:o}))),n},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._quoteBlkId=e.newBlkId)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.newBlkId=this._quoteBlkId),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(1),s=n(2),a=n(11),l=n(133),c=n(23),u=n(49),d=n(102),h=n(58),p=n(131),g=n(105),f=n(84),m=n(57),_=n(3);return t=o.extend({name:"comp.KeyBackspace",_cmdArgs:null,_note:null,initialize:function(){var e,n;if(this._note=this.options.note,this._cmdArgs=this.options.args,this._inlineStyles=this._cmdArgs.inlineStyles,t.__super__.initialize.apply(this),!_.isCollabCommand(this._cmdArgs)){if(n=(e=this._cmdArgs.range).getStartBlockRange().block,!e)return this.isReadyToApply=!1,void r.error(this.name+":note range should NOT be null");if(e.isInSingleBlock()&&s.isTable(n))return this.isReadyToApply=!1,void r.error("should NOT trigger the cmd when in Table.")}},apply:function(){var e,t,n,o,i,r,l,u,d=this._cmdArgs.range,p=[];if(t=(e=d.getStartBlockRange()).block,i=o=d.getEndBlockRange().block,r=this._note.getPreBlock(t),u=this._cmdArgs.inlineStyles,s.isCode(t))return e.selectWholeBlock?(i=a.replaceBlockWithParagraph(this,this._note,t,""),a.setTextBlockAsEndingRange(this,i,0,0)):d.isCollapsed()?(n=this._deleteCodeText(t,e),a.setCodeBlockAsEndingRange(this,n,0)):(a.deleteSelectedContent(this,this._note,d),a.setCodeBlockAsEndingRange(this,e,0)),!0;if(d.isCollapsed()||a.deleteSelectedContent(this,this._note,d),d.isCollapsed()&&s.isTextBlock(t))return 0===e.start?this._deleteAtTextBlockStart(r,t,u):this._deleteAtTextBlockMiddle(t,e.start);if(d.isInSingleBlock()&&s.isTextBlock(t))return a.setTextBlockAsEndingRange(this,t,e.start,e.start),!0;if(s.isTextBlock(t)||(r&&!s.isTable(r)?(p.push(t),i=r,s.isTextBlock(r)&&(l=r.getLength())):(i=a.replaceBlockWithParagraph(this,this._note,t,""),l=0)),d.isInMultiBlock(o)&&(s.isTextBlock(o)?s.isTextBlock(t)&&!s.isCode(o)?(this.executeAtomicCommand(new h({block:t,start:t.getLength(),text:o.getText()})),p.push(o),l=e.start,i=t):(l=0,i=o):p.push(o)),p.length>0&&this.executeAtomicCommand(new c({note:this._note,blocks:p})),s.isTextBlock(i)){if(s.isCode(i))return a.setCodeBlockAsEndingRange(),!0;a.setTextBlockAsEndingRange(this,i,l,l)}else this.setEndingRange(m.buildNoteRangeFromNonTextBlock(i));return!0},_deleteAtTextBlockStart:function(e,t,n){var o,i,r;return s.isListItem(t)?(t.getIndex()>0&&t.getLevel()>1?this.executeAtomicCommand(new g({listItems:[t],newLevel:t.getLevel()-1})):t=a.replaceBlockWithParagraph(this,this._note,t,t.getText(),n),a.setTextBlockAsEndingRange(this,t,0,0),!0):s.isTodo(t)||s.isQuote(t)?(t=a.replaceBlockWithParagraph(this,this._note,t,t.getText(),n),a.setTextBlockAsEndingRange(this,t,0,0),!0):(i=t.getBlockStyle("text-indent"))&&i>0?(this.executeAtomicCommand(new p({blocks:[t],styleNameValues:{"text-indent":i-1}})),a.setTextBlockAsEndingRange(this,t,0,0),!0):(o=t.getBlockStyle("indent"))&&o>0?(this.executeAtomicCommand(new p({blocks:[t],styleNameValues:{indent:o-1}})),a.setTextBlockAsEndingRange(this,t,0,0),!0):e?!s.isTextBlock(e)||s.isCode(e)?(s.isHr(e)?(this.executeAtomicCommand(new c({note:this._note,blocks:[e]})),a.setTextBlockAsEndingRange(this,t,0,0)):this.setEndingRange(m.buildNoteRangeFromNonTextBlock(e)),!0):(r=e.getLength(),this.executeAtomicCommand(new h({block:e,start:e.getLength(),text:t.getText()})),this.executeAtomicCommand(new c({note:this._note,blocks:[t]})),a.setTextBlockAsEndingRange(this,e,r,r),!0):(a.setTextBlockAsEndingRange(this,t,0,0),!0)},_deleteAtTextBlockMiddle:function(e,t){f.isAtHrefBorder(e,t,!0)?this._deleteHrefAtCursorPos(e,t):(this.executeAtomicCommand(new u({block:e,start:t-1,end:t,inlineStyles:this._inlineStyles})),a.setTextBlockAsEndingRange(this,e,t-1,t-1))},_deleteHrefAtCursorPos:function(e,t){var n;-1!==(n=f.findHrefBorder(e,t,!0))&&a.deleteHref(this,e,n,t)},_deleteCodeText:function(e,t){var n=t.clone(),o=t.block.getLineInfo(t.startLineIndex),i=t.block.getLineInfo(t.startLineIndex-1);return 0===t.startLineCharIndex?i&&(n.startLineIndex=t.startLineIndex-1,n.startLineCharIndex=i.lineLength):o.lineStartSpacesNum===t.startLineCharIndex?l.keyBackspace.currentLineIsEmpty.backToLineStart||!i?n.startLineCharIndex=0:(n.startLineIndex=t.startLineIndex-1,n.startLineCharIndex=i.lineLength):n.startLineCharIndex=t.startLineCharIndex-1,n.startLineIndex<t.startLineIndex&&a.getNoteView(this).getBlockViewByBlock(e).scrollRightByIndex(n.startLineIndex),this.executeAtomicCommand(new d({block:e,start:t.start,startBlockRange:n,endBlockRange:t,inlineStyles:this._inlineStyles})),n},isSingleBlockAffected:function(){var e,n=this._args.range,o=t.__super__.isSingleBlockAffected.apply(this),i=0;return o&&n.isCollapsed()&&(i=(e=n.getStartBlockRange()).start,this._note.getPreBlock(e.block)&&0===i&&(o=!1)),o}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(162),i=n(4),r=n(1),s=n(2),a=n(3);return t=o.extend({name:"comp.KeyDelete",_cmdArgs:null,_note:null,initialize:function(){var e,n,o,i,l;if(this._note=this.options.note,this._cmdArgs=this.options.args,t.__super__.initialize.apply(this),!a.isCollabCommand(this._cmdArgs)){if(i=(n=(e=this._cmdArgs.range).getStartBlockRange()).block,l=(o=e.getEndBlockRange()).block,!e)return this.isReadyToApply=!1,void r.error(this.name+":note range should NOT be null");if(e.isInSingleBlock()&&s.isTable(i))return this.isReadyToApply=!1,void r.error("should NOT trigger the cmd when in Table.");if(e.isInSingleBlock()&&s.isTextBlock(i)&&e.isCollapsed()&&n.start===i.getLength()&&!this._note.getNextBlock(i))return this.isReadyToApply=!1,void r.warn("do NOT support the command at the end of note:",this.name);s.isTextBlock(l)&&o.end===l.getLength()&&s.isCatalogue(this._note.getNextBlock(l))&&(this.isReadyToApply=!1,r.warn("do NOT support when next is Catalogue block."))}},isSingleBlockAffected:function(){var e,n,o=this._args.range,i=t.__super__.isSingleBlockAffected.apply(this),r=0;return i&&o.isCollapsed()&&(e=(n=o.getStartBlockRange()).block,r=n.start,this._note.getNextBlock(e)&&r===e.getEndOffset()&&(i=!1)),i},isValidStartNoteRange:function(){var e,t,n=!0;return(e=this.getStartingRange())&&e.isInSingleBlock()&&(t=e.getStartBlockRange().block,s.isTable(t)&&(n=!1)),n}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(1),s=n(0),a=n(2),l=n(10),c=n(48),u=n(11),d=n(133),h=n(22),p=n(85),g=n(49),f=n(23),m=n(105),_=n(84),y=n(3);return t=o.extend({name:"comp.KeyEnter",_note:null,_cmdArgs:null,_newBlkId:null,initialize:function(){var e,n;if(this._note=this.options.note,this._cmdArgs=this.options.args,t.__super__.initialize.apply(this),!y.isCollabCommand(this._cmdArgs)){if(n=(e=this._cmdArgs.range).getStartBlockRange().block,!e)return this.isReadyToApply=!1,void r.error(this.name+":note range should NOT be null");if(e.isInSingleBlock()&&a.isTable(n))return this.isReadyToApply=!1,void r.error("should NOT trigger the cmd when in Table.");this._newBlkId=y.newGUID()}},apply:function(){var e,t,n,o,i,r,l=this._cmdArgs.range,c=!1,d=null,h=[];return i=t=(e=l.getStartBlockRange()).block,r=n=l.getEndBlockRange().block,l.isCollapsed()||u.deleteSelectedContent(this,this._note,l),a.isTextBlock(t)&&!a.isCode(t)&&(a.isCatalogue(t)||(i=a.isQuote(t)&&t.richText.getLength()?u.createNewQuote(t,{id:t.getId(),text:t.getText()}):u.createNewParagraph(t,t.getId(),t.getText()),_.isAtHrefBorder(i,e.start,!0)&&u.deleteHref(this,i,0,t.getLength())),u.recogLink(this,t,0,t.getLength())),l.isInMultiBlock()?(a.isTextBlock(t)||(i=u.replaceBlockWithParagraph(this,this._note,t,"")),a.isTextBlock(n)||(r=u.replaceBlockWithParagraph(this,this._note,n,"")),a.isListItem(i)?r=this._replaceBlockWithListItem(r,i,r.getText()):a.isTextBlock(i)&&a.isListItem(r)&&(r=u.replaceBlockWithParagraph(this,this._note,r,r.getText())),u.setTextBlockAsEndingRange(this,r,0,0),!0):(a.isTextBlock(t)?a.isCode(t)||(o=t.sliceText(e.start,t.getLength()),this.executeAtomicCommand(new g({block:t,start:e.start,end:t.getLength()}))):i=u.replaceBlockWithParagraph(this,this._note,t,""),a.isListItem(t)?t.isEmpty()&&0===o.getLength()?r=i=this._reduceListItemLevel(t):(r=this._insertListItem(t,this._newBlkId,o,this._cmdArgs.inlineStyles),c=!0):(a.isHeading(t)?r=o.toString().length>0?this._insertHeading(i,this._newBlkId,o,t.getLevel()):this._insertParagraph(i,this._newBlkId,o):a.isCatalogue(t)?r=this._insertCatalogueHelp(i,{startBlock:t,paraId:this._newBlkId,text:o}):a.isTodo(t)?r=t.isEmpty()&&0===o.getLength()?u.replaceBlockWithParagraph(this,this._note,t,""):this._insertTodo(i,{startBlock:t,id:this._newBlkId,text:o,checked:!1,inlineStyles:this._cmdArgs.inlineStyles}):a.isQuote(t)?r=t.isEmpty()&&0===o.getLength()?u.replaceBlockWithParagraph(this,this._note,t,""):this._insertQuote(i,{id:this._newBlkId,text:o,inlineStyles:this._cmdArgs.inlineStyles}):a.isCode(t)?e.selectWholeBlock?r=u.replaceBlockWithParagraph(this,this._note,t,""):d=this._insertCodeLine(e):r=this._insertParagraph(i,this._newBlkId,o,this._cmdArgs.inlineStyles),c=!0),r.setInlineStylesForEmpty(this._cmdArgs.inlineStyles),a.isCode(r)?(u.getNoteView(this).getBlockViewByBlock(r).scrollToStart(),u.setCodeBlockAsEndingRange(this,e,d.newCursorOffset,Number(!!d.insertedChars))):u.setTextBlockAsEndingRange(this,r,0,0),s.each(this._note.getInterBlocks(t,n,!0),function(e){h.push(e.getId())}),c&&h.push(this._newBlkId),this.pushAffectedBlockIds(h),!0)},_insertListItem:function(e,t,n,o){var i;return i=u.createNewListItem(e,t,n),u.setBlockStyle(i,o),this.executeAtomicCommand(new h({note:this._note,newBlks:[i],preBlk:e})),i},_insertParagraph:function(e,t,n,o){var i;if(i=u.createNewParagraph(e,t,n,!o))return o&&u.setBlockStyle(i,o),this.executeAtomicCommand(new h({note:this._note,newBlks:[i],preBlk:e})),i},_insertHeading:function(e,t,n,o){var i;return i=u.createNewHeading(e,t,n,o,!0),this.executeAtomicCommand(new h({note:this._note,newBlks:[i],preBlk:e})),i},_insertTodo:function(e,t){var n;return n=u.createNewTodo(e,t),u.setBlockStyle(n,t.inlineStyles),this.executeAtomicCommand(new h({note:this._note,newBlks:[n],preBlk:e})),n},_insertQuote:function(e,t){var n;return n=u.createNewQuote(e,t),u.setBlockStyle(n,t.inlineStyles),this.executeAtomicCommand(new h({note:this._note,newBlks:[n],preBlk:e})),n},_insertCodeLine:function(e){var t,n,o,i,r=0,s=e.block.getLineInfo(e.startLineIndex);return e.startLineCharIndex===s.lineLength&&(r=d.keyEnter.whenEndCharIs[s.lineEndChar]||d.keyEnter.whenEndCharIs.default),e.startLineCharIndex===s.lineLength-1&&(n=s.lineText.slice(s.lineText.length-2),(o=["{}","()","[]"].indexOf(n)>-1)&&(r=4)),t=c.LINE_BREAK+" ".repeat(s.lineStartSpacesNum+r),o&&(t+=c.LINE_BREAK+" ".repeat(s.lineStartSpacesNum)),i=new l({text:t}),this.executeAtomicCommand(new p({block:e.block,startBlockRange:e,text:i})),{insertedChars:t,isBetweenPairs:o,newCursorOffset:o?t.length-s.lineStartSpacesNum-2:t.length-1}},_insertCatalogueHelp:function(e,t){var n=t.startBlock;return t.text.getLength()<1?t.href="":t.href=n.getHref(),this._insertCatalogue(e,t)},_insertCatalogue:function(e,t){var n;return n=u.createNewCatalogue(e,t),this.executeAtomicCommand(new h({note:this._note,newBlks:[n],preBlk:e})),n},_reduceListItemLevel:function(e){var t=e;return e.getLevel()<=1?t=u.replaceBlockWithParagraph(this,this._note,e,""):this.executeAtomicCommand(new m({listItems:[e],newLevel:e.getLevel()-1})),t},_replaceBlockWithListItem:function(e,t,n){return this.executeAtomicCommand(new f({note:this._note,blocks:[e]})),this._insertListItem(t,e.getId(),n,this._cmdArgs.inlineStyles)},fromCollabJSON:function(){var e=this.options.args.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._newBlkId=e.newBlkId)},isSingleBlockAffected:function(){return!1},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.newBlkId=this._newBlkId,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(1),s=n(2),a=n(10),l=n(11),c=n(133),u=n(49),d=n(85),h=n(102),p=n(105),g=n(3);return t=o.extend({name:"comp.KeyTab",_cmdArgs:null,_note:null,_withShiftKey:!1,initialize:function(){var e,n;if(this._note=this.options.note,this._cmdArgs=this.options.args,t.__super__.initialize.apply(this),!g.isCollabCommand(this._cmdArgs)){if(e=this._cmdArgs.range,this._cmdArgs.withShiftKey&&(this._withShiftKey=!0),!e||!e.canDrawedByNative())return r.error(this.name+":note range should NOT be null"),void(this.isReadyToApply=!1);if(n=e.getStartBlockRange().block,e.isInSingleBlock()&&!s.isTextBlock(n))return void(this.isReadyToApply=!1)}},apply:function(){var e,t,n,o,i,r,a=this._cmdArgs.range,c=1;if(t=(e=a.getStartBlockRange()).block,n=a.getEndBlockRange().block,this._withShiftKey&&(c=-1),(i=a.isInMultiBlock())||0===e.start&&e.end===t.getLength())return r=!i,o=this._note.getInterBlocks(t,n,!0),l.isInSameList(o)?this._isFirstListItem(o[0])?l.updateBlocksIndentLevel(this,o[0].getOwnerList().getItems(),c):this.executeAtomicCommand(new p({listItems:o,deltaLevel:c})):this._withShiftKey&&r?t.getBlockStyle("text-indent")?this._updateBlockTextIndent(t,c):l.updateBlocksIndentLevel(this,[t],c):r&&0===e.end?this._updateBlockTextIndent(t,c):l.updateBlocksIndentLevel(this,o,c),this.setEndingRange(a),!0;0===e.start?s.isListItem(t)?this._isFirstListItem(t)?(l.updateBlocksIndentLevel(this,t.getOwnerList().getItems(),c),this.setEndingRange(a)):(this.executeAtomicCommand(new p({listItems:[t],deltaLevel:c})),this.setEndingRange(a)):this._withShiftKey?t.getBlockStyle("text-indent")?this._updateBlockTextIndent(t,c):(l.updateBlocksIndentLevel(this,[t],c),this.setEndingRange(a)):this._updateBlockTextIndent(t,c):this._withShiftKey?this._handleShiftTabNotAtStart(e):this._insertTabChar()},_handleShiftTabNotAtStart:function(e){var t,n,o,i,r=e.block,a=!0;if(s.isCode(r))return this._decreaseIndent(e);for(t=r.getText().getReadOnlyData(),i=(n=e.start)-1;i>=0;i--)if("\t"!==t[i].char){if(" "!==t[i].char){a=!1;break}n-i==4&&(o=i)}else o||(o=i);a?(o=o||0,this.executeAtomicCommand(new u({block:r,start:o,end:n})),l.setTextBlockAsEndingRange(this,r,o,o)):this._insertTabChar()},_insertTabChar:function(){var e,t,n=this._cmdArgs.inlineStyles,o=this._cmdArgs.range,i=0,r=o.getStartBlockRange(),u=o.getEndBlockRange(),h=r.clone(),p=r.clone();if(s.isCode(r.block)&&o.isInSingleBlock()){for(t=r.startLineIndex;t<=u.endLineIndex;t++)e=new a({text:" ".repeat(c.keyTab.addSpacesNum)}),h.startLineIndex=t,h.startLineCharIndex=0,this.executeAtomicCommand(new d({block:r.block,startBlockRange:h,text:e}));return p.startLineCharIndex+=4,i=p.endLineCharIndex+c.keyTab.addSpacesNum,void(r.isCollapsed()?l.setCodeBlockAsEndingRange(this,p,0):l.expandCodeRange(this,p,i,p.endLineIndex-p.startLineIndex))}l.deleteSelectedContent(this,this._note,o),l.insertTabChar(this,r.block,r.start,n),l.setTextBlockAsEndingRange(this,r.block,r.start+1,r.start+1)},_decreaseIndent:function(e){var t,n,o,i=e.block,r=e.clone(),s=e.clone(),a=[];for(t=e.startLineIndex;t<=e.endLineIndex;t++)0!==(n=i.getLineInfo(t).lineStartSpacesNum)?(o=n<4?n:4,r.startLineIndex=t,r.endLineIndex=t,r.startLineCharIndex=0,r.endLineCharIndex=o,a.push(o),this.executeAtomicCommand(new h({block:e.block,startBlockRange:r,endBlockRange:r}))):a.push(0);s.startLineCharIndex=Math.max(s.startLineCharIndex-a.shift(),0),l.expandCodeRange(this,s,s.endLineCharIndex-a.pop()||0,s.endLineIndex-s.startLineIndex)},_isFirstListItem:function(e){return 1===e.getLevel()&&1===e.getIndex()},_updateBlockTextIndent:function(e,t){l.updateBlockTextIndentLevel(this,e,t),this.setEndingRange(this._cmdArgs.range)},fromCollabJSON:function(){var e=this.options.args.collabProperties.cmdJSON;e&&e.simpleValue1&&(this._withShiftKey=!0),t.__super__.fromCollabJSON.apply(this)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return this._withShiftKey&&(e.simpleValue1=!0),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(10),s=n(11),a=n(1),l=n(2),c=n(23),u=n(58),d=n(85),h=n(72),p=n(3);return t=o.extend({name:"comp.KeyTextInput",_cmdArgs:null,_note:null,_inputtedText:null,_recogLink:!1,initialize:function(){var e;if(this._note=this.options.note,this._cmdArgs=this.options.args,e=this._cmdArgs.range,t.__super__.initialize.apply(this,arguments),!p.isCollabCommand(this._cmdArgs)){if(!e)return this.isReadyToApply=!1,void a.error(this.name+":note range should NOT be null");this._recogLink=this._cmdArgs.recogLink,this._inputtedText=this._cmdArgs.text}},apply:function(){var e,t,n,o,i,a,h,p,g=!0,f=this._cmdArgs.range;if(n=t=(e=f.getStartBlockRange()).block,i=e.start,o=f.getEndBlockRange().block,f.isInSingleBlock()&&l.isTable(t))return this._insertTextInTable(e,t,this._inputtedText);if(f.isCollapsed()||l.isCode(n)||s.deleteSelectedContent(this,this._note,f),l.isTextBlock(t,e)||(n=s.replaceBlockWithParagraph(this,this._note,t,""),i=0),f.isInMultiBlock()&&(l.isTextBlock(o)&&(p=o.getText()),this.executeAtomicCommand(new c({note:this._note,blocks:[o]}))),a=i+this._inputtedText.getLength(),p&&this._inputtedText.append(p),l.isCode(n)){switch(f.isCollapsed()||s.deleteSelectedContent(this,this._note,f),h=this._inputtedText.toString()){case"{":h+="}";break;case"(":h+=")";break;case"[":h+="]";break;default:g=!1}return this._inputtedText=new r({text:h}),this.executeAtomicCommand(new d({block:n,start:i,text:this._inputtedText,startBlockRange:e})),s.setCodeBlockAsEndingRange(this,e,this._inputtedText.getLength()-Number(g)),!0}return this.executeAtomicCommand(new u({block:n,start:i,text:this._inputtedText})),this._recogLink&&s.recogLink(this,n,0,i),s.setTextBlockAsEndingRange(this,n,a,a),!0},_insertTextInTable:function(e,t,n){var o,i;(o=e.getAsRectRange())&&(i=o.getFirstCell(),this.executeAtomicCommand(new h({table:t,cellRect:{row:i.row,col:i.col},content:n})))},canBeMerged:function(e){var n,o,i;if(t.__super__.canBeMerged.apply(this,[e])){if(!this.startingRange||!e.getStartingRange())return!1;if(n=this.startingRange.getStartBlockRange(),i=e.getStartingRange().getStartBlockRange(),!e.getStartingRange().isCollapsed())return!1;if(this.isLocalExecutedCmd){if(!this.endingRange)return!1;if(o=this.endingRange.getEndBlockRange(),!l.isTextBlock(o))return!1;if(i.getBlockId()!==o.getBlockId())return!1;if(o.end!==i.start)return!1}else{if(n.getBlockId()!==i.getBlockId())return!1;if(n.start!==i.start)return!1}return" "!==e.getInputtedText().toString()}return!1},fromCollabJSON:function(){var e=this.options.args.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._inputtedText=r.fromCollabJSON(e.richText),e.recogLink&&(this._recogLink=!0))},getInputtedText:function(){return this._inputtedText},mergeLocalCmd:function(e){var t,n,o=e.getInputtedText();this.endingRange&&(t=this.endingRange.getEndBlockRange()),o&&o.getLength()>0&&(this._inputtedText.append(o),this.isLocalExecutedCmd&&(n=t.end+o.getLength(),s.setTextBlockAsEndingRange(this,t.block,n,n)))},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e&&(e.richText=this._inputtedText.toCollabJSON(),this._recogLink&&(e.recogLink=this._recogLink)),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(1),s=n(11);return t=o.extend({name:"comp.RemoveFormat",_note:null,_cmdArgs:null,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args,t.__super__.initialize.apply(this)},apply:function(){var e=this._cmdArgs.range;return!e||e.isCollapsed()?(r.error("collapsed时应该修改编辑器当前样式状态，不应进入此命令",e),!1):(s.resetAllStyles(this,this._note,e,this._args.blockStyles,this._args.inlineStyles,{resetAllStyles:this._args.resetAllStyles,isRemoveFormat:!0}),this.setEndingRange(e),!0)}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(0),s=n(321),a=n(3);return t=o.extend({name:"comp.ReplaceResource",_note:null,_cmdArgs:null,_resources:null,_resProps:null,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args,t.__super__.initialize.apply(this),a.isCollabCommand(this._cmdArgs)||(this._resources=this._cmdArgs.resources,this._resProps=this._cmdArgs.resProps,this.endingRange=this._cmdArgs.endingRange)},apply:function(){return this.executeAtomicCommand(new s({resources:this._resources,newResProps:this._resProps}),this.endingRange),!0},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.coreEditor,o=e._cmdArgs.collabProperties.cmdJSON;o&&(e._resProps=o.simpleValue1,e._resources=[],r.each(o.resIds,function(t){e._resources.push(n.getBlockById(t))}),o.simpleValue2&&(e._cmdArgs.ignoreUndoRedo=!0),o.endNoteRange&&(e.endingRange=o.endNoteRange)),t.__super__.fromCollabJSON.apply(e)},isSingleBlockAffected:function(){return!1},toCollabJSON:function(){var e=[],n=t.__super__.toCollabJSON.apply(this);return n&&(r.each(this._resources,function(t){e.push(t.getId())}),n.simpleValue1=this._resProps,n.resIds=e,this._cmdArgs.ignoreUndoRedo&&(n.simpleValue2=!0),n.endNoteRange=this.endingRange),n}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(0),s=n(2),a=n(3);return t=o.extend({name:"atom.SetResourceProps",_resources:null,_newResProps:null,_oldResProps:null,initialize:function(){var e=this.options,n=e.args;t.__super__.initialize.apply(this),a.isCollabCommand(n)||(this._resources=e.resources,this._newResProps=e.newResProps)},apply:function(){var e=this;return e._oldResProps={},r.each(e._resources,function(t,n){e._oldResProps[n]={},s.isImage(t)?(e._newResProps[n].source&&(e._oldResProps[n].source=t.getSource(),t.setSource(e._newResProps[n].source)),r.isUndefined(e._newResProps[n].title)||(e._oldResProps[n].title=t.getTitle(),t.setTitle(e._newResProps[n].title))):s.isAttachment(t)&&(e._newResProps[n].source&&(e._oldResProps[n].source=t.getSource(),t.setSource(e._newResProps[n].source)),e._newResProps[n].resource&&(e._oldResProps[n].resource=t.getResource(),t.setResource(e._newResProps[n].resource)),e._newResProps[n].fileName&&(e._oldResProps[n].fileName=t.getFileName(),t.setFileName(e._newResProps[n].fileName)),e._newResProps[n].fileLength&&(e._oldResProps[n].fileLength=t.getFileLength(),t.setFileLength(e._newResProps[n].fileLength)))}),!0},doUnapply:function(){var e=this;return r.each(e._resources,function(t,n){s.isImage(t)?(e._oldResProps[n].source&&t.setSource(e._oldResProps[n].source),r.isUndefined(e._oldResProps[n].title)||t.setTitle(e._oldResProps[n].title)):s.isAttachment(t)&&(e._oldResProps[n].source&&t.setSource(e._oldResProps[n].src),e._oldResProps[n].resource&&t.setResource(e._oldResProps[n].resource),e._oldResProps[n].fileName&&t.setFileName(e._oldResProps[n].fileName),e._oldResProps[n].fileLength&&t.setFileLength(e._oldResProps[n].fileLength))}),!0},fromCollabJSON:function(){var e,n=this.options.args,o=n.collabProperties.cmdJSON;o&&(e=n.collabProperties.coreEditor.getNote(),o.dataBefore&&(this._oldResProps=o.dataBefore),this._newResProps=o.dataAfter,this._resources=this._getResByIds(e,o.resIds)),t.__super__.fromCollabJSON.apply(this)},toCollabJSON:function(){var e=[],n=t.__super__.toCollabJSON.apply(this);return this._oldResProps&&(n.dataBefore=this._oldResProps),n.dataAfter=this._newResProps,r.each(this._resources,function(t){e.push(t.getId())}),n.resIds=e,n},_getResByIds:function(e,t){var n=[];return r.some(e.getAllBlocks(),function(e){return r.contains(t,e.getId())&&n.push(e),t.length===n.length}),n}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(0),i=n(9),r=n(4),s=n(2),a=n(11),l=n(52),c=n(64),u=n(10),d=n(6),h=n(23),p=n(22),g=n(3);return t=i.extend({name:"comp.RefreshCatalogue",_cmdArgs:null,_note:null,_ownerId:null,_delete:!1,_catalogueIds:null,_catalogues:null,_newCatalogues:null,_blankParaId:null,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args||{},this._ownerId=this._cmdArgs.ownerId,this._delete=this._cmdArgs.delete,t.__super__.initialize.apply(this,arguments),this._initBlocks()},_initBlocks:function(){var e,t,n=this,i=n._note.blocks,r=[],u=[],h=[];o.each(i,function(e){s.isCatalogue(e)&&e.getOwnerId()===n._ownerId&&r.push(e),a.isForCatalogueBlock(e)&&u.push(e)}),(r.length>0||!n._ownerId)&&(n._catalogueIds=n._catalogueIds||[],n._ownerId=n._ownerId||g.newGUID(),t=new c({id:n._ownerId}),o.each(u,function(o,i){e=new l({indent:o.getLevel()-1,text:o.getText().toString().trim(),href:o.getId(),ownerList:t}),h.push(e),n._catalogueIds[i]?e.setId(n._catalogueIds[i]):n._catalogueIds[i]=e.getId()}),0===u.length&&(e=new l({indent:0,text:d.INSERT_BLANK_CATALOGUE_TEXT,ownerList:t}),h.push(e),n._catalogueIds[0]?e.setId(n._catalogueIds[0]):n._catalogueIds[0]=e.getId())),n._catalogues=r,n._newCatalogues=h,(0===h.length||n._delete)&&(n._blankParaId=n._blankParaId||g.newGUID())},apply:function(){var e=this._catalogues,t=this._newCatalogues,n=e[e.length-1]||this.startingRange.getEndBlockRange().block,i=t[t.length-1];o.each(t,function(e){a.setResourceBlockStyleByPreBlock(e,n)}),this._blankParaId?(i=a.createNewParagraph(null,this._blankParaId,new u({text:""})),a.setResourceBlockStyleByPreBlock(i,n),this.executeAtomicCommand(new p({note:this._note,newBlks:[i],preBlk:n}))):this.executeAtomicCommand(new p({note:this._note,newBlks:t,preBlk:n})),e.length>0&&this.executeAtomicCommand(new h({note:this._note,blocks:this._note.getInterBlocks(e[0],e[e.length-1],!0)})),a.setTextBlockAsEndingRange(this,i,i.getLength(),i.getLength())},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._ownerId=e.listId,this._catalogueIds=e.blockIds,this._delete=e.simpleValue1,this._blankParaId=e.newBlkId)},toCollabJSON:function(){var e;return(e=t.__super__.toCollabJSON.apply(this))&&(e.listId=this._ownerId,e.blockIds=this._catalogueIds,e.simpleValue1=this._delete,e.newBlkId=this._blankParaId),e}}),r.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(3);return t=o.extend({_cmdArgs:null,_oldData:null,_content:null,_align:null,_headerFooter:null,name:"comp.SetHeaderFooter",initialize:function(e){this._oldData={},this._cmdArgs=e.args,r.isCollabCommand(this._cmdArgs)||(this._content=this._cmdArgs.content,this._align=this._cmdArgs.align,this._headerFooter=this._cmdArgs.headerFooter),this.startingRange=e.args.range,this.endingRange=e.args.endingRange,t.__super__.initialize.apply(this)},apply:function(){var e=this._align,t=this._content,n=this._headerFooter;n&&(null!=e&&(this._oldData.align=n.getAlign()),null!=t&&(this._oldData.content=n.getContent(!1)),n.setContentAndStyle(t,e),this.effected=!0)},doReapply:function(){var e=this._align,t=this._content;this._headerFooter.setContentAndStyle(t,e)},doUnapply:function(){var e=this._headerFooter,t=this._oldData;t&&e.setContentAndStyle(t.content,t.align)},fromCollabJSON:function(){var e=this._cmdArgs.collabProperties,n=e.cmdJSON,o=e.coreEditor.note;t.__super__.fromCollabJSON.apply(this),n&&(this._content=n.headerFooterInfo.content,this._align=n.headerFooterInfo.align,this._headerFooter=o.getHeaderFooter(n.headerFooterInfo.isFooter))},toCollabJSON:function(){var e,n=t.__super__.toCollabJSON.apply(this);return n&&((e={}).content=this._content,e.align=this._align,e.isFooter=this._headerFooter.isFooter,n.headerFooterInfo=e),n}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(0),i=n(9),r=n(4),s=n(325),a=n(163),l=n(14),c=n(3);return t=i.extend({name:"comp.SetBlockProps",_cmdArgs:null,_note:null,_blocks:null,_props:null,updateSelectionDisabled:!0,initialize:function(){this._note=this.options.note,this._cmdArgs=this.options.args,t.__super__.initialize.apply(this),c.isCollabCommand(this._cmdArgs)||(this._blocks=this._cmdArgs.blocks,this._props=this._cmdArgs.props)},apply:function(){var e=this._blocks[0],t=new a({block:e,start:e.getEndOffset(),end:e.getEndOffset()});return this.executeAtomicCommand(new s({blocks:this._blocks,props:this._props}),new l({startRange:t,endRange:t})),!0},fromCollabJSON:function(){var e=this,n=e._cmdArgs.collabProperties.cmdJSON;n&&(e._blocks=[],o.each(n.blockIds,function(t){e._blocks.push(e._note.getBlockById(t))}),e._props=n.simpleValue1),t.__super__.fromCollabJSON.apply(e)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this),n=[];return o.each(this._blocks,function(e){n.push(e.getId())}),e.blockIds=n,e.simpleValue1=this._props,e}}),r.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(0),s=n(3);function a(e){return e.charAt(0).toUpperCase()+e.slice(1)}function l(e){return"set"+a(e)}return t=o.extend({name:"atom.SetBlockProps",_blocks:null,_oldPropsMap:{},_props:null,initialize:function(e){var n=this.options.args;this._oldPropsMap={},s.isCollabCommand(n)||(this._blocks=e.blocks,this._props=e.props),t.__super__.initialize.apply(this,arguments)},apply:function(){var e,t=this;r.each(t._blocks,function(n){e={},r.each(t._props,function(t,o){e[o]=n[function(e){return"get"+a(e)}(o)](),n[l(o)](t)}),t._oldPropsMap[n.getId()]=e})},doUnapply:function(){var e,t=this;r.each(t._blocks,function(n){e=t._oldPropsMap[n.getId()],r.each(e,function(e,t){n[l(t)](e)})})},fromCollabJSON:function(){var e=this,n=e.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(e),e._note=n.coreEditor.getNote(),o&&(e._blocks=[],r.each(o.blockIds,function(t){e._blocks.push(e._note.getBlockById(t))}),e._props=o.simpleValue1,e._oldPropsMap=o.simpleValue2)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this),n=[];return r.each(this._blocks,function(e){n.push(e.getId())}),e.blockIds=n,e.simpleValue1=this._props,e.simpleValue2=this._oldPropsMap,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(327),s=n(3);return t=o.extend({name:"comp.SetCodeLanguage",_codeBlock:null,_language:null,initialize:function(){var e=this.options.args;s.isCollabCommand(e)||(this._codeBlock=this.options.args.block,this._language=this.options.args.newLanguage),t.__super__.initialize.apply(this)},apply:function(){var e=this.options.args,t=this.startingRange.startRange.block;return s.isCollabCommand(e)&&t&&(this._codeBlock=t),this.executeAtomicCommand(new r({block:this._codeBlock,newLanguage:this._language})),!0},fromCollabJSON:function(){var e=this.options.args.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._language=e.language)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.language=this._language,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(3);return t=o.extend({name:"atom.SetCodeLanguage",_codeBlock:null,_language:null,_preLanguage:null,initialize:function(){var e=this.options.args;r.isCollabCommand(e)||(this._codeBlock=this.options.block,this._language=this.options.newLanguage,this._preLanguage=this.options.block.getLanguage()),t.__super__.initialize.apply(this)},apply:function(){return!!this._language&&(this._codeBlock.setLanguage(this._language),!0)},doUnapply:function(){this._codeBlock&&this._preLanguage&&this._codeBlock.setLanguage(this._preLanguage)},fromCollabJSON:function(){var e=this.options.args.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._language=e.language)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.language=this._language,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(329),s=n(3);return t=o.extend({name:"comp.SetCodeTheme",_codeBlock:null,_theme:null,initialize:function(){var e=this.options.args;s.isCollabCommand(e)||(this._codeBlock=this.options.args.block,this._theme=this.options.args.newTheme),t.__super__.initialize.apply(this)},apply:function(){var e=this.options.args,t=this.startingRange.startRange.block;return s.isCollabCommand(e)&&t&&(this._codeBlock=t),this.executeAtomicCommand(new r({block:this._codeBlock,newTheme:this._theme})),!0},fromCollabJSON:function(){var e=this.options.args.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._theme=e.theme)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.theme=this._theme,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(3);return t=o.extend({name:"atom.SetCodeTheme",_codeBlock:null,_theme:null,_preTheme:null,initialize:function(){var e=this.options.args;r.isCollabCommand(e)||(this._codeBlock=this.options.block,this._theme=this.options.newTheme,this._preTheme=this.options.block.getTheme()),t.__super__.initialize.apply(this)},apply:function(){return!!this._theme&&(this._codeBlock.setTheme(this._theme),!0)},doUnapply:function(){this._codeBlock&&this._preTheme&&this._codeBlock.setTheme(this._preTheme)},fromCollabJSON:function(){var e=this.options.args.collabProperties.cmdJSON;t.__super__.fromCollabJSON.apply(this),e&&(this._theme=e.theme)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.theme=this._theme,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(331),s=n(3);return t=o.extend({name:"comp.SetTableCellsSize",_table:null,_sizes:null,initialize:function(){var e=this.options.args;s.isCollabCommand(e)||(this._table=e.table,this._sizes=e.sizes),t.__super__.initialize.apply(this)},apply:function(){var e=this,t=e._table,n=e._sizes;return!(n.length<1)&&(n.forEach(function(n){e.executeAtomicCommand(new r({table:t,size:n}))}),!0)},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._sizes=o.simpleValue1)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.simpleValue1=this._sizes,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(3);return t=o.extend({name:"atom.SetTableCellSize",_table:null,_size:null,_oldSize:null,effected:!1,initialize:function(){var e=this.options.args;this._oldSize={},t.__super__.initialize.apply(this),r.isCollabCommand(e)||(this._table=this.options.table,this._size=this.options.size)},apply:function(){var e=this._table,t=this._size;return null!=t.row&&(this._oldSize.row=t.row,this._oldSize.height=e.getRowHeight(t.row),e.setRowHeight(t.row,t.height),this.effected=!0),null!=t.col&&(this._oldSize.col=t.col,this._oldSize.width=e.getColumnWidth(t.col),e.setColumnWidth(t.col,t.width),this.effected=!0),this.effected},doUnapply:function(){var e=this._table,t=this._oldSize;null!=t.row&&e.setRowHeight(t.row,t.height),null!=t.col&&e.setColumnWidth(t.col,t.width)},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._size=o.simpleValue1,this._oldSize=o.simpleValue2)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.simpleValue1=this._size,e.simpleValue2=this._oldSize,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(11),s=n(44),a=n(81),l=n(164),c=n(3);return t=o.extend({name:"comp.InsertTableRowCol",_table:null,_rect:null,_cellsData:null,effected:!1,initialize:function(){var e,n=this.options.args;this._rect={},t.__super__.initialize.apply(this),c.isCollabCommand(n)||(this._cellsData=n.cellsData,this._sizes=n.sizes,(e=n.range)?this._transformRangeToData(e,n):(this._rect=n.rect,this._table=n.table))},_transformRangeToData:function(e,t){var n,o=e.getStartBlockRange(),i=o.getAsRectRange(),r=t.describe;i&&(n=i.getRect(),this._cellsData||(this._cellsData=this._calculateInsertData(r,n)),null!=r.row&&(this._rect.row=r.row===s.UP?n.top:n.top+n.height),null!=r.col&&(this._rect.col=r.col===s.LEFT?n.left:this._rect.col=n.left+n.width),this._table=o.block)},apply:function(){var e=this,t=e._rect,n=e._cellsData,o=e._sizes;null!=t.row&&(n.forEach(function(n){e._insertRows(t.row,[n],o)}),this.effected=!0),null!=t.col&&(n.forEach(function(n){e._insertCols(t.col,[n],o)}),this.effected=!0)},_insertRows:function(e,t,n){var o=this,i=o._table;t.forEach(function(n,s){0===n.length&&(n=i.creatRowData(e+s)),t[s]=n,r.fixMergeCellBeforeRowColChange({index:e+s,table:i,cmd:o,insertData:n})}),o.executeAtomicCommand(new l({cellsData:t,sizes:n,rect:this._rect,table:i}))},_insertCols:function(e,t,n){var o,i=this,s=i._table,a=s.getCells().length,c=[];t.forEach(function(t,n){for(c.push([]),o=0;o<a;o++)c[n].push(t[o]||s.createCell());r.fixMergeCellBeforeRowColChange({index:e+n,table:s,cmd:i,isCol:!0,insertData:c[n]})}),i.executeAtomicCommand(new l({cellsData:c,sizes:n,rect:this._rect,table:s}))},_calculateInsertData:function(e,t){return e.hasOwnProperty("col")?new Array(t.width).fill([]):e.hasOwnProperty("row")?new Array(t.height).fill([]):void 0},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._rect=o.simpleValue1,this._sizes=o.simpleValue2,this._cellsData=a.cellsFromCollabJSON(o.dataBefore))},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.simpleValue1=this._rect,e.simpleValue2=this._sizes,e.dataBefore=a.cellsToCollabJSON(this._cellsData),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(23),s=n(334),a=n(11),l=n(14),c=n(43),u=n(3);return t=o.extend({name:"comp.DeleteTableRowCol",_table:null,_rect:null,_oldData:null,_count:null,_range:null,effected:!1,initialize:function(){var e,n=this.options.args;this._rect={},t.__super__.initialize.apply(this),u.isCollabCommand(n)||((e=n.range)?this._transformRangeToData(e,n):(this._rect=n.rect,this._count=n.count,this._table=n.table))},_transformRangeToData:function(e,t){var n,o,i=e.getStartBlockRange(),r=t.describe;(n=i.getAsRectRange())&&(o=n.getRect(),r.row&&(this._rect.row=o.top,this._count=o.height),r.col&&(this._rect.col=o.left,this._count=o.width),this._rectOfRectRange=o,this._table=i.block)},apply:function(){var e,t,n,o,i,r,u=this._count,d=this._rect,h=this._table;if(null!=d.row){if(e=h.getRowCount(),0===d.row&&e===u)return this._deleteTable();for(n=0;n<u;n++)a.fixMergeCellBeforeRowColChange({index:d.row,table:h,cmd:this,isDelete:!0}),this.executeAtomicCommand(new s({count:1,rect:d,table:h}));this.effected=!0}if(null!=d.col){if(t=h.getColumnCount(),0===d.col&&t===u)return this._deleteTable();for(n=0;n<u;n++)a.fixMergeCellBeforeRowColChange({index:d.col,table:h,cmd:this,isDelete:!0,isCol:!0}),this.executeAtomicCommand(new s({count:1,rect:d,table:h}));this.effected=!0}this._rectOfRectRange&&((o=c.create({block:h,type:c.TYPES.NORMAL,rect:this._rectOfRectRange}))&&(i=o.getAsRectRange()),i||(o=c.create({block:h,type:c.TYPES.FIRST_CELL})),r=l.create({startRange:o,endRange:o}),this.setEndingRange(r))},_deleteTable:function(){this._applyCommandToComposite(new r({blocks:[this._table],note:this.options.note})),this.setEndingRange(l.createMock()),this.effected=!0},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._rect=o.simpleValue1,this._count=o.simpleValue2)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.simpleValue1=this._rect,e.simpleValue2=this._count,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(15),i=n(4),r=n(81),s=n(3);return t=o.extend({name:"atom.DeleteTableRowCol",_table:null,_rect:null,_oldCellsData:null,_count:null,effected:!1,initialize:function(){var e=this.options,n=e.args;s.isCollabCommand(n)||(this._count=e.count,this._rect=e.rect,this._table=e.table),t.__super__.initialize.apply(this)},apply:function(){var e=this._rect,t=this._table,n=this._count;null!=e.row&&(this._oldCellsData=t.deleteRows(e.row,n),this.effected=!0),null!=e.col&&(this._oldCellsData=t.deleteCols(e.col,n),this.effected=!0)},doUnapply:function(){var e=this._rect,t=this._table,n=this._oldCellsData;null!=e.row&&t.insertRows(e.row,n.rowsData,n.heights),null!=e.col&&t.insertCols(e.col,n.colsData,n.widths)},fromCollabJSON:function(){var e,n,o=this.options.args.collabProperties,i=o.cmdJSON;t.__super__.fromCollabJSON.apply(this),n=o.coreEditor.getNote(),i&&(this._table=n.getBlockById(i.blockId),this._rect=i.simpleValue1,this._count=i.simpleValue2,(e=i.dataBefore)&&(this._oldCellsData=e,e.rowsData&&(this._oldCellsData.rowsData=r.cellsFromCollabJSON(e.rowsData)),e.colsData&&(this._oldCellsData.colsData=r.cellsFromCollabJSON(e.colsData))))},toCollabJSON:function(){var e,n=t.__super__.toCollabJSON.apply(this);return n.blockId=this._table.getId(),n.simpleValue1=this._rect,n.simpleValue2=this._count,(e=this._oldCellsData)&&(n.dataBefore=e,e.rowsData&&(n.dataBefore.rowsData=r.cellsToCollabJSON(e.rowsData)),e.colsData&&(n.dataBefore.colsData=r.cellsToCollabJSON(e.colsData))),n}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(132),s=n(104),a=n(336),l=n(3);return t=o.extend({name:"comp.ToggleMergeTableCell",_table:null,_rect:null,_oldData:null,_range:null,effected:!1,initialize:function(){var e,n=this.options.args;l.isCollabCommand(n)||((e=n.range)?this._transformRangeToData(e,n):(this._rect=n.rect,this._table=n.table)),t.__super__.initialize.apply(this)},_transformRangeToData:function(e){var t,n,o=e.getStartBlockRange();(t=o.getAsRectRange())&&(n=t.getRect(),this._range=e,this._rect=n,this._table=o.block)},apply:function(){var e,t,n,o=this._rect,i=this._table,l=!1,c=!1,u=null;if(o&&(1!==o.width||1!==o.height)){for(i.isMergeRect(o)&&(l=!0),t=o.top;t<o.top+o.height;t++)for(n=o.left;n<o.left+o.width;n++)e=i.getCell(t,n),t===o.top&&n===o.left?(e.isEmpty()||(c=!0),this.executeAtomicCommand(new r({table:i,type:r.TYPES.POINT,value:l?null:{width:o.width,height:o.height},rect:{row:t,col:n}}))):(c||u||e.isEmpty()||(u=e.getContent()),l||(this._applyCommandToComposite(new a({args:{table:i,content:"",range:this._range,cellRect:{row:t,col:n}}})),this.executeAtomicCommand(new s({table:i,styles:null,rect:{width:1,height:1,top:t,left:n}}))),this.executeAtomicCommand(new r({table:i,type:r.TYPES.CELL,value:l?null:{dy:t-o.top,dx:n-o.left},rect:{row:t,col:n}})));u&&this._applyCommandToComposite(new a({args:{table:i,content:u,cellRect:{row:o.top,col:o.left}}})),this.effected=!0}},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._rect=o.simpleValue1)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.simpleValue1=this._rect,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(72),s=n(3),a=n(94);return t=o.extend({name:"comp.SetTableCellContent",_table:null,_cellRect:null,_oldContent:null,initialize:function(){var e=this.options.args;s.isCollabCommand(e)||(this._table=e.table,this._cellRect=e.cellRect,this._content=e.content),t.__super__.initialize.apply(this)},apply:function(){this.executeAtomicCommand(new r({table:this._table,cellRect:this._cellRect,content:this._content}))},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._content=a.contentFromCollabJSON(o.simpleValue1),this._oldContent=a.contentFromCollabJSON(o.simpleValue2),this._cellRect=o.newBlkId)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.simpleValue1=a.contentToCollabJSON(this._content),e.simpleValue2=a.contentToCollabJSON(this._oldContent),e.newBlkId=this._cellRect,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(104),s=n(3);return t=o.extend({name:"comp.SetTableCellBlockStyle",_table:null,_styles:null,_rect:null,_toggle:null,_default:null,effected:!1,initialize:function(){var e,n=this.options.args;t.__super__.initialize.apply(this),s.isCollabCommand(n)||(e=n.range,this._styles=n.styles,this._toggle=n.toggle,this._default=n.default,this._transformRangeToData(e,n))},_transformRangeToData:function(e){var t,n,o=e.getStartBlockRange();(t=o.getAsRectRange())&&(n=t.getRect(),this._rect=n,this._table=o.block)},apply:function(){if(!this._rect)return this.effected;this.executeAtomicCommand(new r({table:this._table,rect:this._rect,styles:this._styles,toggle:this._toggle,default:this._default})),this.effected=!0},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._rect=o.simpleValue1,this._styles=o.simpleValue2||null,this._toggle=o.newBlkId||null)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.simpleValue1=this._rect,e.simpleValue2=this._styles||null,e.newBlkId=this._toggle||null,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(164),s=n(72),a=n(132),l=n(104),c=n(81),u=n(3);return t=o.extend({name:"comp.InsertTableCells",_table:null,_widths:null,_heights:null,_cellsData:null,_rect:null,effected:!1,initialize:function(){var e=this.options.args;t.__super__.initialize.apply(this),u.isCollabCommand(e)||(this._table=e.table,this._widths=e.widths,this._heights=e.heights,this._cellsData=e.cellsData,this._transformRangeToData(e.range))},_transformRangeToData:function(e){var t,n=e.getStartBlockRange();n.getAsRectRange&&(t=n.getAsRectRange(),this._rect=t.getRect())},apply:function(){var e,t,n,o,i,r,a,c=this._table,u=this._rect,d=this._cellsData;if(!d)return this._clearCellsData();if(!d[0]||d[0].length<1)return!1;for(e=d.length,t=d[0].length,this._handleExtendCol(),this._handleExtendRow(),o=0;o<e;o++)for(r=o+u.top,i=0;i<t;i++)a=i+u.left,n=d[o][i],(e>1||t>1)&&(this._handleOldMergePoint(c.getCell(r,a),r,a),this._handleMergePointCell(n,o,i)),n.isMergedCell()||(this.executeAtomicCommand(new s({content:n.getContent(),table:c,cellRect:{row:o+u.top,col:i+u.left}})),this.executeAtomicCommand(new l({rect:{top:u.top+o,left:u.left+i,width:1,height:1},styles:n.getBlockStyles(),table:c})),this.effected=!0)},_handleExtendCol:function(){var e,t,n,o=this._table,i=this._rect,s=this._widths,a=this._cellsData,l=a[0].length,c=o.getColumnCount(),u=o.getRowCount(),d=[];if((e=i.left+l-c)>0){for(a.forEach(function(t,n){t.slice(-e).forEach(function(e,t){d[t]=d[t]||[],d[t][i.top+n]=e})}),t=0;t<u;t++)for(n=0;n<d.length;n++)d[n][t]=d[n][t]||o.createCell({row:t,col:i.left+n});this.executeAtomicCommand(new r({rect:{col:c},table:o,cellsData:d,sizes:s?s.slice(-e):null})),this.effected=!0}},_handleExtendRow:function(){var e,t,n,o=this._table,i=this._rect,s=this._heights,a=this._cellsData,l=a.length,c=o.getColumnCount(),u=o.getRowCount(),d=[];if((e=i.top+l-u)>0){for(a.slice(-e).forEach(function(e,t){d[t]=d[t]||[],e.forEach(function(e,n){d[t][i.left+n]=e})}),t=0;t<d.length;t++)for(n=0;n<c;n++)d[t][n]=d[t][n]||o.createCell({row:i.top+i.height,col:n});this.executeAtomicCommand(new r({rect:{row:u},table:o,cellsData:d,sizes:s?s.slice(-e):null})),this.effected=!0}},_handleMergePointCell:function(e,t,n){var o=this._table,i=this._rect;e.isMergePoint()?(e.getMergePointAttr(),this.executeAtomicCommand(new a({rect:{row:i.top+t,col:i.left+n},value:e.getMergePointAttr(),type:a.TYPES.POINT,table:o}))):e.isMergedCell()&&this.executeAtomicCommand(new a({rect:{row:i.top+t,col:i.left+n},value:e.getMergedCellAttr(),type:a.TYPES.CELL,table:o}))},_handleOldMergePoint:function(e,t,n){var o,i,r=this._table,s=this._rect,a=this._cellsData,l=a.length,c=a[0].length;if(e&&(e.isMergePoint()&&(o=e.getMergePointAttr(),this._clearCellsAttr(t,n,o.width,o.height)),e.isMergedCell())){if(!(i=r.getCell(t,n,{findMergePointIfNeeded:!0,withPosition:!0}))||s.top+l>=i.row&&s.top<=i.row&&s.left+c>i.col&&s.left<=i.col)return;o=i.cell.getMergePointAttr(),this._clearCellsAttr(i.row,i.col,o.width,o.height)}},_clearCellsAttr:function(e,t,n,o){var i,r,s=this._table;for(i=0;i<o;i++)for(r=0;r<n;r++)this.executeAtomicCommand(new a({table:s,rect:{row:e+i,col:t+r}}))},_clearCellsData:function(){var e,t,n=this._rect,o=this._table;for(e=0;e<n.height;e++)for(t=0;t<n.width;t++)this.executeAtomicCommand(new s({content:"",table:o,cellRect:{row:e+n.top,col:t+n.left}}));this.executeAtomicCommand(new l({rect:n,table:o}))},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._rect=o.simpleValue1,this._widths=o.simpleValue2.widths,this._heights=o.simpleValue2.heights,this._cellsData=c.cellsFromCollabJSON(o.dataBefore))},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.simpleValue1=this._rect,e.simpleValue2={widths:this._widths,height:this._heights},e.dataBefore=c.cellsToCollabJSON(this._cellsData),e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(9),i=n(4),r=n(161),s=n(3);return t=o.extend({name:"comp.SetTableCellInlineStyle",_table:null,_styles:null,_rect:null,_toggle:null,initialize:function(){var e,n=this.options.args;t.__super__.initialize.apply(this),s.isCollabCommand(n)||(e=n.range,this._styles=n.styles,this._toggle=n.toggle,this._transformRangeToData(e,n))},_transformRangeToData:function(e){var t,n,o=e.getStartBlockRange();(t=o.getAsRectRange())&&(n=t.getRect(),this._rect=n,this._table=o.block)},apply:function(){this._rect&&this.executeAtomicCommand(new r({table:this._table,rect:this._rect,styles:this._styles,toggle:this._toggle}))},fromCollabJSON:function(){var e,n=this.options.args.collabProperties,o=n.cmdJSON;t.__super__.fromCollabJSON.apply(this),e=n.coreEditor.getNote(),o&&(this._table=e.getBlockById(o.blockId),this._rect=o.simpleValue1,this._styles=o.simpleValue2||null,this._toggle=o.newBlkId||null)},toCollabJSON:function(){var e=t.__super__.toCollabJSON.apply(this);return e.blockId=this._table.getId(),e.simpleValue1=this._rect,e.simpleValue2=this._styles||null,e.newBlkId=this._toggle||null,e}}),i.add(t),t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(16),i=n(0),r=n(1),s=n(18),a=n(6),l=n(159),c=function(e){return e&&e.name===l.prototype.name},u=n(57),d=n(14);return t={_editor:null,_undoStack:null,_redoStack:null,_notOwnManagerAdapterStack:null,initialize:function(e){this._undoStack=[],this._redoStack=[],this._notOwnManagerAdapterStack=[],this._editor=e.editor},exec:function(e,t,n){var o,i,s,a,l=!1,u=!0,h=!1;return e?this._editor.isCollabEnabled()&&(l=n.collabProperties.isCollabCmd&&n.collabProperties.isOwnCmd,u=!n.collabProperties.isCollabCmd,l&&(c(e)?this._localManagerAdapterOverriden(e)?e.setIgnoreUndoRedo(!0):h=!0:n.collabProperties.cmdJSON.isLocalExecutedCmd&&(h=!0)),h)?(r.log("Skip local-executed collab command and update noteVersion",e),this._updateUndoCmdFinalVersion(e.cmdId,n.collabProperties.finalNoteVersion),this.trigger("command-exec",e,n),!0):(a=e.apply(),i={cmdName:e.name,cmdType:"do"},o=e.getEndingRange(),!1!==a&&!d.isNoteRange(o)&&e.getStartingRange()&&(r.warn("endingRange should be a noteRange, so set it to be same as startEndingRange:",o),o=e.getStartingRange(),e.setEndingRange(o)),s=u||l,o&&s&&!e.updateSelectionDisabled&&this.trigger("update-selection",o,i,n),s&&!e.effected?(this.trigger("command-exec",e,n),a):(c(e)&&(e.sendInfoToInner({canUndo:this.canUndo(),canRedo:this.canRedo()}),s||this._notOwnManagerAdapterStack.push(e)),this._editor.isCollabEnabled()?n.collabProperties.dataCmdError?(this.trigger("command-exec",e,n),!1):(s&&(e.getIgnoreUndoRedo()||this._pushToUndoStack(e),this._redoStack=[]),this.trigger("command-exec",e,n),!0):(e.getIgnoreUndoRedo()||this._undoStack.push(e),this._redoStack=[],this.trigger("command-exec",e,n),!0))):(r.log("Skip empty local command"),!1)},canUndo:function(){return 0!==this._undoStack.length},undo:function(){if(!this.canUndo())return r.warn("Can Not undo"),!1;var e,t=this._undoStack,n=this._redoStack,o=t.pop();return o.doUnapply(),n.push(o),this.trigger("command-exec",o),e={cmdName:o.name,cmdType:"undo"},this.trigger("update-selection",o.getStartingRange(),e),!0},canRedo:function(){return 0!==this._redoStack.length},redo:function(){if(!this.canRedo())return!1;var e,t=this._undoStack,n=this._redoStack.pop();return n.doReapply(),t.push(n),this.trigger("command-exec",n),e={cmdName:n.name,cmdType:"redo"},this.trigger("update-selection",n.getEndingRange(),e),!0},reset:function(){this._undoStack=[],this._redoStack=[],this._notOwnManagerAdapterStack=[]},registerManager:function(e,t){var n,o=this;e&&e.on?(o.unregisterManager(e),e.on("command-executed",function(i,s){var a=l.create(t,i,s);a?(a.isOriginalCmd=!0,a.isLocalExecutedCmd=!0,a.setCmdOriginalNoteVersion(o._editor.getNoteVersion()),o._pushToUndoStack(a),o._redoStack=[],o.trigger("command-exec",a),e.triggerGlobalUndoStatus(o.canUndo(),o.canRedo()),o._editor.isCollabEnabled()&&(n=window.JSON.parse(s))&&0!==n.colWidths.length&&0!==n.rowHeights.length&&o._editor.pushLocalDataCommand(a,!0)):r.warn("ManagerAdapter failed to create command!")})):r.warn("commandManager is not Valid!")},unregisterManager:function(e){e&&e.on&&e.off("command-executed")},applyCollabCmdRedoUndo:function(e){var t,n=e.options.args,o=n.collabProperties.cmdJSON,i=n.collabProperties.isOwnCmd;if(i&&n.collabProperties.isLocalExecutedCmd)return r.log("skip local-executed-own redo/undo",e),void this.trigger("command-exec",e,n);n.collabProperties.isCollabUndo?(e.setCollabUndo(!0),e.setCollabRedo(!1),t=e.doUnapply(n)):n.collabProperties.isCollabRedo&&(e.setCollabUndo(!1),e.setCollabRedo(!0),t=e.doReapply(n)),!1!==t?(n.collabProperties.isCollabUndo&&e.setStartingRange(u.buildNoteRangeFromJSON(o.startNoteRange,this._editor)),n.collabProperties.isCollabRedo&&e.setEndingRange(u.buildNoteRangeFromJSON(o.endNoteRange,this._editor)),i&&(n.collabProperties.isCollabUndo?(this._pushToRedoStack(this._undoStack.pop()),this.trigger("update-selection",e.getStartingRange())):n.collabProperties.isCollabRedo&&(this._pushToUndoStack(this._redoStack.pop()),this.trigger("update-selection",e.getEndingRange())))):i&&(n.collabProperties.isCollabUndo?this.dropUndoCmds():n.collabProperties.isCollabRedo&&this.dropRedoCmd(),this._editor.notifyErrorToHost(a.INVALIDACTION_FAILED_COLLABCMD,n.collabProperties.coreEditor)),i&&c(e)&&e.sendInfoToInner({canUndo:this.canUndo(),canRedo:this.canRedo()}),this.trigger("command-exec",e,n)},dropRedoCmd:function(){r.log("Drop Redo Command"),this._redoStack.pop(),this.trigger("redo-stack-change")},dropUndoCmds:function(e,t,n){var o;r.log("Drop Undo Command:",e,t,n),e?(o=this._getUndoCmdIndexById(e))>=0&&(n?this._undoStack.splice(o,t,n):this._undoStack.splice(o,t)):this._undoStack.pop(),this.trigger("undo-stack-change")},getRedoCmd:function(){return i.last(this._redoStack)},getUndoCmd:function(){return i.last(this._undoStack)},_getUndoCmdIndexById:function(e){var t=-1,n=0;return i.some(this._undoStack,function(o){return o.getCmdId()===e&&(t=n),t>=0||(n++,!1)}),t},_pushToRedoStack:function(e){e?this._redoStack.push(e):r.log("null command should NOT be pushed to Redo Stack")},_pushToUndoStack:function(e){e?e.getIgnoreUndoRedo()?r.log("this command no need undo redo."):(this._undoStack.push(e),this._undoStack.length>a.MAX_UNDO_STACK_SIZE&&this._undoStack.shift()):r.log("null command should NOT be pushed to Undo Stack")},_localManagerAdapterOverriden:function(e){var t,n=!1,o=0;for(this._notOwnManagerAdapterStack&&(o=this._notOwnManagerAdapterStack.length);o>0&&(t=this._notOwnManagerAdapterStack[o-1]).getCmdOriginalNoteVersion()===e.getCmdOriginalNoteVersion();o--)if(e.getBlockId()===t.getBlockId()){n=!0;break}return n},_updateUndoCmdFinalVersion:function(e,t){i.some(this._undoStack,function(n){if(n.cmdId===e)return n.setCmdFinalNoteVersion(t),!0})}},i.extend(t,s.Events),o.extend(t)}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(14),n(27),n(17),n(1),n(32),n(166)],void 0===(i=function(e,t,n,o,i,r,a,l){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.collapseToStart=function(){this.noteRange&&this.noteRange.collapse&&(this.noteRange.collapse(!0),this._drawRange(),this._triggerSelectionChange())},t.prototype.collapseToEnd=function(){this.noteRange&&this.noteRange.collapse&&(this.noteRange.collapse(!1),this._drawRange(),this._triggerSelectionChange())},t.prototype.getNativeRange=function(){return a.getRange(window)},t.prototype.getRange=function(){return this.noteRange},t.prototype.isCollapsed=function(){var e=this.noteRange;return!!e&&e.isCollapsed()},t.prototype.reset=function(){this.noteRange=null},t.prototype.setRange=function(e,t,n,o){this._setRange(e,{scrollIntoView:o,selectionChangeEvent:t,toDraw:!0,trigger:!0,inlineStyles:n})},t.prototype.initialize=function(e){this.noteView=e.noteView,this._bindEvents()},t.prototype._bindEvents=function(){o.addListeners({selectionchange:"_onDocSelectionChange","set-range":"_onSetRange"},this.noteView,this)},t.prototype._convertToNoteRange=function(e){return n.fromNativeRange(e,this.noteView)},t.prototype._drawRange=function(e){e=!1!==e,this.noteView.trigger("draw-range",this.noteRange,e)},t.prototype._onDocSelectionChange=function(e){var t=a.getRange(),n=this._convertToNoteRange(t);this.noteRange=n,!n||n.canDrawedByNative()?(this.trigger("doc-change-selection",n),this._triggerSelectionChange()):this.setRange(n)},t.prototype._onSetRange=function(e,t,n,o){this._setRange(e,{selectionChangeEvent:o,toDraw:t,trigger:n})},t.prototype._setRange=function(e,t){var n=this._convertToNoteRange(e);n&&n.getStartBlockRange()&&n.getEndBlockRange()?(t=t||{},this.noteRange=n,t.toDraw&&this._drawRange(t.scrollIntoView),t.trigger&&this._triggerSelectionChange(t.selectionChangeEvent,t.inlineStyles)):r.warn("Failed convert native range to note range!")},t.prototype._triggerSelectionChange=function(e,t){e||(e=l.createUserTypeEvent()),this.trigger("selection-change",e,t)},t}(i)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(){return{encode:function(e){return window.btoa(window.unescape(encodeURIComponent(e)))},decode:function(e){return decodeURIComponent(window.escape(window.atob(e)))}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(344),n(345),n(346),n(347),n(348),n(349),n(350),n(351),n(352),n(353),n(354),n(355),n(356),n(357),n(358),n(359),n(360),n(361),n(362),n(363),n(364),n(365),n(366),n(367),n(368),n(369),n(370),n(371),n(372),n(373),n(374),n(375),n(376)],void 0===(i=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"backspace",key:"backspace",action:function(e){e.execDeleteBackward()}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"del",key:"del",action:function(e){e.execDeleteForward()}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5),n(14),n(26),n(2)],void 0===(i=function(e,t,n,o,i,r){"use strict";var s=this;Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t,n){var a=e.noteView;a&&(a.directionKeyJustMoved=!0),e.moveCaretWithDirection(!0,t);var l=e.getNoteRange().getEndBlockRange(),c=l.block,u=e.note.getLastBlock(),d=e.note.getNextBlock(c);if(!c.isEmpty()||r.isHr(d))switch(n){case"right":c.getLength()===l.end&&u===c&&e.execCommand("comp.AppendBlank",{inlineStyles:s.editingInlineStates});break;case"down":u===c&&e.execCommand("comp.AppendBlank",{inlineStyles:s.editingInlineStates})}else if(u!==c&&d){var h=i.createRangeByBlock({allContent:!1,block:d,collapseToStart:!1});e.noteSelection.setRange(new o({startRange:h,endRange:h})),t.preventDefault()}};n.register({name:"down",key:"down",preventDefault:!1,action:a}),n.register({name:"right",key:"right",preventDefault:!1,action:a})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(2),n(5)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){var t,o;o=(t=e.getNoteRange()).getEndBlockRange(),t.isInSingleBlock()&&n.isHeading(o.block)&&o.isCollapsed()&&o.start===o.block.getLength()&&e.resetEditingInlineStates(),e.execCommand("comp.KeyEnter",{inlineStyles:e.getEditingInlineState()})};o.register({name:"enter",key:"enter",action:i}),o.register({name:"alt+enter",key:"alt+enter",action:i}),o.register({name:"shift+enter",key:"shift+enter",action:i})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"esc",key:"esc",preventDefault:!1,action:function(e){e.trigger("esc")}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(2),n(1),n(5)],void 0===(i=function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i.register({name:"space",key:"space",action:function(e){var t,i=e.getNoteRange();i&&(t=i.getStartBlockRange().block,i.isInSingleBlock()&&t&&n.isTable(t))?o.error("should NOT trigger insertText when select only Table."):e.insertText(" ",!1)}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"tab",key:"tab",action:function(e){var t=e.getEditingInlineState();e.execCommand("comp.KeyTab",{inlineStyles:t})}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t){var n=e.noteView;n&&(n.directionKeyJustMoved=!0),e.moveCaretWithDirection(!1,t)};n.register({name:"up",key:"up",preventDefault:!1,action:o}),n.register({name:"left",key:"left",preventDefault:!1,action:o})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5),n(0),n(1)],void 0===(i=function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});o.each(["ctrl+backspace","ctrl+del","shift+backspace","shift+del","alt+backspace","alt+del","mod+backspace","mod+del"],function(e){n.register({name:e,key:e,preventDefault:!0,action:function(){i.log("shortcut prevented:",e)}})})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"bold",key:"mod+b",action:function(e){e.toggleInlineStyle("bold")}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(46),n(5)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return n.pad(e,2,"0","left")};o.register({name:"insertDate",key:"alt+shift+d",action:function(e){var t=new Date,n=t.getFullYear()+"/"+i(t.getMonth()+1)+"/"+i(t.getDate())+" "+i(t.getHours())+":"+i(t.getMinutes());e.insertText(" "+n+" ",!1)}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"italic",key:"mod+i",action:function(e){e.toggleInlineStyle("italic")}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){e.redo()};n.register({name:"redo",key:"mod+y",action:o}),n.register({name:"redo_2",key:"mod+shift+z",action:o})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(1),n(5)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o.register({name:"reloadPage",key:"mod+shift+r",preventDefault:!1,action:function(){if(n.DEBUG){window.clearJstCache&&(window.clearJstCache(),window.alert("Clear JST cache... Done!"));var e=window.location.href;window.location.href=e}}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"save",key:"mod+s",action:function(e){e.trigger("yne-save-content")}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"underline",key:"mod+u",action:function(e){e.toggleInlineStyle("underline")}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"undo",key:"mod+z",action:function(e){e.undo()}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"selectAll",key:"mod+a",read:!0,action:function(e){e.selectAll()}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(2),n(5)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){var t,o,i=e.getNoteRange(),r=e.noteView;r.getHtmlContentEditable()||i&&i.isInSingleBlock()&&i.isMatchBlockTypes(e.note,[n.IMAGE,n.ATTACHMENT])&&(t=i.getStartBlockRange().block,(o=r.getBlockViewByBlock(t))&&(r.setHtmlContentEditable(!0),o.el.focus(),window.setTimeout(function(){r.setHtmlContentEditable(!1)},0)))};o.register({name:"copy",key:"mod+c",preventDefault:!1,read:!0,action:i}),o.register({name:"cut",key:"mod+x",preventDefault:!1,action:i})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(8),n(5)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o.register({name:"paste",key:"mod+v",preventDefault:!1,action:function(e,t){var o=e.editor;e.setPasteAsText(!1),n.IS_MAC&&(t.preventDefault(),o.callMacNativeApi("menuPaste"))}}),o.register({name:"pasteAsText",key:"mod+shift+v",preventDefault:!1,action:function(e){e.setPasteAsText(!0)}}),o.register({name:"pasteAsText_alternative",key:"mod+shift+option+v",preventDefault:!1,action:function(e){e.setPasteAsText(!0)}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(8),n(5)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=!0;(n.IS_WEB_NOTE||n.IS_WEB_GROUP)&&(i=!1),o.register({name:"find",key:"mod+f",read:!0,preventDefault:i,action:function(e){e.trigger("find")}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"shiftTab",key:"shift+tab",action:function(e){var t=e.getEditingInlineState();e.execCommand("comp.KeyTab",{inlineStyles:t,withShiftKey:!0})}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(8),n(5)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.IS_PC&&(o.register({name:"zoomIn_0",key:"mod+plus",action:function(e){e.zoomInEditor()}}),o.register({name:"zoomIn_1",key:"mod+shift+plus",action:function(e){e.zoomInEditor()}}),o.register({name:"zoomIn_2",key:"mod+=",action:function(e){e.zoomInEditor()}}),o.register({name:"zoomIn_3",key:"mod+shift+=",action:function(e){e.zoomInEditor()}}))}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(8),n(5)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.IS_PC&&(o.register({name:"zoomOut_0",key:"mod+-",action:function(e){e.zoomOutEditor()}}),o.register({name:"zoomOut_1",key:"mod+shift+-",action:function(e){e.zoomOutEditor()}}),o.register({name:"zoomOut_2",key:"mod+0",action:function(e){e.zoomEditor(1,!0)}}))}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(8),n(5)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o.register({name:"deleteToEnd",key:"ctrl+k",action:function(e){n.IS_MAC&&e.execDeleteToEnd()}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(8),n(5)],void 0===(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o.register({name:"deleteForward",key:"ctrl+d",action:function(e){n.IS_MAC&&e.execDeleteForward()}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(20),n(1),n(8),n(5)],void 0===(i=function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={insertHeading_1:"1",insertHeading_2:"2",insertHeading_3:"3",insertHeading_4:"4"},a=function(e,t,n){o.log(t),null!=s[n]?e.execCmdByShortCut("comp.InsertHeading",{level:s[n]}):o.warn("Unsupported shortKey:",n)};n.isSafari()&&!i.IS_MAC||(r.register({name:"insertHeading_1",key:"mod+1",preventDefault:!0,action:a}),r.register({name:"insertHeading_2",key:"mod+2",preventDefault:!0,action:a}),r.register({name:"insertHeading_3",key:"mod+3",preventDefault:!0,action:a}),r.register({name:"insertHeading_4",key:"mod+4",preventDefault:!0,action:a}))}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(5)],void 0===(i=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.register({name:"strikeout",key:"mod+e",action:function(e){e.toggleInlineStyle("strike")}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(34),n(20),n(1),n(8),n(5)],void 0===(i=function(e,t,n,o,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t,o){var r;if(i.log(t),"insertOrderList"===o)r=n.ORDERED;else{if("insertUnorderList"!==o)return void i.warn("Unsupported shortKey:",o);r=n.UNORDERED}e.execCmdByShortCut("comp.InsertList",{type:r})};o.isSafari()&&!r.IS_MAC||(s.register({name:"insertUnorderList",key:"mod+l",preventDefault:!0,action:a}),s.register({name:"insertOrderList",key:"mod+shift+l",preventDefault:!0,action:a}))}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(20),n(1),n(8),n(5)],void 0===(i=function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n.isSafari()&&!i.IS_MAC||r.register({name:"insertTodo",key:"mod+d",preventDefault:!0,action:function(e,t,n){o.log(t,n),e.execCmdByShortCut("comp.InsertTodo",{checked:!1})}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(20),n(1),n(8),n(5)],void 0===(i=function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n.isSafari()&&!i.IS_MAC||r.register({name:"insertHR",key:"mod+h",preventDefault:!0,action:function(e,t,n){o.log(t,n),e.execCmdByShortCut("comp.InsertHorizontalRule")}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(20),n(1),n(8),n(5)],void 0===(i=function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n.isSafari()&&!i.IS_MAC||r.register({name:"insertQuote",key:"ctrl+q",preventDefault:!0,action:function(e,t,n){o.log(t,n),e.execCmdByShortCut("comp.InsertQuote")}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(20),n(8),n(5)],void 0===(i=function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n.isSafari()&&!o.IS_MAC||i.register({name:"insertCode",key:"ctrl+alt+d",preventDefault:!0,action:function(e,t,n){e.execCmdByShortCut("comp.InsertCode")}})}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(18),o=n(0),i=n(7),r=n(12),s=n(25),a=n(87),l=[["r","g","b"],["h","s","v"],["h","s","l"]],c=[[255,255,255],[360,100,100],[360,100,100]];return t.View.extend({className:"color-picker",name:"colorpicker",label:"选色器",templateName:"color_picker",events:{mousedown:"onMouseDown","mousedown .color-picker-panel":"onPanelMouseDown","mousedown .color-picker-panel-board":"onBoardMousedown","mousedown .color-picker-panel-alpha":"onAlphaMousedown","mousedown .color-picker-panel-ribbon":"onRibbonMousedown","click .color-picker-panel-params-lable-number":"onParamsLabelClick"},initialize:function(e){this.editor=e.editor,this.render(),this.hidePicker(),this.mode=0,o.bindAll(this,"onDocumentMouseDown","onBoardMousedown","onBoardDrag","onBoardDragEnd","onAlphaMousedown","onAlphaDrag","onAlphaDragEnd","onRibbonMousedown","onRibbonDrag","onRibbonDragEnd","onParamsLabelClick"),this.on("color-picker-show",this.showPicker),i(document).on("mousedown",this.onDocumentMouseDown)},render:function(){var e,t=this.$el;e=r.render("common",this.templateName),t.html(e),this.panel=t.find(".color-picker-panel")[0],this.board=t.find(".color-picker-panel-board")[0],this.boardBg=i(this.board).find(".color-picker-panel-board-hsv"),this.ribbon=t.find(".color-picker-panel-ribbon")[0],this.alpha=t.find(".color-picker-panel-alpha")[0],this.preview=t.find(".color-picker-panel-preview")[0],this.inputs=t.find(".color-picker-panel-params-input"),this.inputHex=i(this.inputs).find("input")[0],this.inputR=i(this.inputs).find("input")[1],this.inputG=i(this.inputs).find("input")[2],this.inputB=i(this.inputs).find("input")[3],this.inputA=i(this.inputs).find("input")[4],this.labelR=t.find(".color-picker-panel-params-lable-number")[0],this.labelG=t.find(".color-picker-panel-params-lable-number")[1],this.labelB=t.find(".color-picker-panel-params-lable-number")[2],this.bindEvents()},bindEvents:function(){o.bindAll(this,"onHexChange","onRedChange","onGreenChange","onBlueChange","onAlphaChange","updateInputHex","updateInputR","updateInputG","updateInputB","updateInputA","onKeyDown","onLastInputKeyDown"),i(this.inputHex).on("input propertychange",this.onHexChange),i(this.inputHex).on("blur",this.updateInputHex),i(this.inputHex).on("keydown",this.onKeyDown),i(this.inputR).on("input propertychange",this.onRedChange),i(this.inputR).on("blur",this.updateInputR),i(this.inputR).on("keydown",this.onKeyDown),i(this.inputG).on("input propertychange",this.onGreenChange),i(this.inputG).on("blur",this.updateInputG),i(this.inputG).on("keydown",this.onKeyDown),i(this.inputB).on("input propertychange",this.onBlueChange),i(this.inputB).on("blur",this.updateInputB),i(this.inputB).on("keydown",this.onKeyDown),i(this.inputA).on("input propertychange",this.onAlphaChange),i(this.inputA).on("blur",this.updateInputA),i(this.inputA).on("keydown",this.onLastInputKeyDown)},showPicker:function(e){var t=this.solidColor(e.selectedValue);t.isValid()||(t=this.solidColor(e.value)),t.isValid()||(t=s("#393939")),this.color=t,this.mode=0,this.item=e,this.$el.show(),this.updateUI()},solidColor:function(e){var t=s(e),n=t.toRgb();return 0===n.r&&0===n.g&&0===n.b&&0===n.a&&t.setAlpha(1),t},hidePicker:function(){var e;this.removeWindowListeners(),this.$el.hide(),this.item&&(e=this.color.toRgbString(),this.item.changeValue(e),this.item=null)},removeWindowListeners:function(){i(window).off("mousemove",this.onBoardDrag),i(window).off("mouseup",this.onBoardDragEnd),i(window).off("mousemove",this.onAlphaDrag),i(window).off("mouseup",this.onAlphaDragEnd),i(window).off("mousemove",this.onRibbonDrag),i(window).off("mouseup",this.onRibbonDragEnd)},onDocumentMouseDown:function(){this.hidePicker()},onMouseDown:function(e){this.hidePicker(),e.stopPropagation(),e.preventDefault()},onPanelMouseDown:function(e){e.stopPropagation()},onBoardMousedown:function(e){this.onBoardDrag(e),this.removeWindowListeners(),i(window).on("mousemove",this.onBoardDrag),i(window).on("mouseup",this.onBoardDragEnd)},onBoardDrag:function(e){var t=e.clientX,n=e.clientY;e.preventDefault(),this.pointMoveTo({x:t,y:n})},onBoardDragEnd:function(e){this.onBoardDrag(e),this.removeWindowListeners()},pointMoveTo:function(e){var t,n,o=this.board.getBoundingClientRect(),r=e.x-o.left,a=e.y-o.top,l=this.color.toHsv(),c=i(this.boardBg).css("background-color"),u=l.h;(t=s(c)).isValid()&&(u=t.toHsv().h),r=Math.max(0,r),r=Math.min(r,200),a=Math.max(0,a),a=Math.min(a,150),(n=s.fromRatio({h:u/360,s:r/200,v:1-a/150,a:l.a})).isValid()&&(this.color=n,this.updateBoardPoint(r-4,a-4),this.updatePreview(),this.updateAlpha(),this.updateInputHex(),this.updateInputG(),this.updateInputB(),this.updateInputR())},onAlphaMousedown:function(e){this.onAlphaDrag(e),this.removeWindowListeners(),i(window).on("mousemove",this.onAlphaDrag),i(window).on("mouseup",this.onAlphaDragEnd)},onAlphaDrag:function(e){var t=e.clientX,n=e.clientY;e.preventDefault(),this.alphaMoveTo({x:t,y:n})},onAlphaDragEnd:function(e){this.onAlphaDrag(e),this.removeWindowListeners()},alphaMoveTo:function(e){var t,n=this.alpha.getBoundingClientRect(),o=n.width,i=e.x-n.left;i=Math.max(0,i),t=(i=Math.min(i,o))/o,this.color.setAlpha(t),this.updateAlpha(100*t),this.updatePreview(),this.updateInputA()},onRibbonMousedown:function(e){this.onRibbonDrag(e),this.removeWindowListeners(),i(window).on("mousemove",this.onRibbonDrag),i(window).on("mouseup",this.onRibbonDragEnd)},onRibbonDrag:function(e){var t=e.clientX,n=e.clientY;e.preventDefault(),this.ribbonMoveTo({x:t,y:n})},onRibbonDragEnd:function(e){this.onRibbonDrag(e),this.removeWindowListeners()},ribbonMoveTo:function(e){var t,n,o=this.ribbon.getBoundingClientRect(),i=o.width,r=e.x-o.left,a=this.color.toHsv();r=Math.max(0,r),t=(r=Math.min(r,i))/i,(n=s.fromRatio({h:t,s:a.s,v:a.v,a:a.a})).isValid()&&(this.color=n,this.updateRibbon(100*t),this.updateBoardBg(360*t),this.updatePreview(),this.updateAlpha(),this.updateInputHex(),this.updateInputR(),0===this.mode&&(this.updateInputG(),this.updateInputB()))},onHexChange:function(){var e,t=i(this.inputHex).val();t.length>0&&t.length<6&&(t=t.concat("0".repeat(6-t.length))),(e=s(t)).isValid()&&(e.setAlpha(this.color.getAlpha()),this.color=e,this.updateOnHexChange())},updateOnHexChange:function(){this.updateBoardPoint(),this.updateBoardBg(),this.updatePreview(),this.updateAlpha(),this.updateRibbon(),this.updateInputR(),this.updateInputG(),this.updateInputB()},onRedChange:function(){var e=i(this.inputR).val(),t=this.mode,n=this.color.toHsv(),r=this.color.toRgb(),a=this.color.toHsl();e=parseInt(e),o.isNumber(e)&&!o.isNaN(e)&&(e<0||e>c[t][0]||(this.color=1===t?s.fromRatio({h:e/360,s:n.s,v:n.v,a:n.a}):2===t?s.fromRatio({h:e/360,s:a.s,l:a.l,a:a.a}):s({r:e,g:r.g,b:r.b,a:r.a}),this.updateOnRedChange()))},updateOnRedChange:function(){0===this.mode&&this.updateBoardPoint(),this.updateBoardBg(),this.updatePreview(),this.updateAlpha(),this.updateRibbon(),this.updateInputHex()},onGreenChange:function(){var e=i(this.inputG).val(),t=this.mode,n=this.color.toHsv(),r=this.color.toRgb(),a=this.color.toHsl();e=parseInt(e),o.isNumber(e)&&!o.isNaN(e)&&(e<0||e>c[t][1]||(this.color=1===t?s.fromRatio({h:n.h,s:e/100,v:n.v,a:n.a}):2===t?s.fromRatio({h:a.h,s:e/100,l:a.l,a:a.a}):s({r:r.r,g:e,b:r.b,a:r.a}),this.updateOnGreenChange()))},updateOnGreenChange:function(){this.updateBoardPoint(),0===this.mode&&(this.updateBoardBg(),this.updateRibbon()),this.updatePreview(),this.updateAlpha(),this.updateInputHex()},onBlueChange:function(){var e=i(this.inputB).val(),t=this.mode,n=this.color.toHsv(),r=this.color.toRgb(),a=this.color.toHsl();e=parseInt(e),o.isNumber(e)&&!o.isNaN(e)&&(e<0||e>c[t][2]||(this.color=1===t?s.fromRatio({h:n.h,s:n.s,v:e/100,a:n.a}):2===t?s.fromRatio({h:a.h,s:a.s,l:e/100,a:a.a}):s({r:r.r,g:r.g,b:e,a:r.a}),this.updateOnBlueChange()))},updateOnBlueChange:function(){this.updateBoardPoint(),0===this.mode&&(this.updateBoardBg(),this.updateRibbon()),this.updatePreview(),this.updateAlpha(),this.updateInputHex()},onAlphaChange:function(){var e=i(this.inputA).val();e=parseInt(e),o.isNumber(e)&&!o.isNaN(e)&&(e<0||e>100||(this.color.setAlpha(e/100),this.updateOnAlphaChange()))},updateOnAlphaChange:function(){this.updatePreview(),this.updateAlpha()},onParamsLabelClick:function(){var e=this.mode;e+=1,e%=3,this.mode=e,this.updateInputR(),this.updateInputB(),this.updateInputG()},onKeyDown:function(e){a.isMatch("enter",e.keyCode)&&(e.stopPropagation(),e.preventDefault(),this.hidePicker(),this.editor.focus())},onLastInputKeyDown:function(e){(a.isMatch("enter",e.keyCode)||a.isMatch("tab",e.keyCode))&&(e.stopPropagation(),e.preventDefault(),this.hidePicker(),this.editor.focus())},inputValue:function(e,t){var n,o=this.color,i=o.toRgb(),r=o.toHsv(),s=o.toHsl(),a=1;switch(e){case 0:n=i;break;case 1:n=r;break;case 2:n=s;break;default:n=i}return(0===e||1!==t&&2!==t)&&3!==t||(a=100),Math.round(n[l[e][t]]*a)},updateInputHex:function(){var e=this.color;i(this.inputHex).val(e.toHex().toUpperCase())},updateInputR:function(){var e=this.mode;i(this.labelR).text(l[e][0].toUpperCase()),i(this.inputR).val(this.inputValue(e,0))},updateInputG:function(){var e=this.mode;i(this.labelG).text(l[e][1].toUpperCase()),i(this.inputG).val(this.inputValue(e,1))},updateInputB:function(){var e=this.mode;i(this.labelB).text(l[e][2].toUpperCase()),i(this.inputB).val(this.inputValue(e,2))},updateInputA:function(){var e=this.color.getAlpha();i(this.inputA).val(Math.round(100*e))},updateBoardBg:function(e){var t,n=this.color.toHsv(),o=this.boardBg;e>=0&&e<=360||(e=n.h),t=s.fromRatio({h:e/360,s:1,v:1}),o.css("background-color",t.toHexString())},updateBoardPoint:function(e,t){var n=this.color.toHsv(),o=i(this.board).find("span");e>=0&&e<=200||(e=200*n.s-4),t>=0&&t<=150||(t=150*(1-n.v)-4),o.css("left",e+"px"),o.css("top",t+"px")},updatePreview:function(){var e=this.color,t=e.getAlpha(),n=i(this.preview).find("span");n.css("background-color",e.toHexString()),n.css("opacity",t)},updateAlpha:function(e){var t,n=this.color.toRgb(),o=i(this.alpha).find(".color-picker-panel-alpha-bg"),r=i(this.alpha).find("span");e>=0&&e<=100||(e=100*n.a),t="linear-gradient(to right, "+s({r:n.r,g:n.g,b:n.b,a:0}).toRgbString()+", "+s({r:n.r,g:n.g,b:n.b,a:1}).toRgbString()+")",o.css("background",t),r.css("left",e+"%")},updateRibbon:function(e){var t=this.color.toHsv().h,n=i(this.ribbon).find("span");e>=0&&e<=100||(e=Math.round(t/360*100)),n.css("left",e+"%")},updateUI:function(){this.updateBoardBg(),this.updateBoardPoint(),this.updatePreview(),this.updateAlpha(),this.updateRibbon(),this.updateInputHex(),this.updateInputA(),this.updateInputR(),this.updateInputB(),this.updateInputG(),this.updateInputHex()},reset:function(){this.$el.hide()}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){"use strict";var o;void 0===(o=function(e){var t=n(12),o=n(18),i=n(0),r=n(87),s=n(8),a=n(1),l=n(169),c=function(){};return o.View.extend({className:"image-title-input-wrapper",name:"ImageTitleInputView",events:{"keydown .image-title-input":"_onKeyDown","paste .image-title-input":"_onPaste","input .image-title-input":"_onInput"},zoom:1,initialize:function(e){this.editor=e.editor,i.bindAll(this,"_onEditStart","_onEditEnd","_onKeyDown","_onExit","_onUpdate","_getPosition","_onPaste","_show","_hide","_onInput","_handlerPlaceholder","_onLockedChange"),this.on("img-title-edit-start",this._onEditStart),this.on("img-title-edit-end",this._onEditEnd),this.on("img-title-edit-focus",this._onFocus),this.on("img-title-edit-exit",this._onExit),this.on("img-title-edit-update",this._onUpdate),this.on("locked-change",this._onLockedChange),this._callback=c},render:function(){var e=t.render("common","image-title-input",{title:""});this.$el.html(e)},_getPosition:function(e){var t=this.editor.getNoteViewWrapper(),n=s.IS_PC?this.editor.getNoteViewFrame():this.editor.noteView.$el,o=n.offset(),i=parseInt(n.css("margin-top"));e.left=e.left-t.offset().left+t.scrollLeft(),e.top=e.top-o.top+i},_show:function(){var e=this._origialNode;this.$el.show(),e&&e.css("color","transparent")},_hide:function(){var e=this._origialNode;e&&(e.css("color",""),e.css("height","auto")),this.$el.hide()},_onEditStart:function(e,n,o,r,s){var a,l=this,u=n();l.getOffset=n,l._getPosition(u),l._callback!==c&&l._onEditEnd(),e||(e=""),a=t.render("common","image-title-input",i.defaults({title:e},u)),l.$el.html(a),l.$input=this.$el.find(".image-title-input"),l.$placeholder=this.$el.find(".image-title-placeholder"),l.$input.on("blur",function(){l._handlerPlaceholder(),l._onEditEnd()}).on("focus",function(){l._handlerPlaceholder(),l.editor.controller.lockBlockById(s)}),l._callback=o||c,l._origialNode=r,l._handlerPlaceholder(),e&&l._show(),l.$placeholder.click(function(){l.$input.focus()})},_onEditEnd:function(e,t){if(this.$input&&this.$input.is(":visible")){var n=this.$input.text();this._callback(n,e,t,this.$el.is(":visible"))}},_onKeyDown:function(e){if(this.$input.is(":visible")&&r.isMatch("enter",e.keyCode)&&i.isFunction(this._onEditEnd))return e.preventDefault(),this._onEditEnd(!0,this.editor.controller.getNextCaretBlockRange()),void this._onExit();(e.ctrlKey||e.metaKey)&&["B","b","U","u","I","i"].forEach(function(t){r.isMatch(t,e.keyCode)&&e.preventDefault()})},_onFocus:function(){var e=this.$input;e&&e.is(":visible")||this._show(),e.focus()},_onExit:function(){this._hide(),this._callback=c},_onUpdate:function(e){var t=e();this.getOffset=e,this._getPosition(t),this.$input.css({left:t.left,top:t.top,width:t.width+"px","min-height":t.height+"px"}),this.$placeholder.css({left:t.left,top:t.top,width:t.width+"px"})},_handlerPlaceholder:function(){this.$input.text()?this.$placeholder.hide():this.$placeholder.show()},setZoom:function(e){this.zoom=e,this.$el.css("zoom",this.zoom)},_transferString:function(e){var t=e;try{t=(t=t.replace(/\r\n/g," ")).replace(/\n/g," ")}catch(e){a.log("replace image title line break failed!")}return t},_onPaste:function(e){var t,n,o=e.originalEvent;e.preventDefault(),o.clipboardData&&o.clipboardData.getData?(t=o.clipboardData.getData("text/plain"),n=this._transferString(t),document.execCommand("insertHTML",!1,n)):window.clipboardData&&window.clipboardData.getData&&(t=window.clipboardData.getData("Text"),l(t))},_onInput:function(){var e=this.$input.height();e!==this._origialNode.height()&&this._origialNode.height(e),this._handlerPlaceholder()},_onLockedChange:function(){this.getOffset&&this._onUpdate(this.getOffset)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(18),o=n(0),i=n(7),r=n(12),s=n(87),a=n(8),l=n(2),c=n(62),u=n(14);return t.View.extend({className:"link-view",templateName:"link_view",zoom:1,events:{"click .link-confirm-button":"onConfirmButtonClick","click .link-modify-button":"onModifyButtonClick","click .link-remove-button":"onRemoveButtonClick","keydown .link-input":"onKeyDown",mousedown:"onMouseDown",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},initialize:function(e){this.editor=e.editor,this.on("link-menu-show",this.timeoutToShowMenu),this.on("link-menu-hide",this.timeoutToHideMenu),this.bindDocumentEvents(),this.modifyMode=!1,this.on("locked-change",this.recalPosition),i(window).on("resize",this.recalPosition.bind(this))},render:function(){var e,t=this.$el;e=r.render("common",this.templateName,{link:c.safeHref(this.link),isReadOnly:this.editor.isReadOnly()}),t.html(e),this.menuPreviewLink=t.find(".hover-menu-show-link"),this.menuModifyLink=t.find(".hover-menu-modify-link"),this.input=t.find(".link-input"),this.hideModifyMenu()},bindDocumentEvents:function(){o.bindAll(this,"onDocumentMouseDown"),i(document).on("mousedown",this.onDocumentMouseDown)},onKeyDown:function(e){e.stopPropagation(),s.isMatch("enter",e.keyCode)&&(e.preventDefault(),this.onConfirmButtonClick())},onDocumentMouseDown:function(){this.fadeOutMenu()},onMouseDown:function(e){e.stopPropagation()},onConfirmButtonClick:function(){var e=this.range,t=c.safeHref(i(this.input).val());t!==this.link?(window.focus(),t&&this.editor.execCommand("comp.InsertLink",{src:t,range:e}),this.fadeOutMenu()):this.fadeOutMenu()},onRemoveButtonClick:function(){var e=this.range;l.isCatalogue(this.block)?this.editor.execCommand("atom.SetCatalogueHref",{range:e,block:this.block,href:null}):this.editor.execCommand("comp.ApplyStyles",{range:e,inlineStyles:{href:"",color:"#393939",underline:!1}}),this.fadeOutMenu()},onModifyButtonClick:function(){this.hidePreviewMenu(),this.showModifyMenu()},showMenu:function(e){var t=e.range.clone(),n=e.linkNode.href;if(l.isCatalogue(e.block)&&(n=e.block.getViewHref()),!this.modifyMode&&n){var o=new RegExp("^note://");n.match(o)||(this.hideTimerId&&(clearTimeout(this.hideTimerId),this.hideTimerId=null),this.link&&this.hideMenu(),this.linkNode=e.linkNode,this.link=n,this.block=e.block,this.blockId=e.block.getId(),this.range=new u({startRange:t,endRange:t}),this.render(),this.showPreviewMenu())}},recalPosition:function(){this.link&&this.modifyMode&&this.setPosition()},setPosition:function(){var e,t,n,r,s,l,c,u,d,h,p=this.linkNode,g=this.editor.noteView,f=this.editor.getNoteViewWrapper(),m=this.editor.getNoteViewWrapper(),_=a.IS_PC?this.editor.getNoteViewFrame().offset():this.editor.noteView.$el.offset();(e=i(p).offset()).left=e.left-m.offset().left+m.scrollLeft()/this.zoom,e.top=e.top-_.top,t=e.top+i(p).outerHeight(),n=e.left+i(p).outerWidth()/2,l=e.left,h=this.$el.find(".hover-menu-before"),s=i(h[0]).outerWidth()/2,c=t+i(h[0]).outerHeight(),n-l-s<15&&(l=n-15-s),u=this.modifyMode?this.$el.find(".hover-menu-modify-link .hover-menu-body").outerWidth():this.$el.find(".hover-menu-show-link .hover-menu-body").outerWidth(),d=g.$el.outerWidth()-30,f.hasClass("read-mode")&&(d+=parseInt(f.find(".note-view-frame").css("margin-left"))),l+u>d&&(l=d-u),r=n-l-s,i(p).outerHeight()>parseFloat(i(p).css("line-height"))&&(l=e.left-15-s,r=15),this.$el.css("left",l),this.$el.css("top",c),o.each(h,function(e){i(e).css("left",r)})},setZoom:function(e){this.zoom=e,this.$el.css("zoom",this.zoom)},showPreviewMenu:function(){var e=this.menuPreviewLink;this.setPosition(),i(e).show()},hidePreviewMenu:function(){var e=this.menuPreviewLink;i(e).hide()},fadeOutPreviewMenu:function(){var e=this.menuPreviewLink;i(e).fadeOut()},showModifyMenu:function(){var e=this.menuModifyLink;this.modifyMode=!0,this.editor.controller.lockBlockById(this.blockId),this.setPosition(),i(e).show()},hideModifyMenu:function(){var e=this.menuModifyLink;i(e).hide(),this.modifyMode=!1},fadeOutModifyMenu:function(){var e=this.menuModifyLink;i(e).fadeOut(),this.modifyMode=!1},hideMenu:function(){this.stay||(this.hideModifyMenu(),this.hidePreviewMenu(),this.link=null)},fadeOutMenu:function(){this.fadeOutModifyMenu(),this.fadeOutPreviewMenu(),this.link=null,this.range=null,this.linkNode=null,this.hideTimerId=null,this.blockId=null,this.block=null,this.showTimerId&&(clearTimeout(this.showTimerId),this.showTimerId=null)},onMouseEnter:function(e){e.stopPropagation(),this.hideTimerId&&(clearTimeout(this.hideTimerId),this.hideTimerId=null)},onMouseLeave:function(){this.trigger("link-menu-hide")},timeoutToHideMenu:function(){var e=this;e.modifyMode||e.hideTimerId||(e.hideTimerId=setTimeout(function(){e.fadeOutMenu()},100))},timeoutToShowMenu:function(e){var t=this;t.showTimerId||(t.showTimerId=setTimeout(function(){t.showMenu(e)},500))}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(381);return[n(382),n(383),n(384),n(385),n(386),n(387),n(388),n(389),n(390),n(391),n(392),n(393),n(394),t,n(395),n(396),n(397),n(398),t,n(399),n(400),n(401),t,n(402)]}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(13)],void 0===(i=function(e,t,n){"use strict";var o=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){},t.prototype.selectAction=function(){},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="split",this.label="---",this.type=n.TYPE.SPLIT},t}(n))({});return function(){return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(13)],void 0===(i=function(e,t,n){"use strict";var o=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return this.block=t.imgBlock,!!t.imgBlock},t.prototype.selectAction=function(){this.block&&this.block.trigger("edit-image-title")},t.prototype.reset=function(){e.prototype.reset.call(this),this.block=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="imageTitle",this.label="标题"},t}(n))({});return function(){return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(13)],void 0===(i=function(e,t,n){"use strict";var o=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return this.editor.canUndo()},t.prototype.selectAction=function(){this.editor.undo()},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="undo",this.label="撤销",this.key="mod+z"},t}(n))({});return function(){return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(13)],void 0===(i=function(e,t,n){"use strict";var o=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return this.editor.canRedo()},t.prototype.selectAction=function(){this.editor.redo()},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="redo",this.label="重做",this.key="mod+y"},t}(n))({});return function(){return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(8),n(13)],void 0===(i=function(e,t,n,o){"use strict";var i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){var n=e.target,o=n.ownerDocument;t.isRangeCollapsed?this.isDisabled=!0:(this.doc=o,this.targetEl=n)},t.prototype.selectAction=function(){var e,t,o,i=this.doc,r=this.editor,s=this.targetEl;if((e=r.getNoteRange()).isSingleTableSelected()&&(t=e.getStartBlockRange().block,s=r.getController().noteView.getBlockViewByBlock(t).getHiddenInputView()),s.focus(),n.IS_MAC)r.callMacNativeApi("menuCut");else{try{o=i.execCommand("cut")}catch(e){o=!1}o||r.trigger("yne-clipboard-error","cut",function(){r.focus()})}},t.prototype.reset=function(){e.prototype.reset.call(this),this.doc=null,this.targetEl=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="cut",this.label="剪切",this.key="mod+x"},t}(o))({});return function(){return i}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(8),n(13)],void 0===(i=function(e,t,n,o){"use strict";var i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){var n=e.target,o=n.ownerDocument;t.isRangeCollapsed?this.isDisabled=!0:(this.targetEl=n,this.doc=o)},t.prototype.selectAction=function(){var e,t,o,i=this.doc,r=this.editor,s=this.targetEl;if((e=r.getNoteRange()).isSingleTableSelected()&&(t=e.getStartBlockRange().block,s=r.getController().noteView.getBlockViewByBlock(t).getHiddenInputView()),s.focus(),n.IS_MAC)r.callMacNativeApi("menuCopy");else{try{o=i.execCommand("copy")}catch(e){o=!1}o||r.trigger("yne-clipboard-error","copy",function(){r.focus()})}},t.prototype.reset=function(){e.prototype.reset.call(this),this.doc=null,this.targetEl=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="copy",this.label="复制",this.key="mod+c"},t}(o))({});return function(){return i}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(8),n(13)],void 0===(i=function(e,t,n,o){"use strict";var i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){var o,i=e.target,r=i.ownerDocument;return this.targetEl=i,this.doc=r,n.IS_MAC&&(o=this.editor.callMacNativeApi("macClipboardAvailable"),this.isDisabled=!o),!0},t.prototype.selectAction=function(){var e,t,o,i=this,r=i.editor,s=r.getNoteRange(),a=i.doc,l=i.targetEl;if(s.isSingleTableSelected()&&(e=s.getStartBlockRange().block,(t=r.getController().noteView.getBlockViewByBlock(e)).setPasteAsText(!1),l=t.getHiddenInputView()),l.focus(),n.IS_MAC)return r.setPasteAsText(!1),void r.callMacNativeApi("menuPaste");try{o=a.execCommand("paste")}catch(e){o=!1}o||this.editor.trigger("yne-clipboard-error","paste",function(){i.editor.focus()})},t.prototype.reset=function(){e.prototype.reset.call(this),this.doc=null,this.targetEl=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="paste",this.label="粘贴"},t}(o))({});return function(){return i}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(13),o=n(0);return function(){return new t({name:"pasteNoteLink",label:"粘贴引用链接",key:"mod+v",_linkId:null,_linkName:null,queryAction:function(){var e=this,t=e.editor;e._linkId=e._linkName=null,e.isDisabled=e.isHidden=!0,t.trigger("yne-require-innerlink",function(t,n){var i=o.isUndefined(t)||o.isUndefined(n);e.isDisabled=e.isHidden=i,i||(e._linkId=t,e._linkName=n)})},selectAction:function(){this.editor.insertNoteLink(this._linkId,this._linkName)}})}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(8),n(13)],void 0===(i=function(e,t,n,o){"use strict";var i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){var o,i=e.target;return this.targetEl=i,n.IS_MAC&&(this.isHidden=!1,o=this.editor.callMacNativeApi("macClipboardAvailable"),this.isDisabled=!o),!0},t.prototype.selectAction=function(){var e,t,o=this,i=this.editor,r=i.getNoteRange(),s=this.targetEl;if(r.isSingleTableSelected()&&(e=r.getStartBlockRange().block,(t=i.getController().noteView.getBlockViewByBlock(e)).setPasteAsText(!0),s=t.getHiddenInputView()),s.focus(),n.IS_MAC)return i.setPasteAsText(!0),void i.callMacNativeApi("menuPaste");this.editor.trigger("yne-clipboard-error","paste-as-text",function(){o.editor.focus()})},t.prototype.reset=function(){e.prototype.reset.call(this),this.targetEl=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="pasteAsText",this.label="纯文本粘贴"},t}(o))({});return function(){return i}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(13)],void 0===(i=function(e,t,n){"use strict";var o=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){var n=this.editor.canRemoveFormat()&&!t.isImgAttachBlock&&!t.tableInfo;return this.isDisabled=!n,!t.tableInfo&&!t.isImgAttachBlock},t.prototype.selectAction=function(){this.editor.execCommand("comp.RemoveFormat")},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="removeFormat",this.label="清除格式"},t}(n))({});return function(){return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(13)],void 0===(i=function(e,t,n){"use strict";var o=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return!t.isImgAttachBlock&&!t.tableInfo},t.prototype.selectAction=function(){this.editor.selectAll()},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="selectAll",this.label="全选"},t}(n))({});return function(){return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(13)],void 0===(i=function(e,t,n){"use strict";var o=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return!t.isImgAttachBlock&&!t.tableInfo},t.prototype.selectAction=function(){var e=this.editor,t=this.editor.countWords(!0),n=t.count,o=t.isSelected,i=t.detail;e.trigger("yne-show-words",n,o,i)},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="countWords",this.label="统计字数"},t}(n))({});return function(){return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(55),n(13)],void 0===(i=function(e,t,n,o){"use strict";var i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return this.block=t.imgBlock||t.attachmentBlock,this.isImg=!!t.imgBlock,this.tableInfo=t.tableInfo,!!t.isImgAttachBlock||!(!t.tableInfo||!t.tableInfo.cell)},t.prototype.selectAction=function(){var e=this.block,t=this.isImg,o=this.tableInfo;o&&(e=o.cell.getContent(),o.type===n.IMAGE&&(t=!0)),t?this.editor.trigger("yne-download-image",e.getSource()):this.editor.trigger("yne-download-attachment",e.getResource(),e.getFileName())},t.prototype.reset=function(){e.prototype.reset.call(this),this.block=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="download",this.label="另存为"},t}(o))({});return function(){return i}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(13)],void 0===(i=function(e,t,n){"use strict";var o=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){var n=this.editor;return this.noteRange=n.getNoteRange(),!!t.isImgAttachBlock},t.prototype.selectAction=function(){this.editor.execCommand("comp.DeleteNoteRange",{range:this.noteRange})},t.prototype.reset=function(){e.prototype.reset.call(this),this.noteRange=null},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="delete",this.label="删除"},t}(n))({});return function(){return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(13)],void 0===(i=function(e,t,n){"use strict";var o=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo&&(t.tableInfo.onlyMergePointAndCell?(this.label="拆分单元格",!0):!1===t.tableInfo.onlyOneCell&&(this.label="合并单元格",!0))},t.prototype.selectAction=function(){this.editor.execCommand("comp.ToggleMergeTableCell",{})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="mergeCell",this.label="合并单元格"},t}(n))({});return function(){return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(44),n(13)],void 0===(i=function(e,t,n,o){"use strict";var i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.InsertTableRowCol",{describe:{row:n.UP}})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="insertRowUp",this.label="在上方插入行"},t}(o))({});return function(){return i}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(44),n(13)],void 0===(i=function(e,t,n,o){"use strict";var i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.InsertTableRowCol",{describe:{row:n.DOWN}})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="insertRowDown",this.label="在下方插入行"},t}(o))({});return function(){return i}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(13)],void 0===(i=function(e,t,n){"use strict";var o=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.DeleteTableRowCol",{describe:{row:!0}})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="deleteRow",this.label="删除整行"},t}(n))({});return function(){return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(44),n(13)],void 0===(i=function(e,t,n,o){"use strict";var i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.InsertTableRowCol",{describe:{col:n.LEFT}})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="insertColLeft",this.label="在左侧插入列"},t}(o))({});return function(){return i}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(44),n(13)],void 0===(i=function(e,t,n,o){"use strict";var i=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.InsertTableRowCol",{describe:{col:n.RIGHT}})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="insertColRight",this.label="在右侧插入列"},t}(o))({});return function(){return i}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(13)],void 0===(i=function(e,t,n){"use strict";var o=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.DeleteTableRowCol",{describe:{col:!0}})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="deleteCol",this.label="删除整列"},t}(n))({});return function(){return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(13)],void 0===(i=function(e,t,n){"use strict";var o=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.queryAction=function(e,t){return!!t.tableInfo},t.prototype.selectAction=function(){this.editor.execCommand("comp.DeleteNoteRange",{isTableDelete:!0})},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.name="deleteTable",this.label="删除整个表格"},t}(n))({});return function(){return o}}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(404),o=n(0),i=n(1),r=!1;return{checkNativeApi:function(){var e=window.ynote||{};e?o.each(t,function(t,n){null==e[n]&&i.error("Native does not implement api: "+n)}):i.error("window.ynote does not exist!")},callNativeApi:function(e,t){var n,o=window.ynote||{};if(r||(this.checkNativeApi(),r=!0),n=o[e])return n.apply(o,t||[]);i.error("No native api: "+e)}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return{menuCopy:function(){},menuPaste:function(){},macClipboardAvailable:function(){},macClipboardData:function(e){}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){n(170);var t=n(18),o=n(0),i=n(7),r=n(2),s=n(165),a=n(8),l=n(406),c=[n(407),n(408),n(409),n(410),n(171),n(412),n(50),n(413),n(415),n(416),n(50),n(417),n(418),n(419),n(420),n(421),n(50),n(422),n(425),n(171),n(426),n(427),n(428),n(429),n(430),n(50),n(431),n(432),n(50),n(433),n(434),n(435),n(436),n(437),n(438),n(439),n(50),n(440),n(441),n(442),n(443),n(444),n(445),n(446)],u=n(447),d=[];return a.IS_MAC||c.push(l),t.View.extend({className:"bulb-toolbar",events:{mousedown:"_onMouseDown"},_lastRangeType:null,initialize:function(e){var t=e.editor;this.editor=t,this.items=[],this.initItems(),this.bindEvents(),this.isRendered=!1},initItems:function(){var e=this,t=e.editor;o.each(c,function(n){e.addItem(new n({editor:t}))}),e.showMore=new u({editor:t,items:d}),e.addItem(e.showMore)},bindEvents:function(){var e=this,t=e.editor,n=s.EDITOR_BUTTON_STATE_MAP;t.on("yne-editing-state-change",function(){var i,a=t.getNoteRange(),l=s.RANGE_DEFAULT;a&&(i=a.getStartBlockRange().block,r.isHeaderFooter(i)?l=s.RANGE_HEADER_FOOTER:r.isImage(i)?l=s.RANGE_IMAGE:r.isAttachment(i)?l=s.RANGE_ATTACHMENT:a.isSingleTableSelected()?l=s.RANGE_TABLE_CELL:r.isCatalogue(i)?l=s.RANGE_CATALOGUE:r.isQuote(i)?l=s.RANGE_QUOTE:r.isCode(i)&&(l=s.RANGE_CODE)),e._lastRangeType!==l&&(e._lastRangeType=l,o.each(e.items,function(e){var t,i=n[e.name],r=s.ACTION_SHOW_ENABLE;switch(o.each(i,function(e){e.on===s.RANGE_DEFAULT&&(r=e.action),e.on===l&&(t=e.action)}),null==t&&(t=r),t){case s.ACTION_SHOW_ENABLE:e.show(),e.enable();break;case s.ACTION_HIDE:e.hide();break;case s.ACTION_ENABLE:e.enable();break;case s.ACTION_DISABLE:e.show(),e.disable()}}),e.reShrink())})},render:function(){var e=this,t=this.items,n=this.$el;o.each(t,function(t){n.append(t.$el),t.on("re-shrink",o.throttle(e.reShrink.bind(e),100))}),e.isRendered=!0,i(window).on("resize",e.reShrink.bind(e))},reset:function(){o.each(this.items,function(e){e&&e.reset&&e.reset()})},addItem:function(e){this.items.push(e)},addItems:function(e){this.items.concat(e)},show:function(){var e=this,t=this.items;o.each(t,function(t){e.$el.append(t.$el)}),e.$el.show(),e.shrink()},hide:function(){this.$el.hide(),this.showMore.hideMenu()},reShrink:function(){var e=this.items,t=this.$el;o.each(e,function(e){t.append(e.$el)}),this.shrink()},shrink:function(){var e,t,n=this.items,i=this.$el.parent().width(),r=o.last(n).$el,s=r.outerWidth(!0),a=0;d=[],o.map(n,function(o,r){var l,c=o.isVisible;if(r===n.length-1)return o.items=d,e=o.$el.find(".combo-menu"),a>(t=i-100)?e.css("width",t).css("white-space","normal"):e.css("width","").css("white-space",""),void o.resetMenu();c?(l=o.$el.outerWidth(!0),s+=l):l=0,i<s&&(a+=l,d.push(o))}),0===d.length?r.hide():r.show()},_onMouseDown:function(e){e.preventDefault()},_invoke:function(e){o.each(this.items,function(t){t[e]&&t[e]()})},enable:function(){this.$el.removeClass("disabled"),this._invoke("enable")},disable:function(){this.$el.addClass("disabled"),this._invoke("disable")}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(33).extend({name:"view-mode",label:"视图切换",defaultState:!1,state:!1,templateName:"toolbar-button-template",render:function(){var e,n=this;t.__super__.render.apply(n,arguments),(e=n.$el.find(".button")).addClass("normal"),n.editor.on("view-mode-change",function(t){var o=2===t;o?(e.removeClass("normal"),e.addClass("page")):(e.removeClass("page"),e.addClass("normal")),n.state=o})},onClick:function(){var e=!0===this.state?0:2;this.editor.setViewMode(e,!0,!0)}});return t}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(33).extend({name:"undo",label:"撤销",defaultState:!1,state:!1,templateName:"toolbar-button-template",editorEvents:{"command-exec":"_onHistoryChange","undo-stack-change":"_onHistoryChange","cell-edit-view-exit":"_onHistoryChange","cell-edit-view-enter":"_onCellEditViewHistoryChange","cell-edit-view-history-change":"_onCellEditViewHistoryChange"},_onHistoryChange:function(){this.setState(this.editor.canUndo())},_onCellEditViewHistoryChange:function(e){this.setState(e.canUndo)},onClick:function(){!0===this.state&&this.editor.execCommandByToolbar("undo")}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(33).extend({name:"redo",label:"重做",defaultState:!1,state:!1,templateName:"toolbar-button-template",editorEvents:{"command-exec":"_onHistoryChange","redo-stack-change":"_onHistoryChange","cell-edit-view-exit":"_onHistoryChange","cell-edit-view-enter":"_onCellEditViewHistoryChange","cell-edit-view-history-change":"_onCellEditViewHistoryChange"},_onHistoryChange:function(){this.setState(this.editor.canRedo())},_onCellEditViewHistoryChange:function(e){this.setState(e.canRedo)},onClick:function(){!0===this.state&&this.editor.execCommandByToolbar("redo")}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(33).extend({name:"remove-format",label:"清除格式",defaultState:!1,state:!1,templateName:"toolbar-button-template",editorEvents:{"yne-selection-change":"_onSelectionChange","yne-editing-state-change":"_onEditingStateChange"},_onEditingStateChange:function(e){this.$el.hasClass("disabled")||(e&&null!==e.cellEditViewRangeCollapsed?this.setState(!1===e.cellEditViewRangeCollapsed):this.setState(!0))},_onSelectionChange:function(){this.$el.hasClass("disabled")||this.setState(!0)},onClick:function(){var e;(e=this.editor.getNoteRange())&&!e.isCollapsed()?this.editor.execCommandByToolbar("comp.RemoveFormat",{resetAllStyles:!0}):this.editor.resetEditingInlineStates()}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(33),o=n(411);return t.extend({name:"format-painter",label:"格式刷",events:{click:"onClick",dblclick:"onDblClick",mousedown:"onMouseDown"},defaultState:!1,state:!1,templateName:"toolbar-button-template",initialize:function(){t.prototype.initialize.apply(this,arguments),this._initFormatPainterManager()},_initFormatPainterManager:function(){this._formatPainterManager=new o({editor:this.editor}),this._formatPainterManager.on("formatpainter-state-change",this.onFormatPainterStateChange.bind(this))},clickAction:function(){!0===this.state?this.reset():this.stash(!0)},onClick:function(){var e=this;clearTimeout(e._timer),e._timer=setTimeout(function(){e.clickAction()},300)},onDblClick:function(){clearTimeout(this._timer),this.stash()},stash:function(e){this._formatPainterManager.stash(e)},reset:function(){this._formatPainterManager.reset()},onFormatPainterStateChange:function(e){this.setState(!!e)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(16),i=n(7),r=n(18),s=n(0),a=n(6),l=n(25),c=0,u=1,d=2;return t={state:null,data:null,initialize:function(e){this._editor=e.editor,this.state=c,s.bindAll(this,"stash","_paintWithDebounce","reset","_onSelectStart","_onCommandExec")},_isLinkStyle:function(e){return e&&e.color&&e.color!==a.INTERM&&l.equals(e.color,"blue")&&!0===e.underline},stash:function(e){var t,n=this._editor;this.reset(),t=n.querySelectionInlineStyles(),this._isLinkStyle(t)&&t.href&&(delete t.color,delete t.underline),this.data={inlineStyles:t,blockStyles:n.querySelectionBlockStyles()},e?this.setState(u):this.setState(d),this.bindEvents()},paint:function(){this.data&&this._editor.execCommandByToolbar("comp.FormatPainter",{data:this.data}),this.state===u&&this.reset()},reset:function(){this._clearPaintTimeout(),this.data=null,this.setState(c),this.unbindEvents()},setState:function(e){this.state!==e&&(this.state=e,this.trigger("formatpainter-state-change",!!e),this.updateFormatPainterCursorUI(!!e))},updateFormatPainterCursorUI:function(e){this._editor.updateFormatPainterCursorUI(e)},bindEvents:function(){var e=this._editor;this.unbindEvents(),e.on("selectstart",this._onSelectStart),e.on("mouse-down",this._onSelectStart),e.on("esc",this.reset),e.on("command-exec",this._onCommandExec)},unbindEvents:function(){var e=this._editor;e.off("selectstart",this._onSelectStart),e.off("mouse-down",this._onSelectStart),e.off("esc",this.reset),e.off("command-exec",this._onCommandExec),i(document).off("mouseup",this._paintWithDebounce)},_onSelectStart:function(){i(document).one("mouseup",this._paintWithDebounce)},_clearPaintTimeout:function(){this._paintTimeout&&(window.clearTimeout(this._paintTimeout),this._paintTimeout=null)},_paintWithDebounce:function(){var e=this;e._clearPaintTimeout(),e._paintTimeout=window.setTimeout(function(){e.paint()},100)},_onCommandExec:function(e){"comp.FormatPainter"!==(e||{}).name&&this.reset()}},s.extend(t,r.Events),o.extend(t)}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(7),o=n(88),i=n(114);return o.extend({name:"heading",label:"标题",defaultValue:"default",items:i.headingArray,templateName:"toolbar-combo-box-heading",editorEvents:{"yne-editing-state-change":"onEditingStateChange","yne-selection-change":"onSelectionChange"},updateValueUI:function(e){var n=t(this.valueWrapperEl).find(".combo-value")[0];i.headingMap[e]?t(n).text(i.headingMap[e].name):t(n).text(this.getUnlistedText(e)||"")},getUnlistedText:function(e){return e?i.headingMap[e].name:i.headingMap[this.defaultValue].name+""},onItemClick:function(e){var t,n,o=e.textContent.trim();for(t in i.headingMap)if(i.headingMap[t].name===o){n=t;break}this.editor.execCommandByToolbar("comp.InsertHeading",{level:n})},onEditingStateChange:function(){var e=this.editor.querySelectionBlockStyle(this.name);i.headingMap[e]?this.select(e):this.select(this.defaultValue)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(88),o=n(414);return t.extend({name:"code-language",label:"语言",defaultValue:"javascript",items:o,templateName:"toolbar-combo-box-font-size",onChange:function(e){var t=this.editor.controller.getNoteRange().getStartBlockRange().block;this.editor.execCommandByToolbar("comp.SetCodeLanguage",{block:t,newLanguage:e})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return{javascript:"JavaScript",java:"Java",python:"Python",php:"PHP",csharp:"C#",cpp:"C++",css:"CSS",ruby:"Ruby",c:"C",objectivec:"Objective-C",swift:"Swift",scala:"Scala",shell:"Shell",go:"Go",r:"R",typescript:"Typescript",html:"HTML",markdown:"Markdown",kotlin:"Kotlin",json:"JSON",xml:"XML",sql:"SQL",matlab:"MATLAB"}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(88).extend({name:"code-theme",label:"主题",defaultValue:"default",items:{default:"默认主题",tomorrow:"宁静深邃",coy:"清新条纹",okaidia:"暗夜繁星",Ateliersulphurpool:"轻快蓝调",vs:"简约线条"},templateName:"toolbar-combo-box-font-size",onChange:function(e){var t=this.editor.controller.getNoteRange().getStartBlockRange().block;this.editor.execCommandByToolbar("comp.SetCodeTheme",{block:t,newTheme:e})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(88),i=n(6),r=n(28),s=n(7);return t=o.extend({name:"font-family",label:"字体",defaultValue:r.DEFAULT_FONT,items:r.getItems(),templateName:"toolbar-combo-box-font-family",getUnlistedText:function(e){var t;return e&&e!==i.INTERM&&(t=r.getFont(e)),t=t||r.splitFontFamily(e)[0]||"微软雅黑"},render:function(){var e,n=this;t.__super__.render.apply(n,arguments),e=n.$el.find(".combo-value-font-family"),s(e).hover(function(){s(n.displayWrapperEl).tooltipster({animation:"",animationDuration:0,content:e.text(),delay:[800,300]})},function(){s(n.displayWrapperEl).tooltipster({animation:"",animationDuration:0,content:n.label,delay:[800,300]})})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(88).extend({name:"font-size",label:"字号",defaultValue:"14",items:{9:"9",12:"12",14:"14",16:"16",18:"18",22:"22",26:"26",30:"30",36:"36",42:"42"},templateName:"toolbar-combo-box-font-size",getUnlistedText:function(e){var t=parseInt(e,10);return t&&!isNaN(t)?t+"":this.defaultValue+""}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(107),o=n(6);return t.extend({name:"bold",label:"加粗",shortcut:o.IS_MAC?"Command+B":"Ctrl+B"})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(107),o=n(6);return t.extend({name:"italic",label:"斜体",shortcut:o.IS_MAC?"Command+I":"Ctrl+I"})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(107),o=n(6);return t.extend({name:"underline",label:"下划线",shortcut:o.IS_MAC?"Command+U":"Ctrl+U"})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(107),o=n(6);return t.extend({name:"strike",label:"删除线",shortcut:o.IS_MAC?"Command+E":"Ctrl+E"})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(172),o=n(1),i=n(25);return t.extend({name:"color",label:"文字颜色",defaultValue:"#393939",defaultSetValue:"#DF402A",doAction:function(e){var t={},n=e||this.value,r=i(n);r&&!1!==r.isValid()?(t[this.name]=r.toHexString(),this.editor.execCommandByToolbar("comp.ApplyStyles",{inlineStyles:t})):o.error("tiny color object is not valid",r)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(106),o=n(7),i=n(424);return t.extend({name:"color",defaultValue:"#000000",items:i,templateName:"toolbar-combo-box-color",editorEvents:{"yne-selection-change":"onSelectionChange"},onValueWrapperElClick:function(){var e=this.value;this.hideMenu(),this.onChange(e)},onChange:function(e){this.doAction(e)},doAction:function(){},onItemClick:function(e){var t=o(e).data("value");if(o(e).hasClass("color-section-other"))return this.editor.trigger("color-picker-show",this),void this.hideMenu();this.changeValue(t)},changeValue:function(e){this.select(e),this.onChange(e)},updateValueUI:function(e){var t=o(this.valueWrapperEl).find(".combo-value-buttom-color")[0];o(t).css("background-color",e)},onSelectionChange:function(){var e=this.editor.querySelectionInlineStyle(this.name);this.selectedValue=e}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return{theme:["#ffffff","#000000","#eeece0","#1c487f","#4d80bf","#c24f4a","#9abc52","#7b5ba1","#46acc8","#f9963b"],other:[["#f2f2f2","#808080","#ddd9c2","#c5d9f2","#dce6f3","#f3dcdb","#ebf1dd","#e6e0ec","#daeef4","#feead9"],["#d9d9d9","#595959","#c4be95","#8db3e5","#b8cde6","#e7b9b7","#d7e5bb","#ccc0db","#b6dee9","#fdd5b3"],["#bfbfbf","#404040","#948b50","#528cd8","#94b2d9","#da9693","#c3d798","#b3a1c8","#91cdde","#fbc08c"],["#a6a6a6","#262626","#4a4528","#15365f","#355f94","#973632","#769436","#60487c","#2c859d","#e66c00"],["#808080","#0d0d0d","#1e1c10","#0f2340","#243f62","#642422","#4f6324","#403053","#1e5969","#994800"]],standard:["#df402a","#f77567","#fad4d3","#fae220","#b19067","#77c94b","#98dede","#184e87","#9896a4","#90a7d1"]}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(172).extend({name:"back-color",label:"背景色",defaultValue:"transparent",defaultSetValue:"#FAE220",templateName:"toolbar-combo-box-back-color",doAction:function(e){var t={};t[this.name]=e||this.value,this.editor.execCommandByToolbar("comp.ApplyStyles",{inlineStyles:t})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(136),o=n(34),i=n(6);return t.extend({name:"unordered-list",label:"无序列表",defaultState:!1,state:!1,templateName:"toolbar-button-template",shortcut:i.IS_MAC?"Command+L":"Ctrl+L",querySelectionState:function(){return this.editor.isSameList("unordered")},onClick:function(){this.editor.execCommandByToolbar("comp.InsertList",{type:o.UNORDERED})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(136),o=n(34),i=n(6);return t.extend({name:"ordered-list",label:"项目编号",defaultState:!1,state:!1,templateName:"toolbar-button-template",shortcut:i.IS_MAC?"Command+Shift+L":"Ctrl+Shift+L",querySelectionState:function(){return this.editor.isSameList("ordered")},onClick:function(){this.editor.execCommandByToolbar("comp.InsertList",{type:o.ORDERED})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(59),o=n(6);return t.extend({name:"todo",label:"待办",defaultState:!1,state:!1,templateName:"toolbar-button-template",shortcut:o.IS_MAC?"Command+D":"Ctrl+D",onClick:function(){this.editor.execCommandByToolbar("comp.InsertTodo",{checked:!1})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(59),o=n(6);return t.extend({name:"quote",label:"引用",defaultState:!1,state:!1,templateName:"toolbar-button-template",shortcut:(o.IS_MAC,""),onClick:function(){this.editor.execCommandByToolbar("comp.InsertQuote")}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(59),o=n(6);return t.extend({name:"code",label:"代码块",defaultState:!1,state:!1,templateName:"toolbar-button-template",shortcut:o.IS_MAC?"Control+Alt+D":"Ctrl+Alt+D",onClick:function(){this.editor.execCommandByToolbar("comp.InsertCode")}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(108),o=n(2),i=n(0),r=n(7),s=t.extend({name:"align",label:"对齐方式",defaultValue:"left",items:{justify:"两端对齐",left:"左对齐",center:"居中对齐",right:"右对齐"},templateName:"toolbar-combo-box-align",updateValueUI:function(e){var t=r(this.valueWrapperEl).find(".combo-value")[0];r(t).removeClass(i.keys(this.items).join(" ")),r(t).addClass(e)},onChange:function(e){var t,n,i,r;(i=(t=this.editor).getNoteRange())&&(r=(n=i.getStartBlockRange()).block)&&o.isHeaderFooter(r)?t.execCommandByToolbar("comp.SetHeaderFooter",{align:e,headerFooter:r,range:n}):s.__super__.onChange.apply(this,arguments)},onSelectionChange:function(){var e,t=this.editor.getNoteRange(),n=t&&t.getStartBlockRange().block;e=n&&o.isHeaderFooter(n)?n.getAlign():this.editor.querySelectionBlockStyle(this.name),this.items[e]?this.select(e):this.select(this.defaultValue)}});return s}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(108),o=n(0),i=n(7);return t.extend({name:"table-justify",label:"垂直对齐",defaultValue:"middle",isVisible:!1,items:{top:"顶端对齐",middle:"水平居中",bottom:"底端对齐"},templateName:"toolbar-combo-box-align",updateValueUI:function(e){var t=i(this.valueWrapperEl).find(".combo-value")[0];i(t).removeClass(o.keys(this.items).join(" ")),i(t).addClass(e)},onEditingStateChange:function(){this.enable()},onChange:function(e){var t=this.editor;e&&t.execCommandByToolbar("comp.SetTableCellBlockStyle",{styles:{verticalAlign:e}})},onSelectionChange:function(){var e;e=this.editor.querySelectionBlockStyle("verticalAlign"),this.items[e]?this.select(e):this.select(this.defaultValue)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(136).extend({name:"indent",label:"增加缩进",defaultState:!1,state:!1,templateName:"toolbar-button-template",onClick:function(){this.editor.execCommandByToolbar("comp.IndentOutdent",{indentStep:1})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(33).extend({name:"outdent",label:"减少缩进",defaultState:!1,state:!1,templateName:"toolbar-button-template",onClick:function(){this.editor.execCommandByToolbar("comp.IndentOutdent",{indentStep:-1})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(108),o=n(0),i=n(7);return t.extend({name:"line-height",label:"行高",defaultValue:1.75,keys:[1,1.25,1.5,1.75,2,2.5,3],items:[{key:1,value:"1.0"},{key:1.25,value:"1.25"},{key:1.5,value:"1.5"},{key:1.75,value:"1.75"},{key:2,value:"2.0"},{key:2.5,value:"2.5"},{key:3,value:"3.0"}],templateName:"toolbar-combo-box-line-height",updateValueUI:function(e){var t=i(this.menuWrapperEl),n=o.indexOf(this.keys,e);t.find(".active").removeClass("active svg-common"),-1!==n&&t.find(".line-height-"+n).addClass("active svg-common")},onSelectionChange:function(){var e,t,n=this.editor.querySelectionBlockStyle(this.name);-1!==o.indexOf(this.keys,n)?this.select(n):parseFloat(n)==n?(e=parseFloat(n),o.each(this.keys,function(o){var i=Math.abs(o-n);i<e&&(t=o,e=i)}),this.select(t)):(this.select(this.defaultValue),this._isForceSelectWhenClick=!0)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(33).extend({name:"table-wrap",label:"自动换行",defaultState:!0,isVisible:!1,templateName:"toolbar-button-template",onEditingStateChange:function(){var e;e=this.editor.querySelectionBlockStyle("wrap"),this.setState(null==e?this.defaultState:e)},onClick:function(){this.editor.execCommandByToolbar("comp.SetTableCellBlockStyle",{toggle:"wrap",default:this.defaultState})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(108),o=n(44),i=n(0),r=n(7);return t.extend({name:"table-operate",label:"操作表格",defaultValue:"",isVisible:!1,items:{insertRowUp:"在上方插入行",insertRowDown:"在下方插入行",deleteRow:"删除整行",insertColLeft:"在左侧插入列",insertColRight:"在右侧插入列",deleteCol:"删除整列",deleteTable:"删除整个表格"},templateName:"toolbar-combo-box-align",updateValueUI:function(e){var t=r(this.valueWrapperEl).find(".combo-value")[0];r(t).removeClass(i.keys(this.items).join(" ")),r(t).addClass(e)},onChange:function(e){var t,n,i=this.editor;e&&("insertRowUp"===e&&(t=o.UP),"insertRowDown"===e&&(t=o.DOWN),"insertColLeft"===e&&(n=o.LEFT),"insertColRight"===e&&(n=o.RIGHT),t&&i.execCommandByToolbar("comp.InsertTableRowCol",{describe:{row:t}}),n&&i.execCommandByToolbar("comp.InsertTableRowCol",{describe:{col:n}}),"deleteRow"===e&&i.execCommandByToolbar("comp.DeleteTableRowCol",{describe:{row:!0}}),"deleteCol"===e&&i.execCommandByToolbar("comp.DeleteTableRowCol",{describe:{col:!0}}),"deleteTable"===e&&i.execCommandByToolbar("comp.DeleteNoteRange",{isTableDelete:!0}),this.value="")}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(50),o=n(0);return t.extend({name:"table-split",isVisible:!1,initialize:function(e){this.editor=e.editor,this.bindEditorEvents(),this.isVisible||this.hide()},editorEvents:{"yne-selection-change":"onSelectionChange"},bindEditorEvents:function(){var e=this,t=e.editor,n=e.editorEvents;n&&o.each(n,function(n,o){t.on(o,e[n].bind(e))})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(33).extend({name:"table-merge",label:"合并单元格",defaultState:!1,isVisible:!1,templateName:"toolbar-button-template",onClick:function(){this.editor.execCommandByToolbar("comp.ToggleMergeTableCell")},onSelectionChange:function(){var e=this.editor.controller.getNoteRange().getStartBlockRange(),t=e.getAsRectRange&&e.getAsRectRange(),n=t&&t.onlyMergePointAndCell();this.label=n?"拆分单元格":"合并单元格",this.render(),this.setState(n)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(7),i=n(12),r=n(74);return r.extend({className:"toolbar-item toolbar-combo-box toolbar-combo-box-table",events:{"click .combo-value-wrapper":"onValueWrapperClick","mouseleave .combo-menu":"onMenuMouseLeave","mouseenter .combo-item":"onItemMouseEnter","click .combo-item":"onItemClick",mousedown:"onMouseDown"},editorEvents:{"yne-editing-state-change":"onEditingStateChange","yne-selection-change":"onSelectionChange"},name:"table",label:"表格",templateName:"toolbar-combo-box-table",initialize:function(e){this.editor=e.editor,this.render(),this.bindDocumentEvents(),this.bindEditorEvents()},render:function(){var e,t=this.$el;e=i.render("web",this.templateName,{name:this.name,label:this.label,maxRows:10,maxCols:8}),t.html(e),this.menuWrapperEl=t.find(".combo-menu-wrapper")[0],this.menuLabelEl=t.find(".combo-menu-label-table")[0],this.comboItems=t.find(".combo-item"),t.find(".combo-display-wrapper").tooltipster({animation:"",animationDuration:0,theme:["tooltipster-borderless","tooltipster-borderless-customized"],side:"bottom",delay:[800,300]})},bindDocumentEvents:function(){t.bindAll(this,"onDocumentMouseDown"),o(document).on("mousedown",this.onDocumentMouseDown)},bindEditorEvents:function(){var e=this,n=e.editor,o=e.editorEvents;o&&t.each(o,function(t,o){n.on(o,e[t].bind(e))})},onDocumentMouseDown:function(e){var t=e.target;o.contains(this.el,t)||this.hideMenu()},onValueWrapperClick:function(){this.toggleMenu()},onItemMouseEnter:function(e){var t=e.target,n=this.getItemCoordinate(t);this.selectItems(n.row+1,n.col+1)},onItemClick:function(e){var t=e.target,n=this.getItemCoordinate(t);this.insertTable(n.row+1,n.col+1),this.hideMenu()},onMenuMouseLeave:function(){this.resetSelected()},onMouseDown:function(e){e.preventDefault()},getItemCoordinate:function(e){var t=o(e);return{row:t.data("row"),col:t.data("col")}},resetSelected:function(){this.selectItems(0,0)},selectItems:function(e,t){this.updateSelectedLabelText(e,t),this.updateSelectedItemsUI(e,t)},updateSelectedLabelText:function(e,t){var n=o(this.menuLabelEl);e>0&&t>0?n.html(e+" 行 "+t+" 列"):n.html("插入表格")},updateSelectedItemsUI:function(e,t){var n,i;for(o(this.comboItems).removeClass("selected"),n=0;n<e;n++)for(i=0;i<t;i++)o(this.comboItems[8*n+i]).addClass("selected")},insertTable:function(e,t){this.editor.execCommandByToolbar("comp.InsertTable",{rows:e,cols:t})},toggleMenu:function(){o(this.menuWrapperEl).hasClass("show")?this.hideMenu():this.showMenu()},showMenu:function(){var e=this.menuWrapperEl;o(e).removeClass("menu-position-fix"),o(e).addClass("show"),e.getBoundingClientRect().right>document.documentElement.offsetWidth&&o(e).addClass("menu-position-fix")},hideMenu:function(){o(this.menuWrapperEl).removeClass("show"),this.resetSelected()},onEditingStateChange:function(){}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(59),o=n(6);return t.extend({name:"hr",label:"水平线",defaultState:!1,state:!1,templateName:"toolbar-button-template",shortcut:o.IS_MAC?"Command+H":"Ctrl+H",onClick:function(){this.editor.execCommandByToolbar("comp.InsertHorizontalRule")}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(7),i=n(12),r=n(87),s=n(62);return n(74).extend({className:"toolbar-item toolbar-combo-box toolbar-combo-link",name:"link",label:"链接",templateName:"toolbar-combo-box-insert-link",events:{"mousedown .combo-value-wrapper-link":"onValueWrapperMouseDown","click .combo-value-wrapper-link":"onValueWrapperClick","click .link-button":"onConfirmButtonClick",mousedown:"onMouseDown"},initialize:function(e){this.editor=e.editor,this.items=e.items,this.render(),this.bindDocumentEvents(),this.bindEditorEvents()},render:function(){var e,t=this,n=t.$el;e=i.render("web",t.templateName,{name:t.name,label:t.label}),n.html(e),t.menuWrapperEl=n.find(".combo-menu-wrapper")[0],t.menuItemContainer=n.find(".combo-menu")[0],t.input=n.find(".link-input"),o(t.input).keydown(function(e){e.stopPropagation(),r.isMatch("enter",e.keyCode)&&(e.preventDefault(),t.onConfirmButtonClick())}),n.find(".combo-display-wrapper").tooltipster({animation:"",animationDuration:0,theme:["tooltipster-borderless","tooltipster-borderless-customized"],side:"bottom",delay:[800,300]})},bindDocumentEvents:function(){t.bindAll(this,"onDocumentMouseDown"),o(document).on("mousedown",this.onDocumentMouseDown)},onDocumentMouseDown:function(){this.hideMenu()},bindEditorEvents:function(){var e=this,n=e.editor,o=e.editorEvents;o&&t.each(o,function(t,o){n.on(o,e[t].bind(e))})},onMouseDown:function(e){e.stopPropagation(),e.preventDefault()},onConfirmButtonClick:function(){var e=s.safeHref(o(this.input).val().trim());e&&this.editor.execCommandByToolbar("comp.InsertLink",{src:e}),this.hideMenu(),window.focus()},onValueWrapperMouseDown:function(e){e.preventDefault()},onValueWrapperClick:function(){this.toggleMenu()},toggleMenu:function(){var e=o(this.menuWrapperEl);e.toggleClass("show"),e.is(":visible")&&this.input.focus()},showMenu:function(){var e=this.menuWrapperEl;o(e).addClass("show"),this.input.focus()},hideMenu:function(){var e=this.menuWrapperEl;o(e).removeClass("show"),o(this.input).val("")},reset:function(){this.hideMenu()}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(59).extend({name:"img",label:"图片",defaultState:!1,state:!1,templateName:"toolbar-button-template",onClick:function(){var e=this.editor;e.trigger("yne-insert-photo",function(t){e.insertImage(t)})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(59).extend({name:"attachment",label:"附件",defaultState:!1,state:!1,templateName:"toolbar-button-template",onClick:function(){var e=this.editor;e.trigger("yne-insert-attachment",function(t){e.insertAttachment(t)})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(59).extend({name:"catalogue",label:"目录",defaultState:!1,state:!1,templateName:"toolbar-button-template",onClick:function(){this.editor.execCommandByToolbar("comp.InsertCatalogue")}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(106),o=n(7),i=n(0),r=n(6),s=n(1);return t.extend({name:"set-background",defaultValue:r.DEFAULT_BACKGROUND,label:"笔记背景",items:{},templateName:"toolbar-combo-box-set-background",editorEvents:{"set-all-backgrounds":"onAllBackgroundsSet","set-background":"onBackgroundChanged","yne-background-changed":"onBackgroundChanged"},_isAllBackgroundsReady:!1,_isVIPUser:!1,_normalBackground:null,_vipBackground:null,_CSS_SHADOW:"0px 0px 0px 1.5px #4C98EF",enable:function(){this._updateEnableState()},disable:function(){this._updateEnableState()},render:function(){i.isEmpty(this.items)&&this._isAllBackgroundsReady&&(this.items={normalUser:this._normalBackground,VIP:this._vipBackground}),t.prototype.render.apply(this)},onAllBackgroundsSet:function(e,t){var n=this,o=0,s=0,a={};n._isVIPUser=!!t,n._normalBackground=[],n._vipBackground=[],a.URI=r.DEFAULT_BACKGROUND,a.isForVIP=!1,e.unshift(a),i.each(e,function(e){e.isForVIP?(n._vipBackground[s]||(n._vipBackground[s]=[]),n._vipBackground[s].push(e.URI),3===n._vipBackground[s].length&&s++):(n._normalBackground[o]||(n._normalBackground[o]=[]),n._normalBackground[o].push(e.URI),3===n._normalBackground[o].length&&o++)}),n.items={},n._isAllBackgroundsReady=!0,n.render(),n.onBackgroundChanged(null,n.defaultValue),n.show(),n.trigger("re-shrink")},onBackgroundChanged:function(e,t){var n,r,a,l=this,c=[t,l.defaultValue];l._resetAllSelection(),i.some(c,function(e){return 0!==(r=l.$el.find('[data-value="'+e+'"]')).length&&(n=e,!0)}),o(r[0]).css("box-shadow",l._CSS_SHADOW),a=o(r[0]).find(".background-cell-check-mark"),o(a).css("visibility","visible"),l.value=n,n!==t&&(s.error("failed to find specified URI:",t),l.editor.trigger("background-failed-update",1,n))},onChange:function(e){this.editor.updateBackground(e)},onItemClick:function(e){var n=this,i=o(e).data("value");n.editor.trigger("yne-is-vip-user",function(e){null!==e&&(n._isVIPUser=!!e)}),n._isVIPUser||!n._isVIPBackground(i)?t.prototype.onItemClick.apply(n,[e]):n.editor.trigger("background-failed-update",0)},show:function(){var e=!1;return this._isAllBackgroundsReady?(e=!0,this.$el.show(),this._updateEnableState()):this.$el.hide(),e},reset:function(){this.value=null,this.$el.find(".background-cell").css("box-shadow",""),this.$el.find(".background-cell-check-mark").css("visibility","hidden"),this._updateEnableState()},_isBackgroundDisabled:function(){return(this.editor.getEditorProps()||{}).disableBackground},_isVIPBackground:function(e){var t=!0;return i.some(this._normalBackground,function(n){if(i.contains(n,e))return t=!1,!0}),t},_resetAllSelection:function(){this.$el.find(".background-cell-check-mark").css("visibility","hidden"),this.$el.find(".background-cell").css("box-shadow","")},_updateEnableState:function(){this._isBackgroundDisabled()?t.prototype.disable.apply(this):t.prototype.enable.apply(this)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(7),i=n(12);return n(74).extend({className:"toolbar-item toolbar-combo-box toolbar-combo-more",name:"showmore",label:"查看更多",templateName:"toolbar-combo-box-show-more",events:{"click .combo-value-wrapper-showmore":"onValueWrapperClick",mousedown:"onMouseDown"},initialize:function(e){this.editor=e.editor,this.items=e.items,this.render(),this.bindDocumentEvents()},render:function(){var e,t=this.$el;e=i.render("web",this.templateName,{name:this.name,label:this.label}),t.html(e),this.menuWrapperEl=t.find(".combo-menu-wrapper")[0],this.menuItemContainer=t.find(".combo-menu")[0],this.$split=t.find(".toolbar-more-split"),t.find(".combo-display-wrapper").tooltipster({animation:"",animationDuration:0,theme:["tooltipster-borderless","tooltipster-borderless-customized"],side:"bottom",delay:[800,300]})},bindDocumentEvents:function(){t.bindAll(this,"onDocumentMouseDown"),o(document).on("mousedown",this.onDocumentMouseDown)},onDocumentMouseDown:function(e){var t=e.target;o.contains(this.el,t)||this.hideMenu()},onMouseDown:function(e){e.preventDefault()},onValueWrapperClick:function(){this.toggleMenu()},toggleMenu:function(){o(this.menuWrapperEl).toggleClass("show")},showMenu:function(){var e=this.menuWrapperEl;o(e).addClass("show")},hideMenu:function(){var e=this.menuWrapperEl;o(e).removeClass("show")},resetMenu:function(){var e,n=this.items,i=o(this.menuItemContainer);t.map(n,function(e){i.append(e.$el)}),i.children().length>0?(((e=this.$el.prev()).hasClass("toolbar-split")||e.hasClass("table-split"))&&e.hide(),this.$el.show()):this.$el.hide()}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(449),o=n(21),i=n(0),r=n(25),s=new t({}),a={color:{valueInView:"#393939",compareEqual:function(e,t){return r.equals(e,t)}},"font-family":{valueInView:["-apple-system","BlinkMacSystemFont","PingFang SC","Helvetica","Tahoma","Arial","Hiragino Sans GB","Microsoft YaHei","微软雅黑","SimSun","宋体","Heiti","黑体","sans-serif"].join(",")},"color-catalogue":{valueInView:"#003884",value:o.getDefault("color"),compareEqual:function(e,t){return r.equals(e,t)}}};return i.each(a,function(e,t){var n={name:t,valueInView:e.valueInView,value:o.getDefault(t)||e.value,compareEqual:e.compareEqual};s.addMappingRule(n)}),s}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){return n(450).extend({name:"InlineStyleViewMapper"})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(16),o=n(1);return t.extend({initialize:function(){this._mappingRules={},delete this.options},_isValidMappingRule:function(e){return!(!e||!e.name||null==e.value||null==e.valueInView)},addMappingRule:function(e){var t,n=this._mappingRules;this._isValidMappingRule(e)?n[t=e.name]?o.error("Failed to add mapping rule, mapping rule do exists",e):this._mappingRules[t]=e:o.error("Failed to add mapping rule, parameter is not valid",e)},valueFromView:function(e,t){var n=this._mappingRules[e],i=t;return n&&(n.compareEqual?n.compareEqual(t,n.valueInView):t===n.valueInView)&&(i=n.value),o.log("valueFromView name/valueInView => value: "+e+"/"+t+" => "+i),i},valueToView:function(e,t){var n=this._mappingRules[e],o=t;return n&&(n.compareEqual?n.compareEqual(t,n.value):t===n.value)&&(o=n.valueInView),o}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(452);return t=o.extend({render:function(){t.__super__.render.apply(this,arguments)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(7),i=n(18),r=n(6),s=n(109),a=n(100),l=n(101),c=n(14),u=n(32),d=n(453),h=n(2),p=n(457),g=n(63),f=n(41),m=n(20),_=n(1),y=n(27),b=n(73),v=n(20),k=n(508),C=n(157),I=n(509),S=n(176);return i.View.extend({className:"note-view",attributes:{tabIndex:1,spellcheck:!1,contenteditable:"true"},directionKeyJustMoved:!1,_isOnMouseDown:!1,events:{textInput:"_onTextInput",compositionstart:"_onCompositionStart",compositionend:"_onCompositionEnd",mousedown:"_onMouseDown",mouseup:"_onMouseUp",selectstart:"_onSelectStart",contextmenu:"_onContextMenu",dragstart:"_onDragDropEvent",dragover:"_onDragDropEvent",drop:"_onDragDropEvent",dragend:"_onDragEnd",copy:"_onCopy",cut:"_onCut",paste:"_onPaste","click a[href]":"_onAnchorClick",click:"_onClick",blur:"_onBlur",focus:"_onFocus"},note:null,blockViews:null,tableViews:null,headerView:null,footerView:null,_keyMonitor:null,_inlineStyleViewMapper:null,isOnComposition:!1,_isSilent:!1,_noteEvents:{"insert-block":"_onInsertBlock","remove-block":"_onRemoveBlock","replace-block":"_onReplaceBlock","read-only-change":"_onReadOnlyChange","high-light":"_onHighlight","next-high-light":"_onNextHighlight","pre-high-light":"_onPreHighlight","content-parse-done":"_onContentParseDone","header-footer-changed":"_OnHeaderFooterChanged","clear-high-light":"_onClearHighlight","copy-prohibited":"_onCopyPSrohibited"},_docEvents:{selectionchange:"_onSelectionChange"},_shouldStopComposition:!1,_affectedViewsByComposition:null,_pageBatchTimer:null,_pageBatchPendingQueue:null,_viewMode:null,_renderBatchTimer:null,_currentZoom:null,_disableOCR:null,initialize:function(e){this._bindEventHandlers(),this.setOptions(e),this._bindEventsForDoc(),this._bindEventsForThis(),this.highlightView=new k,this._pageBatchPendingQueue=[],e.inlineStyleViewMapper&&(this._inlineStyleViewMapper=e.inlineStyleViewMapper),this._currentZoom=1},createHeaderFooterView:function(e){var t,n,o,i;if(null!=(n=(t=this).note))return(o=n.getHeaderFooter(e))||(o=C.createBlank(e),n.setHeaderFooter(o,e)),(i=new I(o,t.isReadOnly())).on("focus",function(){t.trigger("set-range",c.createForHeaderFooter(o),!0,!0)}).on("blur",function(e){t.trigger("selectionchange",e)}).on("text-input",function(e){t.trigger("header-footer-view-text-change",e,i.block)}),i},_renderHeaderFooterView:function(e){e.prepend(this.headerView.$el),e.append(this.footerView.$el)},_removeHeaderFooterView:function(){null!=this.headerView&&(this.headerView.remove(),this.headerView=null),null!=this.footerView&&(this.footerView.remove(),this.footerView=null)},_OnHeaderFooterChanged:function(e){var t=this.options.noteviewFrame;this.isInPageMode()&&(e?(null!=this.footerView&&this.footerView.remove(),this.footerView=this.createHeaderFooterView(e),null!=t&&t.append(this.footerView.$el)):(null!=this.headerView&&this.headerView.remove(),this.headerView=this.createHeaderFooterView(e),null!=t&&t.prepend(this.headerView.$el)))},_bindEventHandlers:function(){var e=this,n=function(n){_.log("bindHandlers: "+n),t.bindAll(e,n)};t.each(e._noteEvents,n),t.each(e._docEvents,n)},_setNote:function(e){this.removeNote(),this.note=e,this._bindEventsForNote()},removeNote:function(){this.note&&this._unbindEventsForNote(),this.note=null},reset:function(){var e;(this.removeNote(),this.$el.html(""),this.blockViews=this._clearBlockViews(this.blockViews),this.options&&(this.options.note=null,this.options.isNoteSet=!1,(e=this.options.noteviewFrame)&&(e.find(".header-footer-input").prop("contenteditable",!0),e.removeClass("has-handwrite"))),this.$el.removeClass("read-only"),this._keyMonitor&&this._keyMonitor.clearCache(),o(document.head).find("style.note-style").remove(),this._isSilent=!1,window.parent!==window)&&window.getSelection().removeAllRanges();this._pageBatchTimer&&(window.clearTimeout(this._pageBatchTimer),this._pageBatchTimer=null),this._renderBatchTimer&&(clearTimeout(this._renderBatchTimer),this._renderBatchTimer=null),this._pageBatchPendingQueue=[],this._removeHeaderFooterView()},setOptions:function(e){if(e=e||{},null==this.options)this.options=t.clone(e);else for(var n in e)e.hasOwnProperty(n)&&(this.options[n]=e[n]);null!=this.options.note&&this._setNote(this.options.note),null!=this.options.viewMode&&(this._viewMode=this.options.viewMode),this._disableOCR=!!this.options.disableOCR},render:function(){var e=this.$el,t=this.highlightView,n=this.options.noteviewFrame;this.blockViews=this.blockViews?this._clearBlockViews(this.blockViews):[],this.tableViews=[],e.html(""),o(document.head).find("style.note-style").remove(),o(document.head).append('<style class="note-style"></style>'),e.append(t.$el),this.isInPageMode()?this._enablePageMode(!1):this._disablePageMode(this._viewMode),window.YNE_PLATFORM&&e.addClass("platform-"+window.YNE_PLATFORM),null!=n&&n.find(".header-footer-input").prop("contenteditable",!this.isReadOnly()),null!=this._renderBatchTimer&&(clearTimeout(this._renderBatchTimer),this._renderBatchTimer=null),this._renderInBatch(0)},_renderInBatch:function(e){var t,n,o=this.note,i=Date.now();if(null!=o){for(;e<o.blocks.length&&(t=o.blocks[e],(n=this._createBlockView(t))||_.warn("Failed to create block view!"),this.blockViews.push(n),this.$el.append(n.$el),n.render(),this._bindEventsForBlockView(t,n),this._setPageInfo(e),e++,!(Date.now()-i>100)););e<o.blocks.length&&(this._renderBatchTimer=setTimeout(this._renderInBatch.bind(this,e),10))}},_repairBlockViews:function(e){var n,o,i,r=this,s=[];e&&e.length>0&&(n=e.shift(),s.push(n),e.length>0&&(o=e.pop(),s.push(o)),r._isElementExisting(n.cid)||((i=r.getBlockViewIndex(n)-1)>=0?r.getBlockViewAt(i).$el.after(n.$el):r.getBlockViewAt(0).$el.before(n.$el)),o&&!r._isElementExisting(o.cid)&&n.$el.after(o.$el),r.reRenderTextBlockView(s),t.each(e,function(e){r._isElementExisting(e.cid)||o.$el.before(e.$el)}))},_isElementExisting:function(e){return this.$el.find('[data-yne-cid="'+e+'"]').length>0},reRenderTextBlockView:function(e){e=e||this.blockViews,t.each(e,function(e){var t=e.block;h.isTextBlock(t)&&e.render()})},_listenerEventsForBlockView:function(e){var n={command:"onCommand","get-read-only-status":"_onGetReadOnlyStatus"};return h.isTable(e)&&(n=t.extend(n,{"select-all":"onSelectAll","save-content":"_onSaveContent"})),n},_bubbleEventsForBlockView:function(e){var n={"locked-change":!0};switch(h.getType(e)){case h.IMAGE:n=t.extend(n,{contextmenu:!0,"yne-replace-image":!0,"yne-open-image":!0,"yne-download-image":!0,"get-image-items":!0,"img-title-edit-start":!0,"img-title-edit-end":!0,"img-title-edit-focus":!0,"img-title-edit-exit":!0,"img-title-edit-update":!0,"yne-image-ocr":!0});break;case h.ATTACHMENT:n=t.extend(n,{"yne-replace-attachment":!0,"yne-open-attachment":!0,"yne-download-attachment":!0,"yne-mac-preview":!0});break;case h.TABLE:n=t.extend(n,{"yne-download-attachment":!0,"yne-on-paste":!0,"get-note-range":!0,"link-menu-show":!0,"link-menu-hide":!0,"move-caret":!0,"set-range":!0,"global-redo":!0,"global-undo":!0,copy:!0,cut:!0,"cell-edit-view-selection-change":!0,"cell-edit-view-enter":!0,"cell-edit-view-exit":!0,"cell-edit-view-history-change":!0,"cell-edit-view-command-executed":!0,"yne-blob-paste":!0});break;case h.QUOTE:case h.TODO:case h.PARAGRAPH:case h.HEADING:n=t.extend(n,{"link-menu-show":!0,"link-menu-hide":!0,"get-entity":!0});break;case h.LIST_ITEM:n=t.extend(n,{"get-editing-styles":!0,"link-menu-show":!0,"link-menu-hide":!0});break;case h.CATALOGUE:n=t.extend(n,{"inner-goto":!0})}return n},_unbindEventsForBlockView:function(e,n){var o=function(e){e&&t.each(e,function(e,t){n.off(t)})};o(this._listenerEventsForBlockView(e)),o(this._bubbleEventsForBlockView(e))},_bindEventsForBlockView:function(e,t,n){var o;(n=!1!==n)&&this._unbindEventsForBlockView(e,t),o=this._listenerEventsForBlockView(e),y.addListeners(o,t,this),o=this._bubbleEventsForBlockView(e),y.bubble(o,t,this)},setHtmlContentEditable:function(e){this.$el.attr("contenteditable",!!e)},getHtmlContentEditable:function(){return"true"===this.el.contentEditable+""},updateFormatPainterCursorUI:function(e){e?this.$el.addClass("format-painter-active"):this.$el.removeClass("format-painter-active")},_handleNoteEvents:function(e){var n=this,o=n.note;o&&o.on&&o.off?t.each(n._noteEvents,function(t,i){e?o.on(i,n[t]):o.off(i,n[t])}):_.warn("Failed to bind note events!")},_bindEventsForNote:function(){this._handleNoteEvents(!0)},_unbindEventsForNote:function(){this._handleNoteEvents(!1)},_bindEventsForDoc:function(){var e=this,n=o(document);t.each(e._docEvents,function(t,o){_.log("bind document event: "+o+" -> "+t),_.log(e[t]),n.on(o,e[t])})},_bindEventsForThis:function(){this.on("draw-range",this._onDrawRange.bind(this)),this.on("resize",this._onResize.bind(this))},_onChangeHandwriteBlock:function(e){var t=this.options.noteviewFrame;e?t.addClass("has-handwrite"):this.note.hasHandWriteBlock()||t.removeClass("has-handwrite")},bindKey:function(e){var t=this,n=t._keyMonitor;e&&(n||(t._keyMonitor=n=new s({el:t.el})),n.unbind(e),n.bind(e,function(n){t.trigger("key-pressed",e,n)}),t._keyMonitor=n)},unbindKey:function(e){var t=this._keyMonitor;t&&e&&t.unbind(e)},_onDrawRange:function(e,t){var n=this;n._silentDo(function(){n._drawRange(e,t)})},_updateSelectionUI:function(e){var t,n,o,i,r,s;e?null!=this.note?(c.isNoteRange(e)?(o=e.getStartBlockRange(),i=e.getEndBlockRange(),t=this.note.getBlockIndex(o.block),n=this.note.getBlockIndex(i.block)):(r=this.getBlockViewContainer(e.startContainer),s=this.getBlockViewContainer(e.endContainer),t=this.getBlockViewIndex(r),n=this.getBlockViewIndex(s)),this._selectAttachments(t,n,e),this._selectCatalogueTables(t,n)):_.warn("Note has been dettached."):_.warn("The range is not valid!")},_selectAttachments:function(e,n){-1!==e&&-1!==n?e!==n&&t.each(this.blockViews,function(t,o){if(t){var i=o>=e&&o<=n;t.selectAttachment&&t.selectAttachment(i)}}):_.warn("start or end is -1")},_selectCatalogueTables:function(e,n){var o,i=[];-1!==e&&-1!==n&&t.each(this.blockViews,function(t,r){if(t){var s=r>=e&&r<=n;if(t.selectTable)t.selectTable(s);else if(t.selectCatalogue){if(o=t.getOwnerId(),!s&&i[o])return;i[o]=!0,t.selectCatalogue(s)}}})},_drawRange:function(e,t){if(e&&e.canDrawedByNative){var n,o,i,r,s=e.getStartBlockRange(),a=s.block;if(t=!1!==t,this._clearCustomSelectionUI(a),h.isCode(a)&&(r=this.getBlockViewByBlock(a)),e.canDrawedByNative())this.setHtmlContentEditable(!0),this._updateSelectionUI(e),n=e.toNativeRange(this),u.setRange(n,window),t&&this._scrollNativeSelectionIntoWrapper(n,r);else{if(this.setHtmlContentEditable(!1),e.isInMultiBlock())return void _.warn("The note range is note valid!");s=e.getStartBlockRange(),null!=this.note&&(o=this.note.getBlockIndex(s.block),(i=this.getBlockViewAt(o))&&i.trigger("draw-range",s,a))}}else _.log("note range is not valid!")},_isZeroRect:function(e){return!e||0===e.width&&0===e.height},_scrollNativeSelectionIntoWrapper:function(e,t){var n,o;this._isOnMouseDown||(e?(e.collapsed?(n=e.getClientRects()[0],this._isZeroRect(n)&&(n=e.getBoundingClientRect())):n=e.getBoundingClientRect(),this._isZeroRect(n)&&(1!==(o=e.commonAncestorContainer).nodeType&&(o=o.parentNode),n=o.getBoundingClientRect()),this._isZeroRect(n)?_.error("can not get selection client rect"):this._scrollRectIntoWrapper(n,t)):_.warn("range not found"))},_getWrapper:function(){for(var e=this.el.parentNode;e;){if(o(e).is(".note-view-wrapper"))return e;e=e.parentNode}},_scrollRectIntoWrapper:function(e,t){var n,o,i=this._getWrapper(),r=i.getBoundingClientRect(),s=r.top,a=r.bottom,l=r.height,c=r.left,u=r.right,d=e.top*this._currentZoom,h=e.bottom*this._currentZoom,p=e.height*this._currentZoom,g=e.left*this._currentZoom,f=null,m=null,_=c+30+10;this._isZeroRect(e)||(t&&(o=(n=t._getContentContainer().get(0)).clientWidth),i.scrollHeight!==i.clientHeight&&(a-=11,l-=11),i.scrollBarWidth!==i.clientWidth&&(u-=11),p>l?(h<0||d>l)&&(m=h-l):d<s||d-s<=10?m=-1*Math.abs(d-s):h>a||a-h<=10?m=Math.abs(h-a):h===a&&(m=10),g>=u||u-g<=10?f=Math.abs(g-u):(g<=c||g-c<=10)&&(f=-1*Math.abs(g-c)),this._scrollWrapperBy(f,m),n&&(g>o||g<_)&&(n.scrollLeft+=g-_))},_scrollWrapperBy:function(e,n){var o=this._getWrapper();e>0?e+=20:e<0&&(e-=20),n>0?n+=20:n<0&&(n-=20),t.isNumber(e)&&(o.scrollLeft+=e),t.isNumber(n)&&(o.scrollTop+=n)},parseNativeRange:function(e){if(e&&e.startContainer){var t=e.startContainer,n=e.endContainer;if(I.isHeaderView(t))return[new d[h.HEADER_FOOTER]({block:this.note.getHeaderFooter(!1)})];if(I.isFooterView(t))return[new d[h.HEADER_FOOTER]({block:this.note.getHeaderFooter(!0)})];var o,i,r,s,a=this.getBlockViewContainer(t),l=this.getBlockViewContainer(n),c=this.getBlockViewIndex(a),u=this.getBlockViewIndex(l),p=[];if(-1!==c&&-1!==u){if(null!=this.note){for(o=c;o<=u;o++)r=this.blockViews[o],i=this.note.getBlockAt(o),(s=r.parseNativeRange(e,i,o!==c&&o!==u))?p.push(s):_.warn("Failed to parse native range to block range!");return p}_.warn("note has been dettached.")}else _.warn("start/end block index is -1 !")}else _.warn("no native range!")},_isRangeInTableBlock:function(){return u.isRangeInSelector(".block-view.table-view")},_onSelectionChange:function(e){var t=!u.isRangeInNode(this.el),n=u.getRange(),o=null;if(this._updateSelectionUI(n),t?(o="The native range is not in note view!",_.log(o)):S.isRangeInCellEditArea(n)?(o="The native range is in table cell edit area",_.log(o)):this._isSilent?o="The _isSilent flag is true!":this.isOnComposition&&(o="The isOnComposition flag is true!"),!o){if(this._isRangeInTableBlock()){if(!this.directionKeyJustMoved)return o="The selection/range is in table box!",_.log("  selection change deprecated!XXXXXXX"),void _.log(o);this.directionKeyJustMoved=!1}this.trigger("selectionchange",e),this._scrollNativeSelectionIntoWrapper(n)}},_silentDo:function(e){var t=this;if(t._isSilent=!0,_.DEBUG)e();else try{e()}catch(e){_.warn("silent do error")}window.setTimeout(function(){t._isSilent=!1},0)},clearNativeSelectionUI:function(){u.getSelection(window).removeAllRanges()},_clearCustomSelectionUI:function(e){var n=this.blockViews;t.each(n,function(t){t.trigger("draw-range",null,e)})},_appendBlankLineIfNeed:function(){var e,t=this.note;t&&((e=t.getLastBlock())&&(!e||t.lastBlockIsEasyInput()&&!e.isLocked())||this.trigger("note-append-blankparagraph",e))},focusLastBlankLine:function(){var e=this;e._appendBlankLineIfNeed(),window.setTimeout(function(){var t=e.getLastBlockView();o(t.el).trigger("mousedown")},50)},isReadOnly:function(){var e=this.note;return null==e||e&&e.isReadOnly()},isDragProhibited:function(){var e=this.note;return null==e||e&&e.isDragProhibited()},isCopyProhibited:function(){var e=this.note;return null==e||e&&e.isCopyProhibited()},_onGetReadOnlyStatus:function(e){e&&e(this.isReadOnly())},_isAtEndOfTextBlock:function(e,t){if(!document.caretRangeFromPoint)return!1;var n,i,r=document.caretRangeFromPoint(e.clientX,e.clientY),s=t.querySelector(".para-text");if(!s||!r||!r.collapsed)return!1;if(n=r.commonAncestorContainer,f.isText(n)){if(r.startOffset!==n.nodeValue.length)return!1;n=n.parentNode}if(!o.contains(s,n))return!1;for(;n&&n!==s;){if((i=n.parentNode).lastChild!==n)return!1;n=i}return!0},_onMouseDown:function(e){var t,n,i,r,s,a,l,u=3===(e.keyCode||e.which);if(this._isOnMouseDown=!0,this._clearHighlight(),this.$el.removeClass("highlight"),!this.isReadOnly()&&(t=this.getBlockViewContainer(e.target),n=this.getBlock(e.target),this._preventSelectStart=!1,!u||(v.isSafari()&&t&&this._isAtEndOfTextBlock(e,t)&&(this._preventSelectStart=!0),o(t).is(".image-view, .attachment-view, .table-view")))){if(!n||n.isLocked())return _.log("_onMouseDown(): block is null or locked!"),void this.focusLastBlankLine();if(this.trigger("mouse-down",e),i=h.getType(n),a=d[i])switch(r=new a({block:n}),s=new c({startRange:r,endRange:r}),i){case h.IMAGE:case h.ATTACHMENT:case h.HANDWRITE:this.setHtmlContentEditable(!0),t.focus(),this.trigger("set-range",s,!0,!0);break;case h.QUOTE:case h.CODE:case h.TODO:case h.PARAGRAPH:case h.LIST_ITEM:case h.HEADING:case h.CATALOGUE:(e=e.originalEvent||e).detail>2?(e.preventDefault(),r.expandToEnd(),l=!0):(l=!1,s=document.caretRangeFromPoint(e.clientX,e.clientY)),this.setHtmlContentEditable(!0),this._clearCustomSelectionUI(n),this.trigger("backup-drag-range"),window.Cypress?setTimeout(function(){this.trigger("set-range",s,!0,!0)}.bind(this),0):this.trigger("set-range",s,l,!0);break;case h.TABLE:break;case h.HR:this.trigger("set-range",s,!0,!0);break;case h.UNKNOWN:this.setHtmlContentEditable(!1),this.trigger("set-range",s,!0,!0)}else _.warn("_onMouseDown is not handled, block type is "+i);this.lastBlock=n}},_clearHighlight:function(){this.highlightView.$el.remove(),this._onClearHighlight()},_onMouseUp:function(){this._isOnMouseDown=!1},_onAnchorClick:function(e){var t,n=e.currentTarget;if(e.preventDefault(),t=n&&n.getAttribute("href"))return b.isNoteLinkUrl(t)?this.trigger("open-link",b.getNoteId(t),!0):void this.trigger("open-link",t)},_onSelectStart:function(e){if(!0===this._preventSelectStart)return e.preventDefault(),e.stopPropagation(),!1;this.trigger("selectstart",e)},_onTextInput:function(e){var t,n;e.preventDefault(),this.isReadOnly()||(n=e.originalEvent||e)&&(t=n.data+"")&&this.trigger("text-input",t)},_onCompositionStart:function(e){var t=this;if(t.isReadOnly())e.preventDefault();else{if(_.log("note view compositionstart ----------\x3e>>>>>"),window.clearTimeout(t._compositionEndTimer),t.setCompositionState(!0),t._shouldStopComposition=!1,t._affectedViewsByComposition=null,t.trigger("onCompositionStart",function(e,n){t._shouldStopComposition=e,t._affectedViewsByComposition=n}),t._shouldStopComposition)return e.preventDefault(),void e.stopPropagation();t.trigger("delete-selection")}},_onCompositionEnd:function(e){var t=this,n=e.originalEvent||e;if(t.isReadOnly()||t._shouldStopComposition)return e.preventDefault(),void(t._affectedViewsByComposition&&t._repairBlockViews(t._affectedViewsByComposition));_.log("note view compositionend ----------\x3e>>>>>"),n.data||t.trigger("delete-selection"),t._compositionEndTimer=window.setTimeout(function(){t.setCompositionState(!1)},0)},setCompositionState:function(e){var t;e&&(t=u.getRange(),this.trigger("set-range",t,!1,!1)),this.isOnComposition=e},_onInsertBlock:function(e,t){var n=this._createBlockView(t);g(n),this._bindEventsForBlockView(t,n),this._insertBlockView(e,n)},_onRemoveBlock:function(e,t){this._removeBlockView(e),!1!==t&&this._setPageInfo(e)},_onReplaceBlock:function(e,t){var n=this._createBlockView(t);g(n),this._replaceBlockView(e,n)},_createBlockView:function(e){var t,n=h.getType(e),o=p(n),i={};return this.isInPageMode()?this.options.pageType===r.PAGE_TYPE_A4?(i.height=r.PAGE_HEIGHT_A4,i.width=r.PAGE_WIDTH_A4):this.options.pageType===r.PAGE_TYPE_B5?(i.height=r.PAGE_HEIGHT_B5,i.width=r.PAGE_WIDTH_B5):this.options.pageType===r.PAGE_TYPE_TEST?(i.height=r.PAGE_HEIGHT_TEST,i.width=r.PAGE_WIDTH_TEST):this.options.pageType===r.PAGE_TYPE_NONE?(i.height=r.PAGE_HEIGHT_NONE,i.width=r.PAGE_WIDTH_NONE):(_.debugAlert("Invalid pageType in PageMode:",this.options.pageType),i.height=r.PAGE_HEIGHT_NONE,i.width=r.PAGE_WIDTH_NONE):(i.height=r.PAGE_HEIGHT_NONE,i.width=r.PAGE_WIDTH_NONE),g(!!o),(t=new o({editor:this.options.editor,block:e,isReadOnly:e.isReadOnly(),inlineStyleViewMapper:this._inlineStyleViewMapper,pageSize:i,pageBreakContainer:this.options.noteviewFrame,noteView:this,disableOCR:this._disableOCR})).on("view-height-changed",this._onBlockViewHeightChanged.bind(this)),t.on("pageBreak-inserted",this._onPageBreakInserted.bind(this)),t.on("pageBreak-positionChanged",this._onPageBreakPosChanged.bind(this)),t instanceof p(h.HANDWRITE)&&this._onChangeHandwriteBlock(!0),t},_insertBlockView:function(e,t){var n,o=this.blockViews,i=t.block,r=this.$el,s=r.children().filter(".block-view"),a=s.length;h.isQuote(i)&&(n=i.getDefaultSetFont()),o.splice(e,0,t),e===a?r.append(t.$el):s.eq(e).before(t.$el),t.render(n)},_removeBlockView:function(e){var n,o,i,r,s=this.blockViews,a=this.$el,l=this.tableViews;n=s.splice(e,1)[0],(i=t.indexOf(l,n))>=0&&l.splice(i,1),(o=(r=a.children().filter(".block-view")).eq(e))&&(o.attr("data-yne-cid")===n.cid?r.eq(e).remove():_.warn("skip div deletion whose attr is "+o.attr("data-yne-cid"))),n instanceof p(h.HANDWRITE)&&this._onChangeHandwriteBlock(!1),n.clearPageBreaks(),n.off(),n.onDestroy()},_replaceBlockView:function(e,t){var n=this.blockViews,o=this.$el;this._clearBlockViews(n.splice(e,1,t)),o.children().filter(".block-view").eq(e).replaceWith(t.$el),t.render()},getBlockViewAt:function(e){return this.blockViews[e]},getLastBlockView:function(){var e=this.blockViews;return e[e.length-1]},getBlockViewContainer:function(e){var t,n;return o(e).is(".highlight-view")?(t=this.getBlockViewAt(0))&&(n=t.el):n=o(e).closest(".block-view")[0],n},getBlockViewIndex:function(e){if(!e)return-1;return this.$el.find(">.block-view").index(e)},getBlock:function(e){var t,n,o=this.note;if(null!=o)return t=this.getBlockViewContainer(e),n=this.getBlockViewIndex(t),o.getBlockAt(n)},getBlockViewByBlock:function(e){var t;if(null!=this.note)return t=this.note.getBlockIndex(e),this.getBlockViewAt(t)},onCommand:function(e,t){var n,o,i;null==t.range&&(t.imageBlockView?(n=t.imageBlockView,t.imageBlockView=null,i=new l({block:n.block}),o=new c({blockRanges:[i]}),t.range=o):t.attachmentBlockView&&(n=t.attachmentBlockView,t.attachmentBlockView=null,i=new a({block:n.block}),o=new c({blockRanges:[i]}),t.range=o)),this.trigger("command",e,t)},_onCopy:function(e){this.trigger("copy",e)},_onCut:function(e){this.isReadOnly()?e.preventDefault():this.trigger("cut",e)},_onPaste:function(e){this.isReadOnly()?e.preventDefault():this.trigger("paste",e)},_onContextMenu:function(e){e.preventDefault(),e.stopPropagation(),this.isReadOnly()||this.trigger("contextmenu",e)},_onDragDropEvent:function(e){var t;if(!this.isReadOnly()&&!this.isDragProhibited())switch((e=e.originalEvent).type){case"dragstart":t=this.getBlock(e.srcElement),this.trigger("dragstart",e,t);break;case"dragover":t=this.getBlock(e.srcElement),this.trigger("dragover",e,t);break;case"drop":this.trigger("drop",e)}},_onDragEnd:function(e){this.trigger("dragend",e)},_onBlur:function(){this.trigger("blur")},_onFocus:function(){window.parent!==window&&m.isSafari()&&window.parent.getSelection().removeAllRanges()},_onClick:function(){this.trigger("yne-click")},onSelectAll:function(){var e,n=document.createRange();e=h.isTodo(t.first(this.note.blocks))?this.el.firstChild.querySelector(".todo-input"):this.el.firstChild,n.setStart(e,0),n.setEnd(this.el.lastChild,1),u.setRange(n,window),this.parseNativeRange(n)},_onSaveContent:function(){this.trigger("save-content")},_onReadOnlyChange:function(){var e=this.isReadOnly(),t=this.options.noteviewFrame;this.setHtmlContentEditable(!e),e?(this.$el.addClass("read-only"),null!=t&&t.find(".header-footer-input").prop("contenteditable",!1)):(this.$el.removeClass("read-only"),null!=t&&t.find(".header-footer-input").prop("contenteditable",!0))},_checkHighlightView:function(){this.$el.children()[0]!==this.highlightView.$el.get(0)&&this.$el.prepend(this.highlightView.$el)},_onHighlight:function(e){var t,n=this.options.noteviewFrame,o=this.options.noteviewWrapper.get(0);e.length?(o.style.background=this.$el.css("background"),n.css("background","transparent"),this.$el.css("background",""),this.$el.addClass("highlight"),this._checkHighlightView()):((t=o.style.background)&&this.$el.css("background",t),this.$el.removeClass("highlight")),this.highlightView.showHighlight(this.el,e)},_onCopyPSrohibited:function(){this.isCopyProhibited()&&this.$el.addClass("copyProhibited")},_onClearHighlight:function(){t.each(this.blockViews,function(e){e.clearHighlight()})},_onNextHighlight:function(){this._checkHighlightView(),this.highlightView.nextHighlight()},_onPreHighlight:function(){this._checkHighlightView(),this.highlightView.preHighlight()},_onResize:function(e){var n=this;t.isNumber(e)&&(n._currentZoom=e),t.each(n.blockViews,function(e){e.trigger("resize"),n.isInPageMode()&&e.coincideAllPageBreaks()}),n._scrollNativeSelectionIntoWrapper(u.getRange())},_clearBlockViews:function(e){return t.each(e,function(e){e.onDestroy()}),[]},isInPageMode:function(){return 2===this._viewMode},setViewMode:function(e,t){this._viewMode=e,this.isInPageMode()?this._enablePageMode(t):this._disablePageMode(e)},_calcNoteViewFrameHeight:function(){var e,n,o,i,s,a=t.last(this.blockViews),l=this.options.noteviewFrame;if(null!=a){if(e=(a.getLastTransPageIndex()||0)+1,this.options.pageType===r.PAGE_TYPE_A4?n=r.PAGE_HEIGHT_A4:this.options.pageType===r.PAGE_TYPE_B5?n=r.PAGE_HEIGHT_B5:this.options.pageType===r.PAGE_TYPE_TEST&&(n=r.PAGE_HEIGHT_TEST),null!=n&&e>1){if(o=e-2,0===(i=l.find('[data-page-id="'+o+'"]')).length)return void _.debugAlert("Failed to find pageBreak:",o);i.length>1&&(_.debugAlert("Should not find more than one pageBreak:",o),i=i.first()),(s=n-(l.height()-parseInt(this.$el.css("padding-bottom"))-parseInt(i.css("top"))-i.height()))<0&&_.log("lastPageShortHeight < 0",s),l.height(l.height()+s),a.$el.position().top-parseInt(this.$el.css("padding-top"))+a.$el.height()>this.$el.height()&&(_.debugAlert("noteview content is overflowed"),l.height("auto"))}else l.height(n+parseInt(this.$el.css("padding-top"))+parseInt(this.$el.css("padding-bottom")));this._coincideAllPageBreaks()}},_coincideAllPageBreaks:function(){t.each(this.blockViews,function(e){e.coincideAllPageBreaks()})},_disablePageMode:function(e){var n=this.options.noteviewFrame;this._pageBatchTimer&&(window.clearTimeout(this._pageBatchTimer),this._pageBatchTimer=null),n?(n.removeClass(r.PAGE_CLASS_A4),n.removeClass(r.PAGE_CLASS_B5),n.removeClass(r.PAGE_CLASS_TEST),t.each(this.blockViews,function(e){e.disablePageMode()}),this._viewMode=e,this._removeHeaderFooterView(),n.css("height","auto")):_.debugAlert("noteviewFrame should NOT be null when _disablePageMode")},_enablePageMode:function(e){var n=this,o=n.options.noteviewFrame;n._pageBatchTimer&&(window.clearTimeout(n._pageBatchTimer),n._pageBatchTimer=null),n._pageBatchPendingQueue=[],o?(o.removeClass(r.PAGE_CLASS_A4),o.removeClass(r.PAGE_CLASS_B5),o.removeClass(r.PAGE_CLASS_TEST),n.options.pageType===r.PAGE_TYPE_A4?o.addClass(r.PAGE_CLASS_A4):n.options.pageType===r.PAGE_TYPE_B5?o.addClass(r.PAGE_CLASS_B5):n.options.pageType===r.PAGE_TYPE_TEST&&o.addClass(r.PAGE_CLASS_TEST),n._removeHeaderFooterView(),n.headerView=n.createHeaderFooterView(!1),n.footerView=n.createHeaderFooterView(!0),n._renderHeaderFooterView(o),!0===e&&null!=n.note&&(t.each(n.blockViews,function(e){e.enablePageMode(n.options.pageType)}),n._setPageInfo(0))):_.debugAlert("noteviewFrame should NOT be null when _enablePageMode")},_getBlockViewIndexByCID:function(e){var n;return t.some(this.blockViews,function(t,o){return t.cid===e&&(n=o,!0)}),n},_onBlockViewHeightChanged:function(e){var t;null!=(t=this._getBlockViewIndexByCID(e))&&this._setPageInfo(t)},_onContentParseDone:function(){this.isInPageMode()&&this._calcNoteViewFrameHeight()},_onPageBreakInserted:function(){},_onPageBreakPosChanged:function(){},_setPageInfo:function(e,t){var n,o,i,r;if(this.isInPageMode()&&null!=this.blockViews&&0!==this.blockViews.length&&null!=(n=this.blockViews[e])&&null!=n.cid)if(this._setPageInfoInBatch(e),!0===t&&(this._pageBatchTimer=null),this._pageBatchPendingQueue.length>0){if(null==this._pageBatchTimer){for(r=null;null==r&&this._pageBatchPendingQueue.length>0;)i=this._pageBatchPendingQueue.shift(),r=null!=(o=this.blockViews[i.index])&&o.cid===i.cid?i.index:this._getBlockViewIndexByCID(i.cid);_.log("resetPageInfo: startTimer for ",r),null!=r&&(this._pageBatchTimer=setTimeout(this._setPageInfo.bind(this,r,!0),10))}}else this._pageBatchTimer=null,this.note.isParsingData()?this.options.noteviewFrame.height("auto"):this._calcNoteViewFrameHeight()},_setPageInfoInBatch:function(e){var t,n,o,i,r,s,a,l,c=Date.now();if(null!=this.blockViews&&0!==this.blockViews.length&&null!=e&&null!=(o=this.blockViews[e]))for(_.log("Start PageInfoInBatch from:",o,e),t=0===e?0:o.getFirstTransPageIndex();e<this.blockViews.length;){if(o=this.blockViews[e],0===e)a=o.resetPageInfo(0,0),n=0;else{if(null==(n=(i=this.blockViews[e-1]).getLastTransPageIndex()))break;-1===(s=i.getBottomPosInPage(n))&&(s=0),a=o.resetPageInfo(n,s)}if(e++,null!=n&&null!=t&&n-t,!0===a){if(h.isImage(o.block)&&o.isOnFloat()&&(l=n+1),(null==l||l<=n)&&Date.now()-c>100){null!=(r=this.blockViews[e])&&this._pageBatchPendingQueue.push({cid:r.cid,index:e});break}}else if(null==l||l<=n)break}}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i;o=[n,t,n(2),n(100),n(454),n(125),n(99),n(455),n(126),n(101),n(456),n(36),n(173),n(70),n(43),n(163),n(128)],void 0===(i=function(e,t,n,o,i,r,s,a,l,c,u,d,h,p,g,f,m){"use strict";var _={};return _[n.ATTACHMENT]=o,_[n.CATALOGUE]=i,_[n.HEADING]=a,_[n.HR]=l,_[n.IMAGE]=c,_[n.LIST_ITEM]=u,_[n.PARAGRAPH]=d,_[n.TABLE]=g,_[n.TODO]=f,_[n.QUOTE]=h,_[n.CODE]=p,_[n.HANDWRITE]=r,_[n.HEADER_FOOTER]=s,_[n.UNKNOWN]=m,_}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(2),n(36)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.HEADING},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(2),n(36)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.HEADING},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(2),n(36)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.type=n.LIST_ITEM},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(2),o=n(38),i={};return i[t.ATTACHMENT]=n(459),i[t.CATALOGUE]=n(460),i[t.HANDWRITE]=n(461),i[t.HEADING]=n(462),i[t.HR]=n(463),i[t.IMAGE]=n(464),i[t.LIST_ITEM]=n(467),i[t.PARAGRAPH]=n(60),i[t.TABLE]=n(176),i[t.TODO]=n(503),i[t.QUOTE]=n(504),i[t.CODE]=n(505),i[t.UNKNOWN]=n(507),function(e){var t=i[e];return t||o}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(18),o=n(6),i=n(12),r=n(1),s=n(7);return t.View.extend({className:"page-break-view",templateName:"page_break_view",PLACEHOLDER_PREFIX:"p_",_$placeholder:null,_$pageBreak:null,_$container:null,_isAtViewBeginning:null,_topBlankHeight:null,_bottomBlankHeight:null,coincide:function(){var e,t,n,o;e=this._getOffsetTopPos(this.getPlaceholder()),t=this.getTopBlankHeight(),n=this.getPageBreak(),o=e+t,r.log("placeHolderTop/pageBreakTop/topBlankHeight:",e,o,this.getTopBlankHeight()),n.offset({top:o}),n.css({"margin-top":-t})},destroy:function(){this._$pageBreak.remove(),this._$placeholder.remove()},getPlaceholder:function(){return this._$placeholder},getPageBreak:function(){return this._$pageBreak},getTopBlankHeight:function(){return this._topBlankHeight},initialize:function(e){var t,n,a,l,c=e.pageIndex;this._topBlankHeight=e.topBlankHeight||0,this._bottomBlankHeight=e.bottomBlankHeight||0,this._$placeholder=e.placeholder||s('<div class="page-break-placeholder"></div>'),this._$pageBreak=s(i.render("common",this.templateName,{})),this._$container=e.container,this._$pageBreak.prepend(e.noteView.createHeaderFooterView(!0).$el),this._$pageBreak.append(e.noteView.createHeaderFooterView(!1).$el),0!==(l=this._$container.find('[data-page-id="'+c+'"]')).length&&l.attr("data-page-cid")===this.cid&&(r.debugAlert("should not create existing pageBreak for same view"),l.remove()),this._topBlankHeight<0&&(r.debugAlert("topBlankHeight should not be less than 0"),this._topBlankHeight=0),this._bottomBlankHeight<0&&(r.debugAlert("bottomBlankHeight should not be less than 0"),this._bottomBlankHeight=0),this._$pageBreak.attr("data-page-id",c),this._$pageBreak.attr("data-page-cid",this.cid),this._$pageBreak.attr("contenteditable","false"),t=this._$pageBreak.find(".bottomSpan"),n=this._$pageBreak.find(".topSpan"),a=this._$pageBreak.find(".middleSpan"),n.outerHeight(o.PAGE_SPLIT_BLANK_HEIGHT),t.outerHeight(o.PAGE_SPLIT_BLANK_HEIGHT),a.outerHeight(o.PAGE_SPLIT_MIDDLE_HEIGHT),this._$pageBreak.appendTo(this._$container),this._$pageBreak.height(n.outerHeight()+a.outerHeight()+t.outerHeight()),this._$placeholder.attr("data-page-id",this.PLACEHOLDER_PREFIX+this._$pageBreak.attr("data-page-id")),this._$placeholder.attr("data-page-cid",this.PLACEHOLDER_PREFIX+this._$pageBreak.attr("data-page-cid")),this._$placeholder.attr("contenteditable","false"),this._$placeholder.height(this._$pageBreak.height()+this._topBlankHeight+this._bottomBlankHeight)},isAtViewBeginning:function(){return!0===this._isAtViewBeginning},setAtViewBeginning:function(e){this._isAtViewBeginning=!0===e},_getOffsetTopPos:function(e){return e.offset().top}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){n(170);var t=n(38),o=n(7),i=n(0),r=n(12),s=n(100),a=n(1),l=n(32),c=n(20),u=n(8),d=n(66),h=n(6),p=n(174);return t.extend({className:"block-view attachment-view",DEFAULT_HEIGHT:100,timer:null,events:{"dblclick .attachment-container":"_onImgDblclick","mousemove .attachment-container":"_onMouseMove","mouseout .attachment-container":"_onMouseOut","click .attachment-download":"_onDownloadClick","dragstart .attachment-mask":"_onDragstart","dragend .attachment-mask":"_onDragEnd"},_isFloatSwitch:!1,_viewFrameHeight:null,initialize:function(){t.prototype.initialize.apply(this,arguments),i.bindAll(this,"_onStyleChange","_onContentChange","_onMouseMove","_onMouseOut"),this.block.on("style-change",this._onStyleChange),this.block.on("content-change",i.debounce(this._onContentChange,100)),this.bindSelectionEvents()},render:function(){var e,n,i,s,l,g=this,f=g.block,m=f.getSource(!0),_=f.getFileName(),y=f.getFileLength();u.IS_PC&&(m=d(m)),(u.IS_WEB_NOTE||u.IS_WEB_GROUP)&&!0===f.getFakeLoading()&&(m=h.LOADING_IMAGE_PATH,f.setFakeLoading(!1)),n=(e=p.getFileType(_))?"src--svg--type_"+e+"_large":"src--svg--type_other_large",s=void 0===y?"未知大小":p.getSizeString(y),l=p.splitFileFullName(_),i=r.render("common","attachment-view-attachment-container",{name:n,fileName:l.fileName,fileType:l.fileType,size:s,title:_,draggable:!0}),g.$el.find(".attachment-container").remove(),g.$el.append(i),g._viewFrameHeight=g.$el.outerHeight(!0)-g.$el.height(),g.$el.find(".attachment-container").tooltipster({animation:"",animationDuration:0,theme:["tooltipster-attachment","tooltipster-attachment-customized"],side:"bottom",delay:[800,300],arrow:!1,functionPosition:function(e,t,n){var i,r,s=o(t.tooltipClone);return i=g.mousePosY+s.height()>document.body.clientHeight?g.mousePosY-s.height()+10:g.mousePosY-10,r=g.mousePosX+s.width()>document.body.clientWidth?g.mousePosX-s.width()-10:g.mousePosX+10,n.coord.top=i>0?i:0,n.coord.left=r>0?r:0,n}}),g._renderStyles(),c.isSafari()&&g.$el.find(".attachment-container").attr("contenteditable","true"),t.prototype.render.apply(g,arguments),a.log("Attachment width/height",g.$el.width(),g.$el.height())},_renderStyles:function(){var e=this,t=e.block.getBlockStyles();i.each(t,function(t,n){e._setStyle(n,t)})},_setStyle:function(e,t){var n=this.$el,o=n.find(".attachment-block-container");switch(e){case"align":n.css("text-align",t);break;case"float":n.css("float")!==t?(this._isFloatSwitch=!0,n.css("float",t)):this._isFloatSwitch=!1;break;case"back-color":o.css("background-color",t),t||n.css("margin","");break;case"padding":o.css("padding",t),"0px"===n.css("padding-top")&&n.find(".attachment-block-container").css({"padding-top":"4px","padding-bottom":"4px"})}},_onStyleChange:function(e,t){this._setStyle(e,t),this.trigger("view-height-changed",this.cid)},_onContentChange:function(){this.render(),a.log("redraw attachment"),this.trigger("view-height-changed",this.cid)},getImgElement:function(){return this.$el.find("img").get(0)},getAttachmentContainerElm:function(){return this.$el.find(".attachment-container").get(0)},convertToNativeRange:function(){var e=document.createRange(),t=this.$el.get(0);return e.setStart(t,0),e.setEnd(t,t.childNodes.length),e},parseNativeRange:function(e,t,n){if(n||l.isNodeInRange(this.getAttachmentContainerElm(),e)||l.isRangeInNode(this.el,e)||this._isSelected())return new s({block:t})},_removeFocusedClass:function(){this.$el.removeClass("focused")},_addFocusedClass:function(){this.$el.addClass("focused")},onDrawRange:function(e){var t;e?(this._addFocusedClass(),(t=document.createRange()).selectNodeContents(this.$el.find(".attachment-container")[0]),l.setRange(t,window)):(this._removeFocusedClass(),this.selectAttachment())},_onImgDblclick:function(){var e=this.block.getResource(),t=this.block.getFileName();u.IS_PC&&this.trigger("yne-open-attachment",e,t),u.IS_MAC&&this.trigger("yne-mac-preview",e,t)},_onDownloadClick:function(){var e=this.block,t=e.getResource(),n=e.getFileName();(u.IS_WEB_GROUP||u.IS_WEB_NOTE||u.IS_MAC||u.IS_PC)&&this.trigger("yne-download-attachment",t,n)},_onDragstart:function(){this.$el.find(".attachment-mask").css("opacity",1)},_onDragEnd:function(){this.$el.find(".attachment-mask").css("opacity",0)},_isSelected:function(){return this.$el.find(".attachment-container").hasClass("selected")},selectAttachment:function(e){e?this.$el.find(".attachment-container").addClass("selected"):this.$el.find(".attachment-container").removeClass("selected")},disablePageMode:function(){t.prototype.disablePageMode.apply(this),this.$el.css("max-height","none")},_isPagingContinue:function(){return this._isFloatSwitch},_setViewMaxHeight:function(e){var t,n=this._pageInfo[e-1],o=0,i=this._getTopPosInPage(e);n&&(o=this._getPageBreakBottomPosInView(e-1)),(t=this.PAGE_HEIGHT+o-this._viewFrameHeight-i)<h.PAGE_SPLIT_BLANK_HEIGHT/2&&(t=h.PAGE_SPLIT_BLANK_HEIGHT/2),this.$el.css("max-height",t),a.log("Attachment max-height",this.$el.css("max-height"))},_onMouseMove:function(e){var t=this;clearTimeout(t.timer),t.timer=setTimeout(function(){t.mousePosX=e.originalEvent.x||e.originalEvent.layerX||0,t.mousePosY=e.originalEvent.y||e.originalEvent.layerY||0},200)},_onMouseOut:function(){clearTimeout(this.timer)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(7),o=n(12),i=n(6),r=n(25),s=n(60),a=n(36),l=n(30),c=n(97),u=n(21),d=n(28),h=n(73),p=s.extend({className:"block-view catalogue-view",events:{"click a":"_onAnchorClick"},_forcePageBreakBegin:!0,initialize:function(){s.prototype.initialize.apply(this,arguments);var e=this,t=e.block;t.on("sorting-change",function(){e._renderSorting()}),t.on("focus",e.focus.bind(e)),t.on("blur",e.blur.bind(e))},_renderTemplate:function(){this.$el.html(o.render("common","catalogue_view",{isFirst:this.block.isFirst()}))},_renderText:function(){var e,n=this.block.getReadOnlyText(),o=this._inlineStyleViewMapper,i=this.$el.find(".para-text"),s=t("<a></a>");e=l.rich2html(n,{styleRules:{color:function(e){var t=e.color;return e.href!==u.getDefault("href")&&r.equals(e.color,"blue")?"#003884":null!=t&&o?o.valueToView("color-catalogue",t):void 0},"font-family":function(e){var t,n=e["font-family"];return null!=n&&o&&(t=o.valueToView("font-family",n)),n!==t?t:d.getAllValueByFont(n)||n}}}),s.html(e),i.html(s),this._renderSorting(),this._addLinkMenu()},_onAnchorClick:function(e){var t=this.block.getHref();e.stopPropagation(),c.test(t)?this.trigger("open-link",t):this.trigger("inner-goto",t)},_addLinkMenu:function(){var e,t=this,n=t.block,o=t.$el.find("a");o.off("hover"),o.hover(function(){h.isNoteLinkUrl(n.getHref())||t.isCollabLocked()||(e=new a({start:0,end:n.getLength(),block:n}),t.trigger("link-menu-show",{linkNode:o[0],href:n.getViewHref(),range:e,block:n}))},function(){t.trigger("link-menu-hide")})},_renderSorting:function(){this._renderFirst(),this._renderLast()},_renderFirst:function(){var e,t,n=this,o=n.block,i=n.$el;if(!o.isFirst())return i.removeClass("catalogue-first");i.addClass("catalogue-first"),e=i.find(".catalogue-refresh"),t=i.find(".catalogue-delete"),e.off("click"),t.off("click"),e.on("click",function(){n.trigger("command","comp.RefreshCatalogue",{ownerId:o.getOwnerId()})}),t.on("click",function(){n.trigger("command","comp.RefreshCatalogue",{ownerId:o.getOwnerId(),delete:!0})})},_renderLast:function(){if(!this.block.isLast())return this.$el.removeClass("catalogue-last");this.$el.addClass("catalogue-last")},_setStyle:function(e,t){var n=this.$el,o=n.find(".para-text"),r=this.block;switch(e){case"indent":t=(t=r.getBlockStyle("text-indent")+t)>0?t:0,o.css("text-indent",t*i.INDENT_WIDTH||"");break;case"text-indent":t=(t=r.getBlockStyle("indent")+t)>0?t:0,o.css("text-indent",t*i.INDENT_WIDTH||"");break;case"href":n.find("a").attr("href",r.getViewHref());break;case"back-color":n.css("background-color",t);break;case"padding":n.css("padding",t),n.css("padding-top","0px");break;default:s.prototype._setStyle.call(this,e,t)}},_onLockedChange:function(e){var t=this.block.getOwnerList();s.prototype._onLockedChange.call(this,e),t.updateLockState(this.isLocked())},getOwnerId:function(){return this.block.getOwnerId()},selectCatalogue:function(e){var t=this.block;e?t.trigger("select"):t.trigger("remove-select")},focus:function(){this.$el.addClass("catalogue-focus")},blur:function(){this.$el.removeClass("catalogue-focus")},_getHeightInPage:function(e){var t=p.__super__._getHeightInPage.apply(this,[e]),n=parseInt(this.$el.css("marginTop")),o=parseInt(this.$el.css("marginBottom"));return isNaN(n)||(t+=n),isNaN(o)||(t+=o),t}});return p}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(38),n(12),n(8),n(125),n(32),n(20)],void 0===(i=function(e,t,n,o,i,r,a,l){"use strict";var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this._viewProps={block:t.block},this.bindSelectionEvents()},t.prototype.convertToNativeRange=function(){var e=document.createRange(),t=this.$el.get(0);return e.setStart(t,0),e.setStart(t,t.childNodes.length),e},t.prototype.getImgElement=function(){return this.$el.find("img").get(0)},t.prototype.onDrawRange=function(e){var t;e?(this._addFocusedClass(),(t=document.createRange()).selectNodeContents(this.$el.children(".handwrite-copy-hack")[0]),a.setRange(t,window)):(this._removeFocusedClass(),this.selectHandWrite(!1))},t.prototype.parseNativeRange=function(e,t,n){if(n||this._isHandWriteInNativeRange(e)||this._isNativeRangeInHandWriteView(e)||this._isSelected())return new r({block:t})},t.prototype.selectHandWrite=function(e){e?this.$el.find(".attachment-container").addClass("selected"):this.$el.find(".attachment-container").removeClass("selected")},t.prototype.render=function(){var t,n;e.prototype.render.call(this),n=this.block.getSource(i.IS_PC),t=o.render("common","handwrite-view-container",{src:n,needCopyHack:i.IS_MAC||l.isSafari()}),this.$el.html(t)},t.prototype._addFocusedClass=function(){this.$el.addClass("focused")},t.prototype._isHandWriteInNativeRange=function(e){var t,n=this.getImgElement(),o=window.Range;return(t=n.ownerDocument.createRange()).selectNode(n),e.compareBoundaryPoints(o.START_TO_START,t)<1&&e.compareBoundaryPoints(o.END_TO_END,t)>-1},t.prototype._isNativeRangeInHandWriteView=function(e){var t,n=this.el;return 3===(t=e.commonAncestorContainer).nodeType&&(t=t.parentNode),!(t!==n&&!$.contains(n,t))},t.prototype._isSelected=function(){return this.$el.find(".attachment-container").hasClass("selected")},t.prototype._removeFocusedClass=function(){this.$el.removeClass("focused")},t}(n);return delete c.prototype.constructor,c.prototype.className="block-view handwrite-view",n.extend(c.prototype)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e){var t=n(60);return t.extend({initialize:function(){t.prototype.initialize.apply(this,arguments)},className:"block-view heading-view",_renderText:function(){this.$el.find(".para-text").attr("id",this.block.getId()),t.prototype._renderText.apply(this)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(38),i=n(126);return o.extend({className:"block-view hr-view",initialize:function(){o.prototype.initialize.apply(this,arguments),t.bindAll(this,"_onStyleChange"),this.block.on("style-change",this._onStyleChange)},render:function(){var e=this.block,t=e.getBlockStyle("width"),n=e.getBlockStyle("height");this.$el.html('<div class="hr-container"></div>').css({"text-align":e.getBlockStyle("align")}).find(".hr-container").css({width:t+"%",height:n,backgroundColor:e.getBlockStyle("color")}),o.prototype.render.apply(this,arguments),this._renderStyles()},_renderStyles:function(){var e=this,n=e.block.getBlockStyles();t.each(n,function(t,n){e._setStyle(n,t)})},_setStyle:function(e,t){var n=this.$el;switch(e){case"back-color":n.css("background-color",t);break;case"padding":t?(n.css({padding:t,margin:"0 20px"}),"0px"===n.css("padding-top")&&n.css({"padding-top":"4px","padding-bottom":"4px"})):n.css({padding:t})}},_onStyleChange:function(e,t){this._setStyle(e,t)},convertToNativeRange:function(){var e=document.createRange(),t=this.$el.get(0);return e.setStart(t,0),e.setEnd(t,t.childNodes.length),e},parseNativeRange:function(e,t,n){if(n||this._isHrInNativeRange(e))return new i({block:t})},_isHrInNativeRange:function(e){var t,n=this.$el.find(".hr-container").get(0);return(t=n.ownerDocument.createRange()).selectNode(n),e.compareBoundaryPoints(Range.START_TO_START,t)<1&&e.compareBoundaryPoints(Range.END_TO_END,t)>-1}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){"use strict";var t=n(38),o=n(7),i=n(0),r=n(12),s=n(101),a=n(1),l=n(465),c=n(32),u=n(20),d=n(66),h=n(175),p=n(134),g=n(8),f=n(6),m=n(466);return t.extend({className:"block-view image-view",DEFAULT_HEIGHT:100,_isFloatSwitch:!1,_isImgError:!1,_$imgDiv:null,_$imgContainerDiv:null,_$imgTitle:null,_viewFrameHeight:null,_isImgLoaded:null,events:{contextmenu:"_onContextMenu","mousedown .resize-handle":"_onMouseDownResizeHandle","mousedown img":"_onMouseDownImgPreview",mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave","mouseleave .menu-wrapper":"_onMouseLeaveMenuWrapper","click .yne-button-item":"_onButtonItemClick","click .yne-popup-item":"_onPopupMenuItemClick","dblclick img":"_onImgDblclick","click img":"_onImgClick","mousedown .image-title":"_onMouseDownImageTitleHandle"},_imageResizeStartInfo:null,_imageResizeEventNS:null,_imgHeightInData:null,_imgWidthInData:null,_imgHeightBeforeLoad:null,_imgLoadWidth:null,_disableOCR:null,_OCRHighlightInfo:null,_OCRHighlightItem:null,initialize:function(e){var n=this;t.prototype.initialize.apply(n,[e]),n._imageResizeEventNS=".img-resize-"+i.uniqueId(),i.bindAll(n,"_onStyleChange","_onContentChange","_onChangeImageTitle","_onUpdateImageTitle","_editImgTitle","_handlerImgTitle","_onWinResize","_onHighlight","_onHideImageTitle"),n.block.on("edit-image-title",n._editImgTitle),n.block.on("style-change",n._onStyleChange),n.block.on("content-change",n._onContentChange),n.block.on("extra-info-change",n._onContentChange),n.block.on("view-resize",n._onWinResize),n.block.on("high-light",n._onHighlight),n.block.on("hide-image-title",n._onHideImageTitle),n.bindSelectionEvents(),n.on("resize",n._onWinResize),n.on("locked-change",function(){n.isLocked()&&(n.trigger("img-title-edit-exit"),n._removeFocusedClass())}),n._disableOCR=!!e.disableOCR||!g.IS_PC,n._OCRHighlightItem=[],n._OCRHighlightInfo=null},render:function(){var e=this,n=e.block,o=n.getSource(!0),i=n.getImageInfo(),r=null,s=n.getTitle(),a=new window.Image,l=o;i&&(o="/yws/res/thumb/"+i.resId,i.rawWide<=620?(r=i.rawWide,i.rawHeight):r=620),e._imgLoadWidth=r,g.IS_PC&&(o=d(o)),(g.IS_WEB_NOTE||g.IS_WEB_GROUP)&&!0===n.getFakeLoading()&&(o=f.LOADING_IMAGE_PATH,n.setFakeLoading(!1)),e._renderWithLoadedImage(o),e._isImgLoaded=!1,e._$imgContainerDiv=e.$el.find(".image-container"),e._$imgDiv=e.$el.find("img"),e._$imgTitle=e.$el.find(".image-title"),e._viewFrameHeight=e.$el.outerHeight(!0)-e.$el.height(),e._imgHeightInData=n.getBlockStyle("height",!0),e._imgWidthInData=n.getBlockStyle("width",!0),e._imgHeightBeforeLoad=e._$imgDiv.height(),e._$imgDiv.load(function(){e.$el.hasClass("focused")&&e._onUpdateImageTitle(!0),e._onImgLoaded()}),/^\//.test(o)&&!g.IS_MAC&&(o=window.location.origin+o),e._$imgDiv.attr("src",p.getURL(h.addIfNeeded(o))),e._renderStyles(),u.isSafari()&&e._$imgContainerDiv.attr("contenteditable","true"),t.prototype.render.apply(e,arguments),e.title=s,s?e._$imgTitle.text(s):e._$imgTitle.hide(),(g.IS_WEB_NOTE||g.IS_WEB_GROUP)&&e._loadOriginImg(l),a.onerror=a.onabort=function(){e._isImgError=!0,a.onload=a.onerror=a.abort=null,e._renderWithLoadedImage(null)},a.src=l},_renderWithLoadedImage:function(e){var t,n,o,s=this.block.getImageInfo();s&&(s.rawWide<=620?(n=s.rawWide,o=s.rawHeight):n=620),this._imgLoadWidth=n,t=r.render("common","image-view-image-container",{randomId:i.uniqueId("img-view"),width:n,height:o,src:e,hasOCR:!this._disableOCR,needCopyHack:g.IS_MAC||u.isSafari()}),this.$el.html(t)},_renderStyles:function(){var e=this,t=e.block.getBlockStyles();i.each(t,function(t,n){e._setStyle(n,t)})},_setStyle:function(e,t){var n,i=this.$el,r=i.find(".image-block-container"),s=r.find(".image-container"),l=o("body").find(".image-title-hidden");switch("100%"===t&&s.css("display","block"),e){case"align":i.css("text-align",t),l.length&&l.css("text-align",t);break;case"width":n=this.getImgElement(),null==t&&null==this._imgLoadWidth?o(n).css("width",""):null==t&&this._imgLoadWidth?o(n).css("width",this._imgLoadWidth):this._setImageWidth(t);break;case"float":i.css("float")!==t?(this._isFloatSwitch=!0,i.css("float",t)):this._isFloatSwitch=!1,!1===this.isOnFloat()&&this._resetImageMaxWidth();break;case"height":break;case"back-color":r.css("background-color",t),t?i.css({"padding-top":0,"padding-bottom":0}):i.css({"padding-top":"","padding-bottom":""});break;case"padding":r.css("padding",t),"0px"===r.css("padding-top")&&r.css({"padding-top":"4px","padding-bottom":"4px"});break;default:a.error("unkown style name:",e)}},_onStyleChange:function(e,t){this._setStyle(e,t),this.trigger("view-height-changed",this.cid)},_onContentChange:function(){var e=this.block,t=this.$el,n=e.getTitle(),o=e.getSource(!0);g.IS_PC&&(o=d(o)),o=p.getURL(h.addIfNeeded(o)),t.find("img").attr("src",o),this._$imgTitle.text(n),this.title=n,this._handlerImgTitle(),this.trigger("img-title-edit-exit"),this.trigger("view-height-changed",this.cid)},getImgElement:function(){return this.$el.find("img").get(0)},convertToNativeRange:function(){var e=document.createRange(),t=this.$el.get(0);return e.setStart(t,0),e.setEnd(t,t.childNodes.length),e},parseNativeRange:function(e,t,n){if(n||c.isNodeInRange(this.getImgElement(),e)||c.isRangeInNode(this.el,e))return new s({block:t})},_showButtonGroup:function(){this._hidePopupMenu(),l.adjustMenu(this.$el)},_hideButtonGroup:function(){this.$el.find(".menu-wrapper").hide(),this._hidePopupMenu()},_onButtonItemClick:function(e){var t=e.currentTarget.dataset.buttonName;if(!this.isLocked())switch(t){case"menu":default:this._togglePopupMenu()}},_togglePopupMenu:function(){var e,t,n,o,i=this.$el.find(".yne-popup-menu");i.toggle(),i.is(":visible")?(e=this.$el.find(".yne-button-group").outerHeight(),n=(t=i.get(0).getBoundingClientRect()).top+(o=t.height)>document.documentElement.clientHeight?-(o+5):e+5,i.css({top:n+"px"})):i.css({top:""})},_hidePopupMenu:function(){var e=this.$el.find(".yne-popup-menu");e.hide(),e.css({top:""})},_onContextMenu:function(e){e.preventDefault(),e.stopPropagation(),this._isReadOnly||this._isImgError||this.trigger("contextmenu",e)},_onMouseEnter:function(){var e=this.block;this.isLocked()||e.isReadOnly()||this._showButtonGroup()},_onMouseLeave:function(){this.isLocked()||this._hideButtonGroup()},_onMouseLeaveMenuWrapper:function(){this.isLocked()||this._hidePopupMenu()},_onPopupMenuItemClick:function(e){var t=e.currentTarget,n=o(t).attr("data-cm-name"),r={},s=this.block;if(!this.isLocked()&&!s.isReadOnly()){switch(this._hidePopupMenu(),n){case"image-title":this._editImgTitle();break;case"float-left":case"float-right":case"clear-float":r.float="float-left"===n?"left":"float-right"===n?"right":"none";break;case"clear-resize":r.width=null;break;case"delete":this.trigger("command","comp.DeleteNoteRange",{range:null,imageBlockView:this});break;case"download":this.trigger("yne-download-image",s.getSource(!0));break;case"image-ocr":this.trigger("yne-image-ocr",m(s))}i.isEmpty(r)||this.trigger("command","comp.ApplyStyles",{range:null,imageBlockView:this,blockStyles:r})}},_removeFocusedClass:function(){!this.$el.hasClass("focused")||this.isLocked()||this.block.isReadOnly()||(this.trigger("img-title-edit-end"),this.trigger("img-title-edit-exit"),this._handlerImgTitle()),this.$el.removeClass("focused")},_onUpdateImageTitle:function(e){var t=this,n=function(){var e=t._$imgTitle.offset();return{left:e.left,top:e.top,width:t.$el.width(),height:t._$imgTitle.height(),textAlign:t.block.getStyles("align")}};t.isLocked()||t.block.isReadOnly()||(e?t.trigger("img-title-edit-update",n):t.$el.hasClass("focused")||t.trigger("img-title-edit-start",t.block.getTitle(),n,t._onChangeImageTitle,t._$imgTitle,t.block.getId()))},_addFocusedClass:function(){this._onUpdateImageTitle(),this.$el.addClass("focused")},_drawNativeRange:function(){var e=document.createRange(),t=this.getImgElement();e.selectNode(t),e.collapse(!0),c.setRange(e)},onDrawRange:function(e){var t;e&&!this.isLocked()?(this._addFocusedClass(),(t=document.createRange()).selectNode(this.$el.find(".image-container")[0]),c.setRange(t,window)):this._removeFocusedClass()},_onMouseDownResizeHandle:function(e){var t,n,i=this.getImgElement(),r=e.pageX,s=e.pageY,a={centerX:0,centerY:0,startWidth:0,startHeight:0,startToCenter:0},l=this.block;this.isLocked()||l.isReadOnly()||i&&(t=o(i),a.startWidth=t.width(),a.startHeight=t.height(),n=t.offset(),a.centerX=n.left+a.startWidth/2,a.centerY=n.top+a.startHeight/2,a.startToCenter=Math.sqrt(Math.pow(a.centerX-r,2)+Math.pow(a.centerY-s,2)),this._imageResizeStartInfo=a,this._bindEventsForResize(),e.preventDefault(),this.$el.css("height",this.$el.height()))},_bindEventsForResize:function(){var e=this.el.ownerDocument,t=this._imageResizeEventNS;this._unbindEventsForResize(),o(e).bind("mousemove"+t,this._onResizeMove.bind(this)).bind("mouseup"+t,this._onResizeEnd.bind(this))},_unbindEventsForResize:function(){var e=this.el.ownerDocument;o(e).unbind(this._imageResizeEventNS)},_onResizeMove:function(e){this._handleImageResize(e.pageX,e.pageY)},_onResizeEnd:function(e){this.$el.css("height","auto"),this._unbindEventsForResize(),this._handleImageResize(e.pageX,e.pageY,!0)},_handleImageResize:function(e,t,n){var o,i,r=this._imageResizeStartInfo,s={};r&&(i=(o=Math.sqrt(Math.pow(r.centerX-e,2)+Math.pow(r.centerY-t,2)))*r.startWidth/r.startToCenter,o*r.startHeight/r.startToCenter,this.getImgElement()?(this._setImageWidth(i),!0===n?(s.width=this._$imgDiv.width(),s.height=this._$imgDiv.height(),this.trigger("command","comp.ApplyStyles",{range:null,imageBlockView:this,blockStyles:s})):this._onUpdateImageTitle(!0)):a.warn("no image element!"))},_onImgDblclick:function(){var e=this.block.getSource(!0);g.IS_PC&&this.trigger("yne-open-image",e)},_onImgClick:function(e){this.trigger("img-title-edit-end"),(g.IS_WEB_GROUP||g.IS_WEB_NOTE||g.IS_MAC)&&(this.showImgPreview||this.isLocked()||this.block.isReadOnly())&&this.trigger("get-image-items",this.block),e.preventDefault(),e.stopPropagation()},_onMouseDownImgPreview:function(){this.showImgPreview=this.$el.hasClass("focused")},_onChangeImageTitle:function(e,t,n,o){var r=this.block,s=[],a=[],l={};return e!==r.getTitle()&&(s.push({source:r.getSource(),title:e}),a.push(r),i.extend(l,{resources:a,resProps:s}),t&&i.extend(l,{endingRange:n}),this.trigger("command","comp.ReplaceResource",l)),!e&&o&&this._$imgTitle.hide(),!0},_onMouseDownImageTitleHandle:function(e){e.preventDefault()},onDestroy:function(){this.trigger("img-title-edit-exit")},_onWinResize:function(){this.$el.hasClass("focused")&&this._onUpdateImageTitle(!0)},_onHighlight:function(e,t,n){var o=this.block.getHighlight(e,t);o&&this._convertToData(o,n)},_convertToData:function(e,t){var n,o=this,r=o._$imgTitle.get(0).firstChild;o._OCRHighlightInfo=null,i.each(e,function(e){null==e.imageInfo?((n=document.createRange()).setStart(r,e.start),n.setEnd(r,e.end),t(n)):o._OCRHighlightInfo=e.imageInfo}),o._createHighlightMark()},_editImgTitle:function(){var e=this;setTimeout(function(){e._$imgTitle.show(),e._onUpdateImageTitle(!0),e.trigger("img-title-edit-focus")},0)},_onHideImageTitle:function(){this.trigger("img-title-edit-exit")},_handlerImgTitle:function(){this.title?this._$imgTitle.show():this._$imgTitle.hide()},clearHighlight:function(){this._OCRHighlightInfo=null,this._clearHighlightMark()},_clearHighlightMark:function(){i.each(this._OCRHighlightItem,function(e){e.remove()}),this._OCRHighlightItem=[]},disablePageMode:function(){t.prototype.disablePageMode.apply(this),this.$el.hasClass("focused")&&this._onUpdateImageTitle(!0),this.$el.css("max-height","none"),this._resetImageMaxWidth()},_contentHeightOverflowCheck:function(){var e,t,n,o,i=this._$imgTitle.height(),r=0,s=this._$imgDiv.height();return this._isInPageMode()?(null!=(e=this.getLastTransPageIndex())&&(t=this._getTopPosInPage(e),s=Math.ceil(s),r=Math.ceil(t+s+i+this._viewFrameHeight)-this.PAGE_HEIGHT),r>0&&((n=this._$imgDiv.height()-r)<f.PAGE_SPLIT_BLANK_HEIGHT/2&&(n=f.PAGE_SPLIT_BLANK_HEIGHT/2),o=this._$imgDiv.width()*n/this._$imgDiv.height(),this._$imgDiv.css("max-width",o)),r):r},_isPagingContinue:function(){return this._isFloatSwitch},_onImgLoaded:function(){var e;this._isImgLoaded=!0,this.$el.height("auto"),this._$imgDiv.height("auto"),e=this._$imgDiv.height(),this._imgHeightInData!==e||null==this._imgWidthInData?(this.block.setStyles("height",e),/^-?\d+%$/.test(this._imgWidthInData)?this.block.setStyles("width",this._imgWidthInData):this.block.setStyles("width",this._$imgDiv.width()),this._imgHeightInData=e):this._imgHeightBeforeLoad!==e?this.trigger("view-height-changed",this.cid):a.log("No height change after image loaded",this),this._createHighlightMark()},_createHighlightMark:function(){var e=this,t=e._OCRHighlightInfo;if(e._clearHighlightMark(),null!=t){var n=e._$imgContainerDiv.width()/t.width;i.each(t.pos,function(t){var i=o(r.render("common","high_light_item",{top:t.top*n-1,left:t.left*n-2,height:(t.bottom-t.top)*n,width:(t.right-t.left)*n}));i.appendTo(e._$imgContainerDiv),e._OCRHighlightItem.push(i)})}},_resetImageMaxWidth:function(){null!=this._$imgDiv&&this._$imgDiv.css("max-width","")},_setImageWidth:function(e){null!=e&&(/^-?\d+%$/.test(e)||(this._$imgContainerDiv.css("display","inline-block"),e=Math.ceil(e)),this._$imgDiv.width(e),this._resetImageMaxWidth(),null!=this._imgHeightInData&&!1===this._isImgLoaded&&this._$imgDiv.height(Math.ceil(this._imgHeightInData*this._$imgDiv.width()/e)))},_setViewMaxHeight:function(e){var t=this._pageInfo[e-1],n=0,o=this._getTopPosInPage(e);t&&(n=this._getPageBreakBottomPosInView(e-1)),this.$el.css("max-height",this.PAGE_HEIGHT+n-this._viewFrameHeight-o),this._contentHeightOverflowCheck()},_loadOriginImg:function(e){var t=this;e=p.getURL(h.addIfNeeded(e)),o("<img />").attr("src",e).load(function(){t._$imgDiv.attr("src",e),t._$imgDiv.removeClass("filter-blur")}).error(function(){t._$imgDiv.unbind("error")}),t._$imgDiv.error(function(){t._$imgDiv.attr("src",e),t._$imgDiv.removeClass("filter-blur")})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(7);return{adjustMenu:function(e){var n=e.find(".menu-wrapper"),o=n.width(),i=t(e.children()[0]),r=e.offsetParent().width(),s=i.position().left;s<o&&i.width()<o?n.addClass("menu-wrapper-left"):n.removeClass("menu-wrapper-left"),r-s-i.width()<o?i.width()<o?(n.addClass("menu-wrapper-mini"),n.removeClass("menu-wrapper-right")):(n.addClass("menu-wrapper-right"),n.removeClass("menu-wrapper-mini")):(n.removeClass("menu-wrapper-mini"),n.removeClass("menu-wrapper-right")),n.show()}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";return function(e){var t=e.getSource();if(t.startsWith("http")){var n=t.split("/");n.length>=2&&(t=n[n.length-2])}return t}}.apply(t,[n,t]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(60),i=n(12),r=n(121);return o.extend({className:"block-view list-item-view paragraph-view",_template:i.getTemplate("common","list_item_view"),_styleSheet:null,initialize:function(){o.prototype.initialize.apply(this,arguments),this._initEvents()},_initEvents:function(){var e=this.block,n=e.getOwnerList();if(!n)throw"no ownerList!";t.bindAll(this,"_onLevelChange","_onIndexChange","_onTypeChange","_onStyleChange"),e.on("level-change",this._onLevelChange),e.on("index-change",this._onIndexChange),n.on("type-change",this._onTypeChange),e.on("style-change",this._onStyleChange)},_renderLevel:function(){var e=this.block,t=e.getLevel(),n=this.$el.find(".li-box"),o=r.makeHtmlMarker(e);n.attr("data-level",t),o&&o.listStyleType&&n.attr("data-style-type",o.listStyleType)},_renderText:function(){o.prototype._renderText.apply(this,arguments),this._renderMarkerText(),this._renderBlockstyles()},_renderMarkerText:function(){var e,t=this,n=t.block.getText(),o=t.$el.find("li");o.attr("style",""),n.getLength()?e=r.convertToCssStyle(n.getStylesAtIndex(0),t._inlineStyleViewMapper):t.trigger("get-editing-styles",function(n){e=r.convertToCssStyle(n,t._inlineStyleViewMapper)}),e&&o.css(e)},_renderIndex:function(){var e=this.block;this.$el.find(".li-box").attr("start",e.getIndex())},_setContainerStyles:function(){var e=this,n=e.block.getBlockStyles();t.each(n,function(t,n){e._setContainerStyle(n,t)})},_setContainerStyle:function(e,t){var n=this.$el.find(".li-box");switch(e){case"back-color":n.parent().css("background-color",t);break;case"padding":n.css("padding",t)}},render:function(){o.prototype.render.apply(this,arguments),this._renderLevel(),this._renderIndex(),this._setContainerStyles(),this.trigger("view-height-changed",this.cid)},_renderTemplate:function(){var e=this.block;this.$el.html(this._template({isOrdered:e.isOrdered()}))},_onLevelChange:function(){this._renderLevel(),this._renderIndex(),this.trigger("view-height-changed",this.cid)},_onIndexChange:function(){this._renderIndex(),this.trigger("view-height-changed",this.cid)},_onTypeChange:function(){this.block.setLocked(!1),this.render()},_onStyleChange:function(e,t){var n=this.$el.find("li");switch(o.prototype._onStyleChange.apply(this,arguments),this._setContainerStyle(e,t),e){case"align":n.css("text-align",t);break;case"line-height":n.css("line-height",t)}},_renderBlockstyles:function(){var e=this.$el.find("li"),t=this.block.getBlockStyle("align"),n=this.block.getBlockStyle("line-height");t&&e.css("text-align",t),n&&e.css("line-height",n)},_onContentChange:function(){0===this.$el.find(".para-text").length&&this.render(),this._renderText(),this.trigger("view-height-changed",this.cid)},_getContentContainer:function(){return this.$el.find(".li-box")}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(41);return function(e,n){if(t.isNode(e)){if(n=!1!==n,e.removeNode&&n)return e.removeNode(e,n);if(e.parentNode&&e.parentNode.removeChild){if(!n)for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);return e.parentNode.removeChild(e)}}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(18),o=n(127);return t.View.extend({tagName:"div",className:"selection-layer",initialize:function(e){var t=e.tableView;this._tableView=t},render:function(){this.$el.attr("contenteditable","false")},hide:function(){this.$el.hide()},_computeViewRect:function(e){if(e){var t,n,i,r,s=this._tableView,a=e.getAsRectRange();if(a&&(t=a.getFirstCell(),n=a.getLastCell(),t&&t.cell&&n&&n.cell))return i=s.getBoundingRectByCell(t.cell),r=s.getBoundingRectByCell(n.cell),o.union(i,r)}},draw:function(e){var t=this._computeViewRect(e);t&&t.width>0&&t.height>0?this.$el.css({top:t.top,left:t.left,width:t.width,height:t.height}).show():this.$el.hide()}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(18),i=n(7),r=n(1),s=n(0),a=n(53),l=n(109),c=n(27),u=n(5),d=n(471),h=n(55),p=n(139),g=n(10),f=n(80),m=n(41),_=n(472),y=n(32),b=n(45),v=n(151),k=n(28),C=n(25),I=n(12),S=n(480),w=n(137),E=n(481),T=n(482),N=n(112),A=n(82);return n(483),t=o.View.extend({tagName:"div",className:"cell-edit",_editBox:null,_changeMonitor:null,_isDirty:!1,_editingCellId:null,_rangeWhenBlur:null,_editingInlineStates:null,events:{contextmenu:"_onPreventAndStop",mousedown:"_onStopPropagation",copy:"_onStopPropagation",cut:"_onStopPropagation",paste:"_onPaste",dblclick:"_onDblclick"},_onPreventAndStop:function(e){e.preventDefault(),e.stopPropagation()},_onStopPropagation:function(e){e.stopPropagation()},initialize:function(e){this._table=e.table,this._tableView=e.tableView,this._styleRules=e.styleRules,this._mapper=e.mapper,this._isRendered=!1,this._commander=_({editHost:this}),this._uid=s.unique("cell-edit-view-"),this._eventNS="."+this._uid,delete this.options},render:function(){var e=I.render("common","table_cell_edit",{}),t=this.el;!0!==this._isRendered&&(this._isRendered=!0,t.innerHTML=e,this._editBox=t.querySelector(".cell-edit-box"),this._initEvents())},_initEvents:function(){var e=this._editBox;c.addListeners({focus:"_onFocus",blur:"_onBlur",textInput:"_onTextInput",compositionstart:"_onCompositionStart",compositionend:"_onCompositionEnd",click:"_onClick"},i(e),this),this._initKeyHandlerManager(),this._changeMonitor=d.create({el:e}),c.addListeners({"content-change":"_onContentChange"},this._changeMonitor,this),this._history=T.create(),c.addListeners({undo:"_onHistoryUndo",redo:"_onHistoryRedo",change:"_onHistoryChange"},this._history,this)},_bindKey:function(e){var t=this,n=t._keyMonitor;e&&(n||(t._keyMonitor=n=new l({el:t._editBox,beforeMatch:function(e){e.stopPropagation()}})),n.unbind(e),n.bind(e,function(n){t._keyHandlerManager&&t._keyHandlerManager.execWithKey(e,t,n)}))},_unbindKey:function(e){var t=this._keyMonitor;t&&e&&t.unbind(e)},_initKeyHandlerManager:function(){var e=new u({scope:"table-cell-edit"}),t=e.getAvailableHandlerNames();e.on("bind-key",this._bindKey.bind(this)),e.on("unbind-key",this._unbindKey.bind(this)),s.each(t,function(t){e.bind(t)}),this._keyHandlerManager=e},blur:function(){this._editBox.blur()},_onBlur:function(){this._isOnToolbarLinkView()?this._rangeWhenBlur=this.getNativeRange():(this.trigger("blur"),this._commitChange())},_onFocus:function(){r.log("on focus")},_recognizeLink:function(e){var t,n,o=this.getNativeRange(),i=this.getEditBox(),r=w.getUrlInfoBeforeRange(o,i)||{};if((this._compositionStartUriInfo||{}).alreadyUrl||r.alreadyUrl)return e.preventDefault(),(n=document.createElement("div")).innerHTML=e.data,t=b.create({name:"insertHTML",value:"<span></span>"+n.innerText,isNative:!0}),void this.execCommand(t);r.startNode&&(" "!==e.data||r.alreadyUrl||(e.preventDefault(),(o=document.createRange()).setStart(r.startNode,r.startOffset),o.setEnd(r.endNode,r.endOffset),this.setNativeRange(o),t=b.create({name:"insertLink",value:r.uri}),this.execCommand(t),(o=this.getNativeRange()).collapse(!1),this.setNativeRange(o),t=b.create({name:"insertHTML",value:" ",isNative:!0}),this.execCommand(t)))},_onTextInput:function(e){var t=e.originalEvent||e;t.stopPropagation(),r.log("text",t.data),this._recognizeLink(t)},_onCompositionStart:function(e){var t=this.getNativeRange(),n=this.getEditBox();e.stopPropagation(),r.log("composition start"),this._isOnComposition=!0,this._compositionStartUriInfo=w.getUrlInfoBeforeRange(t,n)},_onCompositionEnd:function(e){e.stopPropagation(),r.log("composition end"),this._isOnComposition=!1,this._compositionStartUriInfo=null},_onClick:function(e){e.stopPropagation()},_onContentChange:function(){this._isDirty=!0,this._handleChangeWithDebounce()},_snapshot:function(){var e,t=this._editBox,n=this.getNativeRange();if(n)return e=E.jsonlify(t,n),{html:t.innerHTML,jsonRange:e};r.warn("Failed to create snapshot",n)},_saveHistory:function(){var e=this._lastSnapshot||this._baseSnapshot,t=this._snapshot();this._history.save({snapshotBefore:e,snapshotAfter:t}),this._lastSnapshot=t},_clearTimeoutOfHandleChange:function(){this._timeoutOfHandleChange&&(window.clearTimeout(this._timeoutOfHandleChange),this._timeoutOfHandleChange=null)},_handleChangeWithDebounce:function(){var e=this;e._clearTimeoutOfHandleChange(),e._timeoutOfHandleChange=window.setTimeout(function(){if(e._isOnComposition)return!1;e._saveHistory()},500)},_silentDo:function(e){this._changeMonitor&&!1===this._changeMonitor.isMonitoring()?e():(this._changeMonitor.disconnect(),e(),this._changeMonitor.observe())},silentDocSelectionChangeDo:function(e){var t=this;t._stopListenerDocSelectionChange?e():(t._stopListenerDocSelectionChange=!0,e(),window.clearTimeout(t._timeoutForStopListenerDocSelectionChange),t._timeoutForStopListenerDocSelectionChange=window.setTimeout(function(){t._stopListenerDocSelectionChange=!1},0))},undo:function(){var e=this._history;return this._clearTimeoutOfHandleChange(),!!e&&e.undo()},redo:function(){var e=this._history;return this._clearTimeoutOfHandleChange(),!!e&&e.redo()},_restoreSnapshot:function(e){if(e){var t=this;t._clearTimeoutOfHandleChange(),t._silentDo(function(){var n;t._editBox.innerHTML=e.html,n=E.parseJSON(t._editBox,e.jsonRange),t.setNativeRange(n)})}},_onHistoryUndo:function(e){this._restoreSnapshot(e)},_onHistoryRedo:function(e){this._restoreSnapshot(e)},_onHistoryChange:function(){var e=this._history;this.trigger("cell-edit-view-history-change",{canUndo:e.canUndo(),canRedo:e.canRedo()})},_handleContentWhenShowAndEdit:function(e,t){var n,o,i=!1;return null!=e?e instanceof f||(n=e instanceof g?e:g.create(e+""),i=!(o=f.create({richText:n})).isEmpty()):t.getType()===h.TEXT&&(o=t.getContent()).isEmpty()&&(o=null),{lines:o,isDirty:i}},showAndEdit:function(e){if(e&&null!=e.row&&null!=e.col){var t,n,o,a,l=this,c=l._table.getCell(e.row,e.col),u=l._tableView.$el.width(),d=i(".page-A4").get(0)?85:25,h=i(l._editBox),p={};c&&(l._changeMonitor.disconnect(),l._editingCellId=c.getCellId(),(t=l._tableView.getBoundingRectAt(e.row,e.col))&&((o=(n=l._handleContentWhenShowAndEdit(e.content,c)).lines)||(o=f.createBlank(!0),a=!0),l._isDirty=n.isDirty,t.width+t.left>u&&(t.width=u-t.left+d),d+t.left<0&&(t.left=-d,t.width=d+t.right),h.css({left:t.left,top:t.top,width:t.width,minHeight:t.height-3}),l._renderLines(o),l.$el.show(),l._focusEditBox(!0),a&&(s.each(c.getStylesForEmpty(),function(e,t){var n,o={};if(o[t]=e,n=S.createCmdBall("comp.ApplyStyles",{inlineStyles:o}),r.log("stylesForEmpty to cmdBall",t,e,n),!n)return!1;p[n.name]=n}),p.fontSize&&(l.execCommand(p.fontSize),delete p.fontSize),s.each(p,function(e){l.execCommand(e)})),l._changeMonitor.observe(),l._addListenerForDocSelectionChange(),l._baseSnapshot=l._snapshot(),l.trigger("cell-edit-view-enter",{canUndo:l._history.canUndo(),canRedo:l._history.canRedo()})))}else r.warn("Failed to show cell edit view, parameter is not valid",e)},_onSelectionChange:function(){var e=this.getNativeRange();this._clearEditingInlineStates(),this.trigger("cell-edit-view-selection-change",e)},_addListenerForDocSelectionChange:function(){var e=this;i(document).on("selectionchange"+e._eventNS,function(t){e.getNativeRange()?e._stopListenerDocSelectionChange?r.log("selection change NOT listener"):e._onSelectionChange(t):r.log("native range is not in cell edit view")})},_removeListenerForDocSelectionChange:function(){i(document).off("selectionchange"+this._eventNS)},_renderLines:function(e){var t=e.toHtml({styleRules:this._styleRules}),n=this._editBox;i(n).html(t)},_focusEditBox:function(e){var t,n=this._editBox;if(e){var o=y.getRange(),i=n.querySelector(".table-cell-line");if(!i||!o)return;t=i.lastChild||i,o.setStart(t,t.childNodes.length),o.setEnd(t,t.childNodes.length),y.setRange(o)}n.focus()},hide:function(){this.$el.hide()},_filterToLinesHtml:function(){var e=this._editBox,t=function(e){s.each(e,function(e){var n=e.style.textDecorationLine;n&&(e.style.textDecoration=n),e.hasChildNodes()&&t(e.children)})};t(e.children)},_getContentAsLines:function(){var e,t,n=f.createBlank();return this._viewStyleToData(),this._filterToLinesHtml(),e=this._editBox.innerHTML,t=p(e,{holdSpaces:!0})||[],s.each(t,function(e){var t=A.blockToCellContent(e);t instanceof f&&n.appendLines(t)}),n},_viewStyleToData:function(){var e=this,t=e._editBox,n=e._styleRules,o=e._mapper;s.map(n,function(n,i){var r,a,l;r=t.querySelectorAll("font"),"font-family"!==i?(e._elsViewStyleToData(r,o,i),e._elsViewStyleToData(t.querySelectorAll("span"),o,i)):s.forEach(r,function(e){a=e.getAttribute("face"),(a=k.getFontFirstValue(a))&&(l=o.valueFromView(i,a))&&e.setAttribute("face",l)})})},_elsViewStyleToData:function(e,t,n){var o,i,r=!1;s.forEach(e,function(e){(o=e.getAttribute(n))?r=!0:o=e.style[n],o&&("color"===n&&(o=C(o).toHexString()),(i=t.valueFromView(n,o))&&(r?e.setAttribute(n,i):e.style[n]=i))})},_commitChange:function(){var e;r.log("commit change"),this._isDirty&&(e=this._getContentAsLines(),this.trigger("set-cell-content",this._editingCellId,e)),this.exit()},_isOnToolbarLinkView:function(){return i(".combo-menu-link .link-input").is(":visible")},isFocused:function(){var e=document.activeElement;return e===this.el||i.contains(this.el,e)},_isShow:function(){return this.$el.is(":visible")},isOnEdit:function(){return!!this.isFocused()||this._isOnToolbarLinkView()&&this._isShow()},getNativeRange:function(){var e=y.getRange();if(y.isRangeInNode(this._editBox,e))return e;r.warn("native range is null or not in cell edit view",e)},setNativeRange:function(e){y.isRangeInNode(this._editBox,e)?y.setRange(e):r.warn("Failed to set native range to cell edit view",e)},_formatStyles:function(e){return e},_queryStyles:function(e){var t,n,o=this.getNativeRange();if(o)return t=o.startContainer,m.isText(t)&&(t=t.parentNode),n=window.getComputedStyle(t,null),n=this._formatStyles(n),e?n[e]:n},_queryInlineStylesForBulb:function(){var e=this._queryStyles(),t={},n={style:e},o=s.keys(S.INLINE_STYLES_CMD_MAP);return s.forEach(o,function(e){t[e]=N[e].action(n)}),t},queryInlineStylesForBulb:function(){var e,t,n,o=this.getNativeRange();if(o)return e=this._queryInlineStylesForBulb(),o.collapsed&&this._editingInlineStates?(t=s.clone(this._editingInlineStates),s.defaults(t,e),n=t):n=e,n.cellEditViewRangeCollapsed=o.collapsed,n},toggleInlineStyle:function(e){var t,n;-1!==s.keys(S.TOGGLE_INLINE_STYLES_CMD_MAP).indexOf(e)?(n=S.getCmdNameByStyleName(e),t=b.create({name:n,tryNativeIfNeeded:!0}),this.execCommand(t)):r.warn("toggleInlineStyle does NOT supprot",e)},_shouldModifyEditingInlineStates:function(e,t,n){return!!(e&&e.name&&t&&t.collapsed&&1===n)&&s.values(S.INLINE_STYLES_CMD_MAP).indexOf(e.name)>-1},_grabEditingInlineStates:function(e){if(e&&e.name){var t;this._editingInlineStates||(t=this._queryInlineStylesForBulb(),this._editingInlineStates=t)}},_updateEditingInlineStates:function(e){if(e&&e.name){var t=e.name,n=e.value,o=S.getStyleNameByCmdName(t),i=s.keys(S.TOGGLE_INLINE_STYLES_CMD_MAP);o&&this._editingInlineStates&&(i.indexOf(o)>-1&&!0!==n&&!1!==n&&(n=!this._editingInlineStates[o]),this._editingInlineStates[o]=n)}},_clearEditingInlineStates:function(){this._editingInlineStates=null},execCommand:function(e){var t,n,o=this.getNativeRange();return r.log("execCommand",e),o?(this._nestLevel||(this._nestLevel=0),this._nestLevel++,t=this._shouldModifyEditingInlineStates(e,o,this._nestLevel),1===this._nestLevel&&(t?this._grabEditingInlineStates(e):this._clearEditingInlineStates()),(n=this._commander.exec(e))&&1===this._nestLevel&&(t?this._updateEditingInlineStates(e):this._clearEditingInlineStates(),this.trigger("cell-edit-view-command-executed")),this._nestLevel--,n):(r.warn("nativeRange  is not in editBox"),!1)},exit:function(){this._isDirty=!1,this._editingCellId=null,this._clearTimeoutOfHandleChange(),this._lastSnapshot=null,this._baseSnapshot=null,this._removeListenerForDocSelectionChange(),this._changeMonitor.disconnect(),this._history.reset(),this.trigger("cell-edit-view-exit"),this.hide()},_filterTable:function(e){var t=e.querySelectorAll("table");s.each(t,function(e){var t=e.querySelectorAll("td"),n="";s.each(t,function(e){n+=e.innerHTML}),e.innerHTML=n})},_filterHtml:function(e){var t=a(e),n=["img"];return t?(this._filterTable(t),s.each(v,function(e,t){!1===e&&n.push(t)}),s.each(n,function(e){var n=t.querySelectorAll(e);s.each(n,function(e){e&&e.parentNode&&e.parentNode.removeChild(e)})}),t.innerHTML.trim()):""},_onPaste:function(e){var t,n,o=(e.originalEvent||e).clipboardData;e.stopPropagation(),e.preventDefault(),o&&o.types&&(-1!==s.indexOf(o.types,"text/html")?(t=o.getData("text/html"),t=this._filterHtml(t),n=b.create({name:"insertHTML",isNative:!0,value:t})):-1!==s.indexOf(o.types,"text/plain")&&(t=o.getData("text/plain"),n=b.create({name:"insertText",isNative:!0,value:t})),this.execCommand(n))},_onDblclick:function(e){e.stopPropagation()},editFromToolbar:function(e,t){var n,o=this.getNativeRange(),i=this.queryInlineStylesForBulb();return this._rangeWhenBlur&&(o=this._rangeWhenBlur,y.setRange(o)),!!o&&(!!(n=S.createCmdBall(e,t,i))&&(this.execCommand(n),this._rangeWhenBlur=null,!0))},getEditBox:function(){return this._editBox}},{create:function(e){if(e&&e.table&&e.tableView)return new t(e);r.warn("Failed to create CellEditView",e)},isRangeIn:function(e){if(!e)return!1;return y.isRangeInSelector("div.cell-edit",e)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(17),i=n(7),r=n(1),s=window.MutationObserver||window.WebKitMutationObserver;return t=o.extend({initialize:function(e){var t=this;e=e||{},t._el=e.el,t._monitoring=!1,t._hasBindDOMSubtreeModified=!1,delete t.options,s&&(t._observer=new s(function(){t._fireChange()}))},_fireChange:function(){!0===this._monitoring&&this.trigger("content-change")},observe:function(){this.isMonitoring()||(this._observer?this._observer.observe(this._el,{childList:!0,attributes:!0,subtree:!0,characterData:!0,attributeFilter:["style"]}):!1===this._hasBindDOMSubtreeModified&&(this._hasBindDOMSubtreeModified=!0,i(this._el).on("DOMSubtreeModified",this._fireChange.bind(this))),this._monitoring=!0)},disconnect:function(){this._monitoring=!1,this._observer&&this._observer.disconnect()},destroy:function(){this._observer?(this._observer.disconnect(),this._observer=null):!0===this._hasBindDOMSubtreeModified&&i(this._el).off("DOMSubtreeModified")},isMonitoring:function(){return this._monitoring}},{create:function(e){if(e&&e.el)return new t(e);r.warn("Failed to create ChangeMonitor")}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(473),o=n(474),i=[n(475),n(476),o,n(477),n(478),n(479)];return function(e){var n=t.create(e);return n.addCmds(i),n}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(0),i=n(1),r=n(16),s=["undo","redo","fontSize"];return t=r.extend({initialize:function(e){e=o.defaults(e||{},{editHost:null}),this._commands={},this._editHost=e.editHost,delete this.options},addCmd:function(e){var t=this._commands;if(e&&e.name&&e.action){if(t[e.name])return void i.warn("command has defined: ",e.name);t[e.name]=e}},addCmds:function(e){var t=this;o.each(e,function(e){t.addCmd(e)})},exec:function(e){var t,n=this;return e&&e.name?(!0===e.stopSelectionChange?n._editHost.silentDocSelectionChangeDo(function(){t=n._exec(e)}):t=n._exec(e),t):(i.warn("Failed to exec cmdBall",e),!1)},_exec:function(e){var t,n,o,r=this._commands;if(t=e.name,!e.isNative){if((o=r[t])&&o.action)return n=o.action.apply(o,[e.value,this,this._editHost]),e.callback&&e.callback(n),n;if(i.warn("no command",t),!e.tryNativeIfNeeded)return!1;i.warn("try to exec native command",t)}return s.indexOf(t)>-1?(i.error("native command is unvalid",t),!1):(n=this.execNative(t,e.value),e.callback&&e.callback(n),n)},execNative:function(e,t){if(document.queryCommandSupported(e)){document.execCommand("styleWithCSS",!1,!0);var n=document.execCommand(e,!1,t||"");return n||i.error("Failed to exec command",e,t),n}i.error("command is not supported",e)}},{create:function(e){return new t(e)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(45);return{name:"fontSize",action:function(e,n,o){var i,r=o.getNativeRange();return!!r&&(r.collapsed?(o.execCommand(t.create({name:"insertHTML",isNative:!0,value:'<span style="font-size: '+e+'px;"> </span>'})),o.execCommand(t.create({name:"delete",isNative:!0}))):(i=t.create({name:"applyInlineStyle",value:{name:"fontSize",value:e+"px"},isNative:!1}),o.execCommand(i)))}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(41),i=n(1),r=function(e,t){for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1},s=function(e,t,n){if(n===e)return null;if(e.firstChild&&!t)return e.firstChild;if(!e.parentNode)return null;for(var o=e.nextSibling||s(e.parentNode,!0,n);r(o,n);)o=o.firstChild;return o},a=function(e,t,n){var i,r=e.startContainer,a=e.startOffset,l=e.endContainer,c=e.endOffset;for(o.isElement(r)&&0!==a&&(r=(i=r.childNodes[a])||r.nextSibling,a=0),o.isElement(l)&&c!==l.length&&(c=(l=0===c?l.previousSibling:(i=l.childNodes[c-1])||l.previousSibling).length),i=r;i;i=s(i,t,l))n(i)},l=function(e){if(e.parentNode){var n=t.toArray(e.childNodes),o=e.parentNode;(function(e,t){if(e&&e.tagName)return(e.tagName+"").toLowerCase()===(t+"").toLowerCase()})(e,"span")&&0===e.attributes.length&&(t.each(n,function(t){e.removeChild(t),o.insertBefore(t,e)}),o.removeChild(e)),t.each(n,function(e){l(e)})}},c=function(e,t,n){var i;!function(e){var t,n=e.startContainer,i=e.endContainer,r=e.startOffset,s=e.endOffset;o.isText(i)&&s!==i.length&&i.splitText(s),o.isText(n)&&0!==r&&(t=n.splitText(r),n===i&&(i=t,s=t.length),n=t,r=0),e.setStart(n,r),e.setEnd(i,s)}(e),i=function(e){return{startNode:e.startContainer,endNode:e.endContainer,startOffset:e.startOffset,endOffset:e.endOffset}}(e),function(e,t){a(e,!1,function(e){o.isElement(e)&&(e.style[t]="")}),l(e.commonAncestorContainer)}(e,t),a(e,!0,function(i){var r;o.isElement(i)?i.style[t]=n:o.isText(i)&&!/^\s*$/.test(i.data)&&((r=e.startContainer.ownerDocument.createElement("span")).style[t]=n,i.parentNode.insertBefore(r,i),i.parentNode.removeChild(i),r.appendChild(i))}),function(e,t){e.setStart(t.startNode,t.startOffset),e.setEnd(t.endNode,t.endOffset)}(e,i)};return{name:"applyInlineStyle",action:function(e,t,n){var o=e.name,r=e.value,s=n.getNativeRange();return s&&!function(e){var t=e.startContainer,n=e.endContainer,o=e.startOffset,i=e.endOffset;return t===n&&o===i}(s)?(c(s,o,r),n.setNativeRange(s),!0):(i.warn("Failed to execute applyInlineStyle",s),!1)}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(45),i=n(178);return{name:"applyInlineStyles",action:function(e,n,r){var s=!1;return t.map(i.INLINE_STYLES_CMD_MAP,function(n,i){if(t.has(e,i)){if(null==e[i])return;r.execCommand(o.create({name:n,value:e[i],stopSelectionChange:"fontSize"===n})),s=!0}}),s}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(45),o=n(84),i=n(62);return{name:"insertLink",action:function(e,n,r){return!!(e=i.safeHref(e))&&(r.execCommand(t.create({name:"underline",value:!0})),r.execCommand(t.create({name:"createLink",value:o.completeUrl(e||"")})),!0)}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return{name:"undo",action:function(e,t,n){return n.undo()}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return{name:"redo",action:function(e,t,n){return n.redo()}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(45),o=n(28),i=n(0),r=n(1),s=n(178);return{TOGGLE_INLINE_STYLES_CMD_MAP:s.TOGGLE_INLINE_STYLES_CMD_MAP,INLINE_STYLES_CMD_MAP:s.INLINE_STYLES_CMD_MAP,getStyleNameByCmdName:function(e){var t;return i.some(this.INLINE_STYLES_CMD_MAP,function(n,o){if(n===e)return t=o,!0}),t},getCmdNameByStyleName:function(e){if(e)return this.INLINE_STYLES_CMD_MAP[e]},_createInlineStyleCmdBall:function(e){e=e||{};var n;return i.some(this.INLINE_STYLES_CMD_MAP,function(r,s){if(i.has(e,s))return"font-family"===s&&(e[s]=o.getAllValueByFont(e[s])||e[s]),n=t.create({name:r,value:e[s],stopSelectionChange:"fontSize"===r}),!0}),n},_createFormatPainterCmdBall:function(e,n){return i.map(n,function(t,o){e[o]===n[o]&&delete e[o]}),t.create({name:"applyInlineStyles",value:e})},createCmdBall:function(e,n,o){var i;switch(n=n||{},e){case"comp.RemoveFormat":i=t.create({name:"removeFormat"});break;case"comp.FormatPainter":if(!n.data||!n.data.inlineStyles)return;i=this._createFormatPainterCmdBall(n.data.inlineStyles,o);break;case"comp.ApplyStyles":n.inlineStyles&&(i=this._createInlineStyleCmdBall(n.inlineStyles));break;case"comp.InsertLink":if(!n.src)return;i=t.create({name:"insertLink",value:n.src});break;case"undo":i=t.create({name:"undo",isNative:!1,tryNativeIfNeeded:!1});break;case"redo":i=t.create({name:"redo",isNative:!1,tryNativeIfNeeded:!1})}return i?r.log("toolbarAdapter handles name/args/ball",e,n,i):r.warn("toolbarAdapter do NOT handle: ",e,n),i}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(41),i=n(1);return{jsonlify:function(e,n){if(e&&n){var r=function(n){var i,r={};return o.isText(n)?(i=n.parentNode,r.childIndex=t.indexOf(i.childNodes,n)):i=n,r.isRoot=i===e,r.isRoot?r:(r.tagName=i.tagName,r.tagIndex=t.indexOf(e.querySelectorAll(r.tagName),i),r)},s={collapsed:n.collapsed,startContainer:r(n.startContainer),startOffset:n.startOffset};return i.log(s),s.collapsed?s:(s.endContainer=r(n.endContainer),s.endOffset=n.endOffset,s)}},parseJSON:function(e,t){if(e&&t){var n,o=function(t){var n;return t.isRoot?null!=t.childIndex?e.childNodes[t.childIndex]:e:(n=e.querySelectorAll(t.tagName)[t.tagIndex],null!=t.childIndex?n.childNodes[t.childIndex]:n)},i=e.ownerDocument.createRange(),r=o(t.startContainer);return i.setStart(r,t.startOffset),t.collapsed?i.setEnd(r,t.startOffset):(n=o(t.endContainer),i.setEnd(n,t.endOffset)),i}}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(17),i=n(1);return t=o.extend({initialize:function(){delete this.options,this.reset()},reset:function(){this._undo=[],this._redo=[],this.trigger("change")},save:function(e){if(!e||!e.snapshotBefore||!e.snapshotAfter)return i.warn("parameter is unvalid",e),!1;return this._undo.push(e),this._redo=[],this.trigger("change"),i.log("history save operation",this._undo.length,e),!0},canUndo:function(){return this._undo.length>0},canRedo:function(){return this._redo.length>0},undo:function(e){var t;for(e=e||1,i.log("history undo",e);e&&e>0&&this.canUndo();)t=this._undo.pop(),this._redo.push(t),e--;return!!t&&(i.log("history undo",t.snapshotBefore),this.trigger("undo",t.snapshotBefore),this.trigger("change"),!0)},redo:function(e){var t;for(e=e||1,i.log("history redo",e);e&&e>0&&this.canRedo();)t=this._redo.pop(),this._undo.push(t),e--;return!!t&&(i.log("history redo",t.snapshotAfter),this.trigger("redo",t.snapshotAfter),this.trigger("change"),!0)}},{create:function(e){return new t(e)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){n(484),n(485),n(486),n(487),n(488),n(489),n(490)}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(5),o=n(45),i=n(137);t.register({name:"enter",scope:"table-cell-edit",key:"enter",action:function(e){var t,n,r=e.getNativeRange(),s=e.getEditBox();(t=i.getUrlInfoBeforeRange(r,s))?(t.alreadyUrl||((r=document.createRange()).setStart(t.startNode,t.startOffset),r.setEnd(t.endNode,t.endOffset),e.setNativeRange(r),n=o.create({name:"insertLink",value:t.uri}),e.execCommand(n),(r=e.getNativeRange()).collapse(!1),e.setNativeRange(r)),n=o.create({name:"insertHTML",value:"<div><br/></div>",isNative:!0})):n=o.create({name:"insertLineBreak",isNative:!0}),e.execCommand(n)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(5),o=n(45),i=n(137),r=function(e){var t,n,r=e.getNativeRange(),s=e.getEditBox();(t=i.getUrlInfoBeforeRange(r,s))?(t.alreadyUrl||((r=document.createRange()).setStart(t.startNode,t.startOffset),r.setEnd(t.endNode,t.endOffset),e.setNativeRange(r),n=o.create({name:"insertLink",value:t.uri}),e.execCommand(n),(r=e.getNativeRange()).collapse(!1),e.setNativeRange(r)),n=o.create({name:"insertHTML",value:"<div><br/></div>",isNative:!0})):n=o.create({name:"insertLineBreak",isNative:!0}),e.execCommand(n)};t.register({name:"altEnter",scope:"table-cell-edit",key:"alt+enter",action:r}),t.register({name:"shiftEnter",scope:"table-cell-edit",key:"shift+enter",action:r})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){n(5).register({name:"esc",scope:"table-cell-edit",key:"esc",action:function(e){e.exit()}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(5);n(0).each({"mod+b":"bold","mod+i":"italic","mod+e":"strike","mod+u":"underline"},function(e,n){t.register({name:e,scope:"table-cell-edit",key:n,action:function(t){t.toggleInlineStyle(e)}})})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(5),o=n(45);t.register({name:"modZ",scope:"table-cell-edit",key:"mod+z",action:function(e){var t=o.create({name:"undo",isNative:!1,tryNativeIfNeeded:!1});e.execCommand(t)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(5),o=n(45),i=function(e){var t=o.create({name:"redo",isNative:!1,tryNativeIfNeeded:!1});e.execCommand(t)};t.register({name:"modShiftZ",scope:"table-cell-edit",key:"mod+shift+z",action:i}),t.register({name:"modY",scope:"table-cell-edit",key:"mod+y",action:i})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){n(5).register({name:"save",scope:"table-cell-edit",key:"mod+s",action:function(){}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t,o=n(18),i=n(0),r=n(1),s=n(27),a=n(109),l=n(32),c=new Array(3).join(" "),u=[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46,91,92,93,112,113,114,115,116,117,118,119,120,121,122,123,144,145,229];return t=o.View.extend({tagName:"input",className:"hidden-input",_lastKeyDownCode:null,initialize:function(){this._initEvents(),delete this.options},_initEvents:function(){s.addListeners({keydown:"_onKeyDown",textInput:"_onTextInput",compositionstart:"_onCompositionStart",compositionend:"_onCompositionEnd",copy:"_onCopyCutPaste",cut:"_onCopyCutPaste",paste:"_onCopyCutPaste"},this.$el,this)},bindKey:function(e){var t=this,n=t._keyMonitor;e&&(n||(t._keyMonitor=n=new a({el:t.el,beforeMatch:function(e){e.stopPropagation()},afterMatch:function(e,n){n||-1!==i.indexOf(u,e.keyCode)||e.ctrlKey||e.metaKey||t._onPrintableKeyDown(e)}})),n.unbind(e),n.bind(e,function(n){t.trigger("key-monitor",e,n)}))},unbindKey:function(e){var t=this._keyMonitor;t&&e&&t.unbind(e)},render:function(){this.$el.val(c)},isFocused:function(){return document.activeElement===this.el},isOnEdit:function(){return this.isFocused()&&this.getValue()!==c},focus:function(e){var t=this.el;e&&this.setPosition(e.left,e.top),t.select()},blur:function(){this.el.blur()},setPosition:function(e,t){var n=this.el;n.style.left=e+"px",n.style.top=t+"px"},setWidth:function(e){this.el.style.width=e+"px"},bringToFront:function(){this.el.value="",this.el.style.zIndex=255},hideBehind:function(){this.el.style.zIndex=-255},_onPrintableKeyDown:function(e){this._printableKeyDown=!0,32===e.keyCode&&(e.preventDefault(),this.$el.trigger("textInput",e))},_onKeyDown:function(e){this._lastKeyDownCode=e.keyCode},_onTextInput:function(e){e=e.originalEvent||e,r.log("hiddenInputView textInput",e),e.stopPropagation();var t=this,n=e.data;if(this._printableKeyDown)return e.preventDefault(),this._triggerTextInput(n),void(this._printableKeyDown=!1);229===t._lastKeyDownCode&&window.setTimeout(function(){t._triggerTextInput(n)},50)},_onCompositionStart:function(e){r.log("hiddenInputView compositionstart",e),e.stopPropagation(),this.bringToFront()},_onCompositionEnd:function(e){if(e=e.originalEvent||e,r.log("hiddenInputView compositionend",e),e.stopPropagation(),!this.locked){var t=e.data||this.$el.val();t&&i.defer(function(){this._triggerTextInput(t)}),this.hideBehind()}},_onCopyCutPaste:function(e){var t=e.type;e.preventDefault(),e.stopPropagation(),r.log("on copy/cut/paste",t,e),this.trigger(t,e)},_triggerTextInput:function(e){this.trigger("text-input",e),this.clearValue()},clearValue:function(){this.el.value=c},getValue:function(){return this.el.value}},{create:function(e){return new t(e)},isRangeIn:function(e){if(e){return l.isRangeInSelector("input.hidden-input",e)}}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(18),o=n(177),i=n(27),r=n(44),s=n(12),a=n(0);return t.View.extend({className:"cell-resize-layer",initialize:function(e){var t=e.tableView,n=t.$el;this._tableView=t,this._draggable=new o({el:this.el,disableDocSelection:!0}),this._active=!0,this._onDrag=!1,this._resizeDirection=null,this._cellInfo=null,this._rowLine=n.find(".row-resize-line"),this._colLine=n.find(".col-resize-line"),this._bindEvents()},onDestroy:function(){this.draggable.off()},_bindEvents:function(){var e=this._draggable,t=this._tableView,n={};a.bindAll(this,"_onCellEnter"),n[o.DRAG_START]="_onDragStart",n[o.DRAGGING]="_onDragging",n[o.DRAG_END]="_onDragEnd",i.addListeners(n,e,this),t.on("cell-enter",this._onCellEnter)},render:function(){var e=s.render("common","table_cell_resize",{});this.$el.html(e),this.showAt()},showAt:function(e){e&&null!=e.width&&this.$el.css({width:e.width,height:e.height,top:e.top,left:e.left}).show()},hide:function(){this.$el.hide()},enable:function(){this._active=!0},disable:function(){this._active=!1,this.hide()},isActive:function(){return this._active},_parseType:function(e){var t,n=e.className;return a.some(r,function(e,o){var i=o.toLowerCase();if(n.indexOf(i)>-1)return t=e,!0}),t||r.UP},_onDragStart:function(e){var t,n=this._tableView;n&&!n.isLocked()&&(e.stopPropagation(),this._onDrag=!0,this._resizeDirection=this._parseType(e.target),t=n.getEventBoundingRect(e),this._startRect=t,this._updateResizeLine(t.left,t.top),n.focusOutTbody())},_onDragging:function(e){var t,n=this._tableView;n&&!n.isLocked()&&(e.stopPropagation(),this._onDrag=!0,t=n.getEventBoundingRect(e),this._updateResizeLine(t.left,t.top))},_onDragEnd:function(e){var t,n,o,i=this._tableView,s=this._cellInfo;i&&!i.isLocked()&&(e.stopPropagation(),this._onDrag=!1,t=i.getEventBoundingRect(e),this._updateResizeLine(t.left,t.top,!0),n=t.left-this._startRect.left,o=t.top-this._startRect.top,s&&(0===s.row&&this._resizeDirection===r.TOP&&(o=0-o),0===s.col&&this._resizeDirection===r.LEFT&&(n=0-n)),this._execResizeCommand(n,o))},_updateResizeLine:function(e,t,n){switch(this._resizeDirection){case r.UP:case r.DOWN:n?this._rowLine.hide():this._rowLine.css({top:t}).show();break;case r.RIGHT:case r.LEFT:n?this._colLine.hide():this._colLine.css({left:e}).show()}},_execResizeCommand:function(e,t){var n,o,i,s,l,c,u,d,h,p,g=this._tableView,f=g.block,m=this._cellInfo;switch(this._resizeDirection){case r.UP:case r.DOWN:n=m.row,this._resizeDirection===r.UP?n-=1:(c=f.getMergePointAttrAt(m.row,m.col).height||0)>1&&(n+=c-1),n=n<0?0:n,i=g.getRowElHeight(n),i+=t,i=a.max([i,10]),this.trigger("set-row-height",n,i);break;case r.RIGHT:case r.LEFT:if(o=m.col,this._resizeDirection===r.LEFT?o-=1:(l=f.getMergePointAttrAt(m.row,m.col).width||0)>1&&(o+=l-1),u=o+1,o=o<0?0:o,d=g.getColElWidth(o),s=a.max([d+e,35]),u>=f.getColumnCount()){this.trigger("set-col-width",o,d+e);break}u!==o?(h=d+f.getColumnWidth(u),p=a.max([h-s,35]),this.trigger("set-cells-size",[{col:u,width:p},{col:o,width:h-p}])):this.trigger("set-col-width",o,s)}},_onCellEnter:function(e){var t,n,o,i=this._tableView,r=i.block;!r.locked&&i&&this.isActive()&&!this._onDrag&&(n=i.getCellElementByTarget(e),(t=r.getCellById(n))&&(this._cellInfo={row:t.row,col:t.col},o=i.getBoundingRect(n),this.showAt(o)))}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(12),o=n(174),i=n(175),r=n(134);return{_renderWrap:function(e){return'<div class="resource-wrap">'+e+"</div>"},renderImage:function(e,t){var n=e.getSource(t),o=document.createElement("img");return o.setAttribute("draggable","false"),o.setAttribute("src",r.getURL(i.addIfNeeded(n))||""),o.setAttribute("width","100%"),o.setAttribute("height","auto"),this._renderWrap(o.outerHTML)},renderAttachment:function(e){var n,i,r,s,a=e.getInfo();return n=o.splitFileFullName(a.fileName),i=o.getSizeString(a.fileLength),s=o.getFileIconByName(a.fileName),r=t.render("common","attachment-view-attachment-container",{name:s,fileName:n.fileName.replace(/ /g,"&nbsp;"),fileType:n.fileType.replace(/ /g,"&nbsp;"),size:i,title:a.fileName.replace(/ /g,"&nbsp;"),draggable:!1}),this._renderWrap(r)}}}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){n(495),n(496),n(497),n(498),n(499),n(500),n(501),n(502)}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(5);n(0).each({"mod+b":"bold","mod+i":"italic","mod+u":"underline","mod+e":"strike"},function(e,n){t.register({name:e,scope:"table-hidden-input",key:n,action:function(t){t.toggleInlineStyle(e)}})})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(5),o=n(44),i=n(0),r={left:o.LEFT,right:o.RIGHT,up:o.UP,down:o.DOWN,tab:o.RIGHT,"shift+tab":o.LEFT,enter:o.DOWN};i.each(r,function(e,n){t.register({name:n,scope:"table-hidden-input",key:n,action:function(t,n){t.moveWithDirection(e,n)}})})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(5);n(0).each(["backspace","del"],function(e){t.register({name:e,scope:"table-hidden-input",key:e,action:function(e){e.clearSelectedCells()}})})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){n(5).register({name:"save",scope:"table-hidden-input",key:"mod+s",action:function(e){e.trigger("save-content")}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){n(5).register({name:"select-all",scope:"table-hidden-input",key:"mod+a",action:function(e){e.selectAll(!0)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(5);t.register({name:"undo",scope:"table-hidden-input",key:"mod+z",action:function(e){e.trigger("global-undo")}}),t.register({name:"redo",scope:"table-hidden-input",key:"mod+y",action:function(e){e.trigger("global-redo")}}),t.register({name:"redo_2",scope:"table-hidden-input",key:"mod+shift+z",action:function(e){e.trigger("global-redo")}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(5),o=n(0),i=n(1),r=n(8);n(20).isSafari()&&!r.IS_MAC||o.each(["mod+1","mod+2","mod+3","mod+4","mod+d","mod+h","mod+l","ctrl+q"],function(e){t.register({name:e,scope:"table-hidden-input",key:e,preventDefault:!0,action:function(){i.log("shortcut prevented on table")}}),t.register({name:e,scope:"table-cell-edit",key:e,action:function(){i.log("shortcut prevented on table")}})})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(5);t.register({name:"paste",key:"mod+v",scope:"table-hidden-input",preventDefault:!1,action:function(e){e.setPasteAsText(!1)}}),t.register({name:"pasteAsText",key:"mod+shift+v",scope:"table-hidden-input",preventDefault:!1,action:function(e){e.setPasteAsText(!0)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(60),o=n(0),i=n(12);return t.extend({$checkbox:null,_checked:!1,name:"todo",className:"block-view todo-view",events:{"mousedown .todo-mark":"_onClick"},initialize:function(e){t.prototype.initialize.apply(this,arguments),this.options=e,this.block=e.block,o.bindAll(this,"_blockCheckedChange","_onStyleChange"),this.block.on("checked-change",this._blockCheckedChange),this.block.on("style-change",this._onStyleChange)},_renderTemplate:function(){this.$el.html(i.render("common",this.name))},render:function(){var e=this.block;t.prototype.render.apply(this,arguments),this._blockCheckedChange(e.getChecked()),this._setContainerStyles()},_setContainerStyles:function(){var e=this,t=e.block.getBlockStyles();o.each(t,function(t,n){e._setContainerStyle(n,t)})},_setContainerStyle:function(e,t){var n=this.$el.find(".todo-content");switch(e){case"back-color":n.parent().css("background-color",t);break;case"padding":n.css("padding",t)}},_onStyleChange:function(e,n){t.prototype._onStyleChange.apply(this,arguments),this._setContainerStyle(e,n)},_blockCheckedChange:function(e){e?this.$el.addClass("checked"):this.$el.removeClass("checked"),this._checked=e},_onClick:function(e){e.preventDefault(),e.stopPropagation();var t=this._checked;this.trigger("command","comp.SetBlockProps",{blocks:[this.block],props:{checked:!t}})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(0),o=n(7),i=n(60),r=n(38),s=n(173),a=n(30),l=n(25),c=n(21),u=n(73),d=n(123),h=n(28);return i.extend({name:"quote",className:"block-view paragraph-view quote-view",render:function(){this._renderTemplate(),this._renderText(d.getQuoteDefaultStyles()),this._renderStyles(),this._setContainerStyles(),r.prototype.render.apply(this,arguments)},_setContainerStyles:function(){var e=this,n=e.block.getBlockStyles();t.each(n,function(t,n){e._setContainerStyle(n,t)})},_setContainerStyle:function(e,t){var n=this.$el.find(".para-text");switch(e){case"back-color":n.parent().css("background-color",t);break;case"padding":n.css({padding:t,margin:t}),"0px"===n.css("padding-left")&&n.css("padding-left","17px"),n.css("padding-top","0px")}},_renderText:function(e){var n,i,r=this,p=r.block,g=p.getReadOnlyText(),f=r._inlineStyleViewMapper,m=r.$el.find(".para-text");n=g.isEmpty()?this._createHtmlForBlankLine(e):a.rich2html(g,{styles:e,styleRules:{color:function(e){var t=e.color;return e.href!==c.getDefault("href")&&l.equals(e.color,"#003884")?d.getQuoteColor():l.equals(e.color,"#393939")||t===c.getDefault("color")?d.getQuoteColor():null!=t&&f?f.valueToView("color",t):void 0},"font-family":function(e){var t,n=e["font-family"];return n!==c.getDefault("font-family")&&f&&(t=f.valueToView("font-family",n)),n!==t?t:h.getAllValueByFont(n)||n}}}),m.html(n),i=p.getStyleRanges("href"),t.each(i,function(e){var t,n,i;t=new s({start:e.from,end:e.to,block:p}),n=r.convertToNativeRange(t),(i=r._findLinkNode(n.endContainer))&&(o(i).off("hover"),o(i).hover(function(){u.isNoteLinkUrl(i.href)||r.isCollabLocked()||r.trigger("link-menu-show",{linkNode:i,range:t,block:p})},function(){r.trigger("link-menu-hide")}))})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(60),n(38),n(7),n(0),n(506),n(70),n(48),n(62),n(32)],void 0===(i=function(e,t,n,o,i,r,a,l,c,u,d){"use strict";var h=function(e){return(e.data||e.innerText||e.innerHTML)===u.escapeHtmlEntities(c.EMPTY_LINE_TAG)},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.className="block-view code-view",t.name="code",t.isSelectedBlock=!1,t}return s(t,e),t.prototype._convertToData=function(){},t.prototype._getContentContainer=function(){return this.$el},t.prototype.getBlock=function(){return this.block},t.prototype.initialize=function(){o.prototype.initialize.apply(this,arguments),n.prototype.initialize.apply(this,arguments);var e=this.getBlock();e.injectTokenizer(a),e.injectRenderParams({YNE_HEAD_CLASS:"yne",PLAIN_STRING_CLASS:"plain"}),r.bindAll(this,"renderText","_onContentChange","onClickBlock","onDrawRange"),this.on("draw-range",this.onDrawRange),e.on("content-change",this.renderText),e.on("content-change",this._onContentChange)},t.prototype.render=function(){this.renderText(),this.renderBackColor(),o.prototype.render.apply(this,arguments)},t.prototype.renderText=function(e){e?this.update(e):(this.renderAll(),this.updateTheme(),this.getCodeLineContainer().on("mousedown",this.onClickBlock))},t.prototype.renderBackColor=function(){var e=this.getBlock().getBlockStyles()["back-color"];this._getContentContainer().css("background-color",e)},t.prototype.onClickBlock=function(e){this.isSelectedBlock=e.currentTarget===e.toElement,this.drawSelectAllRange()},t.prototype.onDrawRange=function(e,t){e||this.getBlock()===t||(this.isSelectedBlock=!1,this.drawSelectAllRange())},t.prototype.onSetRange=function(e){var t=document.createRange();e&&(t.selectNodeContents(this.getCodeLineContainer()[0]),d.setRange(t,window),this.isSelectedBlock=!0,this.getBlock().isSelectedBlock=!0,this.getCodeLineContainer().addClass("selectAll"))},t.prototype.drawSelectAllRange=function(e){var t=this,n=e||this.isSelectedBlock;this.isSelectedBlock=n,this.getBlock().isSelectedBlock=n,n?this.getCodeLineContainer().addClass("selectAll"):this.getCodeLineContainer().removeClass("selectAll"),n?setTimeout(function(){t._getContentContainer().parent().attr("contenteditable",!1)},0):this._getContentContainer().parent().attr("contenteditable",!0),this._getContentContainer().attr("draggable",n)},t.prototype.scrollToStart=function(){this._getContentContainer().scrollLeft(0)},t.prototype.scrollRightByIndex=function(e){var t,n=(t=e,this.get$CodeLine(t)).children(),o=this._getContentContainer(),i=0;n.each(function(e){var t=Number(n.eq(e).width());isNaN(t)||(i+=t)}),o.scrollLeft(i)},t.prototype.updateTheme=function(){var e=this.className+" "+("yne-code-theme-"+this.getBlock().getTheme());this._getContentContainer().attr("class",e)},t.prototype.renderAll=function(){var e=this.getBlock().code2html();this._getContentContainer().html('<div class="para-text"></div>'),this.getCodeLineContainer().html(e)},t.prototype.update=function(e){var t=this;for(var n=e.preRichText,o=e.newRichText,i=this.getBlock(),r=i.toCodeLines(n.toString()),s=i.toCodeLines(o.toString()),a=[],l=[];r.length>0&&s.length>0&&r[0]===s[0];)a.push(r[0]),r.shift(),s.shift();for(r.reverse(),s.reverse();r.length>0&&s.length>0&&r[0]===s[0];)l.push(r[0]),r.shift(),s.shift();var c=a.length,u=a.length;r.forEach(function(e,n){var o=c+1;t.get$CodeLine(o).remove()}),s.forEach(function(e,n){var o=i.codeLineToHtml(u+n+1);t.insertAfter(u+n,o)})},t.prototype.parseNativeRange=function(e,t,n){var o=function(e){for(var t=i(e);"PRE"!==t.prop("tagName")&&!(t=t.parent()).is(document.body););return 1+t.prevAll("pre").length},r=function(e,t){if(h(e)||h(e.parentElement))return 0;"drop-hint"===e.id&&(t=e.parentElement.innerText.length),e.nextSibling&&"drop-hint"===e.nextSibling.id&&(t=e.wholeText.length),e.previousSibling&&"drop-hint"===e.previousSibling.id&&(t=i(e.parentElement).text().length-e.wholeText.length);var n=e.parentElement;return i(n).prevAll().text().length+t},s=function(e){for(;;){if(/code-view/.test(e.className))return!0;if(/note-view/.test(e.className))return!1;e=e.parentElement}};if(this.isSelectedBlock)return new l({block:t,selectWholeBlock:!0});var a=e.commonAncestorContainer.className,c=e.startContainer.className,u=/para-text/;if(n||u.test(a)&&u.test(c))return l.createSelectToEndRange(t);if(/note-view/.test(a)){if(s(e.startContainer))return l.createSelectToEndRange(t,o(e.startContainer),r(e.startContainer,e.startOffset));if(s(e.endContainer)){var d=o(e.endContainer),p=r(e.endContainer,e.endOffset);return new l({block:t,startLineIndex:1,startLineCharIndex:0,endLineIndex:d,endLineCharIndex:p})}return l.createSelectToEndRange(t)}var g=r(e.startContainer,e.startOffset),f=r(e.endContainer,e.endOffset),m=o(e.startContainer),_=o(e.endContainer);return new l({block:t,startLineCharIndex:g,endLineCharIndex:f,startLineIndex:m,endLineIndex:_,selectWholeBlock:this.isSelectedBlock})},t.prototype.convertToNativeRange=function(e){var t=this,n=document.createRange();e.selectWholeBlock&&(this.drawSelectAllRange(!0),e=l.createBeginRange(e.block));var o=function(e){return t.get$CodeLine(e)},i=function(e,t){var n={node:null,offset:0};return e.children().each(function(){n.node||(h(this)?n.node=this:(t-=this.innerText.length)<=0&&(n.node=this.firstChild,n.offset=t+this.innerText.length))}),n},r=o(e.startLineIndex),s=o(e.endLineIndex),a=i(r,e.startLineCharIndex),c=i(s,e.endLineCharIndex);return n.setStart(a.node,a.offset),n.setEnd(c.node,c.offset),n},t.prototype.insertAfter=function(e,t){0===e?this.getCodeLineContainer().prepend(i(t)):this.get$CodeLine(e).after(t)},t.prototype.getCodeLineContainer=function(){return this._getContentContainer().find(".para-text")},t.prototype.get$CodeLine=function(e){return this.getCodeLineContainer().children("pre").eq(e-1)},t}(n);return delete p.prototype.constructor,p.prototype.className="block-view code-view",o.extend(p.prototype)}.apply(t,o))||(e.exports=i)},function(e,t,n){(function(t){var n="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},o=function(){var e=/\blang(?:uage)?-([\w-]+)\b/i,t=0,o=n.Prism={manual:n.Prism&&n.Prism.manual,disableWorkerMessageHandler:n.Prism&&n.Prism.disableWorkerMessageHandler,util:{encode:function(e){return e instanceof i?new i(e.type,o.util.encode(e.content),e.alias):"Array"===o.util.type(e)?e.map(o.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e,t){var n=o.util.type(e);switch(t=t||{},n){case"Object":if(t[o.util.objId(e)])return t[o.util.objId(e)];var i={};for(var r in t[o.util.objId(e)]=i,e)e.hasOwnProperty(r)&&(i[r]=o.util.clone(e[r],t));return i;case"Array":if(t[o.util.objId(e)])return t[o.util.objId(e)];i=[];return t[o.util.objId(e)]=i,e.forEach(function(e,n){i[n]=o.util.clone(e,t)}),i}return e}},languages:{extend:function(e,t){var n=o.util.clone(o.languages[e]);for(var i in t)n[i]=t[i];return n},insertBefore:function(e,t,n,i){var r=(i=i||o.languages)[e];if(2==arguments.length){for(var s in n=arguments[1])n.hasOwnProperty(s)&&(r[s]=n[s]);return r}var a={};for(var l in r)if(r.hasOwnProperty(l)){if(l==t)for(var s in n)n.hasOwnProperty(s)&&(a[s]=n[s]);a[l]=r[l]}var c=i[e];return i[e]=a,o.languages.DFS(o.languages,function(t,n){n===c&&t!=e&&(this[t]=a)}),a},DFS:function(e,t,n,i){for(var r in i=i||{},e)e.hasOwnProperty(r)&&(t.call(e,r,e[r],n||r),"Object"!==o.util.type(e[r])||i[o.util.objId(e[r])]?"Array"!==o.util.type(e[r])||i[o.util.objId(e[r])]||(i[o.util.objId(e[r])]=!0,o.languages.DFS(e[r],t,r,i)):(i[o.util.objId(e[r])]=!0,o.languages.DFS(e[r],t,null,i)))}},plugins:{},highlightAll:function(e,t){o.highlightAllUnder(document,e,t)},highlightAllUnder:function(e,t,n){var i={callback:n,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};o.hooks.run("before-highlightall",i);for(var r,s=i.elements||e.querySelectorAll(i.selector),a=0;r=s[a++];)o.highlightElement(r,!0===t,i.callback)},highlightElement:function(t,i,r){for(var s,a,l=t;l&&!e.test(l.className);)l=l.parentNode;l&&(s=(l.className.match(e)||[,""])[1].toLowerCase(),a=o.languages[s]),t.className=t.className.replace(e,"").replace(/\s+/g," ")+" language-"+s,t.parentNode&&(l=t.parentNode,/pre/i.test(l.nodeName)&&(l.className=l.className.replace(e,"").replace(/\s+/g," ")+" language-"+s));var c={element:t,language:s,grammar:a,code:t.textContent};if(o.hooks.run("before-sanity-check",c),!c.code||!c.grammar)return c.code&&(o.hooks.run("before-highlight",c),c.element.textContent=c.code,o.hooks.run("after-highlight",c)),void o.hooks.run("complete",c);if(o.hooks.run("before-highlight",c),i&&n.Worker){var u=new Worker(o.filename);u.onmessage=function(e){c.highlightedCode=e.data,o.hooks.run("before-insert",c),c.element.innerHTML=c.highlightedCode,r&&r.call(c.element),o.hooks.run("after-highlight",c),o.hooks.run("complete",c)},u.postMessage(JSON.stringify({language:c.language,code:c.code,immediateClose:!0}))}else c.highlightedCode=o.highlight(c.code,c.grammar,c.language),o.hooks.run("before-insert",c),c.element.innerHTML=c.highlightedCode,r&&r.call(t),o.hooks.run("after-highlight",c),o.hooks.run("complete",c)},highlight:function(e,t,n){var r={code:e,grammar:t,language:n};return o.hooks.run("before-tokenize",r),r.tokens=o.tokenize(r.code,r.grammar),o.hooks.run("after-tokenize",r),i.stringify(o.util.encode(r.tokens),r.language)},matchGrammar:function(e,t,n,i,r,s,a){var l=o.Token;for(var c in n)if(n.hasOwnProperty(c)&&n[c]){if(c==a)return;var u=n[c];u="Array"===o.util.type(u)?u:[u];for(var d=0;d<u.length;++d){var h=u[d],p=h.inside,g=!!h.lookbehind,f=!!h.greedy,m=0,_=h.alias;if(f&&!h.pattern.global){var y=h.pattern.toString().match(/[imuy]*$/)[0];h.pattern=RegExp(h.pattern.source,y+"g")}h=h.pattern||h;for(var b=i,v=r;b<t.length;v+=t[b].length,++b){var k=t[b];if(t.length>e.length)return;if(!(k instanceof l)){if(f&&b!=t.length-1){if(h.lastIndex=v,!(T=h.exec(e)))break;for(var C=T.index+(g?T[1].length:0),I=T.index+T[0].length,S=b,w=v,E=t.length;E>S&&(I>w||!t[S].type&&!t[S-1].greedy);++S)C>=(w+=t[S].length)&&(++b,v=w);if(t[b]instanceof l)continue;N=S-b,k=e.slice(v,w),T.index-=v}else{h.lastIndex=0;var T=h.exec(k),N=1}if(T){g&&(m=T[1]?T[1].length:0);I=(C=T.index+m)+(T=T[0].slice(m)).length;var A=k.slice(0,C),x=k.slice(I),O=[b,N];A&&(++b,v+=A.length,O.push(A));var B=new l(c,p?o.tokenize(T,p):T,_,T,f);if(O.push(B),x&&O.push(x),Array.prototype.splice.apply(t,O),1!=N&&o.matchGrammar(e,t,n,b,v,!0,c),s)break}else if(s)break}}}}},tokenize:function(e,t){var n=[e],i=t.rest;if(i){for(var r in i)t[r]=i[r];delete t.rest}return o.matchGrammar(e,n,t,0,0,!1),n},hooks:{all:{},add:function(e,t){var n=o.hooks.all;n[e]=n[e]||[],n[e].push(t)},run:function(e,t){var n=o.hooks.all[e];if(n&&n.length)for(var i,r=0;i=n[r++];)i(t)}}},i=o.Token=function(e,t,n,o,i){this.type=e,this.content=t,this.alias=n,this.length=0|(o||"").length,this.greedy=!!i};if(i.stringify=function(e,t,n){if("string"==typeof e)return e;if("Array"===o.util.type(e))return e.map(function(n){return i.stringify(n,t,e)}).join("");var r={type:e.type,content:i.stringify(e.content,t,n),tag:"span",classes:["token",e.type],attributes:{},language:t,parent:n};if(e.alias){var s="Array"===o.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(r.classes,s)}o.hooks.run("wrap",r);var a=Object.keys(r.attributes).map(function(e){return e+'="'+(r.attributes[e]||"").replace(/"/g,"&quot;")+'"'}).join(" ");return"<"+r.tag+' class="'+r.classes.join(" ")+'"'+(a?" "+a:"")+">"+r.content+"</"+r.tag+">"},!n.document)return n.addEventListener?(o.disableWorkerMessageHandler||n.addEventListener("message",function(e){var t=JSON.parse(e.data),i=t.language,r=t.code,s=t.immediateClose;n.postMessage(o.highlight(r,o.languages[i],i)),s&&n.close()},!1),n.Prism):n.Prism;var r=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return r&&(o.filename=r.src,o.manual||r.hasAttribute("data-manual")||("loading"!==document.readyState?window.requestAnimationFrame?window.requestAnimationFrame(o.highlightAll):window.setTimeout(o.highlightAll,16):document.addEventListener("DOMContentLoaded",o.highlightAll))),n.Prism}();e.exports&&(e.exports=o),void 0!==t&&(t.Prism=o),o.languages.markup={comment:/<!--[\s\S]*?-->/,prolog:/<\?[\s\S]+?\?>/,doctype:/<!DOCTYPE[\s\S]+?>/i,cdata:/<!\[CDATA\[[\s\S]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\[\s\S]|(?!\1)[^\\])*\1|[^\s'">=]+))?)*\s*\/?>/i,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:("|')(?:\\[\s\S]|(?!\1)[^\\])*\1|[^\s'">=]+)/i,inside:{punctuation:[/^=/,{pattern:/(^|[^\\])["']/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i},o.languages.markup.tag.inside["attr-value"].inside.entity=o.languages.markup.entity,o.hooks.add("wrap",function(e){"entity"===e.type&&(e.attributes.title=e.content.replace(/&amp;/,"&"))}),o.languages.xml=o.languages.markup,o.languages.html=o.languages.markup,o.languages.mathml=o.languages.markup,o.languages.svg=o.languages.markup,o.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(?:;|(?=\s*\{))/i,inside:{rule:/@[\w-]+/}},url:/url\((?:(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1|.*?)\)/i,selector:/[^{}\s][^{};]*?(?=\s*\{)/,string:{pattern:/("|')(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},property:/[-_a-z\xA0-\uFFFF][-\w\xA0-\uFFFF]*(?=\s*:)/i,important:/\B!important\b/i,function:/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:]/},o.languages.css.atrule.inside.rest=o.languages.css,o.languages.markup&&(o.languages.insertBefore("markup","tag",{style:{pattern:/(<style[\s\S]*?>)[\s\S]*?(?=<\/style>)/i,lookbehind:!0,inside:o.languages.css,alias:"language-css",greedy:!0}}),o.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|')(?:\\[\s\S]|(?!\1)[^\\])*\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:o.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,inside:o.languages.css}},alias:"language-css"}},o.languages.markup.tag)),o.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,boolean:/\b(?:true|false)\b/,function:/\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+\.?\d*|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/},o.languages.javascript=o.languages.extend("clike",{"class-name":[o.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])[_$A-Z\xA0-\uFFFF][$\w\xA0-\uFFFF]*(?=\.(?:prototype|constructor))/,lookbehind:!0}],keyword:[{pattern:/((?:^|})\s*)(?:catch|finally)\b/,lookbehind:!0},/\b(?:as|async|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/],number:/\b(?:(?:0[xX][\dA-Fa-f]+|0[bB][01]+|0[oO][0-7]+)n?|\d+n|NaN|Infinity)\b|(?:\b\d+\.?\d*|\B\.\d+)(?:[Ee][+-]?\d+)?/,function:/[_$a-zA-Z\xA0-\uFFFF][$\w\xA0-\uFFFF]*(?=\s*\(|\.(?:apply|bind|call)\()/,operator:/-[-=]?|\+[+=]?|!=?=?|<<?=?|>>?>?=?|=(?:==?|>)?|&[&=]?|\|[|=]?|\*\*?=?|\/=?|~|\^=?|%=?|\?|\.{3}/}),o.languages.javascript["class-name"][0].pattern=/(\b(?:class|interface|extends|implements|instanceof|new)\s+)[\w.\\]+/,o.languages.insertBefore("javascript","keyword",{regex:{pattern:/((?:^|[^$\w\xA0-\uFFFF."'\])\s])\s*)\/(\[[^\]\r\n]+]|\\.|[^\/\\\[\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})\]]))/,lookbehind:!0,greedy:!0},"function-variable":{pattern:/[_$a-z\xA0-\uFFFF][$\w\xA0-\uFFFF]*(?=\s*[=:]\s*(?:function\b|(?:\([^()]*\)|[_$a-z\xA0-\uFFFF][$\w\xA0-\uFFFF]*)\s*=>))/i,alias:"function"},constant:/\b[A-Z][A-Z\d_]*\b/}),o.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\[\s\S]|\${[^}]+}|[^\\`])*`/,greedy:!0,inside:{interpolation:{pattern:/\${[^}]+}/,inside:{"interpolation-punctuation":{pattern:/^\${|}$/,alias:"punctuation"},rest:o.languages.javascript}},string:/[\s\S]+/}}}),o.languages.markup&&o.languages.insertBefore("markup","tag",{script:{pattern:/(<script[\s\S]*?>)[\s\S]*?(?=<\/script>)/i,lookbehind:!0,inside:o.languages.javascript,alias:"language-javascript",greedy:!0}}),o.languages.js=o.languages.javascript,o.languages.c=o.languages.extend("clike",{keyword:/\b(?:_Alignas|_Alignof|_Atomic|_Bool|_Complex|_Generic|_Imaginary|_Noreturn|_Static_assert|_Thread_local|asm|typeof|inline|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|int|long|register|return|short|signed|sizeof|static|struct|switch|typedef|union|unsigned|void|volatile|while)\b/,operator:/>>=?|<<=?|->|([-+&|:])\1|[?:~]|[-+*\/%&|^!=<>]=?/,number:/(?:\b0x[\da-f]+|(?:\b\d+\.?\d*|\B\.\d+)(?:e[+-]?\d+)?)[ful]*/i}),o.languages.insertBefore("c","string",{macro:{pattern:/(^\s*)#\s*[a-z]+(?:[^\r\n\\]|\\(?:\r\n|[\s\S]))*/im,lookbehind:!0,alias:"property",inside:{string:{pattern:/(#\s*include\s*)(?:<.+?>|("|')(?:\\?.)+?\2)/,lookbehind:!0},directive:{pattern:/(#\s*)\b(?:define|defined|elif|else|endif|error|ifdef|ifndef|if|import|include|line|pragma|undef|using)\b/,lookbehind:!0,alias:"keyword"}}},constant:/\b(?:__FILE__|__LINE__|__DATE__|__TIME__|__TIMESTAMP__|__func__|EOF|NULL|SEEK_CUR|SEEK_END|SEEK_SET|stdin|stdout|stderr)\b/}),delete o.languages.c["class-name"],delete o.languages.c.boolean,o.languages.csharp=o.languages.extend("clike",{keyword:/\b(?:abstract|add|alias|as|ascending|async|await|base|bool|break|byte|case|catch|char|checked|class|const|continue|decimal|default|delegate|descending|do|double|dynamic|else|enum|event|explicit|extern|false|finally|fixed|float|for|foreach|from|get|global|goto|group|if|implicit|in|int|interface|internal|into|is|join|let|lock|long|namespace|new|null|object|operator|orderby|out|override|params|partial|private|protected|public|readonly|ref|remove|return|sbyte|sealed|select|set|short|sizeof|stackalloc|static|string|struct|switch|this|throw|true|try|typeof|uint|ulong|unchecked|unsafe|ushort|using|value|var|virtual|void|volatile|where|while|yield)\b/,string:[{pattern:/@("|')(?:\1\1|\\[\s\S]|(?!\1)[^\\])*\1/,greedy:!0},{pattern:/("|')(?:\\.|(?!\1)[^\\\r\n])*?\1/,greedy:!0}],"class-name":[{pattern:/\b[A-Z]\w*(?:\.\w+)*\b(?=\s+\w+)/,inside:{punctuation:/\./}},{pattern:/(\[)[A-Z]\w*(?:\.\w+)*\b/,lookbehind:!0,inside:{punctuation:/\./}},{pattern:/(\b(?:class|interface)\s+[A-Z]\w*(?:\.\w+)*\s*:\s*)[A-Z]\w*(?:\.\w+)*\b/,lookbehind:!0,inside:{punctuation:/\./}},{pattern:/((?:\b(?:class|interface|new)\s+)|(?:catch\s+\())[A-Z]\w*(?:\.\w+)*\b/,lookbehind:!0,inside:{punctuation:/\./}}],number:/\b0x[\da-f]+\b|(?:\b\d+\.?\d*|\B\.\d+)f?/i}),o.languages.insertBefore("csharp","class-name",{"generic-method":{pattern:/\w+\s*<[^>\r\n]+?>\s*(?=\()/,inside:{function:/^\w+/,"class-name":{pattern:/\b[A-Z]\w*(?:\.\w+)*\b/,inside:{punctuation:/\./}},keyword:o.languages.csharp.keyword,punctuation:/[<>(),.:]/}},preprocessor:{pattern:/(^\s*)#.*/m,lookbehind:!0,alias:"property",inside:{directive:{pattern:/(\s*#)\b(?:define|elif|else|endif|endregion|error|if|line|pragma|region|undef|warning)\b/,lookbehind:!0,alias:"keyword"}}}}),o.languages.dotnet=o.languages.csharp,function(e){var t={variable:[{pattern:/\$?\(\([\s\S]+?\)\)/,inside:{variable:[{pattern:/(^\$\(\([\s\S]+)\)\)/,lookbehind:!0},/^\$\(\(/],number:/\b0x[\dA-Fa-f]+\b|(?:\b\d+\.?\d*|\B\.\d+)(?:[Ee]-?\d+)?/,operator:/--?|-=|\+\+?|\+=|!=?|~|\*\*?|\*=|\/=?|%=?|<<=?|>>=?|<=?|>=?|==?|&&?|&=|\^=?|\|\|?|\|=|\?|:/,punctuation:/\(\(?|\)\)?|,|;/}},{pattern:/\$\([^)]+\)|`[^`]+`/,greedy:!0,inside:{variable:/^\$\(|^`|\)$|`$/}},/\$(?:[\w#?*!@]+|\{[^}]+\})/i]};e.languages.bash={shebang:{pattern:/^#!\s*\/bin\/bash|^#!\s*\/bin\/sh/,alias:"important"},comment:{pattern:/(^|[^"{\\])#.*/,lookbehind:!0},string:[{pattern:/((?:^|[^<])<<\s*)["']?(\w+?)["']?\s*\r?\n(?:[\s\S])*?\r?\n\2/,lookbehind:!0,greedy:!0,inside:t},{pattern:/(["'])(?:\\[\s\S]|\$\([^)]+\)|`[^`]+`|(?!\1)[^\\])*\1/,greedy:!0,inside:t}],variable:t.variable,function:{pattern:/(^|[\s;|&])(?:alias|apropos|apt-get|aptitude|aspell|awk|basename|bash|bc|bg|builtin|bzip2|cal|cat|cd|cfdisk|chgrp|chmod|chown|chroot|chkconfig|cksum|clear|cmp|comm|command|cp|cron|crontab|csplit|curl|cut|date|dc|dd|ddrescue|df|diff|diff3|dig|dir|dircolors|dirname|dirs|dmesg|du|egrep|eject|enable|env|ethtool|eval|exec|expand|expect|export|expr|fdformat|fdisk|fg|fgrep|file|find|fmt|fold|format|free|fsck|ftp|fuser|gawk|getopts|git|grep|groupadd|groupdel|groupmod|groups|gzip|hash|head|help|hg|history|hostname|htop|iconv|id|ifconfig|ifdown|ifup|import|install|jobs|join|kill|killall|less|link|ln|locate|logname|logout|look|lpc|lpr|lprint|lprintd|lprintq|lprm|ls|lsof|make|man|mkdir|mkfifo|mkisofs|mknod|more|most|mount|mtools|mtr|mv|mmv|nano|netstat|nice|nl|nohup|notify-send|npm|nslookup|open|op|passwd|paste|pathchk|ping|pkill|popd|pr|printcap|printenv|printf|ps|pushd|pv|pwd|quota|quotacheck|quotactl|ram|rar|rcp|read|readarray|readonly|reboot|rename|renice|remsync|rev|rm|rmdir|rsync|screen|scp|sdiff|sed|seq|service|sftp|shift|shopt|shutdown|sleep|slocate|sort|source|split|ssh|stat|strace|su|sudo|sum|suspend|sync|tail|tar|tee|test|time|timeout|times|touch|top|traceroute|trap|tr|tsort|tty|type|ulimit|umask|umount|unalias|uname|unexpand|uniq|units|unrar|unshar|uptime|useradd|userdel|usermod|users|uuencode|uudecode|v|vdir|vi|vmstat|wait|watch|wc|wget|whereis|which|who|whoami|write|xargs|xdg-open|yes|zip)(?=$|[\s;|&])/,lookbehind:!0},keyword:{pattern:/(^|[\s;|&])(?:let|:|\.|if|then|else|elif|fi|for|break|continue|while|in|case|function|select|do|done|until|echo|exit|return|set|declare)(?=$|[\s;|&])/,lookbehind:!0},boolean:{pattern:/(^|[\s;|&])(?:true|false)(?=$|[\s;|&])/,lookbehind:!0},operator:/&&?|\|\|?|==?|!=?|<<<?|>>|<=?|>=?|=~/,punctuation:/\$?\(\(?|\)\)?|\.\.|[{}[\];]/};var n=t.variable[1].inside;n.string=e.languages.bash.string,n.function=e.languages.bash.function,n.keyword=e.languages.bash.keyword,n.boolean=e.languages.bash.boolean,n.operator=e.languages.bash.operator,n.punctuation=e.languages.bash.punctuation,e.languages.shell=e.languages.bash}(o),o.languages.cpp=o.languages.extend("c",{keyword:/\b(?:alignas|alignof|asm|auto|bool|break|case|catch|char|char16_t|char32_t|class|compl|const|constexpr|const_cast|continue|decltype|default|delete|do|double|dynamic_cast|else|enum|explicit|export|extern|float|for|friend|goto|if|inline|int|int8_t|int16_t|int32_t|int64_t|uint8_t|uint16_t|uint32_t|uint64_t|long|mutable|namespace|new|noexcept|nullptr|operator|private|protected|public|register|reinterpret_cast|return|short|signed|sizeof|static|static_assert|static_cast|struct|switch|template|this|thread_local|throw|try|typedef|typeid|typename|union|unsigned|using|virtual|void|volatile|wchar_t|while)\b/,boolean:/\b(?:true|false)\b/,operator:/>>=?|<<=?|->|([-+&|:])\1|[?:~]|[-+*\/%&|^!=<>]=?|\b(?:and|and_eq|bitand|bitor|not|not_eq|or|or_eq|xor|xor_eq)\b/}),o.languages.insertBefore("cpp","keyword",{"class-name":{pattern:/(class\s+)\w+/i,lookbehind:!0}}),o.languages.insertBefore("cpp","string",{"raw-string":{pattern:/R"([^()\\ ]{0,16})\([\s\S]*?\)\1"/,alias:"string",greedy:!0}}),function(e){e.languages.ruby=e.languages.extend("clike",{comment:[/#.*/,{pattern:/^=begin(?:\r?\n|\r)(?:.*(?:\r?\n|\r))*?=end/m,greedy:!0}],keyword:/\b(?:alias|and|BEGIN|begin|break|case|class|def|define_method|defined|do|each|else|elsif|END|end|ensure|false|for|if|in|module|new|next|nil|not|or|protected|private|public|raise|redo|require|rescue|retry|return|self|super|then|throw|true|undef|unless|until|when|while|yield)\b/});var t={pattern:/#\{[^}]+\}/,inside:{delimiter:{pattern:/^#\{|\}$/,alias:"tag"},rest:e.languages.ruby}};e.languages.insertBefore("ruby","keyword",{regex:[{pattern:/%r([^a-zA-Z0-9\s{(\[<])(?:(?!\1)[^\\]|\\[\s\S])*\1[gim]{0,3}/,greedy:!0,inside:{interpolation:t}},{pattern:/%r\((?:[^()\\]|\\[\s\S])*\)[gim]{0,3}/,greedy:!0,inside:{interpolation:t}},{pattern:/%r\{(?:[^#{}\\]|#(?:\{[^}]+\})?|\\[\s\S])*\}[gim]{0,3}/,greedy:!0,inside:{interpolation:t}},{pattern:/%r\[(?:[^\[\]\\]|\\[\s\S])*\][gim]{0,3}/,greedy:!0,inside:{interpolation:t}},{pattern:/%r<(?:[^<>\\]|\\[\s\S])*>[gim]{0,3}/,greedy:!0,inside:{interpolation:t}},{pattern:/(^|[^\/])\/(?!\/)(\[.+?]|\\.|[^\/\\\r\n])+\/[gim]{0,3}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0,greedy:!0}],variable:/[@$]+[a-zA-Z_]\w*(?:[?!]|\b)/,symbol:{pattern:/(^|[^:]):[a-zA-Z_]\w*(?:[?!]|\b)/,lookbehind:!0}}),e.languages.insertBefore("ruby","number",{builtin:/\b(?:Array|Bignum|Binding|Class|Continuation|Dir|Exception|FalseClass|File|Stat|Fixnum|Float|Hash|Integer|IO|MatchData|Method|Module|NilClass|Numeric|Object|Proc|Range|Regexp|String|Struct|TMS|Symbol|ThreadGroup|Thread|Time|TrueClass)\b/,constant:/\b[A-Z]\w*(?:[?!]|\b)/}),e.languages.ruby.string=[{pattern:/%[qQiIwWxs]?([^a-zA-Z0-9\s{(\[<])(?:(?!\1)[^\\]|\\[\s\S])*\1/,greedy:!0,inside:{interpolation:t}},{pattern:/%[qQiIwWxs]?\((?:[^()\\]|\\[\s\S])*\)/,greedy:!0,inside:{interpolation:t}},{pattern:/%[qQiIwWxs]?\{(?:[^#{}\\]|#(?:\{[^}]+\})?|\\[\s\S])*\}/,greedy:!0,inside:{interpolation:t}},{pattern:/%[qQiIwWxs]?\[(?:[^\[\]\\]|\\[\s\S])*\]/,greedy:!0,inside:{interpolation:t}},{pattern:/%[qQiIwWxs]?<(?:[^<>\\]|\\[\s\S])*>/,greedy:!0,inside:{interpolation:t}},{pattern:/("|')(?:#\{[^}]+\}|\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0,inside:{interpolation:t}}]}(o),o.languages["markup-templating"]={},Object.defineProperties(o.languages["markup-templating"],{buildPlaceholders:{value:function(e,t,n,i){e.language===t&&(e.tokenStack=[],e.code=e.code.replace(n,function(n){if("function"==typeof i&&!i(n))return n;for(var o=e.tokenStack.length;-1!==e.code.indexOf("___"+t.toUpperCase()+o+"___");)++o;return e.tokenStack[o]=n,"___"+t.toUpperCase()+o+"___"}),e.grammar=o.languages.markup)}},tokenizePlaceholders:{value:function(e,t){if(e.language===t&&e.tokenStack){e.grammar=o.languages[t];var n=0,i=Object.keys(e.tokenStack),r=function(s){if(!(n>=i.length))for(var a=0;a<s.length;a++){var l=s[a];if("string"==typeof l||l.content&&"string"==typeof l.content){var c=i[n],u=e.tokenStack[c],d="string"==typeof l?l:l.content,h=d.indexOf("___"+t.toUpperCase()+c+"___");if(h>-1){++n;var p,g=d.substring(0,h),f=new o.Token(t,o.tokenize(u,e.grammar,t),"language-"+t,u),m=d.substring(h+("___"+t.toUpperCase()+c+"___").length);if(g||m?(p=[g,f,m].filter(function(e){return!!e}),r(p)):p=f,"string"==typeof l?Array.prototype.splice.apply(s,[a,1].concat(p)):l.content=p,n>=i.length)break}}else l.content&&"string"!=typeof l.content&&r(l.content)}};r(e.tokens)}}}}),o.languages.go=o.languages.extend("clike",{keyword:/\b(?:break|case|chan|const|continue|default|defer|else|fallthrough|for|func|go(?:to)?|if|import|interface|map|package|range|return|select|struct|switch|type|var)\b/,builtin:/\b(?:bool|byte|complex(?:64|128)|error|float(?:32|64)|rune|string|u?int(?:8|16|32|64)?|uintptr|append|cap|close|complex|copy|delete|imag|len|make|new|panic|print(?:ln)?|real|recover)\b/,boolean:/\b(?:_|iota|nil|true|false)\b/,operator:/[*\/%^!=]=?|\+[=+]?|-[=-]?|\|[=|]?|&(?:=|&|\^=?)?|>(?:>=?|=)?|<(?:<=?|=|-)?|:=|\.\.\./,number:/(?:\b0x[a-f\d]+|(?:\b\d+\.?\d*|\B\.\d+)(?:e[-+]?\d+)?)i?/i,string:{pattern:/(["'`])(\\[\s\S]|(?!\1)[^\\])*\1/,greedy:!0}}),delete o.languages.go["class-name"],o.languages.java=o.languages.extend("clike",{keyword:/\b(?:var|abstract|continue|for|new|switch|assert|default|goto|package|synchronized|boolean|do|if|private|this|break|double|implements|protected|throw|byte|else|import|public|throws|case|enum|instanceof|return|transient|catch|extends|int|short|try|char|final|interface|static|void|class|finally|long|strictfp|volatile|const|float|native|super|while)\b/,number:/\b0b[01]+\b|\b0x[\da-f]*\.?[\da-fp-]+\b|(?:\b\d+\.?\d*|\B\.\d+)(?:e[+-]?\d+)?[df]?/i,operator:{pattern:/(^|[^.])(?:<<=?|>>>?=?|->|([-+&|])\2|[?:~]|[-+*\/%&|^!=<>]=?)/m,lookbehind:!0}}),o.languages.insertBefore("java","function",{annotation:{alias:"punctuation",pattern:/(^|[^.])@\w+/,lookbehind:!0}}),o.languages.insertBefore("java","class-name",{generics:{pattern:/<\s*\w+(?:\.\w+)?(?:\s*,\s*\w+(?:\.\w+)?)*>/i,alias:"function",inside:{keyword:o.languages.java.keyword,punctuation:/[<>(),.:]/}}}),o.languages.json={property:/"(?:\\.|[^\\"\r\n])*"(?=\s*:)/i,string:{pattern:/"(?:\\.|[^\\"\r\n])*"(?!\s*:)/,greedy:!0},number:/-?\d+\.?\d*([Ee][+-]?\d+)?/,punctuation:/[{}[\],]/,operator:/:/g,boolean:/\b(?:true|false)\b/i,null:/\bnull\b/i},o.languages.jsonp=o.languages.json,function(e){e.languages.kotlin=e.languages.extend("clike",{keyword:{pattern:/(^|[^.])\b(?:abstract|actual|annotation|as|break|by|catch|class|companion|const|constructor|continue|crossinline|data|do|dynamic|else|enum|expect|external|final|finally|for|fun|get|if|import|in|infix|init|inline|inner|interface|internal|is|lateinit|noinline|null|object|open|operator|out|override|package|private|protected|public|reified|return|sealed|set|super|suspend|tailrec|this|throw|to|try|typealias|val|var|vararg|when|where|while)\b/,lookbehind:!0},function:[/\w+(?=\s*\()/,{pattern:/(\.)\w+(?=\s*\{)/,lookbehind:!0}],number:/\b(?:0[xX][\da-fA-F]+(?:_[\da-fA-F]+)*|0[bB][01]+(?:_[01]+)*|\d+(?:_\d+)*(?:\.\d+(?:_\d+)*)?(?:[eE][+-]?\d+(?:_\d+)*)?[fFL]?)\b/,operator:/\+[+=]?|-[-=>]?|==?=?|!(?:!|==?)?|[\/*%<>]=?|[?:]:?|\.\.|&&|\|\||\b(?:and|inv|or|shl|shr|ushr|xor)\b/}),delete e.languages.kotlin["class-name"],e.languages.insertBefore("kotlin","string",{"raw-string":{pattern:/("""|''')[\s\S]*?\1/,alias:"string"}}),e.languages.insertBefore("kotlin","keyword",{annotation:{pattern:/\B@(?:\w+:)?(?:[A-Z]\w*|\[[^\]]+\])/,alias:"builtin"}}),e.languages.insertBefore("kotlin","function",{label:{pattern:/\w+@|@\w+/,alias:"symbol"}});var t=[{pattern:/\$\{[^}]+\}/,inside:{delimiter:{pattern:/^\$\{|\}$/,alias:"variable"},rest:e.languages.kotlin}},{pattern:/\$\w+/,alias:"variable"}];e.languages.kotlin.string.inside=e.languages.kotlin["raw-string"].inside={interpolation:t}}(o),o.languages.markdown=o.languages.extend("markup",{}),o.languages.insertBefore("markdown","prolog",{blockquote:{pattern:/^>(?:[\t ]*>)*/m,alias:"punctuation"},code:[{pattern:/^(?: {4}|\t).+/m,alias:"keyword"},{pattern:/``.+?``|`[^`\n]+`/,alias:"keyword"}],title:[{pattern:/\w+.*(?:\r?\n|\r)(?:==+|--+)/,alias:"important",inside:{punctuation:/==+$|--+$/}},{pattern:/(^\s*)#+.+/m,lookbehind:!0,alias:"important",inside:{punctuation:/^#+|#+$/}}],hr:{pattern:/(^\s*)([*-])(?:[\t ]*\2){2,}(?=\s*$)/m,lookbehind:!0,alias:"punctuation"},list:{pattern:/(^\s*)(?:[*+-]|\d+\.)(?=[\t ].)/m,lookbehind:!0,alias:"punctuation"},"url-reference":{pattern:/!?\[[^\]]+\]:[\t ]+(?:\S+|<(?:\\.|[^>\\])+>)(?:[\t ]+(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\)))?/,inside:{variable:{pattern:/^(!?\[)[^\]]+/,lookbehind:!0},string:/(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\))$/,punctuation:/^[\[\]!:]|[<>]/},alias:"url"},bold:{pattern:/(^|[^\\])(\*\*|__)(?:(?:\r?\n|\r)(?!\r?\n|\r)|.)+?\2/,lookbehind:!0,inside:{punctuation:/^\*\*|^__|\*\*$|__$/}},italic:{pattern:/(^|[^\\])([*_])(?:(?:\r?\n|\r)(?!\r?\n|\r)|.)+?\2/,lookbehind:!0,inside:{punctuation:/^[*_]|[*_]$/}},url:{pattern:/!?\[[^\]]+\](?:\([^\s)]+(?:[\t ]+"(?:\\.|[^"\\])*")?\)| ?\[[^\]\n]*\])/,inside:{variable:{pattern:/(!?\[)[^\]]+(?=\]$)/,lookbehind:!0},string:{pattern:/"(?:\\.|[^"\\])*"(?=\)$)/}}}}),o.languages.markdown.bold.inside.url=o.languages.markdown.url,o.languages.markdown.italic.inside.url=o.languages.markdown.url,o.languages.markdown.bold.inside.italic=o.languages.markdown.italic,o.languages.markdown.italic.inside.bold=o.languages.markdown.bold,o.languages.matlab={comment:[/%\{[\s\S]*?\}%/,/%.+/],string:{pattern:/\B'(?:''|[^'\r\n])*'/,greedy:!0},number:/(?:\b\d+\.?\d*|\B\.\d+)(?:[eE][+-]?\d+)?(?:[ij])?|\b[ij]\b/,keyword:/\b(?:break|case|catch|continue|else|elseif|end|for|function|if|inf|NaN|otherwise|parfor|pause|pi|return|switch|try|while)\b/,function:/(?!\d)\w+(?=\s*\()/,operator:/\.?[*^\/\\']|[+\-:@]|[<>=~]=?|&&?|\|\|?/,punctuation:/\.{3}|[.,;\[\](){}!]/},o.languages.objectivec=o.languages.extend("c",{keyword:/\b(?:asm|typeof|inline|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|int|long|register|return|short|signed|sizeof|static|struct|switch|typedef|union|unsigned|void|volatile|while|in|self|super)\b|(?:@interface|@end|@implementation|@protocol|@class|@public|@protected|@private|@property|@try|@catch|@finally|@throw|@synthesize|@dynamic|@selector)\b/,string:/("|')(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1|@"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,operator:/-[->]?|\+\+?|!=?|<<?=?|>>?=?|==?|&&?|\|\|?|[~^%?*\/@]/}),function(e){e.languages.php=e.languages.extend("clike",{keyword:/\b(?:and|or|xor|array|as|break|case|cfunction|class|const|continue|declare|default|die|do|else|elseif|enddeclare|endfor|endforeach|endif|endswitch|endwhile|extends|for|foreach|function|include|include_once|global|if|new|return|static|switch|use|require|require_once|var|while|abstract|interface|public|implements|private|protected|parent|throw|null|echo|print|trait|namespace|final|yield|goto|instanceof|finally|try|catch)\b/i,constant:/\b[A-Z0-9_]{2,}\b/,comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|\/\/.*)/,lookbehind:!0}}),e.languages.insertBefore("php","string",{"shell-comment":{pattern:/(^|[^\\])#.*/,lookbehind:!0,alias:"comment"}}),e.languages.insertBefore("php","keyword",{delimiter:{pattern:/\?>|<\?(?:php|=)?/i,alias:"important"},variable:/\$+(?:\w+\b|(?={))/i,package:{pattern:/(\\|namespace\s+|use\s+)[\w\\]+/,lookbehind:!0,inside:{punctuation:/\\/}}}),e.languages.insertBefore("php","operator",{property:{pattern:/(->)[\w]+/,lookbehind:!0}});var t={pattern:/{\$(?:{(?:{[^{}]+}|[^{}]+)}|[^{}])+}|(^|[^\\{])\$+(?:\w+(?:\[.+?]|->\w+)*)/,lookbehind:!0,inside:{rest:e.languages.php}};e.languages.insertBefore("php","string",{"nowdoc-string":{pattern:/<<<'([^']+)'(?:\r\n?|\n)(?:.*(?:\r\n?|\n))*?\1;/,greedy:!0,alias:"string",inside:{delimiter:{pattern:/^<<<'[^']+'|[a-z_]\w*;$/i,alias:"symbol",inside:{punctuation:/^<<<'?|[';]$/}}}},"heredoc-string":{pattern:/<<<(?:"([^"]+)"(?:\r\n?|\n)(?:.*(?:\r\n?|\n))*?\1;|([a-z_]\w*)(?:\r\n?|\n)(?:.*(?:\r\n?|\n))*?\2;)/i,greedy:!0,alias:"string",inside:{delimiter:{pattern:/^<<<(?:"[^"]+"|[a-z_]\w*)|[a-z_]\w*;$/i,alias:"symbol",inside:{punctuation:/^<<<"?|[";]$/}},interpolation:t}},"single-quoted-string":{pattern:/'(?:\\[\s\S]|[^\\'])*'/,greedy:!0,alias:"string"},"double-quoted-string":{pattern:/"(?:\\[\s\S]|[^\\"])*"/,greedy:!0,alias:"string",inside:{interpolation:t}}}),delete e.languages.php.string,e.hooks.add("before-tokenize",function(t){if(/(?:<\?php|<\?)/gi.test(t.code)){e.languages["markup-templating"].buildPlaceholders(t,"php",/(?:<\?php|<\?)[\s\S]*?(?:\?>|$)/gi)}}),e.hooks.add("after-tokenize",function(t){e.languages["markup-templating"].tokenizePlaceholders(t,"php")})}(o),o.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},variable:[{pattern:/@(["'`])(?:\\[\s\S]|(?!\1)[^\\])+\1/,greedy:!0},/@[\w.$]+/],string:{pattern:/(^|[^@\\])("|')(?:\\[\s\S]|(?!\2)[^\\]|\2\2)*\2/,greedy:!0,lookbehind:!0},function:/\b(?:AVG|COUNT|FIRST|FORMAT|LAST|LCASE|LEN|MAX|MID|MIN|MOD|NOW|ROUND|SUM|UCASE)(?=\s*\()/i,keyword:/\b(?:ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR(?:ACTER|SET)?|CHECK(?:POINT)?|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMNS?|COMMENT|COMMIT(?:TED)?|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS(?:TABLE)?|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|CYCLE|DATA(?:BASES?)?|DATE(?:TIME)?|DAY|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITERS?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE|ELSE(?:IF)?|ENABLE|ENCLOSED|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPED?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|HOUR|IDENTITY(?:_INSERT|COL)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTERVAL|INTO|INVOKER|ISOLATION|ITERATE|JOIN|KEYS?|KILL|LANGUAGE|LAST|LEAVE|LEFT|LEVEL|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|LOOP|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MINUTE|MODE|MODIFIES|MODIFY|MONTH|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL|NATURAL|NCHAR|NEXT|NO|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREPARE|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READS?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEAT(?:ABLE)?|REPLACE|REPLICATION|REQUIRE|RESIGNAL|RESTORE|RESTRICT|RETURNS?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SECOND|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|SQL|START(?:ING)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED|TEXT(?:SIZE)?|THEN|TIME(?:STAMP)?|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNLOCK|UNPIVOT|UNSIGNED|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?|YEAR)\b/i,boolean:/\b(?:TRUE|FALSE|NULL)\b/i,number:/\b0x[\da-f]+\b|\b\d+\.?\d*|\B\.\d+\b/i,operator:/[-+*\/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|IN|LIKE|NOT|OR|IS|DIV|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,punctuation:/[;[\]()`,.]/},o.languages.python={comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0},"triple-quoted-string":{pattern:/("""|''')[\s\S]+?\1/,greedy:!0,alias:"string"},string:{pattern:/("|')(?:\\.|(?!\1)[^\\\r\n])*\1/,greedy:!0},function:{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_]\w*(?=\s*\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)\w+/i,lookbehind:!0},keyword:/\b(?:as|assert|async|await|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|nonlocal|pass|print|raise|return|try|while|with|yield)\b/,builtin:/\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\b/,boolean:/\b(?:True|False|None)\b/,number:/(?:\b(?=\d)|\B(?=\.))(?:0[bo])?(?:(?:\d|0x[\da-f])[\da-f]*\.?\d*|\.\d+)(?:e[+-]?\d+)?j?\b/i,operator:/[-+%=]=?|!=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]|\b(?:or|and|not)\b/,punctuation:/[{}[\];(),.:]/},o.languages.r={comment:/#.*/,string:{pattern:/(['"])(?:\\.|(?!\1)[^\\\r\n])*\1/,greedy:!0},"percent-operator":{pattern:/%[^%\s]*%/,alias:"operator"},boolean:/\b(?:TRUE|FALSE)\b/,ellipsis:/\.\.(?:\.|\d+)/,number:[/\b(?:NaN|Inf)\b/,/(?:\b0x[\dA-Fa-f]+(?:\.\d*)?|\b\d+\.?\d*|\B\.\d+)(?:[EePp][+-]?\d+)?[iL]?/],keyword:/\b(?:if|else|repeat|while|function|for|in|next|break|NULL|NA|NA_integer_|NA_real_|NA_complex_|NA_character_)\b/,operator:/->?>?|<(?:=|<?-)?|[>=!]=?|::?|&&?|\|\|?|[+*\/^$@~]/,punctuation:/[(){}\[\],;]/},o.languages.typescript=o.languages.extend("javascript",{keyword:/\b(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield|module|declare|constructor|namespace|abstract|require|type)\b/,builtin:/\b(?:string|Function|any|number|boolean|Array|symbol|console)\b/}),o.languages.ts=o.languages.typescript,o.languages.scala=o.languages.extend("java",{keyword:/<-|=>|\b(?:abstract|case|catch|class|def|do|else|extends|final|finally|for|forSome|if|implicit|import|lazy|match|new|null|object|override|package|private|protected|return|sealed|self|super|this|throw|trait|try|type|val|var|while|with|yield)\b/,string:[{pattern:/"""[\s\S]*?"""/,greedy:!0},{pattern:/("|')(?:\\.|(?!\1)[^\\\r\n])*\1/,greedy:!0}],builtin:/\b(?:String|Int|Long|Short|Byte|Boolean|Double|Float|Char|Any|AnyRef|AnyVal|Unit|Nothing)\b/,number:/\b0x[\da-f]*\.?[\da-f]+|(?:\b\d+\.?\d*|\B\.\d+)(?:e\d+)?[dfl]?/i,symbol:/'[^\d\s\\]\w*/}),delete o.languages.scala["class-name"],delete o.languages.scala.function,o.languages.swift=o.languages.extend("clike",{string:{pattern:/("|')(\\(?:\((?:[^()]|\([^)]+\))+\)|\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0,inside:{interpolation:{pattern:/\\\((?:[^()]|\([^)]+\))+\)/,inside:{delimiter:{pattern:/^\\\(|\)$/,alias:"variable"}}}}},keyword:/\b(?:as|associativity|break|case|catch|class|continue|convenience|default|defer|deinit|didSet|do|dynamic(?:Type)?|else|enum|extension|fallthrough|final|for|func|get|guard|if|import|in|infix|init|inout|internal|is|lazy|left|let|mutating|new|none|nonmutating|operator|optional|override|postfix|precedence|prefix|private|protocol|public|repeat|required|rethrows|return|right|safe|self|Self|set|static|struct|subscript|super|switch|throws?|try|Type|typealias|unowned|unsafe|var|weak|where|while|willSet|__(?:COLUMN__|FILE__|FUNCTION__|LINE__))\b/,number:/\b(?:[\d_]+(?:\.[\de_]+)?|0x[a-f0-9_]+(?:\.[a-f0-9p_]+)?|0b[01_]+|0o[0-7_]+)\b/i,constant:/\b(?:nil|[A-Z_]{2,}|k[A-Z][A-Za-z_]+)\b/,atrule:/@\b(?:IB(?:Outlet|Designable|Action|Inspectable)|class_protocol|exported|noreturn|NS(?:Copying|Managed)|objc|UIApplicationMain|auto_closure)\b/,builtin:/\b(?:[A-Z]\S+|abs|advance|alignof(?:Value)?|assert|contains|count(?:Elements)?|debugPrint(?:ln)?|distance|drop(?:First|Last)|dump|enumerate|equal|filter|find|first|getVaList|indices|isEmpty|join|last|lexicographicalCompare|map|max(?:Element)?|min(?:Element)?|numericCast|overlaps|partition|print(?:ln)?|reduce|reflect|reverse|sizeof(?:Value)?|sort(?:ed)?|split|startsWith|stride(?:of(?:Value)?)?|suffix|swap|toDebugString|toString|transcode|underestimateCount|unsafeBitCast|with(?:ExtendedLifetime|Unsafe(?:MutablePointers?|Pointers?)|VaList))\b/}),o.languages.swift.string.inside.interpolation.inside.rest=o.languages.swift}).call(this,n(75))},function(e,t,n){var o;void 0===(o=function(e){var t=n(38),o=n(128);return t.extend({className:"block-view unknown-view",initialize:function(){t.prototype.initialize.apply(this,arguments)},render:function(){this.$el.html("<div>当前版本不支持的内容</div>"),t.prototype.render.apply(this,arguments)},convertToNativeRange:function(){},parseNativeRange:function(e,t,n){if(n)return new o({block:t})}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(18),o=n(7),i=n(0),r=n(12);return t.View.extend({className:"highlight-view",_baseRect:null,_focusIndex:-1,_list:[],initialize:function(){i.bindAll(this,"_extractData","onHide","nextHighlight")},_extractData:function(e){var t=this,n=e.getClientRects(),s=[];i.each(n,function(e){e.width<2||s.push(o(r.render("common","high_light_item",{top:e.top-t._baseRect.top-1,left:e.left-t._baseRect.left-2,height:e.height-2,width:e.width})).appendTo(t.$el).get(0))}),t._list.push(o(s))},_reset:function(){this._list=[],this._focusIndex=-1,this.$el.empty()},showHighlight:function(e,t){return e&&t?0===t.length?(this._reset(),void this.onHide()):(this.$el.empty(),this.$el.show(),this._list=[],this._baseRect=this.el.getBoundingClientRect(),i.each(t,this._extractData),this._focusIndex=0,this._list[this._focusIndex].addClass("focused"),void this._list[this._focusIndex].get(0).scrollIntoViewIfNeeded()):(this._reset(),void this.onHide())},nextHighlight:function(e){0!==this._list.length&&(this.$el.show(),e=e||1,this._list[this._focusIndex].removeClass("focused"),this._focusIndex=(this._focusIndex+this._list.length+e)%this._list.length,this._list[this._focusIndex].addClass("focused"),this._list[this._focusIndex].get(0).scrollIntoViewIfNeeded())},preHighlight:function(){this.nextHighlight(-1)},onHide:function(){this.$el.hide()}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(e){var t=n(18),o=n(12),i=n(7),r=n(0),s=n(1),a=n(109),l=n(169),c=i('<div class="collab-editing-view-wrapper"><div class="collab-session-view"></div></div>'),u="header-footer-view";function d(e){var t=null;do{r.contains(e.classList,u)&&(r.contains(e.classList,"page-header")?t="header":r.contains(e.classList,"page-footer")&&(t="footer")),e=e.parentElement}while(e);return t}return t.View.extend({className:u,name:"header-footer",_focus:!1,_isReadOnly:!1,$input:null,events:{"focus .header-footer-input":"_onFocus","blur .header-footer-input":"_onBlur","keydown .header-footer-input":"_onKeyDown","input .header-footer-input":"_onTextInput","paste .header-footer-input":"_onPaste"},initialize:function(e,t){e=e||{};this.block=e,this._contentOnFocus=null,this._keyMonitor=new a({el:this.el}),this.isFooter=!0===e.isFooter,this._isReadOnly=!!t,r.bindAll(this,"_onLockedChange","_updateViewByModel","_onPaste","_onHighlight"),e.on("high-light",this._onHighlight),e.on("locked-change",this._onLockedChange),e.on("change",this._updateViewByModel),this.render()},render:function(){var e,t=this.block,n=this.$el,i="page-"+(t.isFooter?"footer":"header"),r="点击编辑"+(t.isFooter?"页脚":"页眉");e=o.render("common",this.name,{readonly:this._isReadOnly}),n.html(e),n.addClass(i).attr("title",r),this.$input=n.find(".header-footer-input"),this._updateViewByModel(t.getContent(),t.getAlign()),this._updateLockState(this.isLocked())},_updateViewByModel:function(e,t){this._focus||void 0===e||this.setContent(e),void 0!==t&&this.setAlign(t)},_onHighlight:function(e,t,n){var o=this.block.getHighlight(e,t);o&&this._convertToData(o,n)},_convertToData:function(e,t){var n,o=this.$input.get(0).firstChild;r.each(e,function(e){(n=document.createRange()).setStart(o,e.start),n.setEnd(o,e.end),t(n)})},_onPaste:function(e){var t,n,o=e.originalEvent;e.preventDefault(),o.clipboardData&&o.clipboardData.getData?(n=(t=o.clipboardData.getData("text/plain"))&&t.replace(/\r?\n/g," "),document.execCommand("insertHTML",!1,n)):window.clipboardData&&window.clipboardData.getData&&(t=window.clipboardData.getData("Text"),l(t))},_onLockedChange:function(e){this._updateLockState(this.isLocked()),this._updateLockIndicator(this.block.isLocked(),e),this.trigger("locked-change")},isLocked:function(){var e=this.block,t=!1;return e&&(t=e.isLocked()),t},_updateLockIndicator:function(e,t){var n=c.clone(),o=n.find(".collab-session-view"),i=t&&t.lockColor,r=t&&t.nickname;e?(this.$el.addClass("collab-editing-view"),void 0!==r&&(o.css("background-color",i),o.text(r),this.$el.find(".collab-editing-view-wrapper").remove(),this.$el.prepend(n))):(this.$el.removeClass("collab-editing-view"),this.$el.find(".collab-editing-view-wrapper").remove())},_updateLockState:function(e){e?this.$el.addClass("collab-locked"):this.$el.removeClass("collab-locked")},_onTextInput:function(){this.trigger("text-input",this.$input.text())},_onFocus:function(){this._focus=!0,this._contentOnFocus=this.$input.text()||"",s.log("content on focus: "+this._contentOnFocus),this.trigger("focus")},_onBlur:function(){var e=this.$input.text();this._focus=!1,s.log("content on blur: "+e),e!==this._contentOnFocus&&this.trigger("text-change",e),this.trigger("blur"),this._contentOnFocus=null},_stopPropagation:function(e){e.stopPropagation()},_onKeyDown:function(e){var t=this._keyMonitor;t.isEventMatchKey(e,"enter")?(e.stopPropagation(),e.preventDefault(),this.$el.blur()):t.isEventMatchKey(e,"tab")?(e.stopPropagation(),e.preventDefault(),document.execCommand("insertHTML",!1,"&emsp;")):t.isEventMatchKey(e,"mod+z")||t.isEventMatchKey(e,"mod+y")?(e.stopPropagation(),e.preventDefault()):r.some(["mod+s","mod+shift+r","mod+f"],function(n){return t.isEventMatchKey(e,n)})?e.preventDefault():e.stopPropagation()},getAlign:function(){return this.$input.css("text-align")},setAlign:function(e){var t="left"===e||"right"===e?e:"center";this.$input.css("text-align",t)},setContent:function(e){this.$input.text(e)},getContent:function(){return this.$input.text()},checkChange:function(){var e=this.$input.text()||"";null!=this._contentOnFocus&&e!==this._contentOnFocus&&(this.trigger("text-change",e),this._contentOnFocus=e)}},{isHeaderView:function(e){return"header"===d(e)},isFooterView:function(e){return"footer"===d(e)}})}.call(t,n,t,e))||(e.exports=o)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(17),n(0)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.stop=function(){this.trigger("progress-stop")},t.prototype.updateContentSetProgress=function(e){o.isNumber(e.percent)&&this.trigger("progress-update",e)},t.prototype.initialize=function(e){},t}(n)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(512)],void 0===(i=function(e,t,n,o){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.canRedo=function(){return this.coreEditor.canRedo()},t.prototype.canUndo=function(){return this.coreEditor.canUndo()},t.prototype.clearHighlight=function(){this.coreEditor.clearHighlight()},t.prototype.focusHighlight=function(e){!0!==e?this.coreEditor.nextHighlight():this.coreEditor.preHighlight()},t.prototype.getPlain=function(){return this.coreEditor.getPlainContent()},t.prototype.highlight=function(e,t){e&&0!==e.length&&this.coreEditor.highlight(e,t)},t.prototype.insertAttachment=function(e){this.coreEditor.execCommand("comp.InsertAttachment",n.extend({retainStartBlock:!0},e))},t.prototype.insertImage=function(e){this.coreEditor.execCommand("comp.InsertImage",{retainStartBlock:!0,src:e})},t.prototype.redo=function(){return this.coreEditor.redo()},t.prototype.setDefaultFont=function(e,t,n){t=parseInt(t+"",10),this.coreEditor.setDefaultFont(e,t,n)},t.prototype.undo=function(){return this.coreEditor.undo()},t.prototype.setPrintNote=function(){this.coreEditor.setPrintNote(!0)},t.prototype.getNoteContentStatus=function(){return this.coreEditor.getNoteContentStatus()},t.prototype.getFirstLineTextContent=function(){return this.coreEditor.getFirstLineTextContent()},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(6),n(513),n(1)],void 0===(i=function(e,t,n,o,i){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.buildCollabSession=function(e,t){var n,o=0;try{if(t=t||function(){},n=this.coreEditor.getEditorProps(),null==e&&((e={}).shareKey=n.shareKey,e.sessionType=n.sessionType,null!=n.sessionId&&(e.sessionId=n.sessionId)),e.buildVersion=n.buildVersion,e.userInfo=n.userInfo,e.collabServer=n.collabServer,null==e.shareKey||"undefined"===e.shareKey)return t({resultCode:0,message:"shareKey should NOT be null"}),0;this.closeCollabSession(),this.coreEditor.buildCollabSession(e,t),o=1}catch(e){t({resultCode:0,message:e.message})}return o},t.prototype.closeCollabSession=function(){this.coreEditor.closeCollabSession(n.WSEVENTID_HOST_CLOSE,"NormalQuit")},t.prototype.getCollabContent=function(e,t){var n;e=e||function(){};try{return this.coreEditor&&this.coreEditor.isCollabEnabled()?n=this.coreEditor.getCollabContent(e,t):(e(n={status:2,resultCode:2,message:"Not-Collab-Enabled"}),n)}catch(t){return e(n={status:3,resultCode:3,message:t.message}),n}},t.prototype.getModifiers=function(e,t){var n;t=t||function(){};try{return this.coreEditor&&this.coreEditor.isCollabEnabled()?this.coreEditor.getModifiers(e,t):(t(n={status:2,resultCode:2,message:"Not-Collab-Enabled"}),n)}catch(e){return t(n={status:3,resultCode:3,message:e.message}),n}},t.prototype.isReadyToClose=function(){var e=!0;return this.coreEditor&&!this.coreEditor.isLegacyHost()?(i.debugAlert("isReadyToClose should NOT be called in new host"),!1):(this.coreEditor&&this.coreEditor.isCollabEnabled()&&(e=!this.coreEditor.hasCachedDataCmd()),e)},t.prototype.reset=function(){this.coreEditor.reset()},t.prototype.resetEditorOptions=function(e){!this.coreEditor||this.coreEditor.isLegacyHost()?this.coreEditor.updateEditorOptions(e):i.debugAlert("resetEditorOptions should NOT be called in new Host")},t.prototype.saveNotification=function(e,t){this.coreEditor&&this.coreEditor.isCollabEnabled()&&this.coreEditor.saveNotification(e,t)},t.prototype.toggleAttendeeHint=function(e){!this.coreEditor||this.coreEditor.isLegacyHost()||i.debugAlert("toggleAttendeeHint should NOT be called in New Host")},t.prototype.destroyCollabEngine=function(){this.closeCollabSession()},t.prototype.isNotSetContent=function(){return this.coreEditor.isNotSetContent()},t.prototype.saveFile=function(e){this.coreEditor.testSendMsgToCollabServer(e)},t}(o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i,r,s=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});o=[n,t,n(0),n(6),n(17),n(1)],void 0===(i=function(e,t,n,o,i,r){"use strict";return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.focus=function(){return this.coreEditor.focus()},t.prototype.getContent=function(e,t,n,o){e=!!e||this.coreEditor.hasHandWriteBlock(),o=!!o;try{return!0===e?this.coreEditor.getHtmlContent(o,t,n):this.coreEditor.getXmlContent(t,n)}catch(e){null!=t&&t({status:0,resultCode:2,message:e.message})}},t.prototype.getNoteVersion=function(){return this.coreEditor.getNoteVersion()},t.prototype.getSchemaVersion=function(){return this.coreEditor.getSchemaVersion()},t.prototype.resetFont=function(){return this.coreEditor.resetFont()},t.prototype.setAllBackgrounds=function(e,t){if(!this.coreEditor||this.coreEditor.isLegacyHost())return this.coreEditor.setAllBackgrounds(e,t);r.debugAlert("setAllBackgrounds shoud NOT be called in new host")},t.prototype.setBackground=function(e){if(!this.coreEditor||this.coreEditor.isLegacyHost()||!this.coreEditor.isNotSetContent())return this.coreEditor.setBackground(e);r.debugAlert("setBackground shoud NOT be called before setContent")},t.prototype.setContent=function(e,t,i,s,a){var l=this;try{var c=function(e){l.coreEditor.isCollabEnabled()&&1===e.resultCode&&l.coreEditor.noteSetNotification(),null!=a&&a(e)};null==s&&(s=this.options||{}),s=n.defaults(s,{bgImageId:o.DEFAULT_BACKGROUND,disableBackground:!1,isCollabEnabled:!1,isReadOnly:!1,isAsync:!1}),!0===t?this.coreEditor.setHtmlContent(e,i,s,c):this.coreEditor.setXmlContent(e,i,s,c)}catch(e){r.error(e),null!=a&&a({resultCode:0,message:e.message})}},t.prototype.setFont=function(e,t){return this.coreEditor.setFont(e,t)},t.prototype.setReadOnly=function(e){!this.coreEditor||this.coreEditor.isLegacyHost()?this.coreEditor.setReadOnly(e):r.debugAlert("setReadOnly shoud NOT be called in new host")},t.prototype.setDragProhibited=function(e){this.coreEditor.setDragProhibited(e)},t.prototype.setCopyProhibited=function(e){this.coreEditor.setReadOnly(e)},t.prototype.setEntity=function(e,t){null!=e&&n.isString(e)&&""!==e.trim()&&(e=JSON.parse(e)),this.coreEditor.setEntity(e,t)},t.prototype.refreshPageMode=function(){var e=this.coreEditor.getNote();e&&e.blocks&&e.blocks[0]&&e.blocks[0].trigger("content-change")},t.prototype.initialize=function(e){},t}(i)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o,i;o=[n,t,n(0),n(515)],void 0===(i=function(e,t,n,o){"use strict";return n.union(["require-innerlink","find"],o)}.apply(t,o))||(e.exports=i)},function(e,t,n){var o;void 0===(o=function(e,t){"use strict";return["content-change","insert-photo","insert-link","insert-attachment","replace-image","replace-attachment","open-link","download-attachment","get-entity","download-image","preview-image","context-menu","show-words","save-content","blob-paste","upload-image","clipboard-error","mac-preview","background-failed-update","background-changed","is-vip-user","table-click","image-ocr","collabsession-change","datacommand-success","session-built","session-closed","session-initialized","useraction-failed","user-action-collection","view-mode-change","note-version-change"]}.apply(t,[n,t]))||(e.exports=o)},function(e,t){},,,,,,,,,function(e,t){}])});